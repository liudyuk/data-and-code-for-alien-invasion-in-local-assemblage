---
title: "test the invasion in island"
output: html_document
---

```{r}
#explain the code for testing the invasion in islands.
#0. identifying the assmebalges whther is on a island or not.
#1-3. testing the full model (=LU*LUI) without sampling area or with sampling area. Check the AIC and P values for alien incidence, species number and proportions separately.
#4. testing the subset model without sampling area or with sampling area for each taxa.Check the AIC and P values for alien incidence, species number and proportions separately.
#5 validating the models by leaving island out and then calculate the mean and se. Run the models for alien incidence, species number and proportions separately.

```


##import the packages
```{r}
#install the packages and library
#install.packages("lme4")
#install.packages("emmeans")
#install.packages("tidyverse")
#install.packages("data.table")
#install.packages("lme4")
#install.packages("ggplot2")
#install.packages("DHARMa")
library(lme4)
library(data.table)
library(emmeans)
library(multcomp)
library(lme4)
library(ggplot2)
library(tidyverse)
library(DHARMa)
```

#0.use the data to iden island
```{r}
db<-read.csv(file = '...data.csv',sep=";",stringsAsFactors=T)
#the alien ratio is wrong
db$alien_all<-with(db,alien_freq/pred_freq)
levels(as.factor(db$LU))
db$LU<-
  factor(db$LU,c("Primary","SV","Plantation","Pasture","Cropland","Urban"))
levels(as.factor(db$LUI))
db$LUI<-
  factor(db$LUI,c("Cannot decide","Minimal use","Light use","Intense use"))
#run on the right
db%>%summarise(tax_count=plyr::count(taxa))
# Alien presence/absence for logistical model. 
db$Alien.presence <- as.logical(db$alien_freq)
db$alien_prop <- db$alien_freq / db$pred_freq
# alien proportion contains 1, therefore apply lemon squeezer following Smithson M, Verkuilen J (2006). "A Better Lemon Squeezer? Maximum-Likelihood Regression with Beta-Distributed Dependent Variables." Psychological Methods, 11 (1), 54-71
db$alien_prop_squeezed <- (db$alien_prop * (nrow(db)-1) + 0.5) / nrow(db)
```

```{r}
db.island<-db[,c("SSBS","Longitude", "Latitude")]

#read the shape folder from from wayne and can get the shpe file directly
require(sf,warn.conflicts = F,quietly = T)
#need to decompress the folder and then read
level4 <- read_sf(dsn = '/.../Weigelt_etal_2013_PNAS_Islands (1)')
#check the predict sites in the polygam in the shape file
site_sf <- 
  st_as_sf(db.island, coords = c( 'Longitude','Latitude'), crs = st_crs(level4))
#need to add this from https://github.com/r-spatial/sf/issues/1762
sf_use_s2(FALSE)
siteinl4 <- site_sf %>% mutate(
  intersection = as.integer(st_intersects(geometry, level4))
  , area = if_else(is.na(intersection), 'NA', level4$Level4_cod[intersection]))
siteinl4<-siteinl4%>%drop_na(intersection)%>%subset(select=c(SSBS))
siteinl4$island_continent<-c("Island")
#combine together
db<-merge(db,siteinl4,by="SSBS", all.x = T)
names(db)
db<-db %>%mutate_at(c('island_continent'), ~replace_na(.,"continent"))
```




```{r}
#add the sampling size for the local assemblages
# check predict
df.sites<- fread(file = '/.../sites.csv', header = T,na.strings=c("","NA"))
#add the lat and lon since some studies do not have
df.sites[df.sites$Reference=="Garden et al. 2010","Longitude"]<-153.01
df.sites[df.sites$Reference=="Garden et al. 2010","Latitude"]<--27.28

df.sites[df.sites$Reference=="Gardner et al. 2008","Longitude"]<--52
df.sites[df.sites$Reference=="Gardner et al. 2008","Latitude"]<--1
#Kapoor 2008
df.sites[df.sites$Reference=="Kapoor 2008","Longitude"]<-76.49
df.sites[df.sites$Reference=="Kapoor 2008","Latitude"]<-10.2
#Rosselli 2011
df.sites[df.sites$Reference=="Rosselli 2011","Longitude"]<- -73.58
df.sites[df.sites$Reference=="Rosselli 2011","Latitude"]<- 4.58

df.sites[df.sites$Reference=="Liu et al. 2012","Longitude"]<- 40.47
df.sites[df.sites$Reference=="Liu et al. 2012","Latitude"]<- 114.47
names(df.sites)
names(df.sites)[25]<-c("size")
df.sites.local<-df.sites%>%subset(select=c(20,25))%>%distinct(SSBS, size, .keep_all = TRUE)

#merge teh data with local size
db.size<-merge(db,df.sites.local,by="SSBS",all.x=T)
#logged the plot size in the model
db.size$size<-with(db.size,log(size))
hist(db.size$size)
dplyr::count(db.size,taxa,island_continent)
```



#1) non-native incidence
```{r}
db.full.test <- subset(db.size,!(LU %in% "Urban" & LUI %in%"Intense use"))
#1change the refernce for LU
levels(db.full.test$LU)
db.full.test$LU = factor(db.full.test$LU, levels=c("Primary","SV","Plantation","Cropland","Pasture","Urban"))
levels(db.full.test$LUI)
db.full.test$LUI = factor(db.full.test$LUI, levels=c("Minimal use", "Light use","Intense use","Cannot decide"))
```

#1_1) test two models
```{r}
#1 the model in the paper, with SS/SSB in the random factor
m_paper <- glmer(Alien.presence ~ LU*LUI + (1|SS/SSB) , 
          data = db.full.test , family = binomial , 
          control = glmerControl(optimizer = "bobyqa" , 
                                 optCtrl = list(maxfun = 1e5)),
           nAGQ = 1 , subset = as.vector(db.full.test$LUI != "Cannot decide"))
#2 adding plot size into the model
m_size <- glmer(Alien.presence ~ LU*LUI +size+ (1|SS/SSB) , 
          data = db.full.test , family = binomial , 
          control = glmerControl(optimizer = "bobyqa" , 
                                 optCtrl = list(maxfun = 1e5)),
           nAGQ = 1 , subset = as.vector(db.full.test$LUI != "Cannot decide"))
#AIC(m_paper,m_size)
#anova(m_paper,m_size)# p=0.968, no significance for the two models
summary(m_paper);summary(m_size) #No differences for the variables, see below

#conclusion: There is no significance for the size (p=0.821651) when adding the size into the statistical model. See below.
```
#model result
```{r}
####

#Fixed effects:
#                            Estimate Std. Error z value Pr(>|z|)    
#(Intercept)                 -5.40962    0.44369 -12.192  < 2e-16 ***
#LUSV                         1.48449    0.20474   7.250 4.15e-13 ***
#LUPlantation                 1.79626    0.40346   4.452 8.50e-06 ***
#LUCropland                   2.23163    0.39763   5.612 2.00e-08 ***
#LUPasture                    2.63490    0.32538   8.098 5.59e-16 ***
#LUUrban                      2.20741    0.46106   4.788 1.69e-06 ***
#LUILight use                 0.32010    0.17834   1.795  0.07266 .  
#LUIIntense use               1.34429    0.35140   3.826  0.00013 ***
#LUSV:LUILight use           -0.97712    0.30226  -3.233  0.00123 ** 
#LUPlantation:LUILight use    0.33450    0.47664   0.702  0.48281    
#LUCropland:LUILight use     -1.61187    0.55906  -2.883  0.00394 ** 
#LUPasture:LUILight use      -1.02538    0.34483  -2.974  0.00294 ** 
#LUUrban:LUILight use         0.00694    0.63810   0.011  0.99132    
#LUSV:LUIIntense use         -1.13143    0.44572  -2.538  0.01113 *  
#LUPlantation:LUIIntense use -1.27681    0.62256  -2.051  0.04028 *  
#LUCropland:LUIIntense use   -0.11954    0.58386  -0.205  0.83777    
#LUPasture:LUIIntense use    -1.85822    0.66227  -2.806  0.00502 ** 
#---
#Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
#
#Correlation matrix not shown by default, as p = 17 > 12.
#Use print(x, correlation=TRUE)  or
#    vcov(x)        if you need it
#

#Random effects:
# Groups Name        Variance Std.Dev.
# SSB:SS (Intercept)  1.015   1.008   
# SS     (Intercept) 18.124   4.257   
#Number of obs: 8899, groups:  SSB:SS, 683; SS, 198
#
#Fixed effects:
#                            Estimate Std. Error z value Pr(>|z|)    
#(Intercept)                 -5.52462    0.92361  -5.982 2.21e-09 ***
#LUSV                         1.52130    0.21020   7.238 4.57e-13 ***
#LUPlantation                 2.03267    0.42797   4.750 2.04e-06 ***
#LUCropland                   2.11598    0.43229   4.895 9.84e-07 ***
#LUPasture                    2.70470    0.33240   8.137 4.05e-16 ***
#LUUrban                      2.25333    0.46177   4.880 1.06e-06 ***
#LUILight use                 0.37788    0.18233   2.072 0.038223 *  
#LUIIntense use               1.47651    0.35692   4.137 3.52e-05 ***
#size                         0.03269    0.14450   0.226 0.821045    
#LUSV:LUILight use           -0.98721    0.30890  -3.196 0.001394 ** 
#LUPlantation:LUILight use    0.02663    0.49788   0.053 0.957344    
#LUCropland:LUILight use     -1.87547    0.59832  -3.135 0.001721 ** 
#LUPasture:LUILight use      -1.08263    0.35187  -3.077 0.002092 ** 
#LUUrban:LUILight use        -0.02727    0.64034  -0.043 0.966030    
#LUSV:LUIIntense use         -1.00493    0.46307  -2.170 0.029997 *  
#LUPlantation:LUIIntense use -1.87543    0.66310  -2.828 0.004680 ** 
#LUCropland:LUIIntense use   -0.14031    0.61141  -0.229 0.818490    
#LUPasture:LUIIntense use    -2.35010    0.70343  -3.341 0.000835 ***
#---
#Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
#
#Correlation matrix not shown by default, as p = 18 > 12.
#Use print(x, correlation=TRUE)  or
#    vcov(x)        if you need it
#
#fit warnings:
#fixed-effect model matrix is rank deficient so dropping 1 column / coefficient
```

#2) non-native number
```{r}
db_alien <- subset(db.size, alien_freq > 0)
levels(db_alien$LU)
db_alien$LU<-
  factor(db_alien$LU,c("Primary","SV","Plantation","Pasture","Cropland","Urban"))
# reorder LU-intensity
db_alien$LUI <- factor(db_alien$LUI , levels = c("Minimal use" , "Light use" , "Intense use" , "Cannot decide"))
```
#2_1 test the models
```{r}
#1)the model in the paper, with SS/SSB in the random factor
m_paper <- glmer(alien_freq ~ LU*LUI + (1|SS/SSB) , data = db_alien , family = poisson , 
           control = glmerControl(optimizer = "bobyqa" , 
                                  optCtrl = list(maxfun = 1e5)) , 
           nAGQ = 1 , subset = as.vector(db_alien$LUI != "Cannot decide"))
#2)adding model, with SS/SSB/Biome in the random factor
m_adding_size <- glmer(alien_freq ~ LU*LUI +size+ (1|SS/SSB) , data = db_alien , family = poisson , 
           control = glmerControl(optimizer = "bobyqa" , 
                                  optCtrl = list(maxfun = 1e5)) , 
           nAGQ = 1 , subset = as.vector(db_alien$LUI != "Cannot decide"))

summary(m_paper);summary(m_adding_size) 

#Conclusion: No significance for the size (p=0.659588) in the model, see below.
```
##model result
```{r}
#1) summary result for m_paper= glmer(alien_freq ~ LU*LUI + (1|SS/SSB)
#Fixed effects:
#                            Estimate Std. Error z value Pr(>|z|)    
#(Intercept)                 -0.06165    0.08633  -0.714 0.475149    
#LUSV                         0.65267    0.07745   8.427  < 2e-16 ***
#LUPlantation                 0.76349    0.17692   4.315 1.59e-05 ***
#LUPasture                    0.46811    0.12574   3.723 0.000197 ***
#LUCropland                   0.65042    0.09892   6.575 4.86e-11 ***
#LUUrban                      0.69688    0.13850   5.032 4.86e-07 ***
#LUILight use                 0.36000    0.08205   4.387 1.15e-05 ***
#LUIIntense use               0.59567    0.15097   3.946 7.96e-05 ***
#LUSV:LUILight use           -0.48426    0.12360  -3.918 8.93e-05 ***
#LUPlantation:LUILight use   -0.56676    0.20863  -2.717 0.006596 ** 
#LUPasture:LUILight use      -0.24346    0.13715  -1.775 0.075881 .  
#LUCropland:LUILight use     -0.81960    0.11914  -6.880 6.00e-12 ***
#LUUrban:LUILight use        -0.37003    0.17861  -2.072 0.038292 *  
#LUSV:LUIIntense use         -0.75437    0.19962  -3.779 0.000157 ***
#LUPlantation:LUIIntense use -1.18997    0.26640  -4.467 7.94e-06 ***
#LUPasture:LUIIntense use    -0.50842    0.24472  -2.077 0.037756 *  
#LUCropland:LUIIntense use   -0.94804    0.18202  -5.209 1.90e-07 ***
#LUUrban:LUIIntense use      -0.60537    0.24613  -2.460 0.013909 *  
#---

#2) summar result for m_adding_size =glmer(alien_freq ~ LU*LUI +size+ (1|SS/SSB)
#Fixed effects:
#                            Estimate Std. Error z value Pr(>|z|)    
#(Intercept)                 -0.02890    0.18574  -0.156 0.876342    
#LUSV                         0.62934    0.07823   8.045 8.62e-16 ***
#LUPlantation                 0.87751    0.17815   4.926 8.41e-07 ***
#LUPasture                    0.47559    0.12870   3.695 0.000220 ***
#LUCropland                   0.67224    0.14632   4.594 4.34e-06 ***
#LUUrban                      0.71795    0.13668   5.253 1.50e-07 ***
#LUILight use                 0.38089    0.08254   4.615 3.94e-06 ***
#LUIIntense use               0.60016    0.14884   4.032 5.52e-05 ***
#size                        -0.01612    0.03659  -0.440 0.659588    
#LUSV:LUILight use           -0.45907    0.12435  -3.692 0.000223 ***
#LUPlantation:LUILight use   -0.62945    0.21081  -2.986 0.002828 ** 
#LUPasture:LUILight use      -0.25610    0.14063  -1.821 0.068602 .  
#LUCropland:LUILight use     -0.91442    0.17360  -5.267 1.38e-07 ***
#LUUrban:LUILight use        -0.39710    0.17745  -2.238 0.025232 *  
#LUSV:LUIIntense use         -0.73493    0.19862  -3.700 0.000216 ***
#LUPlantation:LUIIntense use -1.27290    0.26874  -4.737 2.17e-06 ***
#LUPasture:LUIIntense use    -0.44913    0.28389  -1.582 0.113635    
#LUCropland:LUIIntense use   -0.99462    0.21139  -4.705 2.54e-06 ***
#LUUrban:LUIIntense use      -0.59748    0.24365  -2.452 0.014197 *  
#---
#Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

```
#3) Non-native proportion
```{r}
# make proportion of aliens
db_alien$alien_prop <- db_alien$alien_freq / db_alien$pred_freq
summary(db_alien$alien_prop)
# alien proportion contains 1, therefore apply lemon squeezer following Smithson M, Verkuilen J (2006). "A Better Lemon Squeezer? Maximum-Likelihood Regression with Beta-Distributed Dependent Variables." Psychological Methods, 11 (1), 54-71
db_alien$alien_prop_squeezed <- (db_alien$alien_prop * (nrow(db_alien)-1) + 0.5) / nrow(db_alien)


```
#3_1 test the models
```{r}
#1)the model in the paper, with SS/SSB in the random factor
library(glmmTMB)
m_paper <- glmmTMB(alien_prop_squeezed ~ LU*LUI + (1|SS/SSB) , data = db_alien[db_alien$LUI != "Cannot decide" , ] , 
                   family = beta_family)
#2)adding model, with SS/SSB/Biome in the random factor
m_adding_size <- glmmTMB(alien_prop_squeezed ~ LU*LUI +size+ (1|SS/SSB) , data = db_alien[db_alien$LUI != "Cannot decide" , ] , 
                    family = beta_family)
summary(m_paper);summary(m_adding_size) 

#Conclusion: No significance for the size (p=0.421732) in the model, see below.
```
##model result
```{r}
#1) summary result for m_paper= glmmTMB(alien_prop_squeezed ~ LU*LUI + (1|SS/SSB)
#Conditional model:
#                            Estimate Std. Error z value Pr(>|z|)    
#(Intercept)                 -1.28339    0.17722  -7.242 4.43e-13 ***
#LUSV                         0.19001    0.09856   1.928 0.053876 .  
#LUPlantation                 0.28103    0.22568   1.245 0.213030    
#LUPasture                    0.19162    0.13958   1.373 0.169797    
#LUCropland                   0.82033    0.15323   5.354 8.62e-08 ***
#LUUrban                      0.58070    0.15981   3.634 0.000279 ***
#LUILight use                 0.17019    0.09526   1.787 0.074000 .  
#LUIIntense use               0.56171    0.20036   2.804 0.005055 ** 
#LUSV:LUILight use           -0.16346    0.14505  -1.127 0.259787    
#LUPlantation:LUILight use    0.03352    0.25031   0.134 0.893456    
#LUPasture:LUILight use      -0.03894    0.15005  -0.260 0.795218    
#LUCropland:LUILight use     -0.68359    0.18608  -3.674 0.000239 ***
#LUUrban:LUILight use        -0.12085    0.19361  -0.624 0.532509    
#LUSV:LUIIntense use         -0.20110    0.23029  -0.873 0.382533    
#LUPlantation:LUIIntense use -0.04982    0.32667  -0.153 0.878792    
#LUPasture:LUIIntense use    -0.43216    0.27919  -1.548 0.121645    
#LUCropland:LUIIntense use   -1.03100    0.25802  -3.996 6.45e-05 ***
#LUUrban:LUIIntense use      -0.19149    0.32285  -0.593 0.553092    


#2) summar result for aading _size= glmmTMB(alien_prop_squeezed ~ LU*LUI +size+ (1|SS/SSB)
#Conditional model:
#                            Estimate Std. Error z value Pr(>|z|)    
#(Intercept)                 -0.92458    0.41124  -2.248 0.024559 *  
#LUSV                         0.18511    0.09996   1.852 0.064043 .  
#LUPlantation                 0.33568    0.23334   1.439 0.150262    
#LUPasture                    0.18366    0.14492   1.267 0.205052    
#LUCropland                   0.65107    0.18798   3.463 0.000533 ***
#LUUrban                      0.58121    0.16086   3.613 0.000303 ***
#LUILight use                 0.17890    0.09688   1.847 0.064792 .  
#LUIIntense use               0.56639    0.20105   2.817 0.004846 ** 
#size                        -0.06355    0.07910  -0.803 0.421732    
#LUSV:LUILight use           -0.11283    0.14816  -0.762 0.446326    
#LUPlantation:LUILight use    0.03406    0.25915   0.131 0.895418    
#LUPasture:LUILight use      -0.03049    0.15572  -0.196 0.844749    
#LUCropland:LUILight use     -0.54505    0.22430  -2.430 0.015097 *  
#LUUrban:LUILight use        -0.13306    0.19557  -0.680 0.496263    
#LUSV:LUIIntense use         -0.19323    0.23139  -0.835 0.403688    
#LUPlantation:LUIIntense use -0.07714    0.33342  -0.231 0.817023    
#LUPasture:LUIIntense use    -0.35689    0.32384  -1.102 0.270442    
#LUCropland:LUIIntense use   -0.86180    0.28311  -3.044 0.002334 ** 
#LUUrban:LUIIntense use      -0.20243    0.32497  -0.623 0.533331    
#---
#Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
```


#4.test islands and contiennts in random factor

```{r}
db_alien <- subset(db.size, alien_freq > 0)
levels(db_alien$LU)
db_alien$LU<-
  factor(db_alien$LU,c("Primary","SV","Plantation","Pasture","Cropland","Urban"))
# reorder LU-intensity
db_alien$LUI <- factor(db_alien$LUI , levels = c("Minimal use" , "Light use" , "Intense use" , "Cannot decide"))


dplyr::count(db,taxa,island_continent)
dplyr::count(db_alien,taxa,island_continent)
```
##4_1) non-native incidence
```{r}
#we condidered to add the island and continents into the random factor and then test the difference wiht the model we used inthe paper. we can compare 1) AIC values, anova and summary result.

db.full.test <- subset(db.size,!(LU %in% "Urban" & LUI %in%"Intense use"))
#1change the refernce for LU
levels(db.full.test$LU)
db.full.test$LU = factor(db.full.test$LU, levels=c("Primary","SV","Plantation","Cropland","Pasture","Urban"))
levels(db.full.test$LUI)
db.full.test$LUI = factor(db.full.test$LUI, levels=c("Minimal use","Light use","Intense use","Cannot decide"))



#1 the model in the paper, with SS/SSB in the random factor
m_paper <- glmer(Alien.presence ~ LU*LUI + (1|SS/SSB) , 
          data = db.full.test , family = binomial , 
          control = glmerControl(optimizer = "bobyqa" , 
                                 optCtrl = list(maxfun = 1e5)),
           nAGQ = 1 , subset = as.vector(db.full.test$LUI != "Cannot decide"))
#2 adding island_continent in model, as the random factor
m_adding <- glmer(Alien.presence ~ LU*LUI + (1|SS/SSB/island_continent) , 
          data = db.full.test , family = binomial , 
          control = glmerControl(optimizer = "bobyqa" , 
                                 optCtrl = list(maxfun = 1e5)),
           nAGQ = 1 , subset = as.vector(db.full.test$LUI != "Cannot decide"))

AIC(m_paper);AIC(m_adding)# deltAIC < 2
anova(m_paper,m_adding)# p=0.2045, no significance for the two models
```
###overll
```{r}
####part1: run the model 
names(db.size)
levels(db.size$LU)
db.size$LU = factor(db.size$LU, levels=c("Pasture","Urban","Cropland", "Plantation","SV", "Primary"))

#0 the model used in the paper
m_paper <- glmer(Alien.presence ~ LU+ (1|SS/SSB) , data = db.size , family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )
#2 adding the factor of island and continent in the random facotr
m_adding <- glmer(Alien.presence ~ LU+ (1|SS/SSB/island_continent) , data = db.size , family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )
AIC(m_paper);AIC(m_adding)# deltAIC < 2
anova(m_paper,m_adding)# p=0.97, no significance for the two models

```
###ants
```{r}
db.size.t<-db.size[db.size$taxa=="Ants",]
levels(db.size.t$LU)
db.size.t$LU<-
  factor(db.size.t$LU,c("Urban","SV","Plantation","Pasture","Cropland","Primary"))
#0 the model used in the paper
dplyr::count(db.size.t,Biome)
m_paper <- glmer(Alien.presence ~ LU+ (1|SS/SSB) , data = db.size.t , family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )
m_adding <- glmer(Alien.presence ~ LU+ (1|SS/SSB/island_continent) , data = db.size.t , family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )
AIC(m_paper);AIC(m_adding)# deltAIC < 2
anova(m_paper,m_adding)# p=0.9998, no significance for the two models
```


###birds
```{r}
db.size.t<-db.size[db.size$taxa=="Birds",]
levels(db.size.t$LU)
db.size.t$LU<-
  factor(db.size.t$LU,c("Urban","SV","Plantation","Pasture","Cropland","Primary"))
db.size.t<-subset(db.size.t,!(LU %in% "Urban" & taxa %in%"Birds"))
db.size.t<-subset(db.size.t,!(LU %in% "Cropland" & taxa %in%"Birds"))
#0 the model used in the paper
dplyr::count(db.size.t,Biome)
m_paper <- glmer(Alien.presence ~ LU+ (1|SS/SSB) , data = db.size.t , family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )
m_adding <- glmer(Alien.presence ~ LU+ (1|SS/SSB/island_continent) , data = db.size.t , family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )
AIC(m_paper);AIC(m_adding)# deltAIC < 2
anova(m_paper,m_adding)# p=0.7564, no significance for the two models

```
###mammals
```{r}
db.size.t<-db.size[db.size$taxa=="Mammals",]
levels(db.size.t$LU)
db.size.t$LU<-
  factor(db.size.t$LU,c("Urban","SV","Plantation","Pasture","Cropland","Primary"))
db.size.t<-subset(db.size.t,!(LU %in% "Urban" & taxa %in%"Mammals"))
db.size.t<-subset(db.size.t,!(LU %in% "Cropland" & taxa %in%"Mammals"))
#0 the model used in the paper
dplyr::count(db.size.t,Biome)
m_paper <- glmer(Alien.presence ~ LU+ (1|SS/SSB) , data = db.size.t , family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )
m_adding <- glmer(Alien.presence ~ LU+ (1|SS/SSB/island_continent) , data = db.size.t , family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )
AIC(m_paper);AIC(m_adding)# deltAIC < 2
anova(m_paper,m_adding)# p=0.9998, no significance for the two models
```
###spiders
```{r}
db.size.t<-db.size[db.size$taxa=="Spiders",]
levels(db.size.t$LU)
db.size.t$LU<-
  factor(db.size.t$LU,c("Urban","SV","Plantation","Pasture","Cropland","Primary"))
db.size.t<-subset(db.size.t,!(LU %in% "Urban" & taxa %in%"Spiders"))
db.size.t<-subset(db.size.t,!(LU %in% "Plantation" & taxa %in%"Spiders"))
#0 the model used in the paper
dplyr::count(db.size.t,Biome)
m_paper <- glmer(Alien.presence ~ LU+ (1|SS/SSB) , data = db.size.t , family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )
m_adding <- glmer(Alien.presence ~ LU+ (1|SS/SSB/island_continent) , data = db.size.t , family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )
AIC(m_paper);AIC(m_adding)# deltAIC < 2
anova(m_paper,m_adding)# p=0.9998, no significance for the two models
```
###plants
```{r}
db.size.t<-db.size[db.size$taxa=="Vascular plants",]
levels(db.size.t$LU)
db.size.t$LU<-
  factor(db.size.t$LU,c("Urban","SV","Plantation","Pasture","Cropland","Primary"))
db.size.t<-subset(db.size.t,!(LU %in% "Urban" & taxa %in%"Vascular plants"))
#0 the model used in the paper
dplyr::count(db.size.t,Biome)
m_paper <- glmer(Alien.presence ~ LU+ (1|SS/SSB) , data = db.size.t , family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )
m_adding <- glmer(Alien.presence ~ LU+ (1|SS/SSB/island_continent) , data = db.size.t , family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )
AIC(m_paper);AIC(m_adding)# deltAIC < 2
anova(m_paper,m_adding)# p=0.9998, no significance for the two models

```
##4_2 non-native number
```{r}
db_alien <- subset(db.size , alien_freq > 0)
levels(db_alien$LU)
db_alien$LU<-
  factor(db_alien$LU,c("Primary","SV","Plantation","Pasture","Cropland","Urban"))
# reorder LU-intensity
db_alien$LUI <- factor(db_alien$LUI , levels = c("Minimal use" , "Light use" , "Intense use" , "Cannot decide"))
```
###overall full model
```{r}
#1)the model in the paper, with SS/SSB in the random factor
m_paper <- glmer(alien_freq ~ LU*LUI + (1|SS/SSB) , data = db_alien , family = poisson , 
           control = glmerControl(optimizer = "bobyqa" , 
                                  optCtrl = list(maxfun = 1e5)) , 
           nAGQ = 1 , subset = as.vector(db_alien$LUI != "Cannot decide"))
#2)adding model, with SS/SSB/Biome in the random factor
m_adding <- glmer(alien_freq ~ LU*LUI + (1|SS/SSB/island_continent) , data = db_alien , family = poisson , 
           control = glmerControl(optimizer = "bobyqa" , 
                                  optCtrl = list(maxfun = 1e5)) , 
           nAGQ = 1 , subset = as.vector(db_alien$LUI != "Cannot decide"))
AIC(m_paper);AIC(m_adding)# deltAIC = 2
anova(m_paper,m_adding)# p=0.9998, no significance for the two models
#No differences for the variables, see below
```

### overall subset model
```{r}
m_paper  <- glmer(alien_freq ~ LU + (1|SS/SSB), data = db_alien , family = poisson)
m_adding  <- glmer(alien_freq ~ LU + (1|SS/SSB/island_continent), data = db_alien , family = poisson)

AIC(m_paper);AIC(m_adding)# deltAIC = 2
anova(m_paper,m_adding)# p=1, no significance for the two models
#No differences for the variables, see below
```


####Ants
```{r}
db.ant<-db_alien[db_alien$taxa=="Ants",]
m_paper <- glmer(alien_freq ~ LU + (1|SS), data = db.ant , family = poisson)
m_adding <- glmer(alien_freq ~ LU + (1|SS/island_continent), data = db.ant , family = poisson)
AIC(m_paper);AIC(m_adding)# deltAIC = 2
anova(m_paper,m_adding)# p=0.9999, no significance for the two models
#No differences for the variables, see below
```

####Birds
```{r}
db.bird<-db_alien[db_alien$taxa=="Birds",]
library(glmmTMB)
m_paper <- glmmTMB(alien_freq ~ LU + (1|SS) , data = db.bird , family = compois)
m_adding <- glmmTMB(alien_freq ~ LU + (1|SS/island_continent) , data = db.bird , family = compois)
AIC(m_paper);AIC(m_adding)# deltAIC = 2
anova(m_paper,m_adding)# p=1, no significance for the two models
#No differences for the variables, see below
```

####Spiders
```{r}
db.spider<-db_alien[db_alien$taxa=="Spiders",]
m_paper <- glmmTMB(alien_freq ~ LU + (1|SS) , data = db.spider , family = compois)
m_adding <- glmmTMB(alien_freq ~ LU + (1|SS/island_continent) , data = db.spider , family = compois)
AIC(m_paper);AIC(m_adding)# deltAIC = 2
anova(m_paper,m_adding)# p=1, no significance for the two models
#No differences for the variables, see below
```

####Plants
```{r}
db.plant<-db_alien[db_alien$taxa=="Vascular plants",]
m_paper <- glmer(alien_freq ~ LU + (1|SS/SSB) , data = db.plant, family = poisson)
m_adding <- glmer(alien_freq ~ LU + (1|SS/SSB/island_continent) , data = db.plant, family = poisson)
AIC(m_paper);AIC(m_adding)# deltAIC = 2
anova(m_paper,m_adding)# p=1, no significance for the two models
#No differences for the variables, see below

```

#4_3non-native proportions
```{r}
db_alien<-db.size[db.size$alien_freq>0,]

```

###all taxa full model
```{r}
#1)the model in the paper, with SS/SSB in the random factor
library(glmmTMB)
m_paper <- glmmTMB(alien_prop_squeezed ~ LU*LUI + (1|SS/SSB) , data = db_alien[db_alien$LUI != "Cannot decide" , ] , family = beta_family)
#2)adding model, with SS/SSB/Biome in the random factor
m_adding <- glmmTMB(alien_prop_squeezed ~ LU*LUI + (1|SS/SSB/island_continent) , data = db_alien[db_alien$LUI != "Cannot decide" , ] , 
                    family = beta_family)
AIC(m_paper);AIC(m_adding)# deltAIC = 2
anova(m_paper,m_adding)# p=0.9996, no significance for the two models
#No differences for the variables, see below
```

### all taxa subset model
```{r}
m_paper  <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS) , data = db_alien, family = beta_family)
dplyr::count(db_alien,LU,island_continent)
m_adding  <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS/island_continent) , data = db_alien, family = beta_family)
#summary(m_adding)
AIC(m_paper);AIC(m_adding)# deltAIC < 2
anova(m_paper,m_adding)# p=1, no significance for the two models
#No differences for the variables, see below
```

####Ants
```{r}
db_alien.t<-db_alien[db_alien$taxa=="Ants",]
m_paper <-  glmmTMB(alien_prop_squeezed ~ LU + (1|SS) , data = db_alien.t, family = beta_family)
m_adding <-  glmmTMB(alien_prop_squeezed ~ LU + (1|SS/island_continent) , data = db_alien.t, family = beta_family)

AIC(m_paper);AIC(m_adding)# deltAIC = 2
anova(m_paper,m_adding)# p=1, no significance for the two models
#No differences for the variables, see below
```

####Birds
```{r}
db_alien.t<-db_alien[db_alien$taxa=="Birds",]
levels(db_alien.t$island_continent)
dplyr::count(db_alien.t,LU,island_continent)
m_paper <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS/SSB) , data = db_alien.t, family = beta_family)
m_adding <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS/SSB/island_continent) , data = db_alien.t, family = beta_family)
AIC(m_paper);AIC(m_adding)# deltAIC = 2
anova(m_paper,m_adding)# p=1, no significance for the two models
#No differences for the variables
```

####mammals
```{r}
db_alien.t<-db_alien[db_alien$taxa=="Mammals",]
db_alien.t<-db_alien.t[db_alien.t$LU!="Cropland",]
m_paper <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS) , data = db_alien.t, family = beta_family)
m_adding <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS/island_continent) , data = db_alien.t, family = beta_family)
AIC(m_paper);AIC(m_adding)# deltAIC = 2
anova(m_paper,m_adding)# p=1, no significance for the two models
#No differences for the variables, see below
```


####Spiders
```{r}
db_alien.t<-db_alien[db_alien$taxa=="Spiders",]
levels(db_alien.t$Biome)
dplyr::count(db_alien.t,Biome)
#db_alien.t<-db_alien.t[db_alien.t$Biome!="Mediterranean Forests, Woodlands & Scrub",]
m_paper <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS) , data = db_alien.t, family = beta_family)
m_adding <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS/island_continent) , data = db_alien.t, family = beta_family)#not working
AIC(m_paper);AIC(m_adding)# deltAIC = 2
anova(m_paper,m_adding)# p=1, no significance for the two models
#No differences for the variables, see below
```


###Plants
```{r}
db_alien.t<-db_alien[db_alien$taxa=="Vascular plants",]
m_paper <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS/SSB) , data = db_alien.t, family = beta_family)
m_adding <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS/SSB/island_continent) , data = db_alien.t, family = beta_family)

AIC(m_paper);AIC(m_adding)# deltAIC < 2
anova(m_paper,m_adding)# p=0.6703, no significance for the two models
summary(m_paper);summary(m_adding) #No differences for the variables, see below
```
#5.leave islands out
##5_1) non-native incidnce
```{r}
#1 run the models
#we condidered to move out the assemblages from the island and then test the difference with the model we used in the paper

db.full.test <- subset(db.size,!(LU %in% "Urban" & LUI %in%"Intense use"))
#1change the refernce for LU
levels(db.full.test$LU)
db.full.test$LU = factor(db.full.test$LU, levels=c("Primary","SV","Plantation","Cropland","Pasture","Urban"))
db.full.test$LU = factor(db.full.test$LU, levels=c("Pasture","Urban","Cropland", "Plantation","SV", "Primary"))
levels(db.full.test$LUI)
db.full.test$LUI = factor(db.full.test$LUI, levels=c("Cannot decide","Minimal use","Light use","Intense use"))
db.full.test$LUI = factor(db.full.test$LUI, levels=c("Intense use", "Light use","Minimal use","Cannot decide"))
dplyr::count(db.full.test,LU,LUI,Alien.presence)
#1 the model in the paper, with SS/SSB in the random factor
m_paper <- glmer(Alien.presence ~ LU*LUI + (1|SS/SSB) , 
          data = db.full.test , family = binomial , 
          control = glmerControl(optimizer = "bobyqa" , 
                                 optCtrl = list(maxfun = 1e5)),
           nAGQ = 1 , subset = as.vector(db.full.test$LUI != "Cannot decide"))
#2 deleting the assembalges from islands
db.full.test_continent<-db.full.test[db.full.test$island_continent=="continent",]
dplyr::count(db.full.test_continent,LU,LUI,Alien.presence)
m_continent <- glmer(Alien.presence ~ LU*LUI + (1|SS/SSB) , 
          data = db.full.test_continent , family = binomial , 
          control = glmerControl(optimizer = "bobyqa" , 
                                 optCtrl = list(maxfun = 1e5)),
           nAGQ = 1 , subset = as.vector(db.full.test_continent$LUI != "Cannot decide"))

#2backtransfer the model result
#for full model in the paper used.
pred.full<-m_paper %>% emmeans(specs = ~LU+LUI , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
#selelct the rows that compared to primary
data.2<-pred.full[grepl("Primary Minimal use",pred.full$contrast),]
data.2$contrast<-as.character(data.2$contrast)
data.2[18,]<-c("Primary Minimal / Primary Minimal use",1, NA,NA,NA,NA,NA,NA,NA)
library(stringr)
data.2[c('name1', 'name2')] <- str_split_fixed(data.2$contrast, '/', 2)
data.2[c('LU', 'LUI',"Use")] <- str_split_fixed(data.2$name1, ' ', 3)
data.2$LUI<-paste(data.2$LUI,data.2$Use)
names(data.2)
data.3<-data.2[,c(1:9,12,13)]
data.3$LUI<-as.factor(data.3$LUI)

levels(data.3$LUI)[1:4]<-c("Intense use","Light use","Minimal use","Minimal use")
data.3$LU<-as.factor(data.3$LU)
levels(data.3$LU)[4:5]<-c("Primary","Secondary")

data.3$LU = factor(data.3$LU, levels=c("Primary","Secondary",
                                       "Plantation","Pasture","Cropland","Urban"))
data.3$LUI = factor(data.3$LUI, levels=c("Minimal use","Light use","Intense use"))
data.3$odds.ratio<-as.numeric(data.3$odds.ratio)
data.3$SE<-as.numeric(data.3$SE)
#add the model name
data.3$model<-with(data.3,"Original")
data.full<-data.3

# for the model that only continents
pred.m_1<-m_continent %>% emmeans(specs = ~LU+LUI , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
#selelct the rows that compared to primary
data.2<-pred.m_1[grepl("Primary Minimal use",pred.m_1$contrast),]
data.2$contrast<-as.character(data.2$contrast)
data.2[18,]<-c("Primary Minimal / Primary Minimal use",1, NA,NA,NA,NA,NA,NA,NA)
library(stringr)
data.2[c('name1', 'name2')] <- str_split_fixed(data.2$contrast, '/', 2)
data.2[c('LU', 'LUI',"Use")] <- str_split_fixed(data.2$name1, ' ', 3)
data.2$LUI<-paste(data.2$LUI,data.2$Use)
names(data.2)
data.3<-data.2[,c(1:9,12,13)]
data.3$LUI<-as.factor(data.3$LUI)

levels(data.3$LUI)[1:4]<-c("Intense use","Light use","Minimal use","Minimal use")
data.3$LU<-as.factor(data.3$LU)
levels(data.3$LU)[4:5]<-c("Primary","Secondary")

data.3$LU = factor(data.3$LU, levels=c("Primary","Secondary",
                                       "Plantation","Pasture","Cropland","Urban"))
data.3$LUI = factor(data.3$LUI, levels=c("Minimal use","Light use","Intense use"))
data.3$odds.ratio<-as.numeric(data.3$odds.ratio)
data.3$SE<-as.numeric(data.3$SE)
#add the model name
data.3$model<-with(data.3,"m_1")
data.m_continent<-data.3

#3combine all the model-transfered result
data.model<-rbind(data.full,data.m_continent)
names(data.model)

#4claclate the mean and confidence interval 95%
#get the model result in our paper
model_result_paper<-data.model%>% filter(model=="Original")
library(dplyr)
model_result_cross<-data.model%>% group_by(LU,LUI) %>%
  dplyr::summarise(mean.ratio = mean(odds.ratio, na.rm = TRUE),
            sd.ratio = sd(odds.ratio, na.rm = TRUE),
            n.ratio = n()) %>%
  mutate(se.ratio = sd.ratio / sqrt(n.ratio))
model_result_table<-merge(model_result_paper[,c(10,11,2,3)],model_result_cross[,c(1:3,6)],by=c("LU","LUI"),all.x=T)
model_result_table$se.ratio[model_result_table$LU=="Primary"&model_result_table$LUI=="Minimal use"]<-NA
```

```{r}
####figure
all<-ggplot(model_result_paper , aes(LU , odds.ratio,shape=LUI,color=LU))+
  geom_errorbar(aes(ymin = odds.ratio-SE , ymax = odds.ratio+SE) ,width=0.4, 
                position = position_dodge(width=.6))+
  scale_y_continuous(name="Odds ratio of alien occurrence",
                     limits=c(0,48),breaks=seq(0,45,15))+
  geom_point(aes(shape=LUI),position = position_dodge(width=.6),size=3.5)+
  scale_shape_manual(name="LU-intensity",values=c(15, 17, 18))+
  scale_color_manual(name='LU-types',
                     values = c("#2166AC","#4393C3","#92C5DE",
                                "#F4A582","red","#B2182B"),
                     label=c('Primary','Secondary','Plantation',
                             'Pasture','Cropland','Urban'))+
  guides(color=FALSE)+
  theme_bw()+
  theme(panel.grid.major.x = element_blank() , 
        axis.ticks.length=unit(0.08,"inch"),
        panel.grid.major.y = element_line(size = 0.6 , colour = "grey90") ,
        panel.spacing = unit(0,"lines") , 
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_text(colour = "black",angle = 25, 
                                   size = 12,vjust = 0.6) ,
        axis.text.y = element_text(colour = "black",  size = 12),
        legend.title = element_text(face = 'bold'),
        legend.background = element_blank(),
        legend.box.background = element_blank(),
        legend.key = element_blank(),
        legend.direction =  "horizontal",legend.position = c(0.4,0.9)) 
all

#corss cheacking
names(model_result_table)
all_cross<-ggplot(model_result_table , aes(LU , mean.ratio,shape=LUI,color=LU))+
    
  geom_errorbar(aes(ymin = mean.ratio-se.ratio , ymax = mean.ratio+se.ratio) ,width=0.4, 
                position = position_dodge(width=.6))+
  scale_y_continuous(name="Odds ratio of alien occurrence",
                     limits=c(0,48),breaks=seq(0,45,15))+
  geom_point(aes(shape=LUI),position = position_dodge(width=.6),size=3.5)+
  scale_shape_manual(name="LU-intensity",values=c(15, 17, 18))+
  scale_color_manual(name='LU-types',
                     values = c("#2166AC","#4393C3","#92C5DE",
                                "#F4A582","red","#B2182B"),
                     label=c('Primary','Secondary','Plantation',
                             'Pasture','Cropland','Urban'))+
  guides(color=FALSE)+
  theme_bw()+
  theme(panel.grid.major.x = element_blank() , 
        axis.ticks.length=unit(0.08,"inch"),
        panel.grid.major.y = element_line(size = 0.6 , colour = "grey90") ,
        panel.spacing = unit(0,"lines") , 
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_text(colour = "black",angle = 25, 
                                   size = 12,vjust = 0.6) ,
        axis.text.y = element_text(colour = "black",  size = 12),
        legend.title = element_text(face = 'bold'),
        legend.background = element_blank(),
        legend.box.background = element_blank(),
        legend.key = element_blank(),
        legend.direction =  "horizontal",legend.position = c(0.4,0.9)) 

all_cross

#com<-cowplot::plot_grid(all,all_cross,ncol=2,align = 'hv')
#com
ggsave(all_cross,filename = '/.../fig2.a.tiff',compression='lzw', width = 10,height = 3.0,dpi=200)
```
###overll
```{r}
####part1: run the model 
names(db.size)
levels(db.size$LU)
db.size$LU = factor(db.size$LU, levels=c("Pasture","Urban","Cropland", "Plantation","SV", "Primary"))

#0 the model used in the paper
m_paper <- glmer(Alien.presence ~ LU+ (1|SS/SSB) , data = db.size , family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )
#2 aleaving out island assembalges
db.size_continent<-db.size[db.size$island_continent=="continent",]
m_continent <- glmer(Alien.presence ~ LU+ (1|SS/SSB) , data = db.size_continent , family = binomial ,
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

####part2: model backtransfomration
#selelct the rows that compared to primary
pred.full<-m_paper %>% emmeans(specs = ~LU , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
pred.full_2<-pred.full[grepl("Primary",pred.full$contrast),]
pred.full_2$contrast<-as.character(pred.full_2$contrast)
pred.full_2[6,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
library(stringr)
pred.full_2[c('name1', 'name2')] <- str_split_fixed(pred.full_2$contrast, '/', 2)
names(pred.full_2)
names(pred.full_2)[10]<-c("LU")
pred.full_2$LU<-as.factor(pred.full_2$LU)
levels(pred.full_2$LU)<-c("Cropland","Pasture","Plantation",
                          "Primary","Secondary", "Urban")
pred.full_2$LU<-
  factor(pred.full_2$LU,c("Primary","Secondary","Plantation",
                          "Pasture","Cropland","Urban"))
names(pred.full_2)[2]<-c("Odds")
pred.full_2$Odds<-as.numeric(pred.full_2$Odds)
pred.full_2$SE<-as.numeric(pred.full_2$SE)
pred.full_2$LU<-as.factor(pred.full_2$LU)
#add the model name
pred.full_2$model<-with(pred.full_2,"Original")
data.full<-pred.full_2

# for the model continent
pred.m_1<-m_continent %>% emmeans(specs = ~LU , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
#selelct the rows that compared to primary
pred.full_2<-pred.m_1[grepl("Primary",pred.m_1$contrast),]
pred.full_2$contrast<-as.character(pred.full_2$contrast)
pred.full_2[6,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
library(stringr)
pred.full_2[c('name1', 'name2')] <- str_split_fixed(pred.full_2$contrast, '/', 2)
names(pred.full_2)
names(pred.full_2)[10]<-c("LU")
pred.full_2$LU<-as.factor(pred.full_2$LU)
levels(pred.full_2$LU)<-c("Cropland","Pasture","Plantation",
                          "Primary","Secondary", "Urban")
pred.full_2$LU<-
  factor(pred.full_2$LU,c("Primary","Secondary","Plantation",
                          "Pasture","Cropland","Urban"))
names(pred.full_2)[2]<-c("Odds")
pred.full_2$Odds<-as.numeric(pred.full_2$Odds)
pred.full_2$SE<-as.numeric(pred.full_2$SE)
pred.full_2$LU<-as.factor(pred.full_2$LU)
#add the model name
pred.full_2$model<-with(pred.full_2,"m_1")
data.m_continent<-pred.full_2

#3combine all the model-transfered result
data.model<-rbind(data.full,data.m_continent)
names(data.model)

#4claclate the mean and confidence interval 95%
#get the model result in our paper
model_result_paper<-data.model%>% filter(model=="Original")
library(dplyr)
model_result_cross<-data.model%>%group_by(LU) %>%
  dplyr::summarise(mean.ratio = mean(Odds, na.rm = TRUE),
            sd.ratio = sd(Odds, na.rm = TRUE),
            n.ratio = n()) %>%
  mutate(se.ratio = sd.ratio / sqrt(n.ratio))
model_result_cross<-merge(model_result_paper[,c(10,2,3)],model_result_cross[,c(1:2,5)],by="LU",all.x=T)
model_result_cross$se.ratio[model_result_cross$LU=="Primary"]<-NA
```


```{r}
####figure
all<-ggplot(model_result_paper , aes(LU , Odds,color=LU))+
  geom_point(aes(color=LU),size=2.5)+
  geom_errorbar(aes(ymin = Odds-SE , ymax = Odds+SE) ,width=0.4, 
                position = position_dodge(width=.6))+
  scale_y_continuous(name="Odds ratio of alien occurrence",
                     limits=c(0,15),breaks=seq(0,15,5))+
  scale_color_manual(name='LU-types',
                     values = c("#2166AC","#4393C3","#92C5DE",
                                "#F4A582","red","#B2182B"),
                     label=c('Primary','Secondary','Plantation',
                             'Pasture','Cropland','Urban'))+
  guides(color=FALSE)+
  theme_bw()+
  theme(panel.grid.major.x = element_blank() , 
        axis.ticks.length=unit(0.08,"inch"),
        panel.grid.major.y = element_line(size = 0.6 , colour = "grey90") ,
        panel.spacing = unit(0,"lines") , 
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_text(colour = "black",angle = 25, 
                                   size = 12,vjust = 0.6) ,
        axis.text.y = element_text(colour = "black",  size = 12),
        legend.title = element_text(face = 'bold'),
        legend.background = element_blank(),
        legend.box.background = element_blank(),
        legend.key = element_blank(),
        legend.direction =  "horizontal",legend.position = c(0.4,0.9)) 
all

#corss cheacking
names(model_result_cross)
all_cross_lu<-ggplot(model_result_cross , aes(LU , mean.ratio,color=LU))+
  geom_point(aes(color=LU),size=2.5)+
  geom_errorbar(aes(ymin = mean.ratio-se.ratio , ymax = mean.ratio+se.ratio) ,width=0.4, 
                position = position_dodge(width=.6))+
  scale_y_continuous(name="Odds ratio of alien occurrence",
                     limits=c(0,30),breaks=seq(0,30,10))+

  scale_color_manual(name='LU-types',
                     values = c("#2166AC","#4393C3","#92C5DE",
                                "#F4A582","red","#B2182B"),
                     label=c('Primary','Secondary','Plantation',
                             'Pasture','Cropland','Urban'))+

  guides(color=FALSE)+
  theme_bw()+
  theme(panel.grid.major.x = element_blank() , 
        axis.ticks.length=unit(0.08,"inch"),
        panel.grid.major.y = element_line(size = 0.6 , colour = "grey90") ,
        panel.spacing = unit(0,"lines") , 
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_text(colour = "black",angle = 25, 
                                   size = 12,vjust = 0.6) ,
        axis.text.y = element_text(colour = "black",  size = 12),
        legend.title = element_text(face = 'bold'),
        legend.background = element_blank(),
        legend.box.background = element_blank(),
        legend.key = element_blank(),
        legend.direction =  "horizontal",legend.position = c(0.4,0.9)) 

all_cross_lu

#com<-cowplot::plot_grid(all,all_cross,ncol=2,align = 'hv')
#com
ggsave(all_cross_lu,filename = '/.../fig2.a.tiff',compression='lzw', width = 3,height = 3.0,dpi=200)
```
###ants
```{r}
db.size.t<-db.size[db.size$taxa=="Ants",]
levels(db.size.t$LU)
db.size.t$LU<-
  factor(db.size.t$LU,c("Urban","SV","Plantation","Pasture","Cropland","Primary"))
#0 the model used in the paper
dplyr::count(db.size.t,Biome)
m_paper <- glmer(Alien.presence ~ LU+ (1|SS/SSB) , data = db.size.t , family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )
db.size.t_continent<-db.size.t[db.size.t$island_continent=="continent",]
m_continent <- glmer(Alien.presence ~ LU+ (1|SS/SSB) , data = db.size.t_continent , family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#selelct the rows that compared to primary
pred.full<-m_paper %>% emmeans(specs = ~LU , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
pred.full_2<-pred.full[grepl("Primary",pred.full$contrast),]
pred.full_2$contrast<-as.character(pred.full_2$contrast)
pred.full_2[6,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
library(stringr)
pred.full_2[c('name1', 'name2')] <- str_split_fixed(pred.full_2$contrast, '/', 2)
names(pred.full_2)
names(pred.full_2)[10]<-c("LU")
pred.full_2$LU<-as.factor(pred.full_2$LU)
levels(pred.full_2$LU)<-c("Cropland","Pasture","Plantation",
                          "Primary","Secondary", "Urban")
pred.full_2$LU<-
  factor(pred.full_2$LU,c("Primary","Secondary","Plantation",
                          "Pasture","Cropland","Urban"))
names(pred.full_2)[2]<-c("Odds")
pred.full_2$Odds<-as.numeric(pred.full_2$Odds)
pred.full_2$SE<-as.numeric(pred.full_2$SE)
pred.full_2$LU<-as.factor(pred.full_2$LU)
#add the model name
pred.full_2$model<-with(pred.full_2,"Original")
data.full<-pred.full_2

# for the model 1
pred.m_1<-m_continent %>% emmeans(specs = ~LU , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
#selelct the rows that compared to primary
pred.full_2<-pred.m_1[grepl("Primary",pred.m_1$contrast),]
pred.full_2$contrast<-as.character(pred.full_2$contrast)
pred.full_2[6,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
library(stringr)
pred.full_2[c('name1', 'name2')] <- str_split_fixed(pred.full_2$contrast, '/', 2)
names(pred.full_2)
names(pred.full_2)[10]<-c("LU")
pred.full_2$LU<-as.factor(pred.full_2$LU)
levels(pred.full_2$LU)<-c("Cropland","Pasture","Plantation",
                          "Primary","Secondary", "Urban")
pred.full_2$LU<-
  factor(pred.full_2$LU,c("Primary","Secondary","Plantation",
                          "Pasture","Cropland","Urban"))
names(pred.full_2)[2]<-c("Odds")
pred.full_2$Odds<-as.numeric(pred.full_2$Odds)
pred.full_2$SE<-as.numeric(pred.full_2$SE)
pred.full_2$LU<-as.factor(pred.full_2$LU)
#add the model name
pred.full_2$model<-with(pred.full_2,"m_1")
data.m_continent<-pred.full_2

#3combine all the model-transfered result
data.model<-rbind(data.full,data.m_continent)
names(data.model)

#4claclate the mean and confidence interval 95%
#get the model result in our paper
model_result_paper<-data.model%>% filter(model=="Original")
library(dplyr)
model_result_cross<-data.model%>%group_by(LU) %>%
  dplyr::summarise(mean.ratio = mean(Odds, na.rm = TRUE),
            sd.ratio = sd(Odds, na.rm = TRUE),
            n.ratio = n()) %>%
  mutate(se.ratio = sd.ratio / sqrt(n.ratio))
model_result_cross<-merge(model_result_paper[,c(10,2,3)],model_result_cross[,c(1:2,5)],by="LU",all.x=T)
model_result_cross$se.ratio[model_result_cross$LU=="Primary"]<-NA
```

```{r}
####figure
all<-ggplot(model_result_paper , aes(LU , Odds,color=LU))+
  geom_point(aes(color=LU),size=2.5)+
  geom_errorbar(aes(ymin = Odds-SE , ymax = Odds+SE) ,width=0.4, 
                position = position_dodge(width=.6))+
  scale_y_continuous(name="Odds ratio of alien occurrence",
                     limits=c(-1,65),breaks=seq(0,60,20))+
  scale_color_manual(name='LU-types',
                     values = c("#2166AC","#4393C3","#92C5DE",
                                "#F4A582","red","#B2182B"),
                     label=c('Primary','Secondary','Plantation',
                             'Pasture','Cropland','Urban'))+
  guides(color=FALSE)+
  theme_bw()+
  theme(panel.grid.major.x = element_blank() , 
        axis.ticks.length=unit(0.08,"inch"),
        panel.grid.major.y = element_line(size = 0.6 , colour = "grey90") ,
        panel.spacing = unit(0,"lines") , 
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_text(colour = "black",angle = 25, 
                                   size = 12,vjust = 0.6) ,
        axis.text.y = element_text(colour = "black",  size = 12),
        legend.title = element_text(face = 'bold'),
        legend.background = element_blank(),
        legend.box.background = element_blank(),
        legend.key = element_blank(),
        legend.direction =  "horizontal",legend.position = c(0.4,0.9)) 
all

#corss cheacking
names(model_result_cross)
all_cross_ant<-ggplot(model_result_cross , aes(LU , mean.ratio,color=LU))+
  geom_point(aes(color=LU),size=2.5)+
  geom_errorbar(aes(ymin = mean.ratio-se.ratio , ymax = mean.ratio+se.ratio) ,width=0.4, 
                position = position_dodge(width=.6))+
  scale_y_continuous(name="Odds ratio of alien occurrence",
                     limits=c(-1,65),breaks=seq(0,60,20))+
  scale_color_manual(name='LU-types',
                     values = c("#2166AC","#4393C3","#92C5DE",
                                "#F4A582","red","#B2182B"),
                     label=c('Primary','Secondary','Plantation',
                             'Pasture','Cropland','Urban'))+
  guides(color=FALSE)+
  theme_bw()+
  theme(panel.grid.major.x = element_blank() , 
        axis.ticks.length=unit(0.08,"inch"),
        panel.grid.major.y = element_line(size = 0.6 , colour = "grey90") ,
        panel.spacing = unit(0,"lines") , 
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_text(colour = "black",angle = 25, 
                                   size = 12,vjust = 0.6) ,
        axis.text.y = element_text(colour = "black",  size = 12),
        legend.title = element_text(face = 'bold'),
        legend.background = element_blank(),
        legend.box.background = element_blank(),
        legend.key = element_blank(),
        legend.direction =  "horizontal",legend.position = c(0.4,0.9)) 

all_cross_ant

#com<-cowplot::plot_grid(all,all_cross,ncol=2,align = 'hv')
#com
ggsave(all_cross_ant,filename = '/.../figxb.tiff',compression='lzw', width = 3,height = 3.0,dpi=200)
```

###Birds
```{r}
db.size.t<-db.size[db.size$taxa=="Birds",]
levels(db.size.t$LU)
db.size.t$LU<-
  factor(db.size.t$LU,c("Cropland","Urban","SV","Plantation","Pasture","Primary"))
#0 the model used in the paper
dplyr::count(db.size.t,Biome)
m_paper <- glmer(Alien.presence ~ LU+ (1|SS/SSB) , data = db.size.t , family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )
db.size.t_continent<-db.size.t[db.size.t$island_continent=="continent",]
m_continent <- glmer(Alien.presence ~ LU+ (1|SS/SSB) , data = db.size.t_continent , family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#selelct the rows that compared to primary
pred.full<-m_paper %>% emmeans(specs = ~LU , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
pred.full_2<-pred.full[grepl("Primary",pred.full$contrast),]
pred.full_2$contrast<-as.character(pred.full_2$contrast)
pred.full_2[6,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
library(stringr)
pred.full_2[c('name1', 'name2')] <- str_split_fixed(pred.full_2$contrast, '/', 2)
names(pred.full_2)
names(pred.full_2)[10]<-c("LU")
pred.full_2$LU<-as.factor(pred.full_2$LU)
levels(pred.full_2$LU)<-c("Cropland","Pasture","Plantation",
                          "Primary","Secondary", "Urban")
pred.full_2$LU<-
  factor(pred.full_2$LU,c("Primary","Secondary","Plantation",
                          "Pasture","Cropland","Urban"))
names(pred.full_2)[2]<-c("Odds")
pred.full_2$Odds<-as.numeric(pred.full_2$Odds)
pred.full_2$SE<-as.numeric(pred.full_2$SE)
pred.full_2$LU<-as.factor(pred.full_2$LU)
#add the model name
pred.full_2$model<-with(pred.full_2,"Original")
data.full<-pred.full_2

# for the model 1
pred.m_1<-m_continent %>% emmeans(specs = ~LU , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
#selelct the rows that compared to primary
pred.full_2<-pred.m_1[grepl("Primary",pred.m_1$contrast),]
pred.full_2$contrast<-as.character(pred.full_2$contrast)
pred.full_2[6,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
library(stringr)
pred.full_2[c('name1', 'name2')] <- str_split_fixed(pred.full_2$contrast, '/', 2)
names(pred.full_2)
names(pred.full_2)[10]<-c("LU")
pred.full_2$LU<-as.factor(pred.full_2$LU)
levels(pred.full_2$LU)<-c("Cropland","Pasture","Plantation",
                          "Primary","Secondary", "Urban")
pred.full_2$LU<-
  factor(pred.full_2$LU,c("Primary","Secondary","Plantation",
                          "Pasture","Cropland","Urban"))
names(pred.full_2)[2]<-c("Odds")
pred.full_2$Odds<-as.numeric(pred.full_2$Odds)
pred.full_2$SE<-as.numeric(pred.full_2$SE)
pred.full_2$LU<-as.factor(pred.full_2$LU)
#add the model name
pred.full_2$model<-with(pred.full_2,"m_1")
data.m_continent<-pred.full_2

#3combine all the model-transfered result
data.model<-rbind(data.full,data.m_continent)
names(data.model)

#4claclate the mean and confidence interval 95%
#get the model result in our paper
model_result_paper<-data.model%>% filter(model=="Original")
library(dplyr)
model_result_cross<-data.model%>%group_by(LU) %>%
  dplyr::summarise(mean.ratio = mean(Odds, na.rm = TRUE),
            sd.ratio = sd(Odds, na.rm = TRUE),
            n.ratio = n()) %>%
  mutate(se.ratio = sd.ratio / sqrt(n.ratio))
model_result_cross<-merge(model_result_paper[,c(10,2,3)],model_result_cross[,c(1:2,5)],by="LU",all.x=T)
model_result_cross$se.ratio[model_result_cross$LU=="Primary"]<-NA
```

```{r}
####figure
all<-ggplot(model_result_paper , aes(LU , Odds,color=LU))+
  geom_point(aes(color=LU),size=2.5)+
  geom_errorbar(aes(ymin = Odds-SE , ymax = Odds+SE) ,width=0.4, 
                position = position_dodge(width=.6))+
  scale_y_continuous(name="Odds ratio of alien occurrence",
                     limits=c(-1,65),breaks=seq(0,60,20))+
  scale_color_manual(name='LU-types',
                     values = c("#2166AC","#4393C3","#92C5DE",
                                "#F4A582","red","#B2182B"),
                     label=c('Primary','Secondary','Plantation',
                             'Pasture','Cropland','Urban'))+
  guides(color=FALSE)+
  theme_bw()+
  theme(panel.grid.major.x = element_blank() , 
        axis.ticks.length=unit(0.08,"inch"),
        panel.grid.major.y = element_line(size = 0.6 , colour = "grey90") ,
        panel.spacing = unit(0,"lines") , 
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_text(colour = "black",angle = 25, 
                                   size = 12,vjust = 0.6) ,
        axis.text.y = element_text(colour = "black",  size = 12),
        legend.title = element_text(face = 'bold'),
        legend.background = element_blank(),
        legend.box.background = element_blank(),
        legend.key = element_blank(),
        legend.direction =  "horizontal",legend.position = c(0.4,0.9)) 
all

#corss cheacking
names(model_result_cross)
all_cross<-ggplot(model_result_cross , aes(LU , mean.ratio,color=LU))+
  geom_point(aes(color=LU),size=2.5)+
  geom_errorbar(aes(ymin = mean.ratio-se.ratio , ymax = mean.ratio+se.ratio) ,width=0.4, 
                position = position_dodge(width=.6))+
  scale_y_continuous(name="Odds ratio of alien occurrence",
                     limits=c(-1,30),breaks=seq(0,30,10))+
  scale_color_manual(name='LU-types',
                     values = c("#2166AC","#4393C3","#92C5DE",
                                "#F4A582","red","#B2182B"),
                     label=c('Primary','Secondary','Plantation',
                             'Pasture','Cropland','Urban'))+
  guides(color=FALSE)+
  theme_bw()+
  theme(panel.grid.major.x = element_blank() , 
        axis.ticks.length=unit(0.08,"inch"),
        panel.grid.major.y = element_line(size = 0.6 , colour = "grey90") ,
        panel.spacing = unit(0,"lines") , 
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_text(colour = "black",angle = 25, 
                                   size = 12,vjust = 0.6) ,
        axis.text.y = element_text(colour = "black",  size = 12),
        legend.title = element_text(face = 'bold'),
        legend.background = element_blank(),
        legend.box.background = element_blank(),
        legend.key = element_blank(),
        legend.direction =  "horizontal",legend.position = c(0.4,0.9)) 

all_cross

#com<-cowplot::plot_grid(all,all_cross,ncol=2,align = 'hv')
#com
ggsave(all_cross,filename = '/.../figxb.tiff',compression='lzw', width = 3,height = 3.0,dpi=200)
```

###mammals
```{r}
db.size.t<-db.size[db.size$taxa=="Mammals",]
levels(db.size.t$LU)
db.size.t$LU<-
  factor(db.size.t$LU,c("Urban","SV","Plantation","Pasture","Cropland","Primary"))
db.size.t<-subset(db.size.t,!(LU %in% "Urban" & taxa %in%"Mammals"))
db.size.t<-subset(db.size.t,!(LU %in% "Cropland" & taxa %in%"Mammals"))
#0 the model used in the paper
dplyr::count(db.size.t,Biome)
m_paper <- glmer(Alien.presence ~ LU+ (1|SS/SSB) , data = db.size.t , family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )
db.size.t_continent<-db.size.t[db.size.t$island_continent=="continent",]
m_continent <- glmer(Alien.presence ~ LU+ (1|SS/SSB) , data = db.size.t_continent , family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#selelct the rows that compared to primary
mam<-m_paper %>% emmeans(specs = ~LU , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
mam.1<-mam[grepl("Primary",mam$contrast),]
mam.1$contrast<-as.character(mam.1$contrast)
mam.1[4,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
mam.1[5,]<-c("Cropland",NA,NA, NA,NA,NA,NA,NA,NA)
mam.1[6,]<-c("Urban",NA,NA, NA,NA,NA,NA,NA,NA)
mam.1[c('name1', 'name2')] <- str_split_fixed(mam.1$contrast, '/', 2)
names(mam.1)
names(mam.1)[10]<-c("LU")
mam.1$LU<-as.factor(mam.1$LU)
levels(mam.1$LU)<-c("Cropland","Pasture","Plantation","Primary","Secondary","Urban")
mam.1$LU<-
  factor(mam.1$LU,c("Primary","Secondary","Plantation","Pasture","Cropland","Urban"))
names(mam.1)[2]<-c("Odds")
mam.1$Odds<-as.numeric(mam.1$Odds)
mam.1$SE<-as.numeric(mam.1$SE)
#add the model name
mam.1$model<-with(mam.1,"Original")
data.full<-mam.1

# for the model 1
mam<-m_continent %>% emmeans(specs = ~LU , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
mam.1<-mam[grepl("Primary",mam$contrast),]
mam.1$contrast<-as.character(mam.1$contrast)
mam.1[4,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
mam.1[5,]<-c("Cropland",NA,NA, NA,NA,NA,NA,NA,NA)
mam.1[6,]<-c("Urban",NA,NA, NA,NA,NA,NA,NA,NA)
mam.1[c('name1', 'name2')] <- str_split_fixed(mam.1$contrast, '/', 2)
names(mam.1)
names(mam.1)[10]<-c("LU")
mam.1$LU<-as.factor(mam.1$LU)
levels(mam.1$LU)<-c("Cropland","Pasture","Plantation","Primary","Secondary","Urban")
mam.1$LU<-
  factor(mam.1$LU,c("Primary","Secondary","Plantation","Pasture","Cropland","Urban"))
names(mam.1)[2]<-c("Odds")
mam.1$Odds<-as.numeric(mam.1$Odds)
mam.1$SE<-as.numeric(mam.1$SE)
#add the model name
mam.1$model<-with(mam.1,"m_1")
m_continent<-mam.1

#3combine all the model-transfered result
data.model<-rbind(data.full,m_continent)
names(data.model)

#4claclate the mean and confidence interval 95%
#get the model result in our paper
model_result_paper<-data.model%>% filter(model=="Original")
library(dplyr)
model_result_cross<-data.model%>%group_by(LU) %>%
  dplyr::summarise(mean.ratio = mean(Odds, na.rm = TRUE),
            sd.ratio = sd(Odds, na.rm = TRUE),
            n.ratio = n()) %>%
  mutate(se.ratio = sd.ratio / sqrt(n.ratio))
model_result_cross<-merge(model_result_paper[,c(10,2,3)],model_result_cross[,c(1:2,5)],by="LU",all.x=T)
model_result_cross$se.ratio[model_result_cross$LU=="Primary"]<-NA
```

```{r}
####figure
all<-ggplot(model_result_paper , aes(LU , Odds,color=LU))+
  geom_point(aes(color=LU),size=2.5)+
  geom_errorbar(aes(ymin = Odds-SE , ymax = Odds+SE) ,width=0.4, 
                position = position_dodge(width=.6))+
  scale_y_continuous(name="Odds ratio of alien occurrence",
                     limits=c(-1,65),breaks=seq(0,60,20))+
  scale_color_manual(name='LU-types',
                     values = c("#2166AC","#4393C3","#92C5DE",
                                "#F4A582","red","#B2182B"),
                     label=c('Primary','Secondary','Plantation',
                             'Pasture','Cropland','Urban'))+
  guides(color=FALSE)+
  theme_bw()+
  theme(panel.grid.major.x = element_blank() , 
        axis.ticks.length=unit(0.08,"inch"),
        panel.grid.major.y = element_line(size = 0.6 , colour = "grey90") ,
        panel.spacing = unit(0,"lines") , 
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_text(colour = "black",angle = 25, 
                                   size = 12,vjust = 0.6) ,
        axis.text.y = element_text(colour = "black",  size = 12),
        legend.title = element_text(face = 'bold'),
        legend.background = element_blank(),
        legend.box.background = element_blank(),
        legend.key = element_blank(),
        legend.direction =  "horizontal",legend.position = c(0.4,0.9)) 
all

#corss cheacking
names(model_result_cross)
all_cross<-ggplot(model_result_cross , aes(LU , mean.ratio,color=LU))+
  geom_point(aes(color=LU),size=2.5)+
  geom_errorbar(aes(ymin = mean.ratio-se.ratio , ymax = mean.ratio+se.ratio) ,width=0.4, 
                position = position_dodge(width=.6))+
  scale_y_continuous(name="Odds ratio of alien occurrence",
                     limits=c(-1,30),breaks=seq(0,30,10))+
  scale_color_manual(name='LU-types',
                     values = c("#2166AC","#4393C3","#92C5DE",
                                "#F4A582","red","#B2182B"),
                     label=c('Primary','Secondary','Plantation',
                             'Pasture','Cropland','Urban'))+
  guides(color=FALSE)+
  theme_bw()+
  theme(panel.grid.major.x = element_blank() , 
        axis.ticks.length=unit(0.08,"inch"),
        panel.grid.major.y = element_line(size = 0.6 , colour = "grey90") ,
        panel.spacing = unit(0,"lines") , 
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_text(colour = "black",angle = 25, 
                                   size = 12,vjust = 0.6) ,
        axis.text.y = element_text(colour = "black",  size = 12),
        legend.title = element_text(face = 'bold'),
        legend.background = element_blank(),
        legend.box.background = element_blank(),
        legend.key = element_blank(),
        legend.direction =  "horizontal",legend.position = c(0.4,0.9)) 

all_cross

#com<-cowplot::plot_grid(all,all_cross,ncol=2,align = 'hv')
#com
ggsave(all_cross,filename = '/.../figxb.tiff',compression='lzw', width = 3,height = 3.0,dpi=200)
```
###spiders
```{r}
db.size.t<-db.size[db.size$taxa=="Spiders",]
levels(db.size.t$LU)
db.size.t$LU<-
  factor(db.size.t$LU,c("Urban","SV","Plantation","Pasture","Cropland","Primary"))
db.size.t<-subset(db.size.t,!(LU %in% "Urban" & taxa %in%"Spiders"))
db.size.t<-subset(db.size.t,!(LU %in% "Plantation" & taxa %in%"Spiders"))
#0 the model used in the paper
dplyr::count(db.size.t,Biome)
m_paper <- glmer(Alien.presence ~ LU+ (1|SS/SSB) , data = db.size.t , family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )
db.size.t_continent<-db.size.t[db.size.t$island_continent=="continent",]
m_continent<- glmer(Alien.presence ~ LU+ (1|SS/SSB) , data = db.size.t_continent , family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

####part2: model backtransfomration
#selelct the rows that compared to primary
spider<-m_paper %>% emmeans(specs = ~LU , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
spider.1<-spider[grepl("Primary",spider$contrast),]
spider.1$contrast<-as.character(spider.1$contrast)
spider.1[4,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
spider.1[5,]<-c("Plantation",NA,NA, NA,NA,NA,NA,NA,NA)
spider.1[6,]<-c("Urban",NA,NA, NA,NA,NA,NA,NA,NA)
spider.1[c('name1', 'name2')] <- str_split_fixed(spider.1$contrast, '/', 2)
names(spider.1)
names(spider.1)[10]<-c("LU")
spider.1$LU<-as.factor(spider.1$LU)
levels(spider.1$LU)<-c("Cropland","Pasture","Plantation","Primary","Secondary","Urban")
spider.1$LU<-
  factor(spider.1$LU,c("Primary","Secondary","Plantation","Pasture","Cropland","Urban"))
names(spider.1)[2]<-c("Odds")
spider.1$Odds<-as.numeric(spider.1$Odds)
spider.1$SE<-as.numeric(spider.1$SE)
spider.1$LU<-as.factor(spider.1$LU)
#add the model name
spider.1$model<-with(spider.1,"Original")
data.full<-spider.1

# for the model 1
spider<-m_continent %>% emmeans(specs = ~LU , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
spider.1<-spider[grepl("Primary",spider$contrast),]
spider.1$contrast<-as.character(spider.1$contrast)
spider.1[4,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
spider.1[5,]<-c("Plantation",NA,NA, NA,NA,NA,NA,NA,NA)
spider.1[6,]<-c("Urban",NA,NA, NA,NA,NA,NA,NA,NA)
spider.1[c('name1', 'name2')] <- str_split_fixed(spider.1$contrast, '/', 2)
names(spider.1)
names(spider.1)[10]<-c("LU")
spider.1$LU<-as.factor(spider.1$LU)
levels(spider.1$LU)<-c("Cropland","Pasture","Plantation","Primary","Secondary","Urban")
spider.1$LU<-
  factor(spider.1$LU,c("Primary","Secondary","Plantation","Pasture","Cropland","Urban"))
names(spider.1)[2]<-c("Odds")
spider.1$Odds<-as.numeric(spider.1$Odds)
spider.1$SE<-as.numeric(spider.1$SE)
spider.1$LU<-as.factor(spider.1$LU)
#add the model name
spider.1$model<-with(spider.1,"m_1")
data.m_continent<-spider.1

#3combine all the model-transfered result
data.model<-rbind(data.full,data.m_continent)
names(data.model)

#4claclate the mean and confidence interval 95%
#get the model result in our paper
model_result_paper<-data.model%>% filter(model=="Original")
library(dplyr)
model_result_cross<-data.model%>%group_by(LU) %>%
  dplyr::summarise(mean.ratio = mean(Odds, na.rm = TRUE),
            sd.ratio = sd(Odds, na.rm = TRUE),
            n.ratio = n()) %>%
  mutate(se.ratio = sd.ratio / sqrt(n.ratio))
model_result_cross<-merge(model_result_paper[,c(10,2,3)],model_result_cross[,c(1:2,5)],by="LU",all.x=T)
model_result_cross$se.ratio[model_result_cross$LU=="Primary"]<-NA
```

```{r}
####figure
all<-ggplot(model_result_paper , aes(LU , Odds,color=LU))+
  geom_point(aes(color=LU),size=2.5)+
  geom_errorbar(aes(ymin = Odds-SE , ymax = Odds+SE) ,width=0.4, 
                position = position_dodge(width=.6))+
  scale_y_continuous(name="Odds ratio of alien occurrence",
                     limits=c(0,300),breaks=seq(0,300,100))+
  scale_color_manual(name='LU-types',
                     values = c("#2166AC","#4393C3","#92C5DE",
                                "#F4A582","red","#B2182B"),
                     label=c('Primary','Secondary','Plantation',
                             'Pasture','Cropland','Urban'))+
  guides(color=FALSE)+
  theme_bw()+
  theme(panel.grid.major.x = element_blank() , 
        axis.ticks.length=unit(0.08,"inch"),
        panel.grid.major.y = element_line(size = 0.6 , colour = "grey90") ,
        panel.spacing = unit(0,"lines") , 
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_text(colour = "black",angle = 25, 
                                   size = 12,vjust = 0.6) ,
        axis.text.y = element_text(colour = "black",  size = 12),
        legend.title = element_text(face = 'bold'),
        legend.background = element_blank(),
        legend.box.background = element_blank(),
        legend.key = element_blank(),
        legend.direction =  "horizontal",legend.position = c(0.4,0.9)) 
all

#corss cheacking
names(model_result_cross)
all_cross<-ggplot(model_result_cross , aes(LU , mean.ratio,color=LU))+
  geom_point(aes(color=LU),size=2.5)+
  geom_errorbar(aes(ymin = mean.ratio-se.ratio , ymax = mean.ratio+se.ratio) ,width=0.4, 
                position = position_dodge(width=.6))+
  scale_y_continuous(name="Odds ratio of alien occurrence",
                     limits=c(0,300),breaks=seq(0,300,100))+
  scale_color_manual(name='LU-types',
                     values = c("#2166AC","#4393C3","#92C5DE",
                                "#F4A582","red","#B2182B"),
                     label=c('Primary','Secondary','Plantation',
                             'Pasture','Cropland','Urban'))+
  guides(color=FALSE)+
  theme_bw()+
  theme(panel.grid.major.x = element_blank() , 
        axis.ticks.length=unit(0.08,"inch"),
        panel.grid.major.y = element_line(size = 0.6 , colour = "grey90") ,
        panel.spacing = unit(0,"lines") , 
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_text(colour = "black",angle = 25, 
                                   size = 12,vjust = 0.6) ,
        axis.text.y = element_text(colour = "black",  size = 12),
        legend.title = element_text(face = 'bold'),
        legend.background = element_blank(),
        legend.box.background = element_blank(),
        legend.key = element_blank(),
        legend.direction =  "horizontal",legend.position = c(0.4,0.9)) 

all_cross

#com<-cowplot::plot_grid(all,all_cross,ncol=2,align = 'hv')
#com
ggsave(all_cross,filename = '/.../figxb.tiff',compression='lzw', width = 3,height = 3.0,dpi=200)
```


###plants
```{r}
db.size.t<-db.size[db.size$taxa=="Vascular plants",]
levels(db.size.t$LU)
db.size.t$LU<-
  factor(db.size.t$LU,c("Urban","SV","Plantation","Pasture","Cropland","Primary"))
db.size.t<-subset(db.size.t,!(LU %in% "Urban" & taxa %in%"Vascular plants"))
#0 the model used in the paper
dplyr::count(db.size.t,Biome)
m_paper <- glmer(Alien.presence ~ LU+ (1|SS/SSB) , data = db.size.t , family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

db.size.t_continent<-db.size.t[db.size.t$island_continent=="continent",]
m_continent<- glmer(Alien.presence ~ LU+ (1|SS/SSB) , data = db.size.t_continent , family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

####part2: model backtransfomration
#selelct the rows that compared to primary
pred.full<-m_paper %>% emmeans(specs = ~LU , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
pred.full_2<-pred.full[grepl("Primary",pred.full$contrast),]
pred.full_2$contrast<-as.character(pred.full_2$contrast)
pred.full_2[5,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
pred.full_2[6,]<-c("Urban",NA,NA, NA,NA,NA,NA,NA,NA)
library(stringr)
pred.full_2[c('name1', 'name2')] <- str_split_fixed(pred.full_2$contrast, '/', 2)
names(pred.full_2)
names(pred.full_2)[10]<-c("LU")
pred.full_2$LU<-as.factor(pred.full_2$LU)
levels(pred.full_2$LU)<-c("Cropland","Pasture","Plantation",
                          "Primary","Secondary", "Urban")
pred.full_2$LU<-
  factor(pred.full_2$LU,c("Primary","Secondary","Plantation",
                          "Pasture","Cropland","Urban"))
names(pred.full_2)[2]<-c("Odds")
pred.full_2$Odds<-as.numeric(pred.full_2$Odds)
pred.full_2$SE<-as.numeric(pred.full_2$SE)
pred.full_2$LU<-as.factor(pred.full_2$LU)
#add the model name
pred.full_2$model<-with(pred.full_2,"Original")
data.full<-pred.full_2

# for the model 1
pred.m_1<-m_continent %>% emmeans(specs = ~LU , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
#selelct the rows that compared to primary
pred.full_2<-pred.m_1[grepl("Primary",pred.m_1$contrast),]
pred.full_2$contrast<-as.character(pred.full_2$contrast)
pred.full_2[5,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
pred.full_2[6,]<-c("Urban",NA,NA, NA,NA,NA,NA,NA,NA)
library(stringr)
pred.full_2[c('name1', 'name2')] <- str_split_fixed(pred.full_2$contrast, '/', 2)
names(pred.full_2)
names(pred.full_2)[10]<-c("LU")
pred.full_2$LU<-as.factor(pred.full_2$LU)
levels(pred.full_2$LU)<-c("Cropland","Pasture","Plantation",
                          "Primary","Secondary", "Urban")
pred.full_2$LU<-
  factor(pred.full_2$LU,c("Primary","Secondary","Plantation",
                          "Pasture","Cropland","Urban"))
names(pred.full_2)[2]<-c("Odds")
pred.full_2$Odds<-as.numeric(pred.full_2$Odds)
pred.full_2$SE<-as.numeric(pred.full_2$SE)
pred.full_2$LU<-as.factor(pred.full_2$LU)
#add the model name
pred.full_2$model<-with(pred.full_2,"m_1")
data.m_continent<-pred.full_2

#3combine all the model-transfered result
data.model<-rbind(data.full,data.m_continent)
names(data.model)

#4claclate the mean and confidence interval 95%
#get the model result in our paper
model_result_paper<-data.model%>% filter(model=="Original")
library(dplyr)
model_result_cross<-data.model%>%group_by(LU) %>%
  dplyr::summarise(mean.ratio = mean(Odds, na.rm = TRUE),
            sd.ratio = sd(Odds, na.rm = TRUE),
            n.ratio = n()) %>%
  mutate(se.ratio = sd.ratio / sqrt(n.ratio))
model_result_cross<-merge(model_result_paper[,c(10,2,3)],model_result_cross[,c(1:2,5)],by="LU",all.x=T)
model_result_cross$se.ratio[model_result_cross$LU=="Primary"]<-NA
```

```{r}
####figure
all<-ggplot(model_result_paper , aes(LU , Odds,color=LU))+
  geom_point(aes(color=LU),size=2.5)+
  geom_errorbar(aes(ymin = Odds-SE , ymax = Odds+SE) ,width=0.4, 
                position = position_dodge(width=.6))+
  scale_y_continuous(name="Odds ratio of alien occurrence",
                     limits=c(0,30),breaks=seq(0,30,10))+
  scale_color_manual(name='LU-types',
                     values = c("#2166AC","#4393C3","#92C5DE",
                                "#F4A582","red","#B2182B"),
                     label=c('Primary','Secondary','Plantation',
                             'Pasture','Cropland','Urban'))+
  guides(color=FALSE)+
  theme_bw()+
  theme(panel.grid.major.x = element_blank() , 
        axis.ticks.length=unit(0.08,"inch"),
        panel.grid.major.y = element_line(size = 0.6 , colour = "grey90") ,
        panel.spacing = unit(0,"lines") , 
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_text(colour = "black",angle = 25, 
                                   size = 12,vjust = 0.6) ,
        axis.text.y = element_text(colour = "black",  size = 12),
        legend.title = element_text(face = 'bold'),
        legend.background = element_blank(),
        legend.box.background = element_blank(),
        legend.key = element_blank(),
        legend.direction =  "horizontal",legend.position = c(0.4,0.9)) 
all

#corss cheacking
names(model_result_cross)
all_cross<-ggplot(model_result_cross , aes(LU , mean.ratio,color=LU))+
  geom_point(aes(color=LU),size=2.5)+
  geom_errorbar(aes(ymin = mean.ratio-se.ratio , ymax = mean.ratio+se.ratio) ,width=0.4, 
                position = position_dodge(width=.6))+
  scale_y_continuous(name="Odds ratio of alien occurrence",
                     limits=c(0,30),breaks=seq(0,30,10))+
  scale_color_manual(name='LU-types',
                     values = c("#2166AC","#4393C3","#92C5DE",
                                "#F4A582","red","#B2182B"),
                     label=c('Primary','Secondary','Plantation',
                             'Pasture','Cropland','Urban'))+
  guides(color=FALSE)+
  theme_bw()+
  theme(panel.grid.major.x = element_blank() , 
        axis.ticks.length=unit(0.08,"inch"),
        panel.grid.major.y = element_line(size = 0.6 , colour = "grey90") ,
        panel.spacing = unit(0,"lines") , 
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_text(colour = "black",angle = 25, 
                                   size = 12,vjust = 0.6) ,
        axis.text.y = element_text(colour = "black",  size = 12),
        legend.title = element_text(face = 'bold'),
        legend.background = element_blank(),
        legend.box.background = element_blank(),
        legend.key = element_blank(),
        legend.direction =  "horizontal",legend.position = c(0.4,0.9)) 

all_cross

#com<-cowplot::plot_grid(all,all_cross,ncol=2,align = 'hv')
#com
ggsave(all_cross,filename = '/.../figxb.tiff',compression='lzw', width = 3,height = 3.0,dpi=200)
```
##5_2 non-native number
```{r}
db_alien <- subset(db.size , alien_freq > 0)
levels(db_alien$LU)
db_alien$LU<-
  factor(db_alien$LU,c("Primary","SV","Plantation","Pasture","Cropland","Urban"))
# reorder LU-intensity
db_alien$LUI <- factor(db_alien$LUI , levels = c("Minimal use" , "Light use" , "Intense use" , "Cannot decide"))
```
###overall full model
```{r}
#1)the model in the paper, with SS/SSB in the random factor
m_paper <- glmer(alien_freq ~ LU*LUI + (1|SS/SSB) , data = db_alien , family = poisson , 
           control = glmerControl(optimizer = "bobyqa" , 
                                  optCtrl = list(maxfun = 1e5)) , 
           nAGQ = 1 , subset = as.vector(db_alien$LUI != "Cannot decide"))
#2)for continents
db_alien_continent<-db_alien[db_alien$island_continent=="continent",]
m_continent <- glmer(alien_freq ~ LU*LUI + (1|SS/SSB) , data = db_alien_continent , family = poisson , 
           control = glmerControl(optimizer = "bobyqa" , 
                                  optCtrl = list(maxfun = 1e5)) , 
           nAGQ = 1 , subset = as.vector(db_alien_continent$LUI != "Cannot decide"))

###part2: model backtransfomration
#0. for full model in the paper used.
#calculates the estimated variances, standard deviation
 sds <- VarCorr(m_paper) %>% as.data.frame()
 sd.total <- sqrt(sds[1 , 5]^2 + sds[2 , 5]^2)
 # predict only LU (i.e. averaged over LUI, possible since no interactions)
data.full <- m_paper %>% emmeans(specs = ~LU*LUI , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% as.data.frame()
levels(data.full$LU)[1:2]<-c("Primary","Secondary")
# remove white space
data.full<-data.full%>%drop_na()
data.full$model<-with(data.full,"Original")
names(data.full)[3]<-c("num")

# for the model of m_1
#calculates the estimated variances, standard deviation
 sds <- VarCorr(m_continent) %>% as.data.frame()
 sd.total <- sqrt(sds[1 , 5]^2 + sds[2 , 5]^2)
 # predict only LU (i.e. averaged over LUI, possible since no interactions)
data.full_m_1 <- m_continent %>% emmeans(specs = ~LU*LUI , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% as.data.frame()
levels(data.full_m_1$LU)[1:2]<-c("Primary","Secondary")
# remove white space
data.full_m_1<-data.full_m_1%>%drop_na()
names(data.full_m_1)[3]<-c("num")
data.full_m_1$model<-with(data.full_m_1,"m_1")
data.m_1<-data.full_m_1

#3combine all the model-transfered result
data.model<-rbind(data.full,data.m_1)
names(data.model)

#4claclate the mean and confidence interval 95%
#get the model result in our paper
model_result_paper<-data.model%>% filter(model=="Original")
library(dplyr)
model_result_cross<-data.model%>%group_by(LU,LUI) %>%
  dplyr::summarise(mean.num = mean(num, na.rm = TRUE),
            sd.num = sd(num, na.rm = TRUE),
            n.num = n()) %>%
  mutate(se.num = sd.num / sqrt(n.num),
         lower.ci.num = mean.num - qt(1 - (0.05 / 2), n.num - 1) * se.num,
         upper.ci.num = mean.num + qt(1 - (0.05 / 2), n.num - 1) * se.num)
model_result_alien_sp<-merge(model_result_paper[,c(1:4)],model_result_cross[,c(1:3,6:8)],by=c("LU","LUI"),all.x=T)

```

```{r}
####figure
all_sp<-ggplot(model_result_alien_sp , aes(LU , num,shape=LUI,color=LU))+
  geom_errorbar(aes(ymin = num-SE , ymax = num+SE) ,width=0.4, 
                position = position_dodge(width=.6))+
  scale_y_continuous(name="Number of alien species",
                     limits=c(0.5,4),breaks=seq(0,4,1))+
  geom_point(aes(shape=LUI),position = position_dodge(width=.6),size=3.5)+
  scale_shape_manual(name="LU-intensity",values=c(15, 17, 18))+
  scale_color_manual(name='LU-types',
                     values = c("#2166AC","#4393C3","#92C5DE",
                                "#F4A582","red","#B2182B"),
                     label=c('Primary','Secondary','Plantation',
                             'Pasture','Cropland','Urban'))+
  guides(color=FALSE)+
  annotate(geom="text", x=0.818, y=1.45, label="a",size=4,color="#2166AC")+
  annotate(geom="text", x=1, y=2.1, label="bcd",size=4,color="#2166AC")+
  annotate(geom="text", x=1.2, y=2.7, label="bcd",size=4,color="#2166AC")+
  annotate(geom="text", x=1.82, y=2.7, label="b",size=4,color="#4393C3")+
  annotate(geom="text", x=2, y=2.55, label="bcd",size=4,color="#4393C3")+
  annotate(geom="text", x=2.2, y=2.4, label="abcd",size=4,color="#4393C3")+
  
  annotate(geom="text", x=2.82, y=3.15, label="bcd",size=4,color="#92C5DE")+
  annotate(geom="text", x=3, y=2.5, label="bcd",size=4,color="#92C5DE")+
  annotate(geom="text", x=3.2, y=1.8, label="abcd",size=4,color="#92C5DE")+ 
  annotate(geom="text", x=3.82, y=2.32, label="bcd",size=4,color="#F4A582")+
  annotate(geom="text", x=4, y=2.6, label="bc",size=4,color="#F4A582")+
  annotate(geom="text", x=4.2, y=2.5, label="abcd",size=4,color="#F4A582")+
  
  annotate(geom="text", x=4.82, y=2.7, label="bc",size=4,color="red")+
  annotate(geom="text", x=5, y=1.8, label="ad",size=4,color="red")+
  annotate(geom="text", x=5.2, y=2, label="acd",size=4,color="red")+
  annotate(geom="text", x=5.82, y=3, label="bcd",size=4,color="#B2182B")+ 
  annotate(geom="text", x=6, y=3.25, label="bcd",size=4,color="#B2182B")+ 
  annotate(geom="text", x=6.2, y=3.12, label="abcd",size=4,color="#B2182B")+  
  theme_bw()+
  theme(panel.grid.major.x = element_blank() , 
        axis.ticks.length=unit(0.08,"inch"),
        panel.grid.major.y = element_line(size = 0.6 , colour = "grey90") ,
        panel.spacing = unit(0,"lines") , 
        axis.title.x = element_blank(),
        axis.title.y = element_text(size=12),
        axis.text.x = element_text(colour = "black",angle = 25, 
                                   size = 12,vjust = 0.6) ,
        axis.text.y = element_text(colour = "black",  size = 12),
        legend.title = element_text(face = 'bold'),
        legend.background = element_blank(),
        legend.box.background = element_blank(),
        legend.key = element_blank(),
        legend.direction =  "horizontal",legend.position = c(0.5,0.94)) 
all_sp

#corss cheacking
names(model_result_alien_sp)
all_sp_cross<-ggplot(model_result_alien_sp , aes(LU , mean.num,shape=LUI,color=LU))+
    
  geom_errorbar(aes(ymin = mean.num-se.num , ymax = mean.num+se.num) ,width=0.4, 
                position = position_dodge(width=.6))+
    scale_y_continuous(name="Number of alien species",
                     limits=c(0.5,4),breaks=seq(0,4,1))+
  geom_point(aes(shape=LUI),position = position_dodge(width=.6),size=3.5)+
  scale_shape_manual(name="LU-intensity",values=c(15, 17, 18))+
  scale_color_manual(name='LU-types',
                     values = c("#2166AC","#4393C3","#92C5DE",
                                "#F4A582","red","#B2182B"),
                     label=c('Primary','Secondary','Plantation',
                             'Pasture','Cropland','Urban'))+
  guides(color=FALSE)+
  theme_bw()+
  theme(panel.grid.major.x = element_blank() , 
        axis.ticks.length=unit(0.08,"inch"),
        panel.grid.major.y = element_line(size = 0.6 , colour = "grey90") ,
        panel.spacing = unit(0,"lines") , 
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_text(colour = "black",angle = 25, 
                                   size = 12,vjust = 0.6) ,
        axis.text.y = element_text(colour = "black",  size = 12),
        legend.title = element_text(face = 'bold'),
        legend.background = element_blank(),
        legend.box.background = element_blank(),
        legend.key = element_blank(),
        legend.direction =  "horizontal",legend.position = c(0.4,0.9)) 

all_sp_cross

#com<-cowplot::plot_grid(all_sp,all_sp_cross,ncol=2,align = 'hv')
#com
ggsave(all_sp_cross,filename = '/.../fig2.bnew.tiff',compression='lzw', width = 10,height = 3.0,dpi=200)
```

### overall subset model
```{r}
db_alien <- subset(db.size , alien_freq > 0)

levels(db_alien$LU)
db_alien$LU<-
  factor(db_alien$LU,c("Primary","SV","Plantation","Pasture","Cropland","Urban"))
levels(db_alien$Biome)
dplyr::count(db_alien,Biome)

###part1: run the model
#there are 11 biomes , we will conduct 11 times for the leaving one biome out test
#1)the model in the paper, with SS/SSB in the random factor
m_paper <- glmer(alien_freq ~ LU + (1|SS/SSB) , data = db_alien , family = poisson , 
           control = glmerControl(optimizer = "bobyqa" , optCtrl = list(maxfun = 1e5)),nAGQ = 1 )
#2)leaving islands assemablges out
db_alien_continent<-db_alien[db_alien$island_continent=="continent",]
m_continent <- glmer(alien_freq ~ LU + (1|SS/SSB) , data = db_alien_continent , family = poisson , 
           control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#calculates the estimated variances, standard deviation
 sds <- VarCorr(m_paper) %>% as.data.frame()
 sd.total <- sqrt(sds[1 , 5]^2 + sds[2 , 5]^2)
 # predict only LU (i.e. averaged over LUI, possible since no interactions)
data.full <- m_paper %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% as.data.frame()
levels(data.full$LU)[1:2]<-c("Primary","Secondary")
# remove white space
data.full<-data.full%>%drop_na()
data.full$model<-with(data.full,"Original")
names(data.full)[2]<-c("num")

# for the model of m_1
#calculates the estimated variances, standard deviation
 sds <- VarCorr(m_continent) %>% as.data.frame()
 sd.total <- sqrt(sds[1 , 5]^2 + sds[2 , 5]^2)
 # predict only LU (i.e. averaged over LUI, possible since no interactions)
data.full_m_1 <- m_continent %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% as.data.frame()
levels(data.full_m_1$LU)[1:2]<-c("Primary","Secondary")
# remove white space
data.full_m_1<-data.full_m_1%>%drop_na()
names(data.full_m_1)[2]<-c("num")
data.full_m_1$model<-with(data.full_m_1,"m_1")
data.m_1<-data.full_m_1

#3combine all the model-transfered result
data.model<-rbind(data.full,data.m_1)
names(data.model)

#4claclate the mean and confidence interval 95%
#get the model result in our paper
model_result_paper<-data.model%>% filter(model=="Original")
library(dplyr)
model_result_cross<-data.model%>%group_by(LU) %>%
  dplyr::summarise(mean.num = mean(num, na.rm = TRUE),
            sd.num = sd(num, na.rm = TRUE),
            n.num = n()) %>%
  mutate(se.num = sd.num / sqrt(n.num))
model_result_alien_sp<-merge(model_result_paper[,c(1:4)],model_result_cross[,c(1:2,5)],by=c("LU"),all.x=T)
```

```{r}
####figure
all<-ggplot(model_result_alien_sp , aes(LU , num,color=LU))+
  geom_errorbar(aes(ymin = num-SE , ymax = num+SE) ,width=0.2, 
                position = position_dodge(width=.6))+
  scale_y_continuous(name="Number of alien species",
                     limits=c(-0.2,6),breaks=seq(0,6,2))+
  geom_point(position = position_dodge(width=.6),size=3)+
  scale_color_manual(name='LU-types',
                     values = c("#2166AC","#4393C3","#92C5DE",
                                "#F4A582","red","#B2182B"),
                     label=c('Primary','Secondary','Plantation',
                             'Pasture','Cropland','Urban'))+
  annotate(geom="text", x=1, y=2, label="a",size=4,color="#2166AC")+
  annotate(geom="text", x=2, y=2.8, label="b",size=4,color="#4393C3")+
  annotate(geom="text", x=3, y=2.7, label="bc",size=4,color="#92C5DE")+
  annotate(geom="text", x=4, y=2.6, label="bc",size=4,color="#F4A582")+
  annotate(geom="text", x=5, y=2.3, label="c",size=4,color="red")+
  annotate(geom="text", x=6, y=3.2, label="bc",size=4,color="#B2182B")+
  guides(colour = guide_legend(nrow = 1),shape=guide_legend(nrow = 1))+
  theme_bw()+
  theme(panel.grid.major.x = element_blank() , 
        axis.ticks.length=unit(0.08,"inch"),
        panel.grid.major.y = element_line(size = 0.6 , colour = "grey90") ,
        panel.spacing = unit(0,"lines") , 
        axis.title.x = element_blank(),
        axis.title.y = element_text(size=13),
        axis.text.x = element_text(colour = "black",angle = 25, 
                                   size = 12,vjust = 0.6) ,
        axis.text.y = element_text(colour = "black",  size = 12),
        legend.position = "none")
all
all_sp<-ggplot(model_result_alien_sp , aes(LU , mean.num,color=LU))+
    geom_point(aes(color=LU),size=2.5)+
  geom_errorbar(aes(ymin = mean.num-se.num , ymax = mean.num+se.num) ,width=0.4, 
                position = position_dodge(width=.6))+
  scale_y_continuous(name="Number of alien species",
                     limits=c(-0.2,6),breaks=seq(0,6,2))+
  geom_point(position = position_dodge(width=.6),size=3)+
  scale_color_manual(name='LU-types',
                     values = c("#2166AC","#4393C3","#92C5DE",
                                "#F4A582","red","#B2182B"),
                     label=c('Primary','Secondary','Plantation',
                             'Pasture','Cropland','Urban'))+
  guides(colour = guide_legend(nrow = 1),shape=guide_legend(nrow = 1))+
  theme_bw()+
  theme(panel.grid.major.x = element_blank() , 
        axis.ticks.length=unit(0.08,"inch"),
        panel.grid.major.y = element_line(size = 0.6 , colour = "grey90") ,
        panel.spacing = unit(0,"lines") , 
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_text(colour = "black",angle = 25, 
                                   size = 12,vjust = 0.6) ,
        axis.text.y = element_text(colour = "black",  size = 12),
        legend.position = "none")
all_sp
ggsave(all_sp,filename = '/.../all_sp_all.tiff',width = 3,height = 3,dpi = 200)
```
####Ants
```{r}
db_alien <- subset(db , alien_freq > 0)
db_alien.t<-db_alien[db_alien$taxa=="Ants",]
###part1: run the model
m_paper <- glmer(alien_freq ~ LU + (1|SS), data = db_alien.t , family = poisson)
db_alien.t_continent<-db_alien.t[db_alien.t$island_continent=="continent",]
m_continent <- glmer(alien_freq ~ LU + (1|SS), data = db_alien.t_continent , family = poisson)

#calculates the estimated variances, standard deviation
 sds <- VarCorr(m_paper) %>% as.data.frame()
 sd.total <- sqrt(sds[1 , 5]^2 )
 # predict only LU (i.e. averaged over LUI, possible since no interactions)
data.full <- m_paper %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% as.data.frame()
levels(data.full$LU)[1:2]<-c("Primary","Secondary")
# remove white space
data.full<-data.full%>%drop_na()
data.full$model<-with(data.full,"Original")
names(data.full)[2]<-c("num")

# for the model of m_1
#calculates the estimated variances, standard deviation
 sds <- VarCorr(m_continent) %>% as.data.frame()
 sd.total <- sqrt(sds[1 , 5]^2 )
 # predict only LU (i.e. averaged over LUI, possible since no interactions)
data.full_m_1 <- m_continent %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% as.data.frame()
levels(data.full_m_1$LU)[1:2]<-c("Primary","Secondary")
# remove white space
data.full_m_1<-data.full_m_1%>%drop_na()
names(data.full_m_1)[2]<-c("num")
data.full_m_1$model<-with(data.full_m_1,"m_1")
data.m_1<-data.full_m_1

#3combine all the model-transfered result
data.model<-rbind(data.full,data.m_1)
names(data.model)

#4claclate the mean and confidence interval 95%
#get the model result in our paper
model_result_paper<-data.model%>% filter(model=="Original")
library(dplyr)
model_result_cross<-data.model%>%group_by(LU) %>%
  dplyr::summarise(mean.num = mean(num, na.rm = TRUE),
            sd.num = sd(num, na.rm = TRUE),
            n.num = n()) %>%
  mutate(se.num = sd.num / sqrt(n.num))
model_result_alien_sp_ant<-merge(model_result_paper[,c(1:4)],model_result_cross[,c(1:2,5)],by=c("LU"),all.x=T)
```

####Birds
```{r}
#start there
db_alien.t<-db_alien[db_alien$taxa=="Birds",]
###part1: run the model
m_paper <- glmer(alien_freq ~ LU + (1|SS), data = db_alien.t , family = poisson)
db_alien.t_continent<-db_alien.t[db_alien.t$island_continent=="continent",]
m_continent <- glmer(alien_freq ~ LU + (1|SS), data = db_alien.t_continent , family = poisson)

#calculates the estimated variances, standard deviation
 sds <- VarCorr(m_paper) %>% as.data.frame()
 sd.total <- sqrt(sds[1 , 5]^2 )
 # predict only LU (i.e. averaged over LUI, possible since no interactions)
data.full <- m_paper %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% as.data.frame()
levels(data.full$LU)[1:2]<-c("Primary","Secondary")
# remove white space
data.full<-data.full%>%drop_na()
data.full$model<-with(data.full,"Original")
names(data.full)[2]<-c("num")

# for the model of m_1
#calculates the estimated variances, standard deviation
 sds <- VarCorr(m_continent) %>% as.data.frame()
 sd.total <- sqrt(sds[1 , 5]^2 )
 # predict only LU (i.e. averaged over LUI, possible since no interactions)
data.full_m_1 <- m_continent %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% as.data.frame()
levels(data.full_m_1$LU)[1:2]<-c("Primary","Secondary")
# remove white space
data.full_m_1<-data.full_m_1%>%drop_na()
names(data.full_m_1)[2]<-c("num")
data.full_m_1$model<-with(data.full_m_1,"m_1")
data.m_1<-data.full_m_1

#3combine all the model-transfered result
data.model<-rbind(data.full,data.m_1)
names(data.model)

#4claclate the mean and confidence interval 95%
#get the model result in our paper
model_result_paper<-data.model%>% filter(model=="Original")
library(dplyr)
model_result_cross<-data.model%>%group_by(LU) %>%
  dplyr::summarise(mean.num = mean(num, na.rm = TRUE),
            sd.num = sd(num, na.rm = TRUE),
            n.num = n()) %>%
  mutate(se.num = sd.num / sqrt(n.num))
model_result_alien_sp_bird<-merge(model_result_paper[,c(1:4)],model_result_cross[,c(1:2,5)],by=c("LU"),all.x=T)

```

####Spiders NOT WORKING
```{r}
#db_alien.t<-db_alien[db_alien$taxa=="Spiders",]
####part1: run the model
#m_paper <- glmer(alien_freq ~ LU + (1|SS), data = db_alien.t , family = poisson)
#db_alien.t_continent<-db_alien.t[db_alien.t$island_continent=="continent",]
#m_continent <- glmer(alien_freq ~ LU + (1|SS), data = db_alien.t_continent , family = poisson)
#
##calculates the estimated variances, standard deviation
# sds <- VarCorr(m_paper) %>% as.data.frame()
# sd.total <- sqrt(sds[1 , 5]^2 )
# # predict only LU (i.e. averaged over LUI, possible since no interactions)
#data.full <- m_paper %>% emmeans(specs = ~LU , type = "response") %>%
#  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% #as.data.frame()
#levels(data.full$LU)[1:2]<-c("Primary","Secondary")
## remove white space
#data.full<-data.full%>%drop_na()
#data.full$model<-with(data.full,"Original")
#names(data.full)[2]<-c("num")
#
## for the model of m_1
##calculates the estimated variances, standard deviation
# sds <- VarCorr(m_continent) %>% as.data.frame()
# sd.total <- sqrt(sds[1 , 5]^2 )
# # predict only LU (i.e. averaged over LUI, possible since no interactions)
#data.full_m_1 <- m_continent %>% emmeans(specs = ~LU , type = "response") %>%
#  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% #as.data.frame()
#levels(data.full_m_1$LU)[1:2]<-c("Primary","Secondary")
## remove white space
#data.full_m_1<-data.full_m_1%>%drop_na()
#names(data.full_m_1)[2]<-c("num")
#data.full_m_1$model<-with(data.full_m_1,"m_1")
#data.m_1<-data.full_m_1
#
##3combine all the model-transfered result
#data.model<-rbind(data.full,data.m_1)
#names(data.model)
#
##4claclate the mean and confidence interval 95%
##get the model result in our paper
#model_result_paper<-data.model%>% filter(model=="Original")
#library(dplyr)
#model_result_cross<-data.model%>%group_by(LU) %>%
#  dplyr::summarise(mean.num = mean(num, na.rm = TRUE),
#            sd.num = sd(num, na.rm = TRUE),
#            n.num = n()) %>%
#  mutate(se.num = sd.num / sqrt(n.num))
#model_result_alien_sp_spider<-merge(model_result_paper[,c(1:4)],model_result_cross[,c(1:2,5)],by=c("LU"),a#ll.x=T)
```

####Plants
```{r}
db_alien.t<-db_alien[db_alien$taxa=="Vascular plants",]
#1)the model in the paper, with SS/SSB in the random factor
m_paper <- glmer(alien_freq ~ LU + (1|SS/SSB) , data = db_alien.t , family = poisson , 
           control = glmerControl(optimizer = "bobyqa" , optCtrl = list(maxfun = 1e5)),nAGQ = 1 )
#2)leaving islands assemablges out
db_alien.t_continent<-db_alien.t[db_alien.t$island_continent=="continent",]
m_continent <- glmer(alien_freq ~ LU + (1|SS/SSB) , data = db_alien_continent , family = poisson , 
           control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#calculates the estimated variances, standard deviation
 sds <- VarCorr(m_paper) %>% as.data.frame()
 sd.total <- sqrt(sds[1 , 5]^2 + sds[2 , 5]^2)
 # predict only LU (i.e. averaged over LUI, possible since no interactions)
data.full <- m_paper %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% as.data.frame()
levels(data.full$LU)[1:2]<-c("Primary","Secondary")
# remove white space
data.full<-data.full%>%drop_na()
data.full$model<-with(data.full,"Original")
names(data.full)[2]<-c("num")

# for the model of m_1
#calculates the estimated variances, standard deviation
 sds <- VarCorr(m_continent) %>% as.data.frame()
 sd.total <- sqrt(sds[1 , 5]^2 + sds[2 , 5]^2)
 # predict only LU (i.e. averaged over LUI, possible since no interactions)
data.full_m_1 <- m_continent %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% as.data.frame()
levels(data.full_m_1$LU)[1:2]<-c("Primary","Secondary")
# remove white space
data.full_m_1<-data.full_m_1%>%drop_na()
names(data.full_m_1)[2]<-c("num")
data.full_m_1$model<-with(data.full_m_1,"m_1")
data.m_1<-data.full_m_1

#3combine all the model-transfered result
data.model<-rbind(data.full,data.m_1)
names(data.model)

#4claclate the mean and confidence interval 95%
#get the model result in our paper
model_result_paper<-data.model%>% filter(model=="Original")
library(dplyr)
model_result_cross<-data.model%>%group_by(LU) %>%
  dplyr::summarise(mean.num = mean(num, na.rm = TRUE),
            sd.num = sd(num, na.rm = TRUE),
            n.num = n()) %>%
  mutate(se.num = sd.num / sqrt(n.num))
model_result_alien_sp_plant<-merge(model_result_paper[,c(1:4)],model_result_cross[,c(1:2,5)],by=c("LU"),all.x=T)
```
###combine four taxa
```{r}
# birds,spiders and vascular plantx

model_result_alien_sp_bird$taxa<-with(model_result_alien_sp_bird,"Birds")
model_result_alien_sp_spider$taxa<-with(model_result_alien_sp_spider,"Spiders")
model_result_alien_sp_plant$taxa<-with(model_result_alien_sp_plant,"Vascular plants")
combine.cross<-rbind(model_result_alien_sp_bird,model_result_alien_sp_spider,model_result_alien_sp_plant)
combine.cross$taxa<-as.factor(combine.cross$taxa)
combine.cross$LU<-
  factor(combine.cross$LU,c("Primary","Secondary","Plantation","Pasture","Cropland","Urban"))
all.taxa<-ggplot(combine.cross , aes(LU , mean.num,color=taxa,shape=taxa))+
  geom_point(size=2.5,  position = position_dodge(0.6))+
  geom_errorbar(aes(ymin = mean.num-se.num , ymax = mean.num+se.num) ,width=0.4, 
                position = position_dodge(width=.6))+
  scale_y_continuous(name="Number of alien species",
                     limits=c(-0.2,6),breaks=seq(0,6,2))+
  geom_point(position = position_dodge(width=.6),size=3)+
  scale_shape_manual(name="Taxa",values=c(16,17,7), 
                     label=c('Ants','Birds','Vascular plants'))+
  scale_color_manual(name='Taxa',
                     values = c("brown1","lightgoldenrod4","magenta"),
                     label=c('Ants','Birds','Vascular plants'))+
  guides(colour = guide_legend(nrow = 1),shape=guide_legend(nrow = 1))+
  theme_bw()+
  theme(panel.grid.major.x = element_blank() , 
        axis.ticks.length=unit(0.08,"inch"),
        panel.grid.major.y = element_line(size = 0.6 , colour = "grey90") ,
        panel.spacing = unit(0,"lines") , 
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_text(colour = "black",angle = 25, 
                                   size = 12,vjust = 0.6) ,
        axis.text.y = element_text(colour = "black",  size = 12),
        legend.title = element_text(face = 'bold'),
        legend.background = element_blank(),
        legend.box.background = element_blank(),
        legend.key = element_blank(),
        legend.direction =  "horizontal",legend.position = c(0.45,0.92)) 
all.taxa
ggsave(all.taxa,filename = '/.../all.taxa.tiff',width = 6.0,height = 3,dpi = 200)
```



#5_3non-native proportions
```{r}
db_alien<-db.size[db.size$alien_freq>0,]
db_alien$alien_prop <- db_alien$alien_freq / db_alien$pred_freq
db_alien$LU<-
  factor(db_alien$LU,c("Primary","SV","Plantation","Pasture","Cropland","Urban"))
# alien proportion contains 1, therefore apply lemon squeezer following Smithson M, Verkuilen J (2006). "A Better Lemon Squeezer? Maximum-Likelihood Regression with Beta-Distributed Dependent Variables." Psychological Methods, 11 (1), 54-71
db_alien$alien_prop_squeezed <- (db_alien$alien_prop * (nrow(db_alien)-1) + 0.5) / nrow(db_alien)
dplyr::count(db_alien,LU,LUI)
```

###all taxa full model
```{r}
#1)the model in the paper, with SS/SSB in the random factor
db_alien_pro<-db_alien[db_alien$LUI != "Cannot decide",]
#since only 17 assembalges in urban under intense use, and 1 in continent, so we decide to not include it
#db_alien_pro<-subset(db_alien_pro,!(LU %in% "Urban" & LUI %in%"Intense use"))
dplyr::count(db_alien_pro,LU,LUI)
library(glmmTMB)
m_paper <- glmmTMB(alien_prop_squeezed ~ LU*LUI + (1|SS/SSB) , data = db_alien_pro , family = beta_family)
db_alien_pro_continent<-db_alien_pro[db_alien_pro$island_continent=="continent",]
dplyr::count(db_alien_pro_continent,LU,LUI)
#dplyr::count(db_alien_pro_continent,LU,LUI)
m_continent <- glmmTMB(alien_prop_squeezed ~ LU*LUI + (1|SS/SSB) , data = db_alien_pro_continent , family = beta_family)

# calculate combined effect for several random effects
VarCorr(m_paper)
sd.total <- sqrt(4.3679e-05 ^2+1.7201e+00^2)
# predict only LU (i.e. averaged over LUI, possible since no interactions)
pred.full <- m_paper %>% emmeans(specs = ~LU*LUI , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full)[3]<-c("Proportion")
levels(pred.full$LU)[1:2]<-c("Primary","Secondary")
pred.full$model<-with(pred.full,"Original")

# for m_1
VarCorr(m_continent)
sd.total <- sqrt(3.1914e-05^2+1.8175e+00^2)
# predict only LU (i.e. averaged over LUI, possible since no interactions)
pred.full_m_1 <- m_continent %>% emmeans(specs = ~LU*LUI , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full_m_1)[3]<-c("Proportion")
levels(pred.full_m_1$LU)[1:2]<-c("Primary","Secondary")
pred.full_m_1$model<-with(pred.full_m_1,"m_1")

#2_2combine all the model-transfered result
pred.full_model<-rbind(pred.full,pred.full_m_1)
names(pred.full_model)
#2_3claclate the mean and confidence interval 95%

#get the model result in our paper
model_result_paper<-pred.full_model%>% filter(model=="Original")
library(dplyr)
model_result_cross<-pred.full_model %>%group_by(LU,LUI) %>%
  dplyr::summarise(mean.prop = mean(Proportion, na.rm = TRUE),
            sd.prop = sd(Proportion, na.rm = TRUE),
            n.prop = n()) %>%
  mutate(se.prop = sd.prop / sqrt(n.prop))
model_result_alien_prop<-merge(model_result_paper[,c(1:4)],model_result_cross[,c(1:3,6)],by=c("LU","LUI"),all.x=T)
```

```{r}
###figure
all_pro<-ggplot(model_result_paper , aes(LU , Proportion,shape=LUI,color=LU))+
  geom_errorbar(aes(ymin = Proportion-SE , ymax = Proportion+SE) ,width=0.4, 
                position = position_dodge(width=.6))+
  scale_y_continuous(name="Alien proportions",
                     limits=c(0.25,0.6),breaks=seq(0.3,0.6,0.1))+
  geom_point(aes(shape=LUI),position = position_dodge(width=.6),size=3.5)+
  scale_shape_manual(name="LU-intensity",values=c(15, 17, 18))+
  scale_color_manual(name='LU-types',
                     values = c("#2166AC","#4393C3","#92C5DE",
                                "#F4A582","red","#B2182B"),
                     label=c('Primary','Secondary','Plantation',
                             'Pasture','Cropland','Urban'))+
  guides(color=FALSE)+
  annotate(geom="text", x=0.817, y=0.42, label="a",size=4,color="#2166AC")+
  annotate(geom="text", x=1, y=0.44, label="ab",size=4,color="#2166AC")+
  annotate(geom="text", x=1.2, y=0.5, label="abc",size=4,color="#2166AC")+
  annotate(geom="text", x=1.82, y=0.44, label="ab",size=4,color="#4393C3")+
  annotate(geom="text", x=2, y=0.44, label="ab",size=4,color="#4393C3")+
  annotate(geom="text", x=2.2, y=0.49, label="abc",size=4,color="#4393C3")+
  
  annotate(geom="text", x=2.82, y=0.46, label="abc",size=4,color="#92C5DE")+
  annotate(geom="text", x=3, y=0.48, label="bc",size=4,color="#92C5DE")+
  annotate(geom="text", x=3.2, y=0.51, label="bc",size=4,color="#92C5DE")+ 
  annotate(geom="text", x=3.818, y=0.46, label="abc",size=4,color="#F4A582")+
  annotate(geom="text", x=4, y=0.47, label="abc",size=4,color="#F4A582")+
  annotate(geom="text", x=4.2, y=0.475, label="abc",size=4,color="#F4A582")+
  
  annotate(geom="text", x=4.817, y=0.51, label="c",size=4,color="red")+
  annotate(geom="text", x=5, y=0.455, label="abc",size=4,color="red")+
  annotate(geom="text", x=5.2, y=0.46, label="abc",size=4,color="red")+
  annotate(geom="text", x=5.82, y=0.49, label="bc",size=4,color="#B2182B")+ 
  annotate(geom="text", x=6, y=0.495, label="abc",size=4,color="#B2182B")+ 
  annotate(geom="text", x=6.2, y=0.53, label="abc",size=4,color="#B2182B")+  
  theme_bw()+
  theme(panel.grid.major.x = element_blank() , 
        axis.ticks.length=unit(0.08,"inch"),
        panel.grid.major.y = element_line(size = 0.6 , colour = "grey90") ,
        panel.spacing = unit(0,"lines") , 
        axis.title.x = element_blank(),
        axis.title.y = element_text(size=12),
        axis.text.x = element_text(colour = "black",angle = 25, 
                                   size = 12,vjust = 0.6) ,
        axis.text.y = element_text(colour = "black",  size = 12),
        legend.title = element_text(face = 'bold'),
        legend.background = element_blank(),
        legend.box.background = element_blank(),
        legend.key = element_blank(),
        legend.direction =  "horizontal",legend.position = c(0.5,0.94)) 
all_pro

#for corss validate
all_cross<-ggplot(model_result_cross , aes(LU , mean.prop,shape=LUI,color=LU))+
  geom_errorbar(aes(ymin = mean.prop-se.prop , ymax = mean.prop+se.prop) ,width=0.4, 
                position = position_dodge(width=.6))+
  scale_y_continuous(name="Alien proportions",
                     limits=c(0.25,0.6),breaks=seq(0.3,0.6,0.1))+
  geom_point(aes(shape=LUI),position = position_dodge(width=.6),size=3.5)+
  scale_shape_manual(name="LU-intensity",values=c(15, 17, 18))+
  scale_color_manual(name='LU-types',
                     values = c("#2166AC","#4393C3","#92C5DE",
                                "#F4A582","red","#B2182B"),
                     label=c('Primary','Secondary','Plantation',
                             'Pasture','Cropland','Urban'))+
  guides(color=FALSE)+
  theme_bw()+
  theme(panel.grid.major.x = element_blank() , 
        axis.ticks.length=unit(0.08,"inch"),
        panel.grid.major.y = element_line(size = 0.6 , colour = "grey90") ,
        panel.spacing = unit(0,"lines") , 
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_text(colour = "black",angle = 25, 
                                   size = 12,vjust = 0.6) ,
        axis.text.y = element_text(colour = "black",  size = 12),
        legend.title = element_text(face = 'bold'),
        legend.background = element_blank(),
        legend.box.background = element_blank(),
        legend.key = element_blank(),
        legend.direction =  "horizontal",legend.position = c(0.4,0.9))
all_cross
#com<-cowplot::plot_grid(all_pro,all_cross,ncol=2,align = 'hv')
#com
ggsave(all_cross,filename = '/.../fig2c.bnew.tiff',compression='lzw', width = 10,height = 3.0,dpi=200)
```
### all taxa subset model
```{r}
####part1: run the model 
levels(db_alien$LU)
#0 the model used in the paper
m_paper <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS) , data = db_alien, family = beta_family)
#1 excluding the assemblages from islands
db_alien_continent<-db_alien[db_alien$island_continent=="continent",]
m_continent <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS) , data = db_alien_continent, family = beta_family)

#selelct the rows that compared to primary
VarCorr(m_paper)
sd.total <- sqrt(1.7288 ^2)
pred.full <- m_paper %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full)[2]<-"prob"
levels(pred.full$LU)[2]<-"Secondary"
#add the model name
pred.full$model<-with(pred.full,"Original")
data.full.all<-pred.full

# for the model 1
VarCorr(m_continent)
sd.total <- sqrt( 1.8456 ^2)
pred.full <- m_continent %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full)[2]<-"prob"
levels(pred.full$LU)[2]<-"Secondary"
#add the model name
pred.full$model<-with(pred.full,"Original")
data.full<-pred.full
#add the model name
data.full$model<-with(data.full,"m_1")
data.m_1<-data.full

#2_2combine all the model-transfered result
pred.full_model<-rbind(data.full.all,data.m_1)
names(pred.full_model)
#2_3claclate the mean and confidence interval 95%

#get the model result in our paper
model_result_paper<-pred.full_model%>% filter(model=="Original")
library(dplyr)
model_result_cross<-pred.full_model %>%group_by(LU) %>%
  dplyr::summarise(mean.prop = mean(prob, na.rm = TRUE),
            sd.prop = sd(prob, na.rm = TRUE),
            n.prop = n()) %>%
  mutate(se.prop = sd.prop / sqrt(n.prop))
model_result_alien_prop<-merge(model_result_paper[,c(1:3)],model_result_cross[,c(1:2,5)],by="LU",all.x=T)
```


```{r}
all<-ggplot(model_result_paper , aes(LU , prob,color=LU))+
  geom_errorbar(aes(ymin = prob-SE , ymax = prob+SE) ,width=0.2, 
                position = position_dodge(width=.6))+
  scale_y_continuous(name="Alien proportions",
                     limits=c(0,1),breaks=seq(0,0.9,0.3))+
  geom_point(position = position_dodge(width=.6),size=3)+
  scale_color_manual(name='LU-types',
                     values = c("#2166AC","#4393C3","#92C5DE",
                                "#F4A582","red","#B2182B"),
                     label=c('Primary','Secondary','Plantation',
                             'Pasture','Cropland','Urban'))+
  annotate(geom="text", x=1, y=0.38, label="a",size=4,color="#2166AC")+
  annotate(geom="text", x=2, y=0.43, label="b",size=4,color="#4393C3")+
  annotate(geom="text", x=3, y=0.47, label="bc",size=4,color="#92C5DE")+
  annotate(geom="text", x=4, y=0.43, label="abc",size=4,color="#F4A582")+
  annotate(geom="text", x=5, y=0.47, label="c",size=4,color="red")+
  annotate(geom="text", x=6, y=0.49, label="bc",size=4,color="#B2182B")+
  guides(colour = guide_legend(nrow = 1),shape=guide_legend(nrow = 1))+
  theme_bw()+
  theme(panel.grid.major.x = element_blank() , 
        axis.ticks.length=unit(0.08,"inch"),
        panel.grid.major.y = element_line(size = 0.6 , colour = "grey90") ,
        panel.spacing = unit(0,"lines") , 
        axis.title.x = element_blank(),
        axis.title.y = element_text(size=13),
        axis.text.x = element_text(colour = "black",angle = 25, 
                                   size = 12,vjust = 0.6) ,
        axis.text.y = element_text(colour = "black",  size = 12),
        legend.position = "none")
all
#ggsave(all,filename = '/.../all.tiff',width = 4.5,height = 3,dpi = 200)

all_sp_cross<-ggplot(model_result_alien_prop , aes(LU , mean.prop,color=LU))+
  geom_errorbar(aes(ymin = mean.prop-se.prop , ymax = mean.prop+se.prop) ,width=0.4, 
                position = position_dodge(width=.6))+
  scale_y_continuous(name="Alien proportions",
                     limits=c(0,1),breaks=seq(0,0.9,0.3))+
  geom_point(position = position_dodge(width=.6),size=3.5)+
  scale_shape_manual(name="LU-intensity",values=c(15, 17, 18))+
  scale_color_manual(name='LU-types',
                     values = c("#2166AC","#4393C3","#92C5DE",
                                "#F4A582","red","#B2182B"),
                     label=c('Primary','Secondary','Plantation',
                             'Pasture','Cropland','Urban'))+
  guides(color=FALSE)+
  theme_bw()+
  theme(panel.grid.major.x = element_blank() , 
        axis.ticks.length=unit(0.08,"inch"),
        panel.grid.major.y = element_line(size = 0.6 , colour = "grey90") ,
        panel.spacing = unit(0,"lines") , 
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_text(colour = "black",angle = 25, 
                                   size = 12,vjust = 0.6) ,
        axis.text.y = element_text(colour = "black",  size = 12),
        legend.title = element_text(face = 'bold'),
        legend.background = element_blank(),
        legend.box.background = element_blank(),
        legend.key = element_blank(),
        legend.direction =  "horizontal",legend.position = c(0.4,0.9)) 

all_sp_cross


#com<-cowplot::plot_grid(all_sp,all_sp_cross,ncol=2,align = 'hv')
#com
ggsave(all_sp_cross,filename = '/.../fig2.bnew.tiff',compression='lzw', width = 3,height = 3.0,dpi=200)

```

####Ants
```{r}
db_alien.t<-db_alien[db_alien$taxa=="Ants",]
m_paper <-  glmmTMB(alien_prop_squeezed ~ LU + (1|SS) , data = db_alien.t, family = beta_family)
db_alien.t_continent<-db_alien.t[db_alien.t$island_continent=="continent",]
m_continent <-  glmmTMB(alien_prop_squeezed ~ LU + (1|SS) , data = db_alien.t_continent, family = beta_family)

###part2: model backtransfomration
# calculate combined effect for several random effects
VarCorr(m_paper)
sd.total <- sqrt(1.4079   ^2)
# predict only LU (i.e. averaged over LUI, possible since no interactions)
pred.full <- m_paper %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full)[2]<-c("Prop")
levels(pred.full$LU)[1:2]<-c("Primary","Secondary")
pred.full$model<-with(pred.full,"Original")
pred.full<-pred.full

# for m_continent
VarCorr(m_continent)
sd.total <- sqrt(1.3598^2)
# predict only LU (i.e. averaged over LUI, possible since no interactions)
pred.full_m_1 <- m_continent %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full_m_1)[2]<-c("Prop")
levels(pred.full_m_1$LU)[1:2]<-c("Primary","Secondary")
pred.full_m_1$model<-with(pred.full_m_1,"m_1")

#2_2combine all the model-transfered result
pred.full_model<-rbind(pred.full,pred.full_m_1)
names(pred.full_model)
#2_3claclate the mean and confidence interval 95%
#get the model result in our paper
model_result_paper<-pred.full_model%>% filter(model=="Original")
library(dplyr)
model_result_cross<-pred.full_model %>%group_by(LU) %>%
  dplyr::summarise(mean.prop = mean(Prop, na.rm = TRUE),
            sd.prop = sd(Prop, na.rm = TRUE),
            n.prop = n()) %>%
  mutate(se.prop = sd.prop / sqrt(n.prop))
model_result_alien_ant<-merge(model_result_paper[,c(1:3)],model_result_cross[,c(1:2,5)],by="LU",all.x=T)
model_result_alien_ant$taxa<-with(model_result_alien_ant,"Ants")
```

####Birds
```{r}
db_alien.t<-db_alien[db_alien$taxa=="Birds",]
levels(db_alien.t$island_continent)
dplyr::count(db_alien.t,LU,island_continent)
m_paper <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS/SSB) , data = db_alien.t, family = beta_family)
db_alien.t_continent<-db_alien.t[db_alien.t$island_continent=="continent",]
m_continent <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS/SSB) , data = db_alien.t_continent, family = beta_family)
###part2: model backtransfomration
# calculate combined effect for several random effects
VarCorr(m_paper)
sd.total <- sqrt(0.14095  ^2+0.95297^2)
# predict only LU (i.e. averaged over LUI, possible since no interactions)
pred.full <- m_paper %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full)[2]<-c("Prop")
levels(pred.full$LU)[1:2]<-c("Primary","Secondary")
pred.full$model<-with(pred.full,"Original")
pred.full<-pred.full

# for m_continent
VarCorr(m_continent)
sd.total <- sqrt(0.048859^2+0.577426^2)
# predict only LU (i.e. averaged over LUI, possible since no interactions)
pred.full_m_1 <- m_continent %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full_m_1)[2]<-c("Prop")
levels(pred.full_m_1$LU)[1:2]<-c("Primary","Secondary")
pred.full_m_1$model<-with(pred.full_m_1,"m_1")

#2_2combine all the model-transfered result
pred.full_model<-rbind(pred.full,pred.full_m_1)
names(pred.full_model)
#2_3claclate the mean and confidence interval 95%
#get the model result in our paper
model_result_paper<-pred.full_model%>% filter(model=="Original")
library(dplyr)
model_result_cross<-pred.full_model %>%group_by(LU) %>%
  dplyr::summarise(mean.prop = mean(Prop, na.rm = TRUE),
            sd.prop = sd(Prop, na.rm = TRUE),
            n.prop = n()) %>%
  mutate(se.prop = sd.prop / sqrt(n.prop))
model_result_alien_bird<-merge(model_result_paper[,c(1:3)],model_result_cross[,c(1:2,5)],by="LU",all.x=T)
model_result_alien_bird$taxa<-with(model_result_alien_bird,"Birds")
```

####mammals
```{r}
db_alien.t<-db_alien[db_alien$taxa=="Mammals",]
db_alien.t<-db_alien.t[db_alien.t$LU!="Cropland",]

m_paper <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS) , data = db_alien.t, family = beta_family)
db_alien.t_continent<-db_alien.t[db_alien.t$island_continent=="continent",]
m_continent <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS) , data = db_alien.t_continent, family = beta_family)
###part2: model backtransfomration
# calculate combined effect for several random effects
VarCorr(m_paper)
sd.total <- sqrt(1.0719 ^2)
# predict only LU (i.e. averaged over LUI, possible since no interactions)
pred.full <- m_paper %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full)[2]<-c("Prop")
levels(pred.full$LU)[1:2]<-c("Primary","Secondary")
pred.full$model<-with(pred.full,"Original")
pred.full<-pred.full

# for m_continent
VarCorr(m_continent)
sd.total <- sqrt(0.92688 ^2)
# predict only LU (i.e. averaged over LUI, possible since no interactions)
pred.full_m_1 <- m_continent %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full_m_1)[2]<-c("Prop")
levels(pred.full_m_1$LU)[1:2]<-c("Primary","Secondary")
pred.full_m_1$model<-with(pred.full_m_1,"m_1")

#2_2combine all the model-transfered result
pred.full_model<-rbind(pred.full,pred.full_m_1)
names(pred.full_model)
#2_3claclate the mean and confidence interval 95%
#get the model result in our paper
model_result_paper<-pred.full_model%>% filter(model=="Original")
library(dplyr)
model_result_cross<-pred.full_model %>%group_by(LU) %>%
  dplyr::summarise(mean.prop = mean(Prop, na.rm = TRUE),
            sd.prop = sd(Prop, na.rm = TRUE),
            n.prop = n()) %>%
  mutate(se.prop = sd.prop / sqrt(n.prop))
model_result_alien_mammal<-merge(model_result_paper[,c(1:3)],model_result_cross[,c(1:2,5)],by="LU",all.x=T)
model_result_alien_mammal$taxa<-with(model_result_alien_mammal,"Mammals")
```
####Spiders
```{r}
db_alien.t<-db_alien[db_alien$taxa=="Spiders",]
levels(db_alien.t$LU)
dplyr::count(db_alien.t,Biome)
#db_alien.t<-db_alien.t[db_alien.t$Biome!="Mediterranean Forests, Woodlands & Scrub",]
m_paper <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS) , data = db_alien.t, family = beta_family)
db_alien.t_continent<-db_alien.t[db_alien.t$island_continent=="continent",]
m_continent <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS) , data = db_alien.t_continent, family = beta_family)
###part2: model backtransfomration
# calculate combined effect for several random effects
VarCorr(m_paper)
sd.total <- sqrt(0.38154 ^2)
# predict only LU (i.e. averaged over LUI, possible since no interactions)
pred.full <- m_paper %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full)[2]<-c("Prop")
levels(pred.full$LU)[1:2]<-c("Primary","Secondary")
pred.full$model<-with(pred.full,"Original")
pred.full<-pred.full

# for m_continent
VarCorr(m_continent)
sd.total <- sqrt(0.33684 ^2)
# predict only LU (i.e. averaged over LUI, possible since no interactions)
pred.full_m_1 <- m_continent %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full_m_1)[2]<-c("Prop")
levels(pred.full_m_1$LU)[1:2]<-c("Primary","Secondary")
pred.full_m_1$model<-with(pred.full_m_1,"m_1")

#2_2combine all the model-transfered result
pred.full_model<-rbind(pred.full,pred.full_m_1)
names(pred.full_model)
#2_3claclate the mean and confidence interval 95%
#get the model result in our paper
model_result_paper<-pred.full_model%>% filter(model=="Original")
library(dplyr)
model_result_cross<-pred.full_model %>%group_by(LU) %>%
  dplyr::summarise(mean.prop = mean(Prop, na.rm = TRUE),
            sd.prop = sd(Prop, na.rm = TRUE),
            n.prop = n()) %>%
  mutate(se.prop = sd.prop / sqrt(n.prop))
model_result_alien_spider<-merge(model_result_paper[,c(1:3)],model_result_cross[,c(1:2,5)],by="LU",all.x=T)
model_result_alien_spider$taxa<-with(model_result_alien_spider,"Spiders")
```


####Plants
```{r}
db_alien.t<-db_alien[db_alien$taxa=="Vascular plants",]
m_paper <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS/SSB) , data = db_alien.t, family = beta_family)
db_alien.t_continent<-db_alien.t[db_alien.t$island_continent=="continent",]
m_continent <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS/SSB) , data = db_alien.t_continent, family = beta_family)
###part2: model backtransfomration
# calculate combined effect for several random effects
VarCorr(m_paper)
sd.total <- sqrt(0.27306^2+1.26272^2)
# predict only LU (i.e. averaged over LUI, possible since no interactions)
pred.full <- m_paper %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full)[2]<-c("Prop")
levels(pred.full$LU)[1:2]<-c("Primary","Secondary")
pred.full$model<-with(pred.full,"Original")
pred.full<-pred.full

# for m_continent
VarCorr(m_continent)
sd.total <- sqrt(0.28049^2+1.39490 ^2)
# predict only LU (i.e. averaged over LUI, possible since no interactions)
pred.full_m_1 <- m_continent %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full_m_1)[2]<-c("Prop")
levels(pred.full_m_1$LU)[1:2]<-c("Primary","Secondary")
pred.full_m_1$model<-with(pred.full_m_1,"m_1")

#2_2combine all the model-transfered result
pred.full_model<-rbind(pred.full,pred.full_m_1)
names(pred.full_model)
#2_3claclate the mean and confidence interval 95%
#get the model result in our paper
model_result_paper<-pred.full_model%>% filter(model=="Original")
library(dplyr)
model_result_cross<-pred.full_model %>%group_by(LU) %>%
  dplyr::summarise(mean.prop = mean(Prop, na.rm = TRUE),
            sd.prop = sd(Prop, na.rm = TRUE),
            n.prop = n()) %>%
  mutate(se.prop = sd.prop / sqrt(n.prop))
model_result_alien_plant<-merge(model_result_paper[,c(1:3)],model_result_cross[,c(1:2,5)],by="LU",all.x=T)
model_result_alien_plant$taxa<-with(model_result_alien_plant,"Vascular plants")
```
####combine
```{r}

combine.cross<-rbind(model_result_alien_ant,model_result_alien_bird,model_result_alien_mammal,model_result_alien_spider,model_result_alien_plant)
combine.cross$taxa<-as.factor(combine.cross$taxa)

combine.cross$LU<-
  factor(combine.cross$LU,c("Primary","Secondary","Plantation","Pasture","Cropland","Urban"))
all.taxa<-ggplot(combine.cross , aes(LU , mean.prop,color=taxa,shape=taxa))+
  geom_point(size=2.5,  position = position_dodge(0.6))+
  geom_errorbar(aes(ymin = mean.prop-se.prop , ymax = mean.prop+se.prop) ,width=0.4, 
                position = position_dodge(0.6))+
  scale_y_continuous(name="Number of alien species",
                     limits=c(0,1),breaks=seq(0,0.9,0.3))+
  scale_shape_manual(name="Taxa",values=c(16,17,15,3,7), 
                     label=c('Ants','Birds',"Mammals",'Spiders','Vascular plants'))+
  scale_color_manual(name='Taxa',
                     values = c("brown1","lightgoldenrod4","cyan2","dodgerblue","magenta"),
                     label=c('Ants','Birds',"Mammals",'Spiders','Vascular plants'))+
  guides(colour = guide_legend(nrow = 1),shape=guide_legend(nrow = 1))+
  theme_bw()+
  theme(panel.grid.major.x = element_blank() , 
        axis.ticks.length=unit(0.08,"inch"),
        panel.grid.major.y = element_line(size = 0.6 , colour = "grey90") ,
        panel.spacing = unit(0,"lines") , 
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_text(colour = "black",angle = 25, 
                                   size = 12,vjust = 0.6) ,
        axis.text.y = element_text(colour = "black",  size = 12),
        legend.title = element_text(face = 'bold'),
        legend.background = element_blank(),
        legend.box.background = element_blank(),
        legend.key = element_blank(),
        legend.direction =  "horizontal",legend.position = c(0.45,0.92)) 
all.taxa
ggsave(all.taxa,filename = '/.../all.taxa.tiff',width = 6.0,height = 3,dpi = 200)
```

