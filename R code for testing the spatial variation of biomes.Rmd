---
title: "test spatial variability"
output: html_document
---
```{r}
#explaination 
#1 adding the biomes into the random factor using full model (=LU*LUI) and subset model (=LU) for alien incidence, species number and proportions.
#2 Running the full model and subset model by leaving one biome out method. The mean modeled values, SE, 95% confidence were obtained for alien incidence, species number and proportions.


```
##import the packages
```{r}
#install the packages and library
#install.packages("lme4")
#install.packages("emmeans")
#install.packages("tidyverse")
#install.packages("data.table")
#install.packages("lme4")
#install.packages("ggplot2")
#install.packages("DHARMa")
library(lme4)
library(data.table)
library(emmeans)
library(multcomp)
library(lme4)
library(ggplot2)
library(tidyverse)
library(DHARMa)
library(glmmTMB)
```
#0.import the data
```{r}
db<-read.csv(file = '/.../data.csv',sep=";",stringsAsFactors=T)
#the alien ratio is wrong
db$alien_all<-with(db,alien_freq/pred_freq)
levels(as.factor(db$LU))
db$LU<-
  factor(db$LU,c("Primary","SV","Plantation","Pasture","Cropland","Urban"))
levels(as.factor(db$LUI))
db$LUI<-
  factor(db$LUI,c("Cannot decide","Minimal use","Light use","Intense use"))
#run on the right
db%>%summarise(tax_count=plyr::count(taxa))
# Alien presence/absence for logistical model. 
db$Alien.presence <- as.logical(db$alien_freq)
# make proportion of aliens
db$alien_prop <- db$alien_freq / db$pred_freq
# alien proportion contains 1, therefore apply lemon squeezer following Smithson M, Verkuilen J (2006). "A Better Lemon Squeezer? Maximum-Likelihood Regression with Beta-Distributed Dependent Variables." Psychological Methods, 11 (1), 54-71
db$alien_prop_squeezed <- (db$alien_prop * (nrow(db)-1) + 0.5) / nrow(db)

#check the biomes of local assemblages
db$Biome<-as.factor(db$Biome)
levels(db$Biome)
dplyr::count(db,Biome)
```

#1. adding biomes in random
#1.1non-native incidence
###all taxa full model
```{r}
db.full.test <- subset(db,!(LU %in% "Urban" & LUI %in%"Intense use"))
#1change the refernce for LU
levels(db.full.test$LU)
db.full.test$LU = factor(db.full.test$LU, levels=c("Primary","SV","Plantation","Cropland","Pasture","Urban"))
db.full.test$LU = factor(db.full.test$LU, levels=c("Pasture","Urban","Cropland", "Plantation","SV", "Primary"))
levels(db.full.test$LUI)
db.full.test$LUI = factor(db.full.test$LUI, levels=c("Cannot decide","Minimal use","Light use","Intense use"))
db.full.test$LUI = factor(db.full.test$LUI, levels=c("Intense use", "Light use","Minimal use","Cannot decide"))

#1 the model in the paper, with SS/SSB in the random factor
m_paper <- glmer(Alien.presence ~ LU*LUI + (1|SS/SSB) , 
          data = db.full.test , family = binomial , 
          control = glmerControl(optimizer = "bobyqa" , 
                                 optCtrl = list(maxfun = 1e5)),
           nAGQ = 1 , subset = as.vector(db.full.test$LUI != "Cannot decide"))
#2 adding model, with SS/SSB/Biome in the random factor
m_adding <- glmer(Alien.presence ~ LU*LUI + (1|SS/SSB/Biome) , 
          data = db.full.test , family = binomial , 
          control = glmerControl(optimizer = "bobyqa" , 
                                 optCtrl = list(maxfun = 1e5)),
           nAGQ = 1 , subset = as.vector(db.full.test$LUI != "Cannot decide"))

AIC(m_paper);AIC(m_adding)# deltAIC < 2
anova(m_paper,m_adding)# p=0.04808
#Decision: it does not satisfy the criterial of both AIC<2 and p <0.05.
```
###all taxa subset model
```{r}
levels(db$LU)
#change teh reference is disturbed types to primary
db$LU = factor(db$LU, levels=c("Pasture","Urban","Cropland", "Plantation","SV", "Primary"))

m_paper <- glmer(Alien.presence ~ LU + (1|SS/SSB) , 
          data = db , family = binomial , 
          control = glmerControl(optimizer = "bobyqa" , 
                                 optCtrl = list(maxfun = 1e5)),nAGQ = 1)
m_adding <- glmer(Alien.presence ~ LU + (1|SS/SSB/Biome) , 
          data = db , family = binomial , 
          control = glmerControl(optimizer = "bobyqa" , 
                                 optCtrl = list(maxfun = 1e5)),nAGQ = 1)
AIC(m_paper);AIC(m_adding)# deltAIC < 2
anova(m_paper,m_adding)# p=0.1122
#Decision: it does not satisfy the criterial of both AIC<2 and p <0.05.
```

####Ants
```{r}
db.t_ants<-db[db$taxa=="Ants",]
m_paper <- glmer(Alien.presence ~ LU + (1|SS/SSB) , 
          data = db.t_ants , family = binomial , 
          control = glmerControl(optimizer = "bobyqa" , optCtrl = list(maxfun = 1e5)),nAGQ = 1)
m_adding <- glmer(Alien.presence ~ LU + (1|SS/SSB/Biome) , 
          data = db.t_ants , family = binomial , 
          control = glmerControl(optimizer = "bobyqa" , optCtrl = list(maxfun = 1e5)),nAGQ = 1)
AIC(m_paper);AIC(m_adding)# deltAIC = 2
anova(m_paper,m_adding)# p=0.9998, no significance for the two models
#Decision: it does not satisfy the criterial of both AIC<2 and p <0.05.
```

####birds
```{r}
db.t_birds<-db[db$taxa=="Birds",]
m_paper <- glmer(Alien.presence ~ LU + (1|SS/SSB) , 
          data = db.t_birds , family = binomial , 
          control = glmerControl(optimizer = "bobyqa" , optCtrl = list(maxfun = 1e5)),nAGQ = 1)
m_adding <- glmer(Alien.presence ~ LU + (1|SS/SSB/Biome) , 
          data = db.t_birds , family = binomial , 
          control = glmerControl(optimizer = "bobyqa" , optCtrl = list(maxfun = 1e5)),nAGQ = 1)
AIC(m_paper);AIC(m_adding)# deltAIC = 2
anova(m_paper,m_adding)# p=1, no significance for the two models
#decision: #No differences for the variables, see below.
```
####mammals
```{r}
db.t_mam<-db[db$taxa=="Mammals",]
db.t_mam<-subset(db.t_mam,!(LU %in% "Urban" & taxa %in%"Mammals"))
db.t_mam<-subset(db.t_mam,!(LU %in% "Cropland" & taxa %in%"Mammals"))
m_paper <- glmer(Alien.presence ~ LU + (1|SS/SSB) , 
          data = db.t_mam , family = binomial , 
          control = glmerControl(optimizer = "bobyqa" , optCtrl = list(maxfun = 1e5)),nAGQ = 1)
m_adding <- glmer(Alien.presence ~ LU + (1|SS/SSB/Biome) , 
          data = db.t_mam , family = binomial , 
          control = glmerControl(optimizer = "bobyqa" , optCtrl = list(maxfun = 1e5)),nAGQ = 1)
AIC(m_paper);AIC(m_adding)# deltAIC < 2
anova(m_paper,m_adding)# p=0.991, no significance for the two models
#decision: No differences for the variables
```

####Spiders
```{r}
db.t_spiders<-db[db$taxa=="Spiders",]
db.t_spiders<-subset(db.t_spiders,!(LU %in% "Plantation" & taxa %in%"Spiders"))
db.t_spiders<-subset(db.t_spiders,!(LU %in% "Urban" & taxa %in%"Spiders"))

m_paper <- glmer(Alien.presence ~ LU + (1|SS/SSB) , 
          data = db.t_spiders , family = binomial , 
          control = glmerControl(optimizer = "bobyqa" , optCtrl = list(maxfun = 1e5)),nAGQ = 1)
m_adding <- glmer(Alien.presence ~ LU + (1|SS/SSB/Biome) , 
          data = db.t_spiders , family = binomial , 
          control = glmerControl(optimizer = "bobyqa" , optCtrl = list(maxfun = 1e5)),nAGQ = 1)
AIC(m_paper);AIC(m_adding)# deltAIC < 2
anova(m_paper,m_adding)# p=0.9976, no significance for the two models
#No differences for the variables
```

####plants
```{r}
db.t_plants<-db[db$taxa=="Vascular plants",]
db.t_plants<-subset(db.t_plants,!(LU %in% "Urban" & taxa %in%"Vascular plants"))

m_paper <- glmer(Alien.presence ~ LU + (1|SS/SSB) , 
          data = db.t_plants , family = binomial , 
          control = glmerControl(optimizer = "bobyqa" , optCtrl = list(maxfun = 1e5)),nAGQ = 1)
m_adding <- glmer(Alien.presence ~ LU + (1|SS/SSB/Biome) , 
          data = db.t_plants , family = binomial , 
          control = glmerControl(optimizer = "bobyqa" , optCtrl = list(maxfun = 1e5)),nAGQ = 1)
AIC(m_paper);AIC(m_adding)# deltAIC = 2
anova(m_paper,m_adding)# p=0.992, no significance for the two models
#decision: No differences for the variables, see below.
```
##1.2non-native number
```{r}
db_alien <- subset(db , alien_freq > 0)
levels(db_alien$LU)
db_alien$LU<-
  factor(db_alien$LU,c("Primary","SV","Plantation","Pasture","Cropland","Urban"))
# reorder LU-intensity
db_alien$LUI <- factor(db_alien$LUI , levels = c("Minimal use" , "Light use" , "Intense use" , "Cannot decide"))
```

###all taxa full model
```{r}
#1)the model in the paper, with SS/SSB in the random factor
m_paper <- glmer(alien_freq ~ LU*LUI + (1|SS/SSB) , data = db_alien , family = poisson , 
           control = glmerControl(optimizer = "bobyqa" , 
                                  optCtrl = list(maxfun = 1e5)) , 
           nAGQ = 1 , subset = as.vector(db_alien$LUI != "Cannot decide"))
#2)adding model, with SS/SSB/Biome in the random factor
m_adding <- glmer(alien_freq ~ LU*LUI + (1|SS/SSB/Biome) , data = db_alien , family = poisson , 
           control = glmerControl(optimizer = "bobyqa" , 
                                  optCtrl = list(maxfun = 1e5)) , 
           nAGQ = 1 , subset = as.vector(db_alien$LUI != "Cannot decide"))
AIC(m_paper);AIC(m_adding)# deltAIC = 2
anova(m_paper,m_adding)# p=0.9998, no significance for the two models
#No differences for the variables, see below
```

### all taxa subset model
```{r}
m_paper  <- glmer(alien_freq ~ LU + (1|SS/SSB), data = db_alien , family = poisson)
m_adding  <- glmer(alien_freq ~ LU + (1|SS/SSB/Biome), data = db_alien , family = poisson)

AIC(m_paper);AIC(m_adding)# deltAIC = 2
anova(m_paper,m_adding)# p=1, no significance for the two models
#No differences for the variables, see below
```


####Ants
```{r}
db.ant<-db_alien[db_alien$taxa=="Ants",]
m_paper <- glmer(alien_freq ~ LU + (1|SS), data = db.ant , family = poisson)
m_adding <- glmer(alien_freq ~ LU + (1|SS/Biome), data = db.ant , family = poisson)
AIC(m_paper);AIC(m_adding)# deltAIC = 2
anova(m_paper,m_adding)# p=0.9999, no significance for the two models
#No differences for the variables, see below
```

####Birds
```{r}
db.bird<-db_alien[db_alien$taxa=="Birds",]
library(glmmTMB)
m_paper <- glmmTMB(alien_freq ~ LU + (1|SS) , data = db.bird , family = compois)
m_adding <- glmmTMB(alien_freq ~ LU + (1|SS/Biome) , data = db.bird , family = compois)
AIC(m_paper);AIC(m_adding)# deltAIC = 2
anova(m_paper,m_adding)# p=1, no significance for the two models
#No differences for the variables, see below
```

####Spiders
```{r}
db.spider<-db_alien[db_alien$taxa=="Spiders",]
m_paper <- glmmTMB(alien_freq ~ LU + (1|SS) , data = db.spider , family = compois)
m_adding <- glmmTMB(alien_freq ~ LU + (1|SS/Biome) , data = db.spider , family = compois)
AIC(m_paper);AIC(m_adding)# deltAIC = 2
anova(m_paper,m_adding)# p=1, no significance for the two models
#No differences for the variables, see below
```

####Plants
```{r}
db.plant<-db_alien[db_alien$taxa=="Vascular plants",]
m_paper <- glmer(alien_freq ~ LU + (1|SS/SSB) , data = db.plant, family = poisson)
m_adding <- glmer(alien_freq ~ LU + (1|SS/SSB/Biome) , data = db.plant, family = poisson)
AIC(m_paper);AIC(m_adding)# deltAIC = 2
anova(m_paper,m_adding)# p=1, no significance for the two models
#No differences for the variables, see below

```

#1.3non-native proportions
```{r}
db_alien<-db[db$alien_freq>0,]
```

###all taxa full model
```{r}
#1)the model in the paper, with SS/SSB in the random factor
library(glmmTMB)
m_paper <- glmmTMB(alien_prop_squeezed ~ LU*LUI + (1|SS/SSB) , data = db_alien[db_alien$LUI != "Cannot decide" , ] , 
                   family = beta_family)
#2)adding model, with SS/SSB/Biome in the random factor
m_adding <- glmmTMB(alien_prop_squeezed ~ LU*LUI + (1|SS/SSB/Biome) , data = db_alien[db_alien$LUI != "Cannot decide" , ] , 
                    family = beta_family)
AIC(m_paper);AIC(m_adding)# deltAIC = 2
anova(m_paper,m_adding)# p=0.9996, no significance for the two models
#No differences for the variables, see below
```

### all taxa subset model
```{r}
m_paper  <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS) , data = db_alien, family = beta_family)

m_adding  <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS/Biome) , data = db_alien, family = beta_family)

AIC(m_paper);AIC(m_adding)# deltAIC < 2
anova(m_paper,m_adding)# p=0.1508, no significance for the two models
#No differences for the variables, see below
```

####Ants
```{r}
db_alien.t<-db_alien[db_alien$taxa=="Ants",]
m_paper <-  glmmTMB(alien_prop_squeezed ~ LU + (1|SS) , data = db_alien.t, family = beta_family)
m_adding <-  glmmTMB(alien_prop_squeezed ~ LU + (1|SS/Biome) , data = db_alien.t, family = beta_family)

AIC(m_paper);AIC(m_adding)# deltAIC = 2
anova(m_paper,m_adding)# p=1, no significance for the two models
#No differences for the variables, see below
```

####Birds
```{r}
db_alien.t<-db_alien[db_alien$taxa=="Birds",]
db_alien.t<-db_alien.t[db_alien.t$Biome!="Tropical & Subtropical Dry Broadleaf Forests",]
levels(db_alien.t$Biome)
dplyr::count(db_alien.t,Biome)
m_paper <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS/SSB) , data = db_alien.t, family = beta_family)
m_adding <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS/SSB/Biome) , data = db_alien.t, family = beta_family)
AIC(m_paper);AIC(m_adding)# deltAIC = 2
anova(m_paper,m_adding)# p=1, no significance for the two models
#No differences for the variables
```

####mammals
```{r}
db_alien.t<-db_alien[db_alien$taxa=="Mammals",]
db_alien.t<-db_alien.t[db_alien.t$LU!="Cropland",]
m_paper <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS) , data = db_alien.t, family = beta_family)
m_adding <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS/Biome) , data = db_alien.t, family = beta_family)
AIC(m_paper);AIC(m_adding)# deltAIC = 2
anova(m_paper,m_adding)# p=1, no significance for the two models
#No differences for the variables, see below
```


####Spiders
```{r}
db_alien.t<-db_alien[db_alien$taxa=="Spiders",]
levels(db_alien.t$Biome)
dplyr::count(db_alien.t,Biome)
#db_alien.t<-db_alien.t[db_alien.t$Biome!="Mediterranean Forests, Woodlands & Scrub",]
m_paper <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS) , data = db_alien.t, family = beta_family)
m_adding <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS/Biome) , data = db_alien.t, family = beta_family)#not working
AIC(m_paper);AIC(m_adding)# deltAIC = 2
anova(m_paper,m_adding)# p=1, no significance for the two models
#No differences for the variables, see below

```


###Plants
```{r}
db_alien.t<-db_alien[db_alien$taxa=="Vascular plants",]
m_paper <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS/SSB) , data = db_alien.t, family = beta_family)
m_adding <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS/SSB/Biome) , data = db_alien.t, family = beta_family)

AIC(m_paper);AIC(m_adding)# deltAIC < 2
anova(m_paper,m_adding)# p=0.6703, no significance for the two models
summary(m_paper);summary(m_adding) #No differences for the variables, see below

```


##2.cross validation
##2.1alien occurrence 
###overall full model
```{r}
####part1: run the model
db.full.test <- subset(db,!(LU %in% "Urban" & LUI %in%"Intense use"))
#1change the refernce for LU
levels(db.full.test$LU)
db.full.test$LU = factor(db.full.test$LU, levels=c("Primary","SV","Plantation","Cropland","Pasture","Urban"))
db.full.test$LU = factor(db.full.test$LU, levels=c("Pasture","Urban","Cropland", "Plantation","SV", "Primary"))
levels(db.full.test$LUI)
db.full.test$LUI = factor(db.full.test$LUI, levels=c("Cannot decide","Minimal use","Light use","Intense use"))
db.full.test$LUI = factor(db.full.test$LUI, levels=c("Intense use", "Light use","Minimal use","Cannot decide"))

#0 the model used in the paper
db.full.test_full<-db.full.test[db.full.test$LUI != "Cannot decide",]
m_paper <- glmer(Alien.presence ~ LU*LUI + (1|SS/SSB) , data = db.full.test_full , family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#1 excluding the assemblages from biome of #Boreal Forests/Taiga
db.full.test_1<-db.full.test_full[db.full.test_full$Biome != "Boreal Forests/Taiga",]
m_1 <- glmer(Alien.presence ~ LU*LUI + (1|SS/SSB) , data = db.full.test_1 , family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#2 excluding the assemblages from biome of #Deserts & Xeric Shrublands
db.full.test_2<-db.full.test_full[db.full.test_full$Biome != "Deserts & Xeric Shrublands",]
m_2 <- glmer(Alien.presence ~ LU*LUI + (1|SS/SSB) , data = db.full.test_2 , family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#3 excluding the assemblages from biome of #Flooded Grasslands & Savannas
db.full.test_3<-db.full.test_full[db.full.test_full$Biome != "Flooded Grasslands & Savannas",]
m_3 <- glmer(Alien.presence ~ LU*LUI + (1|SS/SSB) , data = db.full.test_3 , family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#4 excluding the assemblages from biome of #Mangroves
db.full.test_4<-db.full.test_full[db.full.test_full$Biome != "Mangroves",]
m_4 <- glmer(Alien.presence ~ LU*LUI + (1|SS/SSB) , data = db.full.test_4 , family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#5 excluding the assemblages from biome of #Mediterranean Forests, Woodlands & Scrub
db.full.test_5<-db.full.test_full[db.full.test_full$Biome != "Mediterranean Forests, Woodlands & Scrub",]
m_5 <- glmer(Alien.presence ~ LU*LUI + (1|SS/SSB) , data = db.full.test_5, family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#6 excluding the assemblages from biome of #Montane Grasslands & Shrublands
db.full.test_6<-db.full.test_full[db.full.test_full$Biome != "Montane Grasslands & Shrublands",]
m_6 <- glmer(Alien.presence ~ LU*LUI + (1|SS/SSB) , data = db.full.test_6, family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#7 excluding the assemblages from biome of #Temperate Broadleaf & Mixed Forests
db.full.test_7<-db.full.test_full[db.full.test_full$Biome != "Temperate Broadleaf & Mixed Forests",]
m_7 <- glmer(Alien.presence ~ LU*LUI + (1|SS/SSB) , data = db.full.test_7, family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#8 excluding the assemblages from biome of #Temperate Conifer Forests
db.full.test_8<-db.full.test_full[db.full.test_full$Biome != "Temperate Conifer Forests",]
m_8 <- glmer(Alien.presence ~ LU*LUI + (1|SS/SSB) , data = db.full.test_8, family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#9 excluding the assemblages from biome of #Temperate Grasslands, Savannas & Shrublands
db.full.test_9<-db.full.test_full[db.full.test_full$Biome != "Temperate Grasslands, Savannas & Shrublands",]
m_9 <- glmer(Alien.presence ~ LU*LUI + (1|SS/SSB) , data = db.full.test_9, family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#10 excluding the assemblages from biome of #Tropical & Subtropical Coniferous Forests
db.full.test_10<-db.full.test_full[db.full.test_full$Biome != "Tropical & Subtropical Coniferous Forests",]
m_10 <- glmer(Alien.presence ~ LU*LUI + (1|SS/SSB) , data = db.full.test_10, family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#11 excluding the assemblages from biome of #Tropical & Subtropical Dry Broadleaf Forests
db.full.test_11<-db.full.test_full[db.full.test_full$Biome != "Tropical & Subtropical Dry Broadleaf Forests",]
m_11 <- glmer(Alien.presence ~ LU*LUI + (1|SS/SSB) , data = db.full.test_11, family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#12 excluding the assemblages from biome of #Tropical & Subtropical Grasslands, Savannas & Shrublands
db.full.test_12<-db.full.test_full[db.full.test_full$Biome != "Tropical & Subtropical Grasslands, Savannas & Shrublands",]
m_12 <- glmer(Alien.presence ~ LU*LUI + (1|SS/SSB) , data = db.full.test_12, family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#13 excluding the assemblages from biome of #Tropical & Subtropical Moist Broadleaf Forests
db.full.test_13<-db.full.test_full[db.full.test_full$Biome != "Tropical & Subtropical Moist Broadleaf Forests",]
m_13 <- glmer(Alien.presence ~ LU*LUI + (1|SS/SSB) , data = db.full.test_13, family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#14 excluding the assemblages from biome of #Tundra
db.full.test_14<-db.full.test_full[db.full.test_full$Biome != "Tundra",]
m_14 <- glmer(Alien.presence ~ LU*LUI + (1|SS/SSB) , data = db.full.test_14, family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )
#compare the AIC, but these values can not used to check the models good or bad due to different sampling size.
#AIC(m_paper);AIC(m_1);AIC(m_2);AIC(m_3);AIC(m_4);AIC(m_5);AIC(m_6);AIC(m_7);AIC(m_8);AIC(m_9);AIC(m_10);AIC(m_11);AIC(m_12);AIC(m_13);AIC(m_14)


####part2: model backtransfomration

#selelct the rows that compared to primary

#for full model in the paper used.
pred.full<-m_paper %>% emmeans(specs = ~LU+LUI , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
#selelct the rows that compared to primary
data.2<-pred.full[grepl("Primary Minimal use",pred.full$contrast),]
data.2$contrast<-as.character(data.2$contrast)
data.2[18,]<-c("Primary Minimal / Primary Minimal use",1, NA,NA,NA,NA,NA,NA,NA)
library(stringr)
data.2[c('name1', 'name2')] <- str_split_fixed(data.2$contrast, '/', 2)
data.2[c('LU', 'LUI',"Use")] <- str_split_fixed(data.2$name1, ' ', 3)
data.2$LUI<-paste(data.2$LUI,data.2$Use)
names(data.2)
data.3<-data.2[,c(1:9,12,13)]
data.3$LUI<-as.factor(data.3$LUI)

levels(data.3$LUI)[1:4]<-c("Intense use","Light use","Minimal use","Minimal use")
data.3$LU<-as.factor(data.3$LU)
levels(data.3$LU)[4:5]<-c("Primary","Secondary")

data.3$LU = factor(data.3$LU, levels=c("Primary","Secondary",
                                       "Plantation","Pasture","Cropland","Urban"))
data.3$LUI = factor(data.3$LUI, levels=c("Minimal use","Light use","Intense use"))
data.3$odds.ratio<-as.numeric(data.3$odds.ratio)
data.3$SE<-as.numeric(data.3$SE)
#add the model name
data.3$model<-with(data.3,"Original")
data.full<-data.3

# for the model 1
pred.m_1<-m_1 %>% emmeans(specs = ~LU+LUI , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
#selelct the rows that compared to primary
data.2<-pred.m_1[grepl("Primary Minimal use",pred.m_1$contrast),]
data.2$contrast<-as.character(data.2$contrast)
data.2[18,]<-c("Primary Minimal / Primary Minimal use",1, NA,NA,NA,NA,NA,NA,NA)
library(stringr)
data.2[c('name1', 'name2')] <- str_split_fixed(data.2$contrast, '/', 2)
data.2[c('LU', 'LUI',"Use")] <- str_split_fixed(data.2$name1, ' ', 3)
data.2$LUI<-paste(data.2$LUI,data.2$Use)
names(data.2)
data.3<-data.2[,c(1:9,12,13)]
data.3$LUI<-as.factor(data.3$LUI)

levels(data.3$LUI)[1:4]<-c("Intense use","Light use","Minimal use","Minimal use")
data.3$LU<-as.factor(data.3$LU)
levels(data.3$LU)[4:5]<-c("Primary","Secondary")

data.3$LU = factor(data.3$LU, levels=c("Primary","Secondary",
                                       "Plantation","Pasture","Cropland","Urban"))
data.3$LUI = factor(data.3$LUI, levels=c("Minimal use","Light use","Intense use"))
data.3$odds.ratio<-as.numeric(data.3$odds.ratio)
data.3$SE<-as.numeric(data.3$SE)
#add the model name
data.3$model<-with(data.3,"m_1")
data.m_1<-data.3

# for the model 2
pred.m_2<-m_2 %>% emmeans(specs = ~LU+LUI , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
#selelct the rows that compared to primary
data.2<-pred.m_2[grepl("Primary Minimal use",pred.m_2$contrast),]
data.2$contrast<-as.character(data.2$contrast)
data.2[18,]<-c("Primary Minimal / Primary Minimal use",1, NA,NA,NA,NA,NA,NA,NA)
library(stringr)
data.2[c('name1', 'name2')] <- str_split_fixed(data.2$contrast, '/', 2)
data.2[c('LU', 'LUI',"Use")] <- str_split_fixed(data.2$name1, ' ', 3)
data.2$LUI<-paste(data.2$LUI,data.2$Use)
names(data.2)
data.3<-data.2[,c(1:9,12,13)]
data.3$LUI<-as.factor(data.3$LUI)

levels(data.3$LUI)[1:4]<-c("Intense use","Light use","Minimal use","Minimal use")
data.3$LU<-as.factor(data.3$LU)
levels(data.3$LU)[4:5]<-c("Primary","Secondary")

data.3$LU = factor(data.3$LU, levels=c("Primary","Secondary",
                                       "Plantation","Pasture","Cropland","Urban"))
data.3$LUI = factor(data.3$LUI, levels=c("Minimal use","Light use","Intense use"))
data.3$odds.ratio<-as.numeric(data.3$odds.ratio)
data.3$SE<-as.numeric(data.3$SE)
#add the model name
data.3$model<-with(data.3,"m_2")
data.m_2<-data.3

# for the model 3
pred.m_3<-m_3 %>% emmeans(specs = ~LU+LUI , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
#selelct the rows that compared to primary
data.2<-pred.m_3[grepl("Primary Minimal use",pred.m_3$contrast),]
data.2$contrast<-as.character(data.2$contrast)
data.2[18,]<-c("Primary Minimal / Primary Minimal use",1, NA,NA,NA,NA,NA,NA,NA)
library(stringr)
data.2[c('name1', 'name2')] <- str_split_fixed(data.2$contrast, '/', 2)
data.2[c('LU', 'LUI',"Use")] <- str_split_fixed(data.2$name1, ' ', 3)
data.2$LUI<-paste(data.2$LUI,data.2$Use)
names(data.2)
data.3<-data.2[,c(1:9,12,13)]
data.3$LUI<-as.factor(data.3$LUI)

levels(data.3$LUI)[1:4]<-c("Intense use","Light use","Minimal use","Minimal use")
data.3$LU<-as.factor(data.3$LU)
levels(data.3$LU)[4:5]<-c("Primary","Secondary")

data.3$LU = factor(data.3$LU, levels=c("Primary","Secondary",
                                       "Plantation","Pasture","Cropland","Urban"))
data.3$LUI = factor(data.3$LUI, levels=c("Minimal use","Light use","Intense use"))
data.3$odds.ratio<-as.numeric(data.3$odds.ratio)
data.3$SE<-as.numeric(data.3$SE)
#add the model name
data.3$model<-with(data.3,"m_3")
data.m_3<-data.3

# for the model 4
pred.m_4<-m_4 %>% emmeans(specs = ~LU+LUI , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
#selelct the rows that compared to primary
data.2<-pred.m_4[grepl("Primary Minimal use",pred.m_4$contrast),]
data.2$contrast<-as.character(data.2$contrast)
data.2[18,]<-c("Primary Minimal / Primary Minimal use",1, NA,NA,NA,NA,NA,NA,NA)
library(stringr)
data.2[c('name1', 'name2')] <- str_split_fixed(data.2$contrast, '/', 2)
data.2[c('LU', 'LUI',"Use")] <- str_split_fixed(data.2$name1, ' ', 3)
data.2$LUI<-paste(data.2$LUI,data.2$Use)
names(data.2)
data.3<-data.2[,c(1:9,12,13)]
data.3$LUI<-as.factor(data.3$LUI)

levels(data.3$LUI)[1:4]<-c("Intense use","Light use","Minimal use","Minimal use")
data.3$LU<-as.factor(data.3$LU)
levels(data.3$LU)[4:5]<-c("Primary","Secondary")

data.3$LU = factor(data.3$LU, levels=c("Primary","Secondary",
                                       "Plantation","Pasture","Cropland","Urban"))
data.3$LUI = factor(data.3$LUI, levels=c("Minimal use","Light use","Intense use"))
data.3$odds.ratio<-as.numeric(data.3$odds.ratio)
data.3$SE<-as.numeric(data.3$SE)
#add the model name
data.3$model<-with(data.3,"m_4")
data.m_4<-data.3


# for the model 5
pred.m_5<-m_5 %>% emmeans(specs = ~LU+LUI , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
#selelct the rows that compared to primary
data.2<-pred.m_5[grepl("Primary Minimal use",pred.m_5$contrast),]
data.2$contrast<-as.character(data.2$contrast)
data.2[18,]<-c("Primary Minimal / Primary Minimal use",1, NA,NA,NA,NA,NA,NA,NA)
library(stringr)
data.2[c('name1', 'name2')] <- str_split_fixed(data.2$contrast, '/', 2)
data.2[c('LU', 'LUI',"Use")] <- str_split_fixed(data.2$name1, ' ', 3)
data.2$LUI<-paste(data.2$LUI,data.2$Use)
names(data.2)
data.3<-data.2[,c(1:9,12,13)]
data.3$LUI<-as.factor(data.3$LUI)

levels(data.3$LUI)[1:4]<-c("Intense use","Light use","Minimal use","Minimal use")
data.3$LU<-as.factor(data.3$LU)
levels(data.3$LU)[4:5]<-c("Primary","Secondary")

data.3$LU = factor(data.3$LU, levels=c("Primary","Secondary",
                                       "Plantation","Pasture","Cropland","Urban"))
data.3$LUI = factor(data.3$LUI, levels=c("Minimal use","Light use","Intense use"))
data.3$odds.ratio<-as.numeric(data.3$odds.ratio)
data.3$SE<-as.numeric(data.3$SE)
#add the model name
data.3$model<-with(data.3,"m_5")
data.m_5<-data.3

# for the model 6
pred.m_6<-m_6 %>% emmeans(specs = ~LU+LUI , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
#selelct the rows that compared to primary
data.2<-pred.m_6[grepl("Primary Minimal use",pred.m_6$contrast),]
data.2$contrast<-as.character(data.2$contrast)
data.2[18,]<-c("Primary Minimal / Primary Minimal use",1, NA,NA,NA,NA,NA,NA,NA)
library(stringr)
data.2[c('name1', 'name2')] <- str_split_fixed(data.2$contrast, '/', 2)
data.2[c('LU', 'LUI',"Use")] <- str_split_fixed(data.2$name1, ' ', 3)
data.2$LUI<-paste(data.2$LUI,data.2$Use)
names(data.2)
data.3<-data.2[,c(1:9,12,13)]
data.3$LUI<-as.factor(data.3$LUI)

levels(data.3$LUI)[1:4]<-c("Intense use","Light use","Minimal use","Minimal use")
data.3$LU<-as.factor(data.3$LU)
levels(data.3$LU)[4:5]<-c("Primary","Secondary")

data.3$LU = factor(data.3$LU, levels=c("Primary","Secondary",
                                       "Plantation","Pasture","Cropland","Urban"))
data.3$LUI = factor(data.3$LUI, levels=c("Minimal use","Light use","Intense use"))
data.3$odds.ratio<-as.numeric(data.3$odds.ratio)
data.3$SE<-as.numeric(data.3$SE)
#add the model name
data.3$model<-with(data.3,"m_6")
data.m_6<-data.3

# for the model 7
pred.m_7<-m_7 %>% emmeans(specs = ~LU+LUI , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
#selelct the rows that compared to primary
data.2<-pred.m_7[grepl("Primary Minimal use",pred.m_7$contrast),]
data.2$contrast<-as.character(data.2$contrast)
data.2[18,]<-c("Primary Minimal / Primary Minimal use",1, NA,NA,NA,NA,NA,NA,NA)
library(stringr)
data.2[c('name1', 'name2')] <- str_split_fixed(data.2$contrast, '/', 2)
data.2[c('LU', 'LUI',"Use")] <- str_split_fixed(data.2$name1, ' ', 3)
data.2$LUI<-paste(data.2$LUI,data.2$Use)
names(data.2)
data.3<-data.2[,c(1:9,12,13)]
data.3$LUI<-as.factor(data.3$LUI)

levels(data.3$LUI)[1:4]<-c("Intense use","Light use","Minimal use","Minimal use")
data.3$LU<-as.factor(data.3$LU)
levels(data.3$LU)[4:5]<-c("Primary","Secondary")

data.3$LU = factor(data.3$LU, levels=c("Primary","Secondary",
                                       "Plantation","Pasture","Cropland","Urban"))
data.3$LUI = factor(data.3$LUI, levels=c("Minimal use","Light use","Intense use"))
data.3$odds.ratio<-as.numeric(data.3$odds.ratio)
data.3$SE<-as.numeric(data.3$SE)
#add the model name
data.3$model<-with(data.3,"m_7")
data.m_7<-data.3

# for the model 8
pred.m_8<-m_8 %>% emmeans(specs = ~LU+LUI , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
#selelct the rows that compared to primary
data.2<-pred.m_8[grepl("Primary Minimal use",pred.m_8$contrast),]
data.2$contrast<-as.character(data.2$contrast)
data.2[18,]<-c("Primary Minimal / Primary Minimal use",1, NA,NA,NA,NA,NA,NA,NA)
library(stringr)
data.2[c('name1', 'name2')] <- str_split_fixed(data.2$contrast, '/', 2)
data.2[c('LU', 'LUI',"Use")] <- str_split_fixed(data.2$name1, ' ', 3)
data.2$LUI<-paste(data.2$LUI,data.2$Use)
names(data.2)
data.3<-data.2[,c(1:9,12,13)]
data.3$LUI<-as.factor(data.3$LUI)

levels(data.3$LUI)[1:4]<-c("Intense use","Light use","Minimal use","Minimal use")
data.3$LU<-as.factor(data.3$LU)
levels(data.3$LU)[4:5]<-c("Primary","Secondary")

data.3$LU = factor(data.3$LU, levels=c("Primary","Secondary",
                                       "Plantation","Pasture","Cropland","Urban"))
data.3$LUI = factor(data.3$LUI, levels=c("Minimal use","Light use","Intense use"))
data.3$odds.ratio<-as.numeric(data.3$odds.ratio)
data.3$SE<-as.numeric(data.3$SE)
#add the model name
data.3$model<-with(data.3,"m_8")
data.m_8<-data.3

# for the model 9
pred.m_9<-m_9 %>% emmeans(specs = ~LU+LUI , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
#selelct the rows that compared to primary
data.2<-pred.m_9[grepl("Primary Minimal use",pred.m_9$contrast),]
data.2$contrast<-as.character(data.2$contrast)
data.2[18,]<-c("Primary Minimal / Primary Minimal use",1, NA,NA,NA,NA,NA,NA,NA)
library(stringr)
data.2[c('name1', 'name2')] <- str_split_fixed(data.2$contrast, '/', 2)
data.2[c('LU', 'LUI',"Use")] <- str_split_fixed(data.2$name1, ' ', 3)
data.2$LUI<-paste(data.2$LUI,data.2$Use)
names(data.2)
data.3<-data.2[,c(1:9,12,13)]
data.3$LUI<-as.factor(data.3$LUI)

levels(data.3$LUI)[1:4]<-c("Intense use","Light use","Minimal use","Minimal use")
data.3$LU<-as.factor(data.3$LU)
levels(data.3$LU)[4:5]<-c("Primary","Secondary")

data.3$LU = factor(data.3$LU, levels=c("Primary","Secondary",
                                       "Plantation","Pasture","Cropland","Urban"))
data.3$LUI = factor(data.3$LUI, levels=c("Minimal use","Light use","Intense use"))
data.3$odds.ratio<-as.numeric(data.3$odds.ratio)
data.3$SE<-as.numeric(data.3$SE)
#add the model name
data.3$model<-with(data.3,"m_9")
data.m_9<-data.3

# for the model 10
pred.m_10<-m_10 %>% emmeans(specs = ~LU+LUI , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
#selelct the rows that compared to primary
data.2<-pred.m_10[grepl("Primary Minimal use",pred.m_10$contrast),]
data.2$contrast<-as.character(data.2$contrast)
data.2[18,]<-c("Primary Minimal / Primary Minimal use",1, NA,NA,NA,NA,NA,NA,NA)
library(stringr)
data.2[c('name1', 'name2')] <- str_split_fixed(data.2$contrast, '/', 2)
data.2[c('LU', 'LUI',"Use")] <- str_split_fixed(data.2$name1, ' ', 3)
data.2$LUI<-paste(data.2$LUI,data.2$Use)
names(data.2)
data.3<-data.2[,c(1:9,12,13)]
data.3$LUI<-as.factor(data.3$LUI)

levels(data.3$LUI)[1:4]<-c("Intense use","Light use","Minimal use","Minimal use")
data.3$LU<-as.factor(data.3$LU)
levels(data.3$LU)[4:5]<-c("Primary","Secondary")

data.3$LU = factor(data.3$LU, levels=c("Primary","Secondary",
                                       "Plantation","Pasture","Cropland","Urban"))
data.3$LUI = factor(data.3$LUI, levels=c("Minimal use","Light use","Intense use"))
data.3$odds.ratio<-as.numeric(data.3$odds.ratio)
data.3$SE<-as.numeric(data.3$SE)
#add the model name
data.3$model<-with(data.3,"m_10")
data.m_10<-data.3


# for the model 11
pred.m_11<-m_11 %>% emmeans(specs = ~LU+LUI , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
#selelct the rows that compared to primary
data.2<-pred.m_11[grepl("Primary Minimal use",pred.m_11$contrast),]
data.2$contrast<-as.character(data.2$contrast)
data.2[18,]<-c("Primary Minimal / Primary Minimal use",1, NA,NA,NA,NA,NA,NA,NA)
library(stringr)
data.2[c('name1', 'name2')] <- str_split_fixed(data.2$contrast, '/', 2)
data.2[c('LU', 'LUI',"Use")] <- str_split_fixed(data.2$name1, ' ', 3)
data.2$LUI<-paste(data.2$LUI,data.2$Use)
names(data.2)
data.3<-data.2[,c(1:9,12,13)]
data.3$LUI<-as.factor(data.3$LUI)

levels(data.3$LUI)[1:4]<-c("Intense use","Light use","Minimal use","Minimal use")
data.3$LU<-as.factor(data.3$LU)
levels(data.3$LU)[4:5]<-c("Primary","Secondary")

data.3$LU = factor(data.3$LU, levels=c("Primary","Secondary",
                                       "Plantation","Pasture","Cropland","Urban"))
data.3$LUI = factor(data.3$LUI, levels=c("Minimal use","Light use","Intense use"))
data.3$odds.ratio<-as.numeric(data.3$odds.ratio)
data.3$SE<-as.numeric(data.3$SE)
#add the model name
data.3$model<-with(data.3,"m_11")
data.m_11<-data.3

# for the model 12
pred.m_12<-m_12 %>% emmeans(specs = ~LU+LUI , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
#selelct the rows that compared to primary
data.2<-pred.m_12[grepl("Primary Minimal use",pred.m_12$contrast),]
data.2$contrast<-as.character(data.2$contrast)
data.2[18,]<-c("Primary Minimal / Primary Minimal use",1, NA,NA,NA,NA,NA,NA,NA)
library(stringr)
data.2[c('name1', 'name2')] <- str_split_fixed(data.2$contrast, '/', 2)
data.2[c('LU', 'LUI',"Use")] <- str_split_fixed(data.2$name1, ' ', 3)
data.2$LUI<-paste(data.2$LUI,data.2$Use)
names(data.2)
data.3<-data.2[,c(1:9,12,13)]
data.3$LUI<-as.factor(data.3$LUI)

levels(data.3$LUI)[1:4]<-c("Intense use","Light use","Minimal use","Minimal use")
data.3$LU<-as.factor(data.3$LU)
levels(data.3$LU)[4:5]<-c("Primary","Secondary")

data.3$LU = factor(data.3$LU, levels=c("Primary","Secondary",
                                       "Plantation","Pasture","Cropland","Urban"))
data.3$LUI = factor(data.3$LUI, levels=c("Minimal use","Light use","Intense use"))
data.3$odds.ratio<-as.numeric(data.3$odds.ratio)
data.3$SE<-as.numeric(data.3$SE)
#add the model name
data.3$model<-with(data.3,"m_12")
data.m_12<-data.3

# for the model 13
pred.m_13<-m_13 %>% emmeans(specs = ~LU+LUI , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
#selelct the rows that compared to primary
data.2<-pred.m_13[grepl("Primary Minimal use",pred.m_13$contrast),]
data.2$contrast<-as.character(data.2$contrast)
data.2[18,]<-c("Primary Minimal / Primary Minimal use",1, NA,NA,NA,NA,NA,NA,NA)
library(stringr)
data.2[c('name1', 'name2')] <- str_split_fixed(data.2$contrast, '/', 2)
data.2[c('LU', 'LUI',"Use")] <- str_split_fixed(data.2$name1, ' ', 3)
data.2$LUI<-paste(data.2$LUI,data.2$Use)
names(data.2)
data.3<-data.2[,c(1:9,12,13)]
data.3$LUI<-as.factor(data.3$LUI)

levels(data.3$LUI)[1:4]<-c("Intense use","Light use","Minimal use","Minimal use")
data.3$LU<-as.factor(data.3$LU)
levels(data.3$LU)[4:5]<-c("Primary","Secondary")

data.3$LU = factor(data.3$LU, levels=c("Primary","Secondary",
                                       "Plantation","Pasture","Cropland","Urban"))
data.3$LUI = factor(data.3$LUI, levels=c("Minimal use","Light use","Intense use"))
data.3$odds.ratio<-as.numeric(data.3$odds.ratio)
data.3$SE<-as.numeric(data.3$SE)
#add the model name
data.3$model<-with(data.3,"m_13")
data.m_13<-data.3

# for the model 14
pred.m_14<-m_14 %>% emmeans(specs = ~LU+LUI , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
#selelct the rows that compared to primary
data.2<-pred.m_14[grepl("Primary Minimal use",pred.m_14$contrast),]
data.2$contrast<-as.character(data.2$contrast)
data.2[18,]<-c("Primary Minimal / Primary Minimal use",1, NA,NA,NA,NA,NA,NA,NA)
library(stringr)
data.2[c('name1', 'name2')] <- str_split_fixed(data.2$contrast, '/', 2)
data.2[c('LU', 'LUI',"Use")] <- str_split_fixed(data.2$name1, ' ', 3)
data.2$LUI<-paste(data.2$LUI,data.2$Use)
names(data.2)
data.3<-data.2[,c(1:9,12,13)]
data.3$LUI<-as.factor(data.3$LUI)

levels(data.3$LUI)[1:4]<-c("Intense use","Light use","Minimal use","Minimal use")
data.3$LU<-as.factor(data.3$LU)
levels(data.3$LU)[4:5]<-c("Primary","Secondary")

data.3$LU = factor(data.3$LU, levels=c("Primary","Secondary",
                                       "Plantation","Pasture","Cropland","Urban"))
data.3$LUI = factor(data.3$LUI, levels=c("Minimal use","Light use","Intense use"))
data.3$odds.ratio<-as.numeric(data.3$odds.ratio)
data.3$SE<-as.numeric(data.3$SE)
#add the model name
data.3$model<-with(data.3,"m_14")
data.m_14<-data.3

#2_2combine all the model-transfered result
data.model<-rbind(data.full,data.m_1,data.m_2,data.m_3,data.m_4,data.m_5,data.m_6,data.m_7,
                  data.m_8,data.m_9,data.m_10,data.m_11,data.m_12,data.m_13,data.m_14)
names(data.model)
#2_3claclate the mean and confidence interval 95%

#get the model result in our paper
model_result_paper<-data.model%>% filter(model=="Original")
library(dplyr)
model_result_cross<-data.model%>% filter(model!="Original") %>%group_by(LU,LUI) %>%
  dplyr::summarise(mean.ratio = mean(odds.ratio, na.rm = TRUE),
            sd.ratio = sd(odds.ratio, na.rm = TRUE),
            n.ratio = n()) %>%
  mutate(se.ratio = sd.ratio / sqrt(n.ratio),
         lower.ci.ratio = mean.ratio - qt(1 - (0.05 / 2), n.ratio - 1) * se.ratio,
         upper.ci.ratio = mean.ratio + qt(1 - (0.05 / 2), n.ratio - 1) * se.ratio)
model_result_table<-merge(model_result_paper[,c(10,11,2,3)],model_result_cross[,c(1:3,6:8)],by=c("LU","LUI"),all.x=T)
model_result_table$se.ratio[model_result_table$LU=="Primary"&model_result_table$LUI=="Minimal use"]<-NA
model_result_table$lower.ci.ratio[model_result_table$LU=="Primary"&model_result_table$LUI=="Minimal use"]<-NA
model_result_table$upper.ci.ratio[model_result_table$LU=="Primary"&model_result_table$LUI=="Minimal use"]<-NA
```
####figure
```{r}
all<-ggplot(model_result_table , aes(LU , odds.ratio,shape=LUI,color=LU))+
  geom_errorbar(aes(ymin = odds.ratio-SE , ymax = odds.ratio+SE) ,width=0.4, 
                position = position_dodge(width=.6))+
  scale_y_continuous(name="Odds ratio of alien occurrence",
                     limits=c(0,48),breaks=seq(0,45,15))+
  geom_point(aes(shape=LUI),position = position_dodge(width=.6),size=3.5)+
  scale_shape_manual(name="LU-intensity",values=c(15, 17, 18))+
  scale_color_manual(name='LU-types',
                     values = c("#2166AC","#4393C3","#92C5DE",
                                "#F4A582","red","#B2182B"),
                     label=c('Primary','Secondary','Plantation',
                             'Pasture','Cropland','Urban'))+
  guides(color=FALSE)+
  theme_bw()+
  theme(panel.grid.major.x = element_blank() , 
        axis.ticks.length=unit(0.08,"inch"),
        panel.grid.major.y = element_line(size = 0.6 , colour = "grey90") ,
        panel.spacing = unit(0,"lines") , 
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_text(colour = "black",angle = 25, 
                                   size = 12,vjust = 0.6) ,
        axis.text.y = element_text(colour = "black",  size = 12),
        legend.title = element_text(face = 'bold'),
        legend.background = element_blank(),
        legend.box.background = element_blank(),
        legend.key = element_blank(),
        legend.direction =  "horizontal",legend.position = c(0.4,0.9)) 
all

#corss cheacking
names(model_result_table)
all_cross<-ggplot(model_result_table , aes(LU , mean.ratio,shape=LUI,color=LU))+
    geom_errorbar(aes(ymin = lower.ci.ratio, ymax = upper.ci.ratio) ,width=0.6, 
                position = position_dodge(width=.6),color="grey50")+
  geom_errorbar(aes(ymin = mean.ratio-se.ratio , ymax = mean.ratio+se.ratio) ,width=0.4, 
                position = position_dodge(width=.6))+
  scale_y_continuous(name="Odds ratio of alien occurrence",
                     limits=c(0,48),breaks=seq(0,45,15))+
  geom_point(aes(shape=LUI),position = position_dodge(width=.6),size=3.5)+
  scale_shape_manual(name="LU-intensity",values=c(15, 17, 18))+
  scale_color_manual(name='LU-types',
                     values = c("#2166AC","#4393C3","#92C5DE",
                                "#F4A582","red","#B2182B"),
                     label=c('Primary','Secondary','Plantation',
                             'Pasture','Cropland','Urban'))+

  guides(color=FALSE)+
  theme_bw()+
  theme(panel.grid.major.x = element_blank() , 
        axis.ticks.length=unit(0.08,"inch"),
        panel.grid.major.y = element_line(size = 0.6 , colour = "grey90") ,
        panel.spacing = unit(0,"lines") , 
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_text(colour = "black",angle = 25, 
                                   size = 12,vjust = 0.6) ,
        axis.text.y = element_text(colour = "black",  size = 12),
        legend.title = element_text(face = 'bold'),
        legend.background = element_blank(),
        legend.box.background = element_blank(),
        legend.key = element_blank(),
        legend.direction =  "horizontal",legend.position = c(0.4,0.9)) 

all_cross

#com<-cowplot::plot_grid(all,all_cross,ncol=2,align = 'hv')
#com
ggsave(all_cross,filename = '.../fig2.a.tiff',compression='lzw', width = 10,height = 3.0,dpi=200)
```
```{r}
db.full.test <- subset(db,!(LU %in% "Urban" & LUI %in%"Intense use"))
#1change the refernce for LU
levels(db.full.test$LU)
db.full.test$LU = factor(db.full.test$LU, levels=c("Primary","SV","Plantation","Cropland","Pasture","Urban"))
db.full.test$LU = factor(db.full.test$LU, levels=c("Pasture","Urban","Cropland", "Plantation","SV", "Primary"))
levels(db.full.test$LUI)
db.full.test$LUI = factor(db.full.test$LUI, levels=c("Cannot decide","Minimal use","Light use","Intense use"))
db.full.test$LUI = factor(db.full.test$LUI, levels=c("Intense use", "Light use","Minimal use","Cannot decide"))

#0 the model used in the paper
db.full.test_full<-db.full.test[db.full.test$LUI != "Cannot decide",]
m_paper <- glmer(Alien.presence ~ LU*LUI + (1|SS/SSB) , data = db.full.test_full , family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#1 excluding the assemblages from biome of #Boreal Forests/Taiga
db.full.test_1<-db.full.test_full[db.full.test_full$Biome != "Boreal Forests/Taiga",]
m_1 <- glmer(Alien.presence ~ LU*LUI + (1|SS/SSB) , data = db.full.test_1 , family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#2 excluding the assemblages from biome of #Deserts & Xeric Shrublands
db.full.test_2<-db.full.test_full[db.full.test_full$Biome != "Deserts & Xeric Shrublands",]
m_2 <- glmer(Alien.presence ~ LU*LUI + (1|SS/SSB) , data = db.full.test_2 , family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#3 excluding the assemblages from biome of #Flooded Grasslands & Savannas
db.full.test_3<-db.full.test_full[db.full.test_full$Biome != "Flooded Grasslands & Savannas",]
m_3 <- glmer(Alien.presence ~ LU*LUI + (1|SS/SSB) , data = db.full.test_3 , family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#4 excluding the assemblages from biome of #Mangroves
db.full.test_4<-db.full.test_full[db.full.test_full$Biome != "Mangroves",]
m_4 <- glmer(Alien.presence ~ LU*LUI + (1|SS/SSB) , data = db.full.test_4 , family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#5 excluding the assemblages from biome of #Mediterranean Forests, Woodlands & Scrub
db.full.test_5<-db.full.test_full[db.full.test_full$Biome != "Mediterranean Forests, Woodlands & Scrub",]
m_5 <- glmer(Alien.presence ~ LU*LUI + (1|SS/SSB) , data = db.full.test_5, family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#6 excluding the assemblages from biome of #Montane Grasslands & Shrublands
db.full.test_6<-db.full.test_full[db.full.test_full$Biome != "Montane Grasslands & Shrublands",]
m_6 <- glmer(Alien.presence ~ LU*LUI + (1|SS/SSB) , data = db.full.test_6, family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#7 excluding the assemblages from biome of #Temperate Broadleaf & Mixed Forests
db.full.test_7<-db.full.test_full[db.full.test_full$Biome != "Temperate Broadleaf & Mixed Forests",]
m_7 <- glmer(Alien.presence ~ LU*LUI + (1|SS/SSB) , data = db.full.test_7, family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#8 excluding the assemblages from biome of #Temperate Conifer Forests
db.full.test_8<-db.full.test_full[db.full.test_full$Biome != "Temperate Conifer Forests",]
m_8 <- glmer(Alien.presence ~ LU*LUI + (1|SS/SSB) , data = db.full.test_8, family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#9 excluding the assemblages from biome of #Temperate Grasslands, Savannas & Shrublands
db.full.test_9<-db.full.test_full[db.full.test_full$Biome != "Temperate Grasslands, Savannas & Shrublands",]
m_9 <- glmer(Alien.presence ~ LU*LUI + (1|SS/SSB) , data = db.full.test_9, family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#10 excluding the assemblages from biome of #Tropical & Subtropical Coniferous Forests
db.full.test_10<-db.full.test_full[db.full.test_full$Biome != "Tropical & Subtropical Coniferous Forests",]
m_10 <- glmer(Alien.presence ~ LU*LUI + (1|SS/SSB) , data = db.full.test_10, family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#11 excluding the assemblages from biome of #Tropical & Subtropical Dry Broadleaf Forests
db.full.test_11<-db.full.test_full[db.full.test_full$Biome != "Tropical & Subtropical Dry Broadleaf Forests",]
m_11 <- glmer(Alien.presence ~ LU*LUI + (1|SS/SSB) , data = db.full.test_11, family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#12 excluding the assemblages from biome of #Tropical & Subtropical Grasslands, Savannas & Shrublands
db.full.test_12<-db.full.test_full[db.full.test_full$Biome != "Tropical & Subtropical Grasslands, Savannas & Shrublands",]
m_12 <- glmer(Alien.presence ~ LU*LUI + (1|SS/SSB) , data = db.full.test_12, family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#13 excluding the assemblages from biome of #Tropical & Subtropical Moist Broadleaf Forests
db.full.test_13<-db.full.test_full[db.full.test_full$Biome != "Tropical & Subtropical Moist Broadleaf Forests",]
m_13 <- glmer(Alien.presence ~ LU*LUI + (1|SS/SSB) , data = db.full.test_13, family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#14 excluding the assemblages from biome of #Tundra
db.full.test_14<-db.full.test_full[db.full.test_full$Biome != "Tundra",]
m_14 <- glmer(Alien.presence ~ LU*LUI + (1|SS/SSB) , data = db.full.test_14, family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )
#compare the AIC, but these values can not used to check the models good or bad due to different sampling size.
#AIC(m_paper);AIC(m_1);AIC(m_2);AIC(m_3);AIC(m_4);AIC(m_5);AIC(m_6);AIC(m_7);AIC(m_8);AIC(m_9);AIC(m_10);AIC(m_11);AIC(m_12);AIC(m_13);AIC(m_14)
```
###overall subset model

```{r}
####part1: run the model 
levels(db$LU)
db$LU = factor(db$LU, levels=c("Pasture","Urban","Cropland", "Plantation","SV", "Primary"))

#0 the model used in the paper

m_paper <- glmer(Alien.presence ~ LU+ (1|SS/SSB) , data = db , family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#1 excluding the assemblages from biome of #Boreal Forests/Taiga
db_1<-db[db$Biome != "Boreal Forests/Taiga",]
m_1 <- glmer(Alien.presence ~ LU + (1|SS/SSB) , data = db_1 , family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#2 excluding the assemblages from biome of #Deserts & Xeric Shrublands
db_2<-db[db$Biome != "Deserts & Xeric Shrublands",]
m_2 <- glmer(Alien.presence ~ LU + (1|SS/SSB) , data = db_2 , family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#3 excluding the assemblages from biome of #Flooded Grasslands & Savannas
db_3<-db[db$Biome != "Flooded Grasslands & Savannas",]
m_3 <- glmer(Alien.presence ~ LU + (1|SS/SSB) , data = db_3 , family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#4 excluding the assemblages from biome of #Mangroves
db_4<-db[db$Biome != "Mangroves",]
m_4 <- glmer(Alien.presence ~ LU + (1|SS/SSB) , data = db_4 , family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#5 excluding the assemblages from biome of #Mediterranean Forests, Woodlands & Scrub
db_5<-db[db$Biome != "Mediterranean Forests, Woodlands & Scrub",]
m_5 <- glmer(Alien.presence ~ LU + (1|SS/SSB) , data = db_5, family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#6 excluding the assemblages from biome of #Montane Grasslands & Shrublands
db_6<-db[db$Biome != "Montane Grasslands & Shrublands",]
m_6 <- glmer(Alien.presence ~ LU + (1|SS/SSB) , data = db_6, family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#7 excluding the assemblages from biome of #Temperate Broadleaf & Mixed Forests
db_7<-db[db$Biome != "Temperate Broadleaf & Mixed Forests",]
m_7 <- glmer(Alien.presence ~ LU + (1|SS/SSB) , data = db_7, family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#8 excluding the assemblages from biome of #Temperate Conifer Forests
db_8<-db[db$Biome != "Temperate Conifer Forests",]
m_8 <- glmer(Alien.presence ~ LU + (1|SS/SSB) , data = db_8, family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#9 excluding the assemblages from biome of #Temperate Grasslands, Savannas & Shrublands
db_9<-db[db$Biome != "Temperate Grasslands, Savannas & Shrublands",]
m_9 <- glmer(Alien.presence ~ LU + (1|SS/SSB) , data = db_9, family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#10 excluding the assemblages from biome of #Tropical & Subtropical Coniferous Forests
db_10<-db[db$Biome != "Tropical & Subtropical Coniferous Forests",]
m_10 <- glmer(Alien.presence ~ LU + (1|SS/SSB) , data = db_10, family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#11 excluding the assemblages from biome of #Tropical & Subtropical Dry Broadleaf Forests
db_11<-db[db$Biome != "Tropical & Subtropical Dry Broadleaf Forests",]
m_11 <- glmer(Alien.presence ~ LU + (1|SS/SSB) , data = db_11, family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#12 excluding the assemblages from biome of #Tropical & Subtropical Grasslands, Savannas & Shrublands
db_12<-db[db$Biome != "Tropical & Subtropical Grasslands, Savannas & Shrublands",]
m_12 <- glmer(Alien.presence ~ LU + (1|SS/SSB) , data = db_12, family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#13 excluding the assemblages from biome of #Tropical & Subtropical Moist Broadleaf Forests
db_13<-db[db$Biome != "Tropical & Subtropical Moist Broadleaf Forests",]
m_13 <- glmer(Alien.presence ~ LU + (1|SS/SSB) , data = db_13, family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#14 excluding the assemblages from biome of #Tundra
db_14<-db[db$Biome != "Tundra",]
m_14 <- glmer(Alien.presence ~ LU + (1|SS/SSB) , data = db_14, family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )
#compare the AIC, but these values can not used to check the models good or bad due to different sampling size.
#AIC(m_paper);AIC(m_1);AIC(m_2);AIC(m_3);AIC(m_4);AIC(m_5);AIC(m_6);AIC(m_7);AIC(m_8);AIC(m_9);AIC(m_10);AIC(m_11);AIC(m_12);AIC(m_13);AIC(m_14)

####part2: model backtransfomration
#selelct the rows that compared to primary
pred.full<-m_paper %>% emmeans(specs = ~LU , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
pred.full_2<-pred.full[grepl("Primary",pred.full$contrast),]
pred.full_2$contrast<-as.character(pred.full_2$contrast)
pred.full_2[6,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
library(stringr)
pred.full_2[c('name1', 'name2')] <- str_split_fixed(pred.full_2$contrast, '/', 2)
names(pred.full_2)
names(pred.full_2)[10]<-c("LU")
pred.full_2$LU<-as.factor(pred.full_2$LU)
levels(pred.full_2$LU)<-c("Cropland","Pasture","Plantation",
                          "Primary","Secondary", "Urban")
pred.full_2$LU<-
  factor(pred.full_2$LU,c("Primary","Secondary","Plantation",
                          "Pasture","Cropland","Urban"))
names(pred.full_2)[2]<-c("Odds")
pred.full_2$Odds<-as.numeric(pred.full_2$Odds)
pred.full_2$SE<-as.numeric(pred.full_2$SE)
pred.full_2$LU<-as.factor(pred.full_2$LU)
#add the model name
pred.full_2$model<-with(pred.full_2,"Original")
data.full<-pred.full_2

# for the model 1
pred.m_1<-m_1 %>% emmeans(specs = ~LU , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
#selelct the rows that compared to primary
pred.full_2<-pred.m_1[grepl("Primary",pred.m_1$contrast),]
pred.full_2$contrast<-as.character(pred.full_2$contrast)
pred.full_2[6,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
library(stringr)
pred.full_2[c('name1', 'name2')] <- str_split_fixed(pred.full_2$contrast, '/', 2)
names(pred.full_2)
names(pred.full_2)[10]<-c("LU")
pred.full_2$LU<-as.factor(pred.full_2$LU)
levels(pred.full_2$LU)<-c("Cropland","Pasture","Plantation",
                          "Primary","Secondary", "Urban")
pred.full_2$LU<-
  factor(pred.full_2$LU,c("Primary","Secondary","Plantation",
                          "Pasture","Cropland","Urban"))
names(pred.full_2)[2]<-c("Odds")
pred.full_2$Odds<-as.numeric(pred.full_2$Odds)
pred.full_2$SE<-as.numeric(pred.full_2$SE)
pred.full_2$LU<-as.factor(pred.full_2$LU)
#add the model name
pred.full_2$model<-with(pred.full_2,"m_1")
data.m_1<-pred.full_2

# for the model 2
pred.m_2<-m_2 %>% emmeans(specs = ~LU , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()

#selelct the rows that compared to primary
pred.full_2<-pred.m_2[grepl("Primary",pred.m_2$contrast),]
pred.full_2$contrast<-as.character(pred.full_2$contrast)
pred.full_2[6,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
library(stringr)
pred.full_2[c('name1', 'name2')] <- str_split_fixed(pred.full_2$contrast, '/', 2)
names(pred.full_2)
names(pred.full_2)[10]<-c("LU")
pred.full_2$LU<-as.factor(pred.full_2$LU)
levels(pred.full_2$LU)<-c("Cropland","Pasture","Plantation",
                          "Primary","Secondary", "Urban")
pred.full_2$LU<-
  factor(pred.full_2$LU,c("Primary","Secondary","Plantation",
                          "Pasture","Cropland","Urban"))
names(pred.full_2)[2]<-c("Odds")
pred.full_2$Odds<-as.numeric(pred.full_2$Odds)
pred.full_2$SE<-as.numeric(pred.full_2$SE)
pred.full_2$LU<-as.factor(pred.full_2$LU)
#add the model name
pred.full_2$model<-with(pred.full_2,"m_2")
data.m_2<-pred.full_2

# for the model 3
pred.m_3<-m_3 %>% emmeans(specs = ~LU, type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
#selelct the rows that compared to primary
pred.full_2<-pred.m_3[grepl("Primary",pred.m_3$contrast),]
pred.full_2$contrast<-as.character(pred.full_2$contrast)
pred.full_2[6,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
library(stringr)
pred.full_2[c('name1', 'name2')] <- str_split_fixed(pred.full_2$contrast, '/', 2)
names(pred.full_2)
names(pred.full_2)[10]<-c("LU")
pred.full_2$LU<-as.factor(pred.full_2$LU)
levels(pred.full_2$LU)<-c("Cropland","Pasture","Plantation",
                          "Primary","Secondary", "Urban")
pred.full_2$LU<-
  factor(pred.full_2$LU,c("Primary","Secondary","Plantation",
                          "Pasture","Cropland","Urban"))
names(pred.full_2)[2]<-c("Odds")
pred.full_2$Odds<-as.numeric(pred.full_2$Odds)
pred.full_2$SE<-as.numeric(pred.full_2$SE)
pred.full_2$LU<-as.factor(pred.full_2$LU)
#add the model name
pred.full_2$model<-with(pred.full_2,"m_3")
data.m_3<-pred.full_2

# for the model 4
pred.m_4<-m_4 %>% emmeans(specs = ~LU , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
#selelct the rows that compared to primary
pred.full_2<-pred.m_4[grepl("Primary",pred.m_4$contrast),]
pred.full_2$contrast<-as.character(pred.full_2$contrast)
pred.full_2[6,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
library(stringr)
pred.full_2[c('name1', 'name2')] <- str_split_fixed(pred.full_2$contrast, '/', 2)
names(pred.full_2)
names(pred.full_2)[10]<-c("LU")
pred.full_2$LU<-as.factor(pred.full_2$LU)
levels(pred.full_2$LU)<-c("Cropland","Pasture","Plantation",
                          "Primary","Secondary", "Urban")
pred.full_2$LU<-
  factor(pred.full_2$LU,c("Primary","Secondary","Plantation",
                          "Pasture","Cropland","Urban"))
names(pred.full_2)[2]<-c("Odds")
pred.full_2$Odds<-as.numeric(pred.full_2$Odds)
pred.full_2$SE<-as.numeric(pred.full_2$SE)
pred.full_2$LU<-as.factor(pred.full_2$LU)
#add the model name
pred.full_2$model<-with(pred.full_2,"m_4")
data.m_4<-pred.full_2


# for the model 5
pred.m_5<-m_5 %>% emmeans(specs = ~LU , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
#selelct the rows that compared to primary
#selelct the rows that compared to primary
pred.full_2<-pred.m_5[grepl("Primary",pred.m_5$contrast),]
pred.full_2$contrast<-as.character(pred.full_2$contrast)
pred.full_2[6,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
library(stringr)
pred.full_2[c('name1', 'name2')] <- str_split_fixed(pred.full_2$contrast, '/', 2)
names(pred.full_2)
names(pred.full_2)[10]<-c("LU")
pred.full_2$LU<-as.factor(pred.full_2$LU)
levels(pred.full_2$LU)<-c("Cropland","Pasture","Plantation",
                          "Primary","Secondary", "Urban")
pred.full_2$LU<-
  factor(pred.full_2$LU,c("Primary","Secondary","Plantation",
                          "Pasture","Cropland","Urban"))
names(pred.full_2)[2]<-c("Odds")
pred.full_2$Odds<-as.numeric(pred.full_2$Odds)
pred.full_2$SE<-as.numeric(pred.full_2$SE)
pred.full_2$LU<-as.factor(pred.full_2$LU)
#add the model name
pred.full_2$model<-with(pred.full_2,"m_5")
data.m_5<-pred.full_2

# for the model 6
pred.m_6<-m_6 %>% emmeans(specs = ~LU , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
#selelct the rows that compared to primary
pred.full_2<-pred.m_6[grepl("Primary",pred.m_6$contrast),]
pred.full_2$contrast<-as.character(pred.full_2$contrast)
pred.full_2[6,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
library(stringr)
pred.full_2[c('name1', 'name2')] <- str_split_fixed(pred.full_2$contrast, '/', 2)
names(pred.full_2)
names(pred.full_2)[10]<-c("LU")
pred.full_2$LU<-as.factor(pred.full_2$LU)
levels(pred.full_2$LU)<-c("Cropland","Pasture","Plantation",
                          "Primary","Secondary", "Urban")
pred.full_2$LU<-
  factor(pred.full_2$LU,c("Primary","Secondary","Plantation",
                          "Pasture","Cropland","Urban"))
names(pred.full_2)[2]<-c("Odds")
pred.full_2$Odds<-as.numeric(pred.full_2$Odds)
pred.full_2$SE<-as.numeric(pred.full_2$SE)
pred.full_2$LU<-as.factor(pred.full_2$LU)

#add the model name
pred.full_2$model<-with(pred.full_2,"m_6")
data.m_6<-pred.full_2

# for the model 7
pred.m_7<-m_7 %>% emmeans(specs = ~LU , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
#selelct the rows that compared to primary
pred.full_2<-pred.m_7[grepl("Primary",pred.m_7$contrast),]
pred.full_2$contrast<-as.character(pred.full_2$contrast)
pred.full_2[6,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
library(stringr)
pred.full_2[c('name1', 'name2')] <- str_split_fixed(pred.full_2$contrast, '/', 2)
names(pred.full_2)
names(pred.full_2)[10]<-c("LU")
pred.full_2$LU<-as.factor(pred.full_2$LU)
levels(pred.full_2$LU)<-c("Cropland","Pasture","Plantation",
                          "Primary","Secondary", "Urban")
pred.full_2$LU<-
  factor(pred.full_2$LU,c("Primary","Secondary","Plantation",
                          "Pasture","Cropland","Urban"))
names(pred.full_2)[2]<-c("Odds")
pred.full_2$Odds<-as.numeric(pred.full_2$Odds)
pred.full_2$SE<-as.numeric(pred.full_2$SE)
pred.full_2$LU<-as.factor(pred.full_2$LU)
#add the model name
pred.full_2$model<-with(pred.full_2,"m_7")
data.m_7<-pred.full_2

# for the model 8
pred.m_8<-m_8 %>% emmeans(specs = ~LU , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
#selelct the rows that compared to primary
pred.full_2<-pred.m_8[grepl("Primary",pred.m_8$contrast),]
pred.full_2$contrast<-as.character(pred.full_2$contrast)
pred.full_2[6,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
library(stringr)
pred.full_2[c('name1', 'name2')] <- str_split_fixed(pred.full_2$contrast, '/', 2)
names(pred.full_2)
names(pred.full_2)[10]<-c("LU")
pred.full_2$LU<-as.factor(pred.full_2$LU)
levels(pred.full_2$LU)<-c("Cropland","Pasture","Plantation",
                          "Primary","Secondary", "Urban")
pred.full_2$LU<-
  factor(pred.full_2$LU,c("Primary","Secondary","Plantation",
                          "Pasture","Cropland","Urban"))
names(pred.full_2)[2]<-c("Odds")
pred.full_2$Odds<-as.numeric(pred.full_2$Odds)
pred.full_2$SE<-as.numeric(pred.full_2$SE)
pred.full_2$LU<-as.factor(pred.full_2$LU)
#add the model name
pred.full_2$model<-with(pred.full_2,"m_8")
data.m_8<-pred.full_2

# for the model 2
pred.m_9<-m_9 %>% emmeans(specs = ~LU , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()

#selelct the rows that compared to primary
pred.full_2<-pred.m_9[grepl("Primary",pred.m_9$contrast),]
pred.full_2$contrast<-as.character(pred.full_2$contrast)
pred.full_2[6,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
library(stringr)
pred.full_2[c('name1', 'name2')] <- str_split_fixed(pred.full_2$contrast, '/', 2)
names(pred.full_2)
names(pred.full_2)[10]<-c("LU")
pred.full_2$LU<-as.factor(pred.full_2$LU)
levels(pred.full_2$LU)<-c("Cropland","Pasture","Plantation",
                          "Primary","Secondary", "Urban")
pred.full_2$LU<-
  factor(pred.full_2$LU,c("Primary","Secondary","Plantation",
                          "Pasture","Cropland","Urban"))
names(pred.full_2)[2]<-c("Odds")
pred.full_2$Odds<-as.numeric(pred.full_2$Odds)
pred.full_2$SE<-as.numeric(pred.full_2$SE)
pred.full_2$LU<-as.factor(pred.full_2$LU)
#add the model name
pred.full_2$model<-with(pred.full_2,"m_9")
data.m_9<-pred.full_2

# for the model 10
pred.m_10<-m_10 %>% emmeans(specs = ~LU, type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
#selelct the rows that compared to primary
pred.full_2<-pred.m_10[grepl("Primary",pred.m_10$contrast),]
pred.full_2$contrast<-as.character(pred.full_2$contrast)
pred.full_2[6,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
library(stringr)
pred.full_2[c('name1', 'name2')] <- str_split_fixed(pred.full_2$contrast, '/', 2)
names(pred.full_2)
names(pred.full_2)[10]<-c("LU")
pred.full_2$LU<-as.factor(pred.full_2$LU)
levels(pred.full_2$LU)<-c("Cropland","Pasture","Plantation",
                          "Primary","Secondary", "Urban")
pred.full_2$LU<-
  factor(pred.full_2$LU,c("Primary","Secondary","Plantation",
                          "Pasture","Cropland","Urban"))
names(pred.full_2)[2]<-c("Odds")
pred.full_2$Odds<-as.numeric(pred.full_2$Odds)
pred.full_2$SE<-as.numeric(pred.full_2$SE)
pred.full_2$LU<-as.factor(pred.full_2$LU)
#add the model name
pred.full_2$model<-with(pred.full_2,"m_10")
data.m_10<-pred.full_2

# for the model 11
pred.m_11<-m_11 %>% emmeans(specs = ~LU , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
#selelct the rows that compared to primary
pred.full_2<-pred.m_11[grepl("Primary",pred.m_11$contrast),]
pred.full_2$contrast<-as.character(pred.full_2$contrast)
pred.full_2[6,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
library(stringr)
pred.full_2[c('name1', 'name2')] <- str_split_fixed(pred.full_2$contrast, '/', 2)
names(pred.full_2)
names(pred.full_2)[10]<-c("LU")
pred.full_2$LU<-as.factor(pred.full_2$LU)
levels(pred.full_2$LU)<-c("Cropland","Pasture","Plantation",
                          "Primary","Secondary", "Urban")
pred.full_2$LU<-
  factor(pred.full_2$LU,c("Primary","Secondary","Plantation",
                          "Pasture","Cropland","Urban"))
names(pred.full_2)[2]<-c("Odds")
pred.full_2$Odds<-as.numeric(pred.full_2$Odds)
pred.full_2$SE<-as.numeric(pred.full_2$SE)
pred.full_2$LU<-as.factor(pred.full_2$LU)
#add the model name
pred.full_2$model<-with(pred.full_2,"m_11")
data.m_11<-pred.full_2


# for the model 12
pred.m_12<-m_12 %>% emmeans(specs = ~LU , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
#selelct the rows that compared to primary
#selelct the rows that compared to primary
pred.full_2<-pred.m_12[grepl("Primary",pred.m_12$contrast),]
pred.full_2$contrast<-as.character(pred.full_2$contrast)
pred.full_2[6,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
library(stringr)
pred.full_2[c('name1', 'name2')] <- str_split_fixed(pred.full_2$contrast, '/', 2)
names(pred.full_2)
names(pred.full_2)[10]<-c("LU")
pred.full_2$LU<-as.factor(pred.full_2$LU)
levels(pred.full_2$LU)<-c("Cropland","Pasture","Plantation",
                          "Primary","Secondary", "Urban")
pred.full_2$LU<-
  factor(pred.full_2$LU,c("Primary","Secondary","Plantation",
                          "Pasture","Cropland","Urban"))
names(pred.full_2)[2]<-c("Odds")
pred.full_2$Odds<-as.numeric(pred.full_2$Odds)
pred.full_2$SE<-as.numeric(pred.full_2$SE)
pred.full_2$LU<-as.factor(pred.full_2$LU)
#add the model name
pred.full_2$model<-with(pred.full_2,"m_12")
data.m_12<-pred.full_2

# for the model 13
pred.m_13<-m_13 %>% emmeans(specs = ~LU , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
#selelct the rows that compared to primary
pred.full_2<-pred.m_13[grepl("Primary",pred.m_13$contrast),]
pred.full_2$contrast<-as.character(pred.full_2$contrast)
pred.full_2[6,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
library(stringr)
pred.full_2[c('name1', 'name2')] <- str_split_fixed(pred.full_2$contrast, '/', 2)
names(pred.full_2)
names(pred.full_2)[10]<-c("LU")
pred.full_2$LU<-as.factor(pred.full_2$LU)
levels(pred.full_2$LU)<-c("Cropland","Pasture","Plantation",
                          "Primary","Secondary", "Urban")
pred.full_2$LU<-
  factor(pred.full_2$LU,c("Primary","Secondary","Plantation",
                          "Pasture","Cropland","Urban"))
names(pred.full_2)[2]<-c("Odds")
pred.full_2$Odds<-as.numeric(pred.full_2$Odds)
pred.full_2$SE<-as.numeric(pred.full_2$SE)
pred.full_2$LU<-as.factor(pred.full_2$LU)

#add the model name
pred.full_2$model<-with(pred.full_2,"m_13")
data.m_13<-pred.full_2

# for the model 14
pred.m_14<-m_14 %>% emmeans(specs = ~LU , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
#selelct the rows that compared to primary
pred.full_2<-pred.m_14[grepl("Primary",pred.m_14$contrast),]
pred.full_2$contrast<-as.character(pred.full_2$contrast)
pred.full_2[6,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
library(stringr)
pred.full_2[c('name1', 'name2')] <- str_split_fixed(pred.full_2$contrast, '/', 2)
names(pred.full_2)
names(pred.full_2)[10]<-c("LU")
pred.full_2$LU<-as.factor(pred.full_2$LU)
levels(pred.full_2$LU)<-c("Cropland","Pasture","Plantation",
                          "Primary","Secondary", "Urban")
pred.full_2$LU<-
  factor(pred.full_2$LU,c("Primary","Secondary","Plantation",
                          "Pasture","Cropland","Urban"))
names(pred.full_2)[2]<-c("Odds")
pred.full_2$Odds<-as.numeric(pred.full_2$Odds)
pred.full_2$SE<-as.numeric(pred.full_2$SE)
pred.full_2$LU<-as.factor(pred.full_2$LU)
#add the model name
pred.full_2$model<-with(pred.full_2,"m_14")
data.m_14<-pred.full_2

#2_2combine all the model-transfered result
data.model<-rbind(data.full,data.m_1,data.m_2,data.m_3,data.m_4,data.m_5,data.m_6,data.m_7,
                  data.m_8,data.m_9,data.m_10,data.m_11,data.m_12,data.m_13,data.m_14)
names(data.model)
#2_3claclate the mean and confidence interval 95%

#get the model result in our paper
model_result_paper<-data.model%>% filter(model=="Original")
library(dplyr)
model_result_cross<-data.model%>% filter(model!="Original") %>%group_by(LU) %>%
  dplyr::summarise(mean.ratio = mean(Odds, na.rm = TRUE),
            sd.ratio = sd(Odds, na.rm = TRUE),
            n.ratio = n()) %>%
  mutate(se.ratio = sd.ratio / sqrt(n.ratio),
         lower.ci.ratio = mean.ratio - qt(1 - (0.05 / 2), n.ratio - 1) * se.ratio,
         upper.ci.ratio = mean.ratio + qt(1 - (0.05 / 2), n.ratio - 1) * se.ratio)
model_result_cross<-merge(model_result_paper[,c(10,2,3)],model_result_cross[,c(1:3,5:7)],by="LU",all.x=T)
model_result_cross$se.ratio[model_result_cross$LU=="Primary"]<-NA
model_result_cross$lower.ci.ratio[model_result_cross$LU=="Primary"]<-NA
model_result_cross$upper.ci.ratio[model_result_cross$LU=="Primary"]<-NA

```

####figure
```{r}
all<-ggplot(model_result_paper , aes(LU , Odds,color=LU))+
  geom_point(aes(color=LU),size=2.5)+
  geom_errorbar(aes(ymin = Odds-SE , ymax = Odds+SE) ,width=0.4, 
                position = position_dodge(width=.6))+
  scale_y_continuous(name="Odds ratio of alien occurrence",
                     limits=c(0,15),breaks=seq(0,15,5))+
  scale_color_manual(name='LU-types',
                     values = c("#2166AC","#4393C3","#92C5DE",
                                "#F4A582","red","#B2182B"),
                     label=c('Primary','Secondary','Plantation',
                             'Pasture','Cropland','Urban'))+
  guides(color=FALSE)+
  theme_bw()+
  theme(panel.grid.major.x = element_blank() , 
        axis.ticks.length=unit(0.08,"inch"),
        panel.grid.major.y = element_line(size = 0.6 , colour = "grey90") ,
        panel.spacing = unit(0,"lines") , 
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_text(colour = "black",angle = 25, 
                                   size = 12,vjust = 0.6) ,
        axis.text.y = element_text(colour = "black",  size = 12),
        legend.title = element_text(face = 'bold'),
        legend.background = element_blank(),
        legend.box.background = element_blank(),
        legend.key = element_blank(),
        legend.direction =  "horizontal",legend.position = c(0.4,0.9)) 
all

#corss cheacking
names(model_result_cross)
all_cross_lu<-ggplot(model_result_cross , aes(LU , mean.ratio,color=LU))+
  geom_point(aes(color=LU),size=2.5)+
    geom_errorbar(aes(ymin = lower.ci.ratio, ymax = upper.ci.ratio) ,width=0.6, 
                position = position_dodge(width=.6),color="grey50")+
  geom_errorbar(aes(ymin = mean.ratio-se.ratio , ymax = mean.ratio+se.ratio) ,width=0.4, 
                position = position_dodge(width=.6))+
  scale_y_continuous(name="Odds ratio of alien occurrence",
                     limits=c(0,30),breaks=seq(0,30,10))+

  scale_color_manual(name='LU-types',
                     values = c("#2166AC","#4393C3","#92C5DE",
                                "#F4A582","red","#B2182B"),
                     label=c('Primary','Secondary','Plantation',
                             'Pasture','Cropland','Urban'))+

  guides(color=FALSE)+
  theme_bw()+
  theme(panel.grid.major.x = element_blank() , 
        axis.ticks.length=unit(0.08,"inch"),
        panel.grid.major.y = element_line(size = 0.6 , colour = "grey90") ,
        panel.spacing = unit(0,"lines") , 
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_text(colour = "black",angle = 25, 
                                   size = 12,vjust = 0.6) ,
        axis.text.y = element_text(colour = "black",  size = 12),
        legend.title = element_text(face = 'bold'),
        legend.background = element_blank(),
        legend.box.background = element_blank(),
        legend.key = element_blank(),
        legend.direction =  "horizontal",legend.position = c(0.4,0.9)) 

all_cross_lu

#com<-cowplot::plot_grid(all,all_cross,ncol=2,align = 'hv')
#com
ggsave(all_cross_lu,filename = '.../fig2.a.tiff',compression='lzw', width = 3,height = 3.0,dpi=200)
```
###ants subset model

```{r}
####part1: run the model 
db.t<-db[db$taxa=="Ants",]
levels(db.t$LU)
db.t$LU<-
  factor(db.t$LU,c("Urban","SV","Plantation","Pasture","Cropland","Primary"))
#0 the model used in the paper
dplyr::count(db.t,Biome)
m_paper <- glmer(Alien.presence ~ LU+ (1|SS/SSB) , data = db.t , family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#1 excluding the assemblages from biome of #Deserts & Xeric Shrublands
db.t_1<-db.t[db.t$Biome != "Deserts & Xeric Shrublands",]
m_1 <- glmer(Alien.presence ~ LU + (1|SS/SSB) , data = db.t_1 , family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#2 excluding the assemblages from biome of #Flooded Grasslands & Savannas
db.t_2<-db.t[db.t$Biome != "Flooded Grasslands & Savannas",]
m_2 <- glmer(Alien.presence ~ LU + (1|SS/SSB) , data = db.t_2 , family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#3 excluding the assemblages from biome of #Mediterranean Forests, Woodlands & Scrub
db.t_3<-db.t[db.t$Biome != "Mediterranean Forests, Woodlands & Scrub",]
m_3 <- glmer(Alien.presence ~ LU + (1|SS/SSB) , data = db.t_3 , family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#4 excluding the assemblages from biome of #Montane Grasslands & Shrublands
db.t_4<-db.t[db.t$Biome != "Montane Grasslands & Shrublands",]
m_4 <- glmer(Alien.presence ~ LU + (1|SS/SSB) , data = db.t_4 , family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#5 excluding the assemblages from biome of #Temperate Conifer Forests
db.t_5<-db.t[db.t$Biome != "Temperate Conifer Forests",]
m_5 <- glmer(Alien.presence ~ LU + (1|SS/SSB) , data = db.t_5, family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#6 excluding the assemblages from biome of #Montane Grasslands & Shrublands
db.t_6<-db.t[db.t$Biome != "Montane Grasslands & Shrublands",]
m_6 <- glmer(Alien.presence ~ LU + (1|SS/SSB) , data = db.t_6, family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#7 excluding the assemblages from biome of #Temperate Grasslands, Savannas & Shrublands
db.t_7<-db.t[db.t$Biome != "Temperate Grasslands, Savannas & Shrublands",]
m_7 <- glmer(Alien.presence ~ LU + (1|SS/SSB) , data = db.t_7, family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#8 excluding the assemblages from biome of #Tropical & Subtropical Dry Broadleaf Forests
db.t_8<-db.t[db.t$Biome != "Tropical & Subtropical Dry Broadleaf Forests",]
m_8 <- glmer(Alien.presence ~ LU + (1|SS/SSB) , data = db.t_8, family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#9 excluding the assemblages from biome of #Tropical & Subtropical Grasslands, Savannas & Shrublands
db.t_9<-db.t[db.t$Biome != "Tropical & Subtropical Grasslands, Savannas & Shrublands",]
m_9 <- glmer(Alien.presence ~ LU + (1|SS/SSB) , data = db.t_9, family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#10 excluding the assemblages from biome of #Tropical & Subtropical Moist Broadleaf Forests
db.t_10<-db.t[db.t$Biome != "Tropical & Subtropical Moist Broadleaf Forests",]
m_10 <- glmer(Alien.presence ~ LU + (1|SS/SSB) , data = db.t_10, family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

####part2: model backtransfomration
#selelct the rows that compared to primary
pred.full<-m_paper %>% emmeans(specs = ~LU , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
pred.full_2<-pred.full[grepl("Primary",pred.full$contrast),]
pred.full_2$contrast<-as.character(pred.full_2$contrast)
pred.full_2[6,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
library(stringr)
pred.full_2[c('name1', 'name2')] <- str_split_fixed(pred.full_2$contrast, '/', 2)
names(pred.full_2)
names(pred.full_2)[10]<-c("LU")
pred.full_2$LU<-as.factor(pred.full_2$LU)
levels(pred.full_2$LU)<-c("Cropland","Pasture","Plantation",
                          "Primary","Secondary", "Urban")
pred.full_2$LU<-
  factor(pred.full_2$LU,c("Primary","Secondary","Plantation",
                          "Pasture","Cropland","Urban"))
names(pred.full_2)[2]<-c("Odds")
pred.full_2$Odds<-as.numeric(pred.full_2$Odds)
pred.full_2$SE<-as.numeric(pred.full_2$SE)
pred.full_2$LU<-as.factor(pred.full_2$LU)
#add the model name
pred.full_2$model<-with(pred.full_2,"Original")
data.full<-pred.full_2

# for the model 1
pred.m_1<-m_1 %>% emmeans(specs = ~LU , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
#selelct the rows that compared to primary
pred.full_2<-pred.m_1[grepl("Primary",pred.m_1$contrast),]
pred.full_2$contrast<-as.character(pred.full_2$contrast)
pred.full_2[6,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
library(stringr)
pred.full_2[c('name1', 'name2')] <- str_split_fixed(pred.full_2$contrast, '/', 2)
names(pred.full_2)
names(pred.full_2)[10]<-c("LU")
pred.full_2$LU<-as.factor(pred.full_2$LU)
levels(pred.full_2$LU)<-c("Cropland","Pasture","Plantation",
                          "Primary","Secondary", "Urban")
pred.full_2$LU<-
  factor(pred.full_2$LU,c("Primary","Secondary","Plantation",
                          "Pasture","Cropland","Urban"))
names(pred.full_2)[2]<-c("Odds")
pred.full_2$Odds<-as.numeric(pred.full_2$Odds)
pred.full_2$SE<-as.numeric(pred.full_2$SE)
pred.full_2$LU<-as.factor(pred.full_2$LU)
#add the model name
pred.full_2$model<-with(pred.full_2,"m_1")
data.m_1<-pred.full_2

# for the model 2
pred.m_2<-m_2 %>% emmeans(specs = ~LU , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()

#selelct the rows that compared to primary
pred.full_2<-pred.m_2[grepl("Primary",pred.m_2$contrast),]
pred.full_2$contrast<-as.character(pred.full_2$contrast)
pred.full_2[6,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
library(stringr)
pred.full_2[c('name1', 'name2')] <- str_split_fixed(pred.full_2$contrast, '/', 2)
names(pred.full_2)
names(pred.full_2)[10]<-c("LU")
pred.full_2$LU<-as.factor(pred.full_2$LU)
levels(pred.full_2$LU)<-c("Cropland","Pasture","Plantation",
                          "Primary","Secondary", "Urban")
pred.full_2$LU<-
  factor(pred.full_2$LU,c("Primary","Secondary","Plantation",
                          "Pasture","Cropland","Urban"))
names(pred.full_2)[2]<-c("Odds")
pred.full_2$Odds<-as.numeric(pred.full_2$Odds)
pred.full_2$SE<-as.numeric(pred.full_2$SE)
pred.full_2$LU<-as.factor(pred.full_2$LU)
#add the model name
pred.full_2$model<-with(pred.full_2,"m_2")
data.m_2<-pred.full_2

# for the model 3
pred.m_3<-m_3 %>% emmeans(specs = ~LU, type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
#selelct the rows that compared to primary
pred.full_2<-pred.m_3[grepl("Primary",pred.m_3$contrast),]
pred.full_2$contrast<-as.character(pred.full_2$contrast)
pred.full_2[6,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
library(stringr)
pred.full_2[c('name1', 'name2')] <- str_split_fixed(pred.full_2$contrast, '/', 2)
names(pred.full_2)
names(pred.full_2)[10]<-c("LU")
pred.full_2$LU<-as.factor(pred.full_2$LU)
levels(pred.full_2$LU)<-c("Cropland","Pasture","Plantation",
                          "Primary","Secondary", "Urban")
pred.full_2$LU<-
  factor(pred.full_2$LU,c("Primary","Secondary","Plantation",
                          "Pasture","Cropland","Urban"))
names(pred.full_2)[2]<-c("Odds")
pred.full_2$Odds<-as.numeric(pred.full_2$Odds)
pred.full_2$SE<-as.numeric(pred.full_2$SE)
pred.full_2$LU<-as.factor(pred.full_2$LU)
#add the model name
pred.full_2$model<-with(pred.full_2,"m_3")
data.m_3<-pred.full_2

# for the model 4
pred.m_4<-m_4 %>% emmeans(specs = ~LU , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
#selelct the rows that compared to primary
pred.full_2<-pred.m_4[grepl("Primary",pred.m_4$contrast),]
pred.full_2$contrast<-as.character(pred.full_2$contrast)
pred.full_2[6,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
library(stringr)
pred.full_2[c('name1', 'name2')] <- str_split_fixed(pred.full_2$contrast, '/', 2)
names(pred.full_2)
names(pred.full_2)[10]<-c("LU")
pred.full_2$LU<-as.factor(pred.full_2$LU)
levels(pred.full_2$LU)<-c("Cropland","Pasture","Plantation",
                          "Primary","Secondary", "Urban")
pred.full_2$LU<-
  factor(pred.full_2$LU,c("Primary","Secondary","Plantation",
                          "Pasture","Cropland","Urban"))
names(pred.full_2)[2]<-c("Odds")
pred.full_2$Odds<-as.numeric(pred.full_2$Odds)
pred.full_2$SE<-as.numeric(pred.full_2$SE)
pred.full_2$LU<-as.factor(pred.full_2$LU)
#add the model name
pred.full_2$model<-with(pred.full_2,"m_4")
data.m_4<-pred.full_2


# for the model 5
pred.m_5<-m_5 %>% emmeans(specs = ~LU , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
#selelct the rows that compared to primary
#selelct the rows that compared to primary
pred.full_2<-pred.m_5[grepl("Primary",pred.m_5$contrast),]
pred.full_2$contrast<-as.character(pred.full_2$contrast)
pred.full_2[6,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
library(stringr)
pred.full_2[c('name1', 'name2')] <- str_split_fixed(pred.full_2$contrast, '/', 2)
names(pred.full_2)
names(pred.full_2)[10]<-c("LU")
pred.full_2$LU<-as.factor(pred.full_2$LU)
levels(pred.full_2$LU)<-c("Cropland","Pasture","Plantation",
                          "Primary","Secondary", "Urban")
pred.full_2$LU<-
  factor(pred.full_2$LU,c("Primary","Secondary","Plantation",
                          "Pasture","Cropland","Urban"))
names(pred.full_2)[2]<-c("Odds")
pred.full_2$Odds<-as.numeric(pred.full_2$Odds)
pred.full_2$SE<-as.numeric(pred.full_2$SE)
pred.full_2$LU<-as.factor(pred.full_2$LU)
#add the model name
pred.full_2$model<-with(pred.full_2,"m_5")
data.m_5<-pred.full_2

# for the model 6
pred.m_6<-m_6 %>% emmeans(specs = ~LU , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
#selelct the rows that compared to primary
pred.full_2<-pred.m_6[grepl("Primary",pred.m_6$contrast),]
pred.full_2$contrast<-as.character(pred.full_2$contrast)
pred.full_2[6,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
library(stringr)
pred.full_2[c('name1', 'name2')] <- str_split_fixed(pred.full_2$contrast, '/', 2)
names(pred.full_2)
names(pred.full_2)[10]<-c("LU")
pred.full_2$LU<-as.factor(pred.full_2$LU)
levels(pred.full_2$LU)<-c("Cropland","Pasture","Plantation",
                          "Primary","Secondary", "Urban")
pred.full_2$LU<-
  factor(pred.full_2$LU,c("Primary","Secondary","Plantation",
                          "Pasture","Cropland","Urban"))
names(pred.full_2)[2]<-c("Odds")
pred.full_2$Odds<-as.numeric(pred.full_2$Odds)
pred.full_2$SE<-as.numeric(pred.full_2$SE)
pred.full_2$LU<-as.factor(pred.full_2$LU)

#add the model name
pred.full_2$model<-with(pred.full_2,"m_6")
data.m_6<-pred.full_2

# for the model 7
pred.m_7<-m_7 %>% emmeans(specs = ~LU , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
#selelct the rows that compared to primary
pred.full_2<-pred.m_7[grepl("Primary",pred.m_7$contrast),]
pred.full_2$contrast<-as.character(pred.full_2$contrast)
pred.full_2[6,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
library(stringr)
pred.full_2[c('name1', 'name2')] <- str_split_fixed(pred.full_2$contrast, '/', 2)
names(pred.full_2)
names(pred.full_2)[10]<-c("LU")
pred.full_2$LU<-as.factor(pred.full_2$LU)
levels(pred.full_2$LU)<-c("Cropland","Pasture","Plantation",
                          "Primary","Secondary", "Urban")
pred.full_2$LU<-
  factor(pred.full_2$LU,c("Primary","Secondary","Plantation",
                          "Pasture","Cropland","Urban"))
names(pred.full_2)[2]<-c("Odds")
pred.full_2$Odds<-as.numeric(pred.full_2$Odds)
pred.full_2$SE<-as.numeric(pred.full_2$SE)
pred.full_2$LU<-as.factor(pred.full_2$LU)
#add the model name
pred.full_2$model<-with(pred.full_2,"m_7")
data.m_7<-pred.full_2

# for the model 8
pred.m_8<-m_8 %>% emmeans(specs = ~LU , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
#selelct the rows that compared to primary
pred.full_2<-pred.m_8[grepl("Primary",pred.m_8$contrast),]
pred.full_2$contrast<-as.character(pred.full_2$contrast)
pred.full_2[6,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
library(stringr)
pred.full_2[c('name1', 'name2')] <- str_split_fixed(pred.full_2$contrast, '/', 2)
names(pred.full_2)
names(pred.full_2)[10]<-c("LU")
pred.full_2$LU<-as.factor(pred.full_2$LU)
levels(pred.full_2$LU)<-c("Cropland","Pasture","Plantation",
                          "Primary","Secondary", "Urban")
pred.full_2$LU<-
  factor(pred.full_2$LU,c("Primary","Secondary","Plantation",
                          "Pasture","Cropland","Urban"))
names(pred.full_2)[2]<-c("Odds")
pred.full_2$Odds<-as.numeric(pred.full_2$Odds)
pred.full_2$SE<-as.numeric(pred.full_2$SE)
pred.full_2$LU<-as.factor(pred.full_2$LU)
#add the model name
pred.full_2$model<-with(pred.full_2,"m_8")
data.m_8<-pred.full_2

# for the model 2
pred.m_9<-m_9 %>% emmeans(specs = ~LU , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()

#selelct the rows that compared to primary
pred.full_2<-pred.m_9[grepl("Primary",pred.m_9$contrast),]
pred.full_2$contrast<-as.character(pred.full_2$contrast)
pred.full_2[6,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
library(stringr)
pred.full_2[c('name1', 'name2')] <- str_split_fixed(pred.full_2$contrast, '/', 2)
names(pred.full_2)
names(pred.full_2)[10]<-c("LU")
pred.full_2$LU<-as.factor(pred.full_2$LU)
levels(pred.full_2$LU)<-c("Cropland","Pasture","Plantation",
                          "Primary","Secondary", "Urban")
pred.full_2$LU<-
  factor(pred.full_2$LU,c("Primary","Secondary","Plantation",
                          "Pasture","Cropland","Urban"))
names(pred.full_2)[2]<-c("Odds")
pred.full_2$Odds<-as.numeric(pred.full_2$Odds)
pred.full_2$SE<-as.numeric(pred.full_2$SE)
pred.full_2$LU<-as.factor(pred.full_2$LU)
#add the model name
pred.full_2$model<-with(pred.full_2,"m_9")
data.m_9<-pred.full_2

# for the model 10
pred.m_10<-m_10 %>% emmeans(specs = ~LU, type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
#selelct the rows that compared to primary
pred.full_2<-pred.m_10[grepl("Primary",pred.m_10$contrast),]
pred.full_2$contrast<-as.character(pred.full_2$contrast)
pred.full_2[6,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
library(stringr)
pred.full_2[c('name1', 'name2')] <- str_split_fixed(pred.full_2$contrast, '/', 2)
names(pred.full_2)
names(pred.full_2)[10]<-c("LU")
pred.full_2$LU<-as.factor(pred.full_2$LU)
levels(pred.full_2$LU)<-c("Cropland","Pasture","Plantation",
                          "Primary","Secondary", "Urban")
pred.full_2$LU<-
  factor(pred.full_2$LU,c("Primary","Secondary","Plantation",
                          "Pasture","Cropland","Urban"))
names(pred.full_2)[2]<-c("Odds")
pred.full_2$Odds<-as.numeric(pred.full_2$Odds)
pred.full_2$SE<-as.numeric(pred.full_2$SE)
pred.full_2$LU<-as.factor(pred.full_2$LU)
#add the model name
pred.full_2$model<-with(pred.full_2,"m_10")
data.m_10<-pred.full_2



#2_2combine all the model-transfered result
data.model<-rbind(data.full,data.m_1,data.m_2,data.m_3,data.m_4,data.m_5,data.m_6,data.m_7,
                  data.m_8,data.m_9,data.m_10)
names(data.model)
#2_3claclate the mean and confidence interval 95%

#get the model result in our paper
model_result_paper<-data.model%>% filter(model=="Original")
library(dplyr)
model_result_cross<-data.model%>% filter(model!="Original") %>%group_by(LU) %>%
  dplyr::summarise(mean.ratio = mean(Odds, na.rm = TRUE),
            sd.ratio = sd(Odds, na.rm = TRUE),
            n.ratio = n()) %>%
  mutate(se.ratio = sd.ratio / sqrt(n.ratio),
         lower.ci.ratio = mean.ratio - qt(1 - (0.05 / 2), n.ratio - 1) * se.ratio,
         upper.ci.ratio = mean.ratio + qt(1 - (0.05 / 2), n.ratio - 1) * se.ratio)
model_result_table<-merge(model_result_paper[,c(10,2,3)],model_result_cross[,c(1:3,5:7)],by="LU",all.x=T)
model_result_table$se.ratio[model_result_table$LU=="Primary"]<-NA
model_result_table$lower.ci.ratio[model_result_table$LU=="Primary"]<-NA
model_result_table$upper.ci.ratio[model_result_table$LU=="Primary"]<-NA

```

####figure
```{r}
all<-ggplot(model_result_paper , aes(LU , Odds,color=LU))+
  geom_point(aes(color=LU),size=2.5)+
  geom_errorbar(aes(ymin = Odds-SE , ymax = Odds+SE) ,width=0.4, 
                position = position_dodge(width=.6))+
  scale_y_continuous(name="Odds ratio of alien occurrence",
                     limits=c(-1,65),breaks=seq(0,60,20))+
  scale_color_manual(name='LU-types',
                     values = c("#2166AC","#4393C3","#92C5DE",
                                "#F4A582","red","#B2182B"),
                     label=c('Primary','Secondary','Plantation',
                             'Pasture','Cropland','Urban'))+
  guides(color=FALSE)+
  theme_bw()+
  theme(panel.grid.major.x = element_blank() , 
        axis.ticks.length=unit(0.08,"inch"),
        panel.grid.major.y = element_line(size = 0.6 , colour = "grey90") ,
        panel.spacing = unit(0,"lines") , 
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_text(colour = "black",angle = 25, 
                                   size = 12,vjust = 0.6) ,
        axis.text.y = element_text(colour = "black",  size = 12),
        legend.title = element_text(face = 'bold'),
        legend.background = element_blank(),
        legend.box.background = element_blank(),
        legend.key = element_blank(),
        legend.direction =  "horizontal",legend.position = c(0.4,0.9)) 
all

#corss cheacking
names(model_result_table)
all_cross_ant<-ggplot(model_result_table , aes(LU , mean.ratio,color=LU))+
  geom_point(aes(color=LU),size=2.5)+
    geom_errorbar(aes(ymin = lower.ci.ratio, ymax = upper.ci.ratio) ,width=0.6, 
                position = position_dodge(width=.6),color="grey50")+
  geom_errorbar(aes(ymin = mean.ratio-se.ratio , ymax = mean.ratio+se.ratio) ,width=0.4, 
                position = position_dodge(width=.6))+
  scale_y_continuous(name="Odds ratio of alien occurrence",
                     limits=c(-1,65),breaks=seq(0,60,20))+

  scale_color_manual(name='LU-types',
                     values = c("#2166AC","#4393C3","#92C5DE",
                                "#F4A582","red","#B2182B"),
                     label=c('Primary','Secondary','Plantation',
                             'Pasture','Cropland','Urban'))+

  guides(color=FALSE)+
  theme_bw()+
  theme(panel.grid.major.x = element_blank() , 
        axis.ticks.length=unit(0.08,"inch"),
        panel.grid.major.y = element_line(size = 0.6 , colour = "grey90") ,
        panel.spacing = unit(0,"lines") , 
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_text(colour = "black",angle = 25, 
                                   size = 12,vjust = 0.6) ,
        axis.text.y = element_text(colour = "black",  size = 12),
        legend.title = element_text(face = 'bold'),
        legend.background = element_blank(),
        legend.box.background = element_blank(),
        legend.key = element_blank(),
        legend.direction =  "horizontal",legend.position = c(0.4,0.9)) 

all_cross_ant

#com<-cowplot::plot_grid(all,all_cross,ncol=2,align = 'hv')
#com
ggsave(all_cross_ant,filename = '.../figxb.tiff',compression='lzw', width = 3,height = 3.0,dpi=200)
```
###birds subset
```{r}
####part1: run the model 
db.t<-db[db$taxa=="Birds",]
levels(db.t$LU)
dplyr::count(db.t,LU)
db.t$LU<-
  factor(db.t$LU,c("Cropland","Urban","SV","Plantation","Pasture","Primary"))
dplyr::count(db.t,Biome)

#0 the model used in the paper
m_paper <- glmer(Alien.presence ~ LU+ (1|SS/SSB) , data = db.t , family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#1 excluding the assemblages from biome of #Boreal Forests/Taiga
db.t_1<-db.t[db.t$Biome != "Boreal Forests/Taiga",]
m_1 <- glmer(Alien.presence ~ LU + (1|SS/SSB) , data = db.t_1 , family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#2 excluding the assemblages from biome of #Deserts & Xeric Shrublands
db.t_2<-db.t[db.t$Biome != "Deserts & Xeric Shrublands",]
m_2 <- glmer(Alien.presence ~ LU + (1|SS/SSB) , data = db.t_2 , family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )
summary(m_2)
#3 excluding the assemblages from biome of #Flooded Grasslands & Savannas
#db.t_3<-db.t[db.t$Biome != "Flooded Grasslands & Savannas",]
#m_3 <- glmer(Alien.presence ~ LU + (1|SS/SSB) , data = db.t_3 , family = binomial , 
#                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#4 excluding the assemblages from biome of #Mangroves
db.t_4<-db.t[db.t$Biome != "Mangroves",]
m_4 <- glmer(Alien.presence ~ LU + (1|SS/SSB) , data = db.t_4 , family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#5 excluding the assemblages from biome of #Mediterranean Forests, Woodlands & Scrub
db.t_5<-db.t[db.t$Biome != "Mediterranean Forests, Woodlands & Scrub",]
m_5 <- glmer(Alien.presence ~ LU + (1|SS/SSB) , data = db.t_5, family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#6 excluding the assemblages from biome of #Montane Grasslands & Shrublands
db.t_6<-db.t[db.t$Biome != "Montane Grasslands & Shrublands",]
m_6 <- glmer(Alien.presence ~ LU + (1|SS/SSB) , data = db.t_6, family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#7 excluding the assemblages from biome of #Temperate Broadleaf & Mixed Forests,#low assembalges in urban is 84
#db.t_7<-db.t[db.t$Biome != "Temperate Broadleaf & Mixed Forests",]
#m_7 <- glmer(Alien.presence ~ LU + (1|SS/SSB) , data = db.t_7, family = binomial , 
#                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )
#summary(m_6);summary(m_7)

#8 excluding the assemblages from biome of #Temperate Conifer Forests
db.t_8<-db.t[db.t$Biome != "Temperate Conifer Forests",]
m_8 <- glmer(Alien.presence ~ LU + (1|SS/SSB) , data = db.t_8, family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#9 excluding the assemblages from biome of #Temperate Grasslands, Savannas & Shrublands
db.t_9<-db.t[db.t$Biome != "Temperate Grasslands, Savannas & Shrublands",]
m_9 <- glmer(Alien.presence ~ LU + (1|SS/SSB) , data = db.t_9, family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#10 excluding the assemblages from biome of #Tropical & Subtropical Coniferous Forests
db.t_10<-db.t[db.t$Biome != "Tropical & Subtropical Coniferous Forests",]
m_10 <- glmer(Alien.presence ~ LU + (1|SS/SSB) , data = db.t_10, family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#11 excluding the assemblages from biome of #Tropical & Subtropical Dry Broadleaf Forests
db.t_11<-db.t[db.t$Biome != "Tropical & Subtropical Dry Broadleaf Forests",]
m_11 <- glmer(Alien.presence ~ LU + (1|SS/SSB) , data = db.t_11, family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#12 excluding the assemblages from biome of #Tropical & Subtropical Grasslands, Savannas & Shrublands
db.t_12<-db.t[db.t$Biome != "Tropical & Subtropical Grasslands, Savannas & Shrublands",]
m_12 <- glmer(Alien.presence ~ LU + (1|SS/SSB) , data = db.t_12, family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#13 excluding the assemblages from biome of #Tropical & Subtropical Moist Broadleaf Forests
db.t_13<-db.t[db.t$Biome != "Tropical & Subtropical Moist Broadleaf Forests",]
m_13 <- glmer(Alien.presence ~ LU + (1|SS/SSB) , data = db.t_13, family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#14 excluding the assemblages from biome of #Tundra
db.t_14<-db.t[db.t$Biome != "Tundra",]
m_14 <- glmer(Alien.presence ~ LU + (1|SS/SSB) , data = db.t_14, family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

####part2: model backtransfomration
#selelct the rows that compared to primary
pred.full<-m_paper %>% emmeans(specs = ~LU , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
pred.full_2<-pred.full[grepl("Primary",pred.full$contrast),]
pred.full_2$contrast<-as.character(pred.full_2$contrast)
pred.full_2[6,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
library(stringr)
pred.full_2[c('name1', 'name2')] <- str_split_fixed(pred.full_2$contrast, '/', 2)
names(pred.full_2)
names(pred.full_2)[10]<-c("LU")
pred.full_2$LU<-as.factor(pred.full_2$LU)
levels(pred.full_2$LU)<-c("Cropland","Pasture","Plantation",
                          "Primary","Secondary", "Urban")
pred.full_2$LU<-
  factor(pred.full_2$LU,c("Primary","Secondary","Plantation",
                          "Pasture","Cropland","Urban"))
names(pred.full_2)[2]<-c("Odds")
pred.full_2$Odds<-as.numeric(pred.full_2$Odds)
pred.full_2$SE<-as.numeric(pred.full_2$SE)
pred.full_2$LU<-as.factor(pred.full_2$LU)
#add the model name
pred.full_2$model<-with(pred.full_2,"Original")
data.full<-pred.full_2

# for the model 1
pred.m_1<-m_1 %>% emmeans(specs = ~LU , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
#selelct the rows that compared to primary
pred.full_2<-pred.m_1[grepl("Primary",pred.m_1$contrast),]
pred.full_2$contrast<-as.character(pred.full_2$contrast)
pred.full_2[6,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
library(stringr)
pred.full_2[c('name1', 'name2')] <- str_split_fixed(pred.full_2$contrast, '/', 2)
names(pred.full_2)
names(pred.full_2)[10]<-c("LU")
pred.full_2$LU<-as.factor(pred.full_2$LU)
levels(pred.full_2$LU)<-c("Cropland","Pasture","Plantation",
                          "Primary","Secondary", "Urban")
pred.full_2$LU<-
  factor(pred.full_2$LU,c("Primary","Secondary","Plantation",
                          "Pasture","Cropland","Urban"))
names(pred.full_2)[2]<-c("Odds")
pred.full_2$Odds<-as.numeric(pred.full_2$Odds)
pred.full_2$SE<-as.numeric(pred.full_2$SE)
pred.full_2$LU<-as.factor(pred.full_2$LU)
#add the model name
pred.full_2$model<-with(pred.full_2,"m_1")
data.m_1<-pred.full_2

# for the model 2
pred.m_2<-m_2 %>% emmeans(specs = ~LU , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
#selelct the rows that compared to primary
pred.full_2<-pred.m_2[grepl("Primary",pred.m_2$contrast),]
pred.full_2$contrast<-as.character(pred.full_2$contrast)
pred.full_2[6,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
library(stringr)
pred.full_2[c('name1', 'name2')] <- str_split_fixed(pred.full_2$contrast, '/', 2)
names(pred.full_2)
names(pred.full_2)[10]<-c("LU")
pred.full_2$LU<-as.factor(pred.full_2$LU)
levels(pred.full_2$LU)<-c("Cropland","Pasture","Plantation",
                          "Primary","Secondary", "Urban")
pred.full_2$LU<-
  factor(pred.full_2$LU,c("Primary","Secondary","Plantation",
                          "Pasture","Cropland","Urban"))
names(pred.full_2)[2]<-c("Odds")
pred.full_2$Odds<-as.numeric(pred.full_2$Odds)
pred.full_2$SE<-as.numeric(pred.full_2$SE)
pred.full_2$LU<-as.factor(pred.full_2$LU)
#add the model name
pred.full_2$model<-with(pred.full_2,"m_2")
data.m_2<-pred.full_2

# for the model 3
pred.m_3<-m_3 %>% emmeans(specs = ~LU, type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
#selelct the rows that compared to primary
pred.full_2<-pred.m_3[grepl("Primary",pred.m_3$contrast),]
pred.full_2$contrast<-as.character(pred.full_2$contrast)
pred.full_2[6,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
library(stringr)
pred.full_2[c('name1', 'name2')] <- str_split_fixed(pred.full_2$contrast, '/', 2)
names(pred.full_2)
names(pred.full_2)[10]<-c("LU")
pred.full_2$LU<-as.factor(pred.full_2$LU)
levels(pred.full_2$LU)<-c("Cropland","Pasture","Plantation",
                          "Primary","Secondary", "Urban")
pred.full_2$LU<-
  factor(pred.full_2$LU,c("Primary","Secondary","Plantation",
                          "Pasture","Cropland","Urban"))
names(pred.full_2)[2]<-c("Odds")
pred.full_2$Odds<-as.numeric(pred.full_2$Odds)
pred.full_2$SE<-as.numeric(pred.full_2$SE)
pred.full_2$LU<-as.factor(pred.full_2$LU)
#add the model name
pred.full_2$model<-with(pred.full_2,"m_3")
data.m_3<-pred.full_2

# for the model 4
pred.m_4<-m_4 %>% emmeans(specs = ~LU , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
#selelct the rows that compared to primary
pred.full_2<-pred.m_4[grepl("Primary",pred.m_4$contrast),]
pred.full_2$contrast<-as.character(pred.full_2$contrast)
pred.full_2[6,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
library(stringr)
pred.full_2[c('name1', 'name2')] <- str_split_fixed(pred.full_2$contrast, '/', 2)
names(pred.full_2)
names(pred.full_2)[10]<-c("LU")
pred.full_2$LU<-as.factor(pred.full_2$LU)
levels(pred.full_2$LU)<-c("Cropland","Pasture","Plantation",
                          "Primary","Secondary", "Urban")
pred.full_2$LU<-
  factor(pred.full_2$LU,c("Primary","Secondary","Plantation",
                          "Pasture","Cropland","Urban"))
names(pred.full_2)[2]<-c("Odds")
pred.full_2$Odds<-as.numeric(pred.full_2$Odds)
pred.full_2$SE<-as.numeric(pred.full_2$SE)
pred.full_2$LU<-as.factor(pred.full_2$LU)
#add the model name
pred.full_2$model<-with(pred.full_2,"m_4")
data.m_4<-pred.full_2


# for the model 5
pred.m_5<-m_5 %>% emmeans(specs = ~LU , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
#selelct the rows that compared to primary
#selelct the rows that compared to primary
pred.full_2<-pred.m_5[grepl("Primary",pred.m_5$contrast),]
pred.full_2$contrast<-as.character(pred.full_2$contrast)
pred.full_2[6,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
library(stringr)
pred.full_2[c('name1', 'name2')] <- str_split_fixed(pred.full_2$contrast, '/', 2)
names(pred.full_2)
names(pred.full_2)[10]<-c("LU")
pred.full_2$LU<-as.factor(pred.full_2$LU)
levels(pred.full_2$LU)<-c("Cropland","Pasture","Plantation",
                          "Primary","Secondary", "Urban")
pred.full_2$LU<-
  factor(pred.full_2$LU,c("Primary","Secondary","Plantation",
                          "Pasture","Cropland","Urban"))
names(pred.full_2)[2]<-c("Odds")
pred.full_2$Odds<-as.numeric(pred.full_2$Odds)
pred.full_2$SE<-as.numeric(pred.full_2$SE)
pred.full_2$LU<-as.factor(pred.full_2$LU)
#add the model name
pred.full_2$model<-with(pred.full_2,"m_5")
data.m_5<-pred.full_2

# for the model 6
pred.m_6<-m_6 %>% emmeans(specs = ~LU , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
#selelct the rows that compared to primary
pred.full_2<-pred.m_6[grepl("Primary",pred.m_6$contrast),]
pred.full_2$contrast<-as.character(pred.full_2$contrast)
pred.full_2[6,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
library(stringr)
pred.full_2[c('name1', 'name2')] <- str_split_fixed(pred.full_2$contrast, '/', 2)
names(pred.full_2)
names(pred.full_2)[10]<-c("LU")
pred.full_2$LU<-as.factor(pred.full_2$LU)
levels(pred.full_2$LU)<-c("Cropland","Pasture","Plantation",
                          "Primary","Secondary", "Urban")
pred.full_2$LU<-
  factor(pred.full_2$LU,c("Primary","Secondary","Plantation",
                          "Pasture","Cropland","Urban"))
names(pred.full_2)[2]<-c("Odds")
pred.full_2$Odds<-as.numeric(pred.full_2$Odds)
pred.full_2$SE<-as.numeric(pred.full_2$SE)
pred.full_2$LU<-as.factor(pred.full_2$LU)

#add the model name
pred.full_2$model<-with(pred.full_2,"m_6")
data.m_6<-pred.full_2

# for the model 7
pred.m_7<-m_7 %>% emmeans(specs = ~LU , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
#selelct the rows that compared to primary
pred.full_2<-pred.m_7[grepl("Primary",pred.m_7$contrast),]
pred.full_2$contrast<-as.character(pred.full_2$contrast)
pred.full_2[6,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
library(stringr)
pred.full_2[c('name1', 'name2')] <- str_split_fixed(pred.full_2$contrast, '/', 2)
names(pred.full_2)
names(pred.full_2)[10]<-c("LU")
pred.full_2$LU<-as.factor(pred.full_2$LU)
levels(pred.full_2$LU)<-c("Cropland","Pasture","Plantation",
                          "Primary","Secondary", "Urban")
pred.full_2$LU<-
  factor(pred.full_2$LU,c("Primary","Secondary","Plantation",
                          "Pasture","Cropland","Urban"))
names(pred.full_2)[2]<-c("Odds")
pred.full_2$Odds<-as.numeric(pred.full_2$Odds)
pred.full_2$SE<-as.numeric(pred.full_2$SE)
pred.full_2$LU<-as.factor(pred.full_2$LU)
#add the model name
pred.full_2$model<-with(pred.full_2,"m_7")
data.m_7<-pred.full_2

# for the model 8
pred.m_8<-m_8 %>% emmeans(specs = ~LU , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
#selelct the rows that compared to primary
pred.full_2<-pred.m_8[grepl("Primary",pred.m_8$contrast),]
pred.full_2$contrast<-as.character(pred.full_2$contrast)
pred.full_2[6,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
library(stringr)
pred.full_2[c('name1', 'name2')] <- str_split_fixed(pred.full_2$contrast, '/', 2)
names(pred.full_2)
names(pred.full_2)[10]<-c("LU")
pred.full_2$LU<-as.factor(pred.full_2$LU)
levels(pred.full_2$LU)<-c("Cropland","Pasture","Plantation",
                          "Primary","Secondary", "Urban")
pred.full_2$LU<-
  factor(pred.full_2$LU,c("Primary","Secondary","Plantation",
                          "Pasture","Cropland","Urban"))
names(pred.full_2)[2]<-c("Odds")
pred.full_2$Odds<-as.numeric(pred.full_2$Odds)
pred.full_2$SE<-as.numeric(pred.full_2$SE)
pred.full_2$LU<-as.factor(pred.full_2$LU)
#add the model name
pred.full_2$model<-with(pred.full_2,"m_8")
data.m_8<-pred.full_2

# for the model 2
pred.m_9<-m_9 %>% emmeans(specs = ~LU , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()

#selelct the rows that compared to primary
pred.full_2<-pred.m_9[grepl("Primary",pred.m_9$contrast),]
pred.full_2$contrast<-as.character(pred.full_2$contrast)
pred.full_2[6,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
library(stringr)
pred.full_2[c('name1', 'name2')] <- str_split_fixed(pred.full_2$contrast, '/', 2)
names(pred.full_2)
names(pred.full_2)[10]<-c("LU")
pred.full_2$LU<-as.factor(pred.full_2$LU)
levels(pred.full_2$LU)<-c("Cropland","Pasture","Plantation",
                          "Primary","Secondary", "Urban")
pred.full_2$LU<-
  factor(pred.full_2$LU,c("Primary","Secondary","Plantation",
                          "Pasture","Cropland","Urban"))
names(pred.full_2)[2]<-c("Odds")
pred.full_2$Odds<-as.numeric(pred.full_2$Odds)
pred.full_2$SE<-as.numeric(pred.full_2$SE)
pred.full_2$LU<-as.factor(pred.full_2$LU)
#add the model name
pred.full_2$model<-with(pred.full_2,"m_9")
data.m_9<-pred.full_2

# for the model 10
pred.m_10<-m_10 %>% emmeans(specs = ~LU, type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
#selelct the rows that compared to primary
pred.full_2<-pred.m_10[grepl("Primary",pred.m_10$contrast),]
pred.full_2$contrast<-as.character(pred.full_2$contrast)
pred.full_2[6,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
library(stringr)
pred.full_2[c('name1', 'name2')] <- str_split_fixed(pred.full_2$contrast, '/', 2)
names(pred.full_2)
names(pred.full_2)[10]<-c("LU")
pred.full_2$LU<-as.factor(pred.full_2$LU)
levels(pred.full_2$LU)<-c("Cropland","Pasture","Plantation",
                          "Primary","Secondary", "Urban")
pred.full_2$LU<-
  factor(pred.full_2$LU,c("Primary","Secondary","Plantation",
                          "Pasture","Cropland","Urban"))
names(pred.full_2)[2]<-c("Odds")
pred.full_2$Odds<-as.numeric(pred.full_2$Odds)
pred.full_2$SE<-as.numeric(pred.full_2$SE)
pred.full_2$LU<-as.factor(pred.full_2$LU)
#add the model name
pred.full_2$model<-with(pred.full_2,"m_10")
data.m_10<-pred.full_2

# for the model 11
pred.m_11<-m_11 %>% emmeans(specs = ~LU , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
#selelct the rows that compared to primary
pred.full_2<-pred.m_11[grepl("Primary",pred.m_11$contrast),]
pred.full_2$contrast<-as.character(pred.full_2$contrast)
pred.full_2[6,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
library(stringr)
pred.full_2[c('name1', 'name2')] <- str_split_fixed(pred.full_2$contrast, '/', 2)
names(pred.full_2)
names(pred.full_2)[10]<-c("LU")
pred.full_2$LU<-as.factor(pred.full_2$LU)
levels(pred.full_2$LU)<-c("Cropland","Pasture","Plantation",
                          "Primary","Secondary", "Urban")
pred.full_2$LU<-
  factor(pred.full_2$LU,c("Primary","Secondary","Plantation",
                          "Pasture","Cropland","Urban"))
names(pred.full_2)[2]<-c("Odds")
pred.full_2$Odds<-as.numeric(pred.full_2$Odds)
pred.full_2$SE<-as.numeric(pred.full_2$SE)
pred.full_2$LU<-as.factor(pred.full_2$LU)
#add the model name
pred.full_2$model<-with(pred.full_2,"m_11")
data.m_11<-pred.full_2


# for the model 12
pred.m_12<-m_12 %>% emmeans(specs = ~LU , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
#selelct the rows that compared to primary
#selelct the rows that compared to primary
pred.full_2<-pred.m_12[grepl("Primary",pred.m_12$contrast),]
pred.full_2$contrast<-as.character(pred.full_2$contrast)
pred.full_2[6,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
library(stringr)
pred.full_2[c('name1', 'name2')] <- str_split_fixed(pred.full_2$contrast, '/', 2)
names(pred.full_2)
names(pred.full_2)[10]<-c("LU")
pred.full_2$LU<-as.factor(pred.full_2$LU)
levels(pred.full_2$LU)<-c("Cropland","Pasture","Plantation",
                          "Primary","Secondary", "Urban")
pred.full_2$LU<-
  factor(pred.full_2$LU,c("Primary","Secondary","Plantation",
                          "Pasture","Cropland","Urban"))
names(pred.full_2)[2]<-c("Odds")
pred.full_2$Odds<-as.numeric(pred.full_2$Odds)
pred.full_2$SE<-as.numeric(pred.full_2$SE)
pred.full_2$LU<-as.factor(pred.full_2$LU)
#add the model name
pred.full_2$model<-with(pred.full_2,"m_12")
data.m_12<-pred.full_2

# for the model 13
pred.m_13<-m_13 %>% emmeans(specs = ~LU , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
#selelct the rows that compared to primary
pred.full_2<-pred.m_13[grepl("Primary",pred.m_13$contrast),]
pred.full_2$contrast<-as.character(pred.full_2$contrast)
pred.full_2[6,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
library(stringr)
pred.full_2[c('name1', 'name2')] <- str_split_fixed(pred.full_2$contrast, '/', 2)
names(pred.full_2)
names(pred.full_2)[10]<-c("LU")
pred.full_2$LU<-as.factor(pred.full_2$LU)
levels(pred.full_2$LU)<-c("Cropland","Pasture","Plantation",
                          "Primary","Secondary", "Urban")
pred.full_2$LU<-
  factor(pred.full_2$LU,c("Primary","Secondary","Plantation",
                          "Pasture","Cropland","Urban"))
names(pred.full_2)[2]<-c("Odds")
pred.full_2$Odds<-as.numeric(pred.full_2$Odds)
pred.full_2$SE<-as.numeric(pred.full_2$SE)
pred.full_2$LU<-as.factor(pred.full_2$LU)

#add the model name
pred.full_2$model<-with(pred.full_2,"m_13")
data.m_13<-pred.full_2

# for the model 14
pred.m_14<-m_14 %>% emmeans(specs = ~LU , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
#selelct the rows that compared to primary
pred.full_2<-pred.m_14[grepl("Primary",pred.m_14$contrast),]
pred.full_2$contrast<-as.character(pred.full_2$contrast)
pred.full_2[6,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
library(stringr)
pred.full_2[c('name1', 'name2')] <- str_split_fixed(pred.full_2$contrast, '/', 2)
names(pred.full_2)
names(pred.full_2)[10]<-c("LU")
pred.full_2$LU<-as.factor(pred.full_2$LU)
levels(pred.full_2$LU)<-c("Cropland","Pasture","Plantation",
                          "Primary","Secondary", "Urban")
pred.full_2$LU<-
  factor(pred.full_2$LU,c("Primary","Secondary","Plantation",
                          "Pasture","Cropland","Urban"))
names(pred.full_2)[2]<-c("Odds")
pred.full_2$Odds<-as.numeric(pred.full_2$Odds)
pred.full_2$SE<-as.numeric(pred.full_2$SE)
pred.full_2$LU<-as.factor(pred.full_2$LU)
#add the model name
pred.full_2$model<-with(pred.full_2,"m_14")
data.m_14<-pred.full_2

#2_2combine all the model-transfered result, delete m3 due to no assemblages, data.m_7 not run due to low assemblage
data.model<-rbind(data.full,data.m_1,data.m_2,data.m_4,data.m_5,data.m_6,
                  data.m_8,data.m_9,data.m_10,data.m_11,data.m_12,data.m_13,data.m_14)
names(data.model)
#2_3claclate the mean and confidence interval 95%

#get the model result in our paper
model_result_paper<-data.model%>% filter(model=="Original")
library(dplyr)
model_result_cross<-data.model%>% filter(model!="Original") %>%group_by(LU) %>%
  dplyr::summarise(mean.ratio = mean(Odds, na.rm = TRUE),
            sd.ratio = sd(Odds, na.rm = TRUE),
            n.ratio = n()) %>%
  mutate(se.ratio = sd.ratio / sqrt(n.ratio),
         lower.ci.ratio = mean.ratio - qt(1 - (0.05 / 2), n.ratio - 1) * se.ratio,
         upper.ci.ratio = mean.ratio + qt(1 - (0.05 / 2), n.ratio - 1) * se.ratio)
model_result_table<-merge(model_result_paper[,c(10,2,3)],model_result_cross[,c(1:3,5:7)],by="LU",all.x=T)
model_result_table$se.ratio[model_result_table$LU=="Primary"]<-NA
model_result_table$lower.ci.ratio[model_result_table$LU=="Primary"]<-NA
model_result_table$upper.ci.ratio[model_result_table$LU=="Primary"]<-NA

```

####figure
```{r}
all<-ggplot(model_result_paper , aes(LU , Odds,color=LU))+
  geom_point(aes(color=LU),size=2.5)+
  geom_errorbar(aes(ymin = Odds-SE , ymax = Odds+SE) ,width=0.4, 
                position = position_dodge(width=.6))+
  scale_y_continuous(name="Odds ratio of alien occurrence",
                     limits=c(0,30),breaks=seq(0,30,10))+
  scale_color_manual(name='LU-types',
                     values = c("#2166AC","#4393C3","#92C5DE",
                                "#F4A582","red","#B2182B"),
                     label=c('Primary','Secondary','Plantation',
                             'Pasture','Cropland','Urban'))+
  guides(color=FALSE)+
  theme_bw()+
  theme(panel.grid.major.x = element_blank() , 
        axis.ticks.length=unit(0.08,"inch"),
        panel.grid.major.y = element_line(size = 0.6 , colour = "grey90") ,
        panel.spacing = unit(0,"lines") , 
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_text(colour = "black",angle = 25, 
                                   size = 12,vjust = 0.6) ,
        axis.text.y = element_text(colour = "black",  size = 12),
        legend.title = element_text(face = 'bold'),
        legend.background = element_blank(),
        legend.box.background = element_blank(),
        legend.key = element_blank(),
        legend.direction =  "horizontal",legend.position = c(0.4,0.9)) 
all

#corss cheacking
names(model_result_table)
all_cross_bird<-ggplot(model_result_table , aes(LU , mean.ratio,color=LU))+
  geom_point(aes(color=LU),size=2.5)+
    geom_errorbar(aes(ymin = lower.ci.ratio, ymax = upper.ci.ratio) ,width=0.6, 
                position = position_dodge(width=.6),color="grey50")+
  geom_errorbar(aes(ymin = mean.ratio-se.ratio , ymax = mean.ratio+se.ratio) ,width=0.4, 
                position = position_dodge(width=.6))+
  scale_y_continuous(name="Odds ratio of alien occurrence",
                     limits=c(0,30),breaks=seq(0,30,10))+

  scale_color_manual(name='LU-types',
                     values = c("#2166AC","#4393C3","#92C5DE",
                                "#F4A582","red","#B2182B"),
                     label=c('Primary','Secondary','Plantation',
                             'Pasture','Cropland','Urban'))+

  guides(color=FALSE)+
  theme_bw()+
  theme(panel.grid.major.x = element_blank() , 
        axis.ticks.length=unit(0.08,"inch"),
        panel.grid.major.y = element_line(size = 0.6 , colour = "grey90") ,
        panel.spacing = unit(0,"lines") , 
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_text(colour = "black",angle = 25, 
                                   size = 12,vjust = 0.6) ,
        axis.text.y = element_text(colour = "black",  size = 12),
        legend.title = element_text(face = 'bold'),
        legend.background = element_blank(),
        legend.box.background = element_blank(),
        legend.key = element_blank(),
        legend.direction =  "horizontal",legend.position = c(0.4,0.9)) 

all_cross_bird

#com<-cowplot::plot_grid(all,all_cross,ncol=2,align = 'hv')
#com
ggsave(all_cross_bird,filename = '.../figxb.tiff',compression='lzw', width = 3,height = 3.0,dpi=200)
```
###mammals subset model

```{r}
####part1: run the model 
db.t<-db[db$taxa=="Mammals",]
levels(db.t$LU)
db.t$LU<-
  factor(db.t$LU,c("Urban","SV","Plantation","Pasture","Cropland","Primary"))
db.t<-subset(db.t,!(LU %in% "Urban" & taxa %in%"Mammals"))
db.t<-subset(db.t,!(LU %in% "Cropland" & taxa %in%"Mammals"))
#0 the model used in the paper
dplyr::count(db.t,LU)
dplyr::count(db.t,Biome)
m_paper <- glmer(Alien.presence ~ LU+ (1|SS/SSB) , data = db.t , family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )
summary(m_paper)


#1 excluding the assemblages from biome of #Boreal Forests/Taiga
db.t_1<-db.t[db.t$Biome != "Boreal Forests/Taiga",]
m_1 <- glmer(Alien.presence ~ LU + (1|SS/SSB) , data = db.t_1 , family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#2 excluding the assemblages from biome of #Deserts & Xeric Shrublands
db.t_2<-db.t[db.t$Biome != "Deserts & Xeric Shrublands",]
m_2 <- glmer(Alien.presence ~ LU + (1|SS/SSB) , data = db.t_2 , family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#3 excluding the assemblages from biome of #Mangroves
db.t_3<-db.t[db.t$Biome != "Mangroves",]
m_3 <- glmer(Alien.presence ~ LU + (1|SS/SSB) , data = db.t_3 , family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#4 excluding the assemblages from biome of #Mediterranean Forests, Woodlands & Scrub
db.t_4<-db.t[db.t$Biome != "Mediterranean Forests, Woodlands & Scrub",]
m_4 <- glmer(Alien.presence ~ LU + (1|SS/SSB) , data = db.t_4 , family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#5 excluding the assemblages from biome of #Montane Grasslands & Shrublands
db.t_5<-db.t[db.t$Biome != "Montane Grasslands & Shrublands",]
m_5 <- glmer(Alien.presence ~ LU + (1|SS/SSB) , data = db.t_5, family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#6 excluding the assemblages from biome of #Temperate Broadleaf & Mixed Forests
db.t_6<-db.t[db.t$Biome != "Temperate Broadleaf & Mixed Forests",]
m_6 <- glmer(Alien.presence ~ LU + (1|SS/SSB) , data = db.t_6, family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#7 excluding the assemblages from biome of #Temperate Grasslands, Savannas & Shrublands
db.t_7<-db.t[db.t$Biome != "Temperate Grasslands, Savannas & Shrublands",]
m_7 <- glmer(Alien.presence ~ LU + (1|SS/SSB) , data = db.t_7, family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#8 excluding the assemblages from biome of #Tropical & Subtropical Grasslands, Savannas & Shrublands
db.t_8<-db.t[db.t$Biome != "Tropical & Subtropical Grasslands, Savannas & Shrublands",]
m_8 <- glmer(Alien.presence ~ LU + (1|SS/SSB) , data = db.t_8, family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#9 excluding the assemblages from biome of #Tropical & Subtropical Moist Broadleaf Forests
db.t_9<-db.t[db.t$Biome != "Tropical & Subtropical Moist Broadleaf Forests",]
m_9 <- glmer(Alien.presence ~ LU + (1|SS/SSB) , data = db.t_9, family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

####part2: model backtransfomration

#selelct the rows that compared to primary
mam<-m_paper %>% emmeans(specs = ~LU , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
mam.1<-mam[grepl("Primary",mam$contrast),]
mam.1$contrast<-as.character(mam.1$contrast)
mam.1[4,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
mam.1[5,]<-c("Cropland",NA,NA, NA,NA,NA,NA,NA,NA)
mam.1[6,]<-c("Urban",NA,NA, NA,NA,NA,NA,NA,NA)
mam.1[c('name1', 'name2')] <- str_split_fixed(mam.1$contrast, '/', 2)
names(mam.1)
names(mam.1)[10]<-c("LU")
mam.1$LU<-as.factor(mam.1$LU)
levels(mam.1$LU)<-c("Cropland","Pasture","Plantation","Primary","Secondary","Urban")
mam.1$LU<-
  factor(mam.1$LU,c("Primary","Secondary","Plantation","Pasture","Cropland","Urban"))
names(mam.1)[2]<-c("Odds")
mam.1$Odds<-as.numeric(mam.1$Odds)
mam.1$SE<-as.numeric(mam.1$SE)
#add the model name
mam.1$model<-with(mam.1,"Original")
data.full<-mam.1

# for the model 1
mam<-m_1 %>% emmeans(specs = ~LU , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
mam.1<-mam[grepl("Primary",mam$contrast),]
mam.1$contrast<-as.character(mam.1$contrast)
mam.1[4,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
mam.1[5,]<-c("Cropland",NA,NA, NA,NA,NA,NA,NA,NA)
mam.1[6,]<-c("Urban",NA,NA, NA,NA,NA,NA,NA,NA)
mam.1[c('name1', 'name2')] <- str_split_fixed(mam.1$contrast, '/', 2)
names(mam.1)
names(mam.1)[10]<-c("LU")
mam.1$LU<-as.factor(mam.1$LU)
levels(mam.1$LU)<-c("Cropland","Pasture","Plantation","Primary","Secondary","Urban")
mam.1$LU<-
  factor(mam.1$LU,c("Primary","Secondary","Plantation","Pasture","Cropland","Urban"))
names(mam.1)[2]<-c("Odds")
mam.1$Odds<-as.numeric(mam.1$Odds)
mam.1$SE<-as.numeric(mam.1$SE)
#add the model name
mam.1$model<-with(mam.1,"m_1")
data.m_1<-mam.1

# for the model 2
mam<-m_2 %>% emmeans(specs = ~LU , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
mam.1<-mam[grepl("Primary",mam$contrast),]
mam.1$contrast<-as.character(mam.1$contrast)
mam.1[4,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
mam.1[5,]<-c("Cropland",NA,NA, NA,NA,NA,NA,NA,NA)
mam.1[6,]<-c("Urban",NA,NA, NA,NA,NA,NA,NA,NA)
mam.1[c('name1', 'name2')] <- str_split_fixed(mam.1$contrast, '/', 2)
names(mam.1)
names(mam.1)[10]<-c("LU")
mam.1$LU<-as.factor(mam.1$LU)
levels(mam.1$LU)<-c("Cropland","Pasture","Plantation","Primary","Secondary","Urban")
mam.1$LU<-
  factor(mam.1$LU,c("Primary","Secondary","Plantation","Pasture","Cropland","Urban"))
names(mam.1)[2]<-c("Odds")
mam.1$Odds<-as.numeric(mam.1$Odds)
mam.1$SE<-as.numeric(mam.1$SE)
#add the model name
mam.1$model<-with(mam.1,"m_2")
data.m_2<-mam.1

# for the model 3
mam<-m_3 %>% emmeans(specs = ~LU , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
mam.1<-mam[grepl("Primary",mam$contrast),]
mam.1$contrast<-as.character(mam.1$contrast)
mam.1[4,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
mam.1[5,]<-c("Cropland",NA,NA, NA,NA,NA,NA,NA,NA)
mam.1[6,]<-c("Urban",NA,NA, NA,NA,NA,NA,NA,NA)
mam.1[c('name1', 'name2')] <- str_split_fixed(mam.1$contrast, '/', 2)
names(mam.1)
names(mam.1)[10]<-c("LU")
mam.1$LU<-as.factor(mam.1$LU)
levels(mam.1$LU)<-c("Cropland","Pasture","Plantation","Primary","Secondary","Urban")
mam.1$LU<-
  factor(mam.1$LU,c("Primary","Secondary","Plantation","Pasture","Cropland","Urban"))
names(mam.1)[2]<-c("Odds")
mam.1$Odds<-as.numeric(mam.1$Odds)
mam.1$SE<-as.numeric(mam.1$SE)
#add the model name
mam.1$model<-with(mam.1,"m_3")
data.m_3<-mam.1

# for the model 4
mam<-m_4 %>% emmeans(specs = ~LU , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
mam.1<-mam[grepl("Primary",mam$contrast),]
mam.1$contrast<-as.character(mam.1$contrast)
mam.1[4,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
mam.1[5,]<-c("Cropland",NA,NA, NA,NA,NA,NA,NA,NA)
mam.1[6,]<-c("Urban",NA,NA, NA,NA,NA,NA,NA,NA)
mam.1[c('name1', 'name2')] <- str_split_fixed(mam.1$contrast, '/', 2)
names(mam.1)
names(mam.1)[10]<-c("LU")
mam.1$LU<-as.factor(mam.1$LU)
levels(mam.1$LU)<-c("Cropland","Pasture","Plantation","Primary","Secondary","Urban")
mam.1$LU<-
  factor(mam.1$LU,c("Primary","Secondary","Plantation","Pasture","Cropland","Urban"))
names(mam.1)[2]<-c("Odds")
mam.1$Odds<-as.numeric(mam.1$Odds)
mam.1$SE<-as.numeric(mam.1$SE)
#add the model name
mam.1$model<-with(mam.1,"m_4")
data.m_4<-mam.1

# for the model 5
mam<-m_5 %>% emmeans(specs = ~LU , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
mam.1<-mam[grepl("Primary",mam$contrast),]
mam.1$contrast<-as.character(mam.1$contrast)
mam.1[4,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
mam.1[5,]<-c("Cropland",NA,NA, NA,NA,NA,NA,NA,NA)
mam.1[6,]<-c("Urban",NA,NA, NA,NA,NA,NA,NA,NA)
mam.1[c('name1', 'name2')] <- str_split_fixed(mam.1$contrast, '/', 2)
names(mam.1)
names(mam.1)[10]<-c("LU")
mam.1$LU<-as.factor(mam.1$LU)
levels(mam.1$LU)<-c("Cropland","Pasture","Plantation","Primary","Secondary","Urban")
mam.1$LU<-
  factor(mam.1$LU,c("Primary","Secondary","Plantation","Pasture","Cropland","Urban"))
names(mam.1)[2]<-c("Odds")
mam.1$Odds<-as.numeric(mam.1$Odds)
mam.1$SE<-as.numeric(mam.1$SE)
#add the model name
mam.1$model<-with(mam.1,"m_5")
data.m_5<-mam.1

# for the model 6
mam<-m_6 %>% emmeans(specs = ~LU , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
mam.1<-mam[grepl("Primary",mam$contrast),]
mam.1$contrast<-as.character(mam.1$contrast)
mam.1[4,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
mam.1[5,]<-c("Cropland",NA,NA, NA,NA,NA,NA,NA,NA)
mam.1[6,]<-c("Urban",NA,NA, NA,NA,NA,NA,NA,NA)
mam.1[c('name1', 'name2')] <- str_split_fixed(mam.1$contrast, '/', 2)
names(mam.1)
names(mam.1)[10]<-c("LU")
mam.1$LU<-as.factor(mam.1$LU)
levels(mam.1$LU)<-c("Cropland","Pasture","Plantation","Primary","Secondary","Urban")
mam.1$LU<-
  factor(mam.1$LU,c("Primary","Secondary","Plantation","Pasture","Cropland","Urban"))
names(mam.1)[2]<-c("Odds")
mam.1$Odds<-as.numeric(mam.1$Odds)
mam.1$SE<-as.numeric(mam.1$SE)
#add the model name
mam.1$model<-with(mam.1,"m_6")
data.m_6<-mam.1

# for the model 7
mam<-m_7 %>% emmeans(specs = ~LU , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
mam.1<-mam[grepl("Primary",mam$contrast),]
mam.1$contrast<-as.character(mam.1$contrast)
mam.1[4,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
mam.1[5,]<-c("Cropland",NA,NA, NA,NA,NA,NA,NA,NA)
mam.1[6,]<-c("Urban",NA,NA, NA,NA,NA,NA,NA,NA)
mam.1[c('name1', 'name2')] <- str_split_fixed(mam.1$contrast, '/', 2)
names(mam.1)
names(mam.1)[10]<-c("LU")
mam.1$LU<-as.factor(mam.1$LU)
levels(mam.1$LU)<-c("Cropland","Pasture","Plantation","Primary","Secondary","Urban")
mam.1$LU<-
  factor(mam.1$LU,c("Primary","Secondary","Plantation","Pasture","Cropland","Urban"))
names(mam.1)[2]<-c("Odds")
mam.1$Odds<-as.numeric(mam.1$Odds)
mam.1$SE<-as.numeric(mam.1$SE)
#add the model name
mam.1$model<-with(mam.1,"m_7")
data.m_7<-mam.1

# for the model 8
mam<-m_8 %>% emmeans(specs = ~LU , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
mam.1<-mam[grepl("Primary",mam$contrast),]
mam.1$contrast<-as.character(mam.1$contrast)
mam.1[4,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
mam.1[5,]<-c("Cropland",NA,NA, NA,NA,NA,NA,NA,NA)
mam.1[6,]<-c("Urban",NA,NA, NA,NA,NA,NA,NA,NA)
mam.1[c('name1', 'name2')] <- str_split_fixed(mam.1$contrast, '/', 2)
names(mam.1)
names(mam.1)[10]<-c("LU")
mam.1$LU<-as.factor(mam.1$LU)
levels(mam.1$LU)<-c("Cropland","Pasture","Plantation","Primary","Secondary","Urban")
mam.1$LU<-
  factor(mam.1$LU,c("Primary","Secondary","Plantation","Pasture","Cropland","Urban"))
names(mam.1)[2]<-c("Odds")
mam.1$Odds<-as.numeric(mam.1$Odds)
mam.1$SE<-as.numeric(mam.1$SE)
#add the model name
mam.1$model<-with(mam.1,"m_8")
data.m_8<-mam.1

# for the model 9
mam<-m_9 %>% emmeans(specs = ~LU , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
mam.1<-mam[grepl("Primary",mam$contrast),]
mam.1$contrast<-as.character(mam.1$contrast)
mam.1[4,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
mam.1[5,]<-c("Cropland",NA,NA, NA,NA,NA,NA,NA,NA)
mam.1[6,]<-c("Urban",NA,NA, NA,NA,NA,NA,NA,NA)
mam.1[c('name1', 'name2')] <- str_split_fixed(mam.1$contrast, '/', 2)
names(mam.1)
names(mam.1)[10]<-c("LU")
mam.1$LU<-as.factor(mam.1$LU)
levels(mam.1$LU)<-c("Cropland","Pasture","Plantation","Primary","Secondary","Urban")
mam.1$LU<-
  factor(mam.1$LU,c("Primary","Secondary","Plantation","Pasture","Cropland","Urban"))
names(mam.1)[2]<-c("Odds")
mam.1$Odds<-as.numeric(mam.1$Odds)
mam.1$SE<-as.numeric(mam.1$SE)
#add the model name
mam.1$model<-with(mam.1,"m_9")
data.m_9<-mam.1


#2_2combine all the model-transfered result
data.model<-rbind(data.full,data.m_1,data.m_2,data.m_3,data.m_4,data.m_5,data.m_6,data.m_7,
                  data.m_8,data.m_9)
names(data.model)
#2_3claclate the mean and confidence interval 95%

#get the model result in our paper
model_result_paper<-data.model%>% filter(model=="Original")
library(dplyr)
model_result_cross<-data.model%>% filter(model!="Original") %>%group_by(LU) %>%
  dplyr::summarise(mean.ratio = mean(Odds, na.rm = TRUE),
            sd.ratio = sd(Odds, na.rm = TRUE),
            n.ratio = n()) %>%
  mutate(se.ratio = sd.ratio / sqrt(n.ratio),
         lower.ci.ratio = mean.ratio - qt(1 - (0.05 / 2), n.ratio - 1) * se.ratio,
         upper.ci.ratio = mean.ratio + qt(1 - (0.05 / 2), n.ratio - 1) * se.ratio)
model_result_table<-merge(model_result_paper[,c(10,2,3)],model_result_cross[,c(1:3,5:7)],by="LU",all.x=T)
model_result_table$se.ratio[model_result_table$LU=="Primary"]<-NA
model_result_table$lower.ci.ratio[model_result_table$LU=="Primary"]<-NA
model_result_table$upper.ci.ratio[model_result_table$LU=="Primary"]<-NA

```

####figure
```{r}
all<-ggplot(model_result_paper , aes(LU , Odds,color=LU))+
  geom_point(aes(color=LU),size=2.5)+
  geom_errorbar(aes(ymin = Odds-SE , ymax = Odds+SE) ,width=0.4, 
                position = position_dodge(width=.6))+
  scale_y_continuous(name="Odds ratio of alien occurrence",
                     limits=c(0,30),breaks=seq(0,30,10))+
  scale_color_manual(name='LU-types',
                     values = c("#2166AC","#4393C3","#92C5DE",
                                "#F4A582","red","#B2182B"),
                     label=c('Primary','Secondary','Plantation',
                             'Pasture','Cropland','Urban'))+
  guides(color=FALSE)+
  theme_bw()+
  theme(panel.grid.major.x = element_blank() , 
        axis.ticks.length=unit(0.08,"inch"),
        panel.grid.major.y = element_line(size = 0.6 , colour = "grey90") ,
        panel.spacing = unit(0,"lines") , 
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_text(colour = "black",angle = 25, 
                                   size = 12,vjust = 0.6) ,
        axis.text.y = element_text(colour = "black",  size = 12),
        legend.title = element_text(face = 'bold'),
        legend.background = element_blank(),
        legend.box.background = element_blank(),
        legend.key = element_blank(),
        legend.direction =  "horizontal",legend.position = c(0.4,0.9)) 
all

#corss cheacking
names(model_result_table)
all_cross_mam<-ggplot(model_result_table , aes(LU , mean.ratio,color=LU))+
  geom_point(aes(color=LU),size=2.5)+
    geom_errorbar(aes(ymin = lower.ci.ratio, ymax = upper.ci.ratio) ,width=0.6, 
                position = position_dodge(width=.6),color="grey50")+
  geom_errorbar(aes(ymin = mean.ratio-se.ratio , ymax = mean.ratio+se.ratio) ,width=0.4, 
                position = position_dodge(width=.6))+
  scale_y_continuous(name="Odds ratio of alien occurrence",
                     limits=c(0,30),breaks=seq(0,30,10))+

  scale_color_manual(name='LU-types',
                     values = c("#2166AC","#4393C3","#92C5DE",
                                "#F4A582","red","#B2182B"),
                     label=c('Primary','Secondary','Plantation',
                             'Pasture','Cropland','Urban'))+

  guides(color=FALSE)+
  theme_bw()+
  theme(panel.grid.major.x = element_blank() , 
        axis.ticks.length=unit(0.08,"inch"),
        panel.grid.major.y = element_line(size = 0.6 , colour = "grey90") ,
        panel.spacing = unit(0,"lines") , 
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_text(colour = "black",angle = 25, 
                                   size = 12,vjust = 0.6) ,
        axis.text.y = element_text(colour = "black",  size = 12),
        legend.title = element_text(face = 'bold'),
        legend.background = element_blank(),
        legend.box.background = element_blank(),
        legend.key = element_blank(),
        legend.direction =  "horizontal",legend.position = c(0.4,0.9)) 

all_cross_mam

#com<-cowplot::plot_grid(all,all_cross,ncol=2,align = 'hv')
#com
ggsave(all_cross_mam,filename = '.../figxb.tiff',compression='lzw', width = 3,height = 3.0,dpi=200)
```
###spiders subset model
```{r}
####part1: run the model 
db.t<-db[db$taxa=="Spiders",]
levels(db.t$LU)
db.t$LU<-
  factor(db.t$LU,c("Urban","SV","Plantation","Pasture","Cropland","Primary"))
db.t<-subset(db.t,!(LU %in% "Plantation" & taxa %in%"Spiders"))
db.t<-subset(db.t,!(LU %in% "Urban" & taxa %in%"Spiders"))
#0 the model used in the paper
dplyr::count(db.t,LU)
dplyr::count(db.t,Biome)
m_paper <- glmer(Alien.presence ~ LU+ (1|SS/SSB) , data = db.t , family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )
summary(m_paper)


#1 excluding the assemblages from biome of #Mediterranean Forests, Woodlands & Scrub
db.t_1<-db.t[db.t$Biome != "Mediterranean Forests, Woodlands & Scrub",]
m_1 <- glmer(Alien.presence ~ LU + (1|SS/SSB) , data = db.t_1 , family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#2 excluding the assemblages from biome of #Temperate Broadleaf & Mixed Forests, do nto run it since it lead to low assembalges
#db.t_2<-db.t[db.t$Biome != "Temperate Broadleaf & Mixed Forests",]
#dplyr::count(db.t_2,LU)
#m_2 <- glmer(Alien.presence ~ LU + (1|SS/SSB) , data = db.t_2 , family = binomial , 
#                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#3 excluding the assemblages from biome of #Temperate Grasslands, Savannas & Shrublands
db.t_3<-db.t[db.t$Biome != "Temperate Grasslands, Savannas & Shrublands",]
m_3 <- glmer(Alien.presence ~ LU + (1|SS/SSB) , data = db.t_3 , family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#4 excluding the assemblages from biome of #Tropical & Subtropical Dry Broadleaf Forests
db.t_4<-db.t[db.t$Biome != "Tropical & Subtropical Dry Broadleaf Forests",]
m_4 <- glmer(Alien.presence ~ LU + (1|SS/SSB) , data = db.t_4 , family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#5 excluding the assemblages from biome of #Tropical & Subtropical Moist Broadleaf Forests
db.t_5<-db.t[db.t$Biome != "Tropical & Subtropical Moist Broadleaf Forests",]
m_5 <- glmer(Alien.presence ~ LU + (1|SS/SSB) , data = db.t_5, family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

####part2: model backtransfomration
#selelct the rows that compared to primary
spider<-m_paper %>% emmeans(specs = ~LU , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
spider.1<-spider[grepl("Primary",spider$contrast),]
spider.1$contrast<-as.character(spider.1$contrast)
spider.1[4,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
spider.1[5,]<-c("Plantation",NA,NA, NA,NA,NA,NA,NA,NA)
spider.1[6,]<-c("Urban",NA,NA, NA,NA,NA,NA,NA,NA)
spider.1[c('name1', 'name2')] <- str_split_fixed(spider.1$contrast, '/', 2)
names(spider.1)
names(spider.1)[10]<-c("LU")
spider.1$LU<-as.factor(spider.1$LU)
levels(spider.1$LU)<-c("Cropland","Pasture","Plantation","Primary","Secondary","Urban")
spider.1$LU<-
  factor(spider.1$LU,c("Primary","Secondary","Plantation","Pasture","Cropland","Urban"))
names(spider.1)[2]<-c("Odds")
spider.1$Odds<-as.numeric(spider.1$Odds)
spider.1$SE<-as.numeric(spider.1$SE)
spider.1$LU<-as.factor(spider.1$LU)
#add the model name
spider.1$model<-with(spider.1,"Original")
data.full<-spider.1

# for the model 1
spider<-m_1 %>% emmeans(specs = ~LU , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
spider.1<-spider[grepl("Primary",spider$contrast),]
spider.1$contrast<-as.character(spider.1$contrast)
spider.1[4,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
spider.1[5,]<-c("Plantation",NA,NA, NA,NA,NA,NA,NA,NA)
spider.1[6,]<-c("Urban",NA,NA, NA,NA,NA,NA,NA,NA)
spider.1[c('name1', 'name2')] <- str_split_fixed(spider.1$contrast, '/', 2)
names(spider.1)
names(spider.1)[10]<-c("LU")
spider.1$LU<-as.factor(spider.1$LU)
levels(spider.1$LU)<-c("Cropland","Pasture","Plantation","Primary","Secondary","Urban")
spider.1$LU<-
  factor(spider.1$LU,c("Primary","Secondary","Plantation","Pasture","Cropland","Urban"))
names(spider.1)[2]<-c("Odds")
spider.1$Odds<-as.numeric(spider.1$Odds)
spider.1$SE<-as.numeric(spider.1$SE)
spider.1$LU<-as.factor(spider.1$LU)
#add the model name
spider.1$model<-with(spider.1,"m_1")
data.m_1<-spider.1



# for the model 3
spider<-m_3 %>% emmeans(specs = ~LU , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
spider.1<-spider[grepl("Primary",spider$contrast),]
spider.1$contrast<-as.character(spider.1$contrast)
spider.1[4,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
spider.1[5,]<-c("Plantation",NA,NA, NA,NA,NA,NA,NA,NA)
spider.1[6,]<-c("Urban",NA,NA, NA,NA,NA,NA,NA,NA)
spider.1[c('name1', 'name2')] <- str_split_fixed(spider.1$contrast, '/', 2)
names(spider.1)
names(spider.1)[10]<-c("LU")
spider.1$LU<-as.factor(spider.1$LU)
levels(spider.1$LU)<-c("Cropland","Pasture","Plantation","Primary","Secondary","Urban")
spider.1$LU<-
  factor(spider.1$LU,c("Primary","Secondary","Plantation","Pasture","Cropland","Urban"))
names(spider.1)[2]<-c("Odds")
spider.1$Odds<-as.numeric(spider.1$Odds)
spider.1$SE<-as.numeric(spider.1$SE)
spider.1$LU<-as.factor(spider.1$LU)
#add the model name
spider.1$model<-with(spider.1,"m_3")
data.m_3<-spider.1

# for the model 4
spider<-m_4 %>% emmeans(specs = ~LU , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
spider.1<-spider[grepl("Primary",spider$contrast),]
spider.1$contrast<-as.character(spider.1$contrast)
spider.1[4,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
spider.1[5,]<-c("Plantation",NA,NA, NA,NA,NA,NA,NA,NA)
spider.1[6,]<-c("Urban",NA,NA, NA,NA,NA,NA,NA,NA)
spider.1[c('name1', 'name2')] <- str_split_fixed(spider.1$contrast, '/', 2)
names(spider.1)
names(spider.1)[10]<-c("LU")
spider.1$LU<-as.factor(spider.1$LU)
levels(spider.1$LU)<-c("Cropland","Pasture","Plantation","Primary","Secondary","Urban")
spider.1$LU<-
  factor(spider.1$LU,c("Primary","Secondary","Plantation","Pasture","Cropland","Urban"))
names(spider.1)[2]<-c("Odds")
spider.1$Odds<-as.numeric(spider.1$Odds)
spider.1$SE<-as.numeric(spider.1$SE)
spider.1$LU<-as.factor(spider.1$LU)
#add the model name
spider.1$model<-with(spider.1,"m_4")
data.m_4<-spider.1

# for the model 5
spider<-m_5 %>% emmeans(specs = ~LU , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
spider.1<-spider[grepl("Primary",spider$contrast),]
spider.1$contrast<-as.character(spider.1$contrast)
spider.1[4,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
spider.1[5,]<-c("Plantation",NA,NA, NA,NA,NA,NA,NA,NA)
spider.1[6,]<-c("Urban",NA,NA, NA,NA,NA,NA,NA,NA)
spider.1[c('name1', 'name2')] <- str_split_fixed(spider.1$contrast, '/', 2)
names(spider.1)
names(spider.1)[10]<-c("LU")
spider.1$LU<-as.factor(spider.1$LU)
levels(spider.1$LU)<-c("Cropland","Pasture","Plantation","Primary","Secondary","Urban")
spider.1$LU<-
  factor(spider.1$LU,c("Primary","Secondary","Plantation","Pasture","Cropland","Urban"))
names(spider.1)[2]<-c("Odds")
spider.1$Odds<-as.numeric(spider.1$Odds)
spider.1$SE<-as.numeric(spider.1$SE)
spider.1$LU<-as.factor(spider.1$LU)
#add the model name
spider.1$model<-with(spider.1,"m_5")
data.m_5<-spider.1


#2_2combine all the model-transfered result
data.model<-rbind(data.full,data.m_1,data.m_3,data.m_4,data.m_5)
names(data.model)
#2_3claclate the mean and confidence interval 95%

#get the model result in our paper
model_result_paper<-data.model%>% filter(model=="Original")
library(dplyr)
model_result_cross<-data.model%>% filter(model!="Original") %>%group_by(LU) %>%
  dplyr::summarise(mean.ratio = mean(Odds, na.rm = TRUE),
            sd.ratio = sd(Odds, na.rm = TRUE),
            n.ratio = n()) %>%
  mutate(se.ratio = sd.ratio / sqrt(n.ratio),
         lower.ci.ratio = mean.ratio - qt(1 - (0.05 / 2), n.ratio - 1) * se.ratio,
         upper.ci.ratio = mean.ratio + qt(1 - (0.05 / 2), n.ratio - 1) * se.ratio)
model_result_table<-merge(model_result_paper[,c(10,2,3)],model_result_cross[,c(1:3,5:7)],by="LU",all.x=T)
model_result_table$se.ratio[model_result_table$LU=="Primary"]<-NA
model_result_table$lower.ci.ratio[model_result_table$LU=="Primary"]<-NA
model_result_table$upper.ci.ratio[model_result_table$LU=="Primary"]<-NA
```

####figure
```{r}
all<-ggplot(model_result_paper , aes(LU , Odds,color=LU))+
  geom_point(aes(color=LU),size=2.5)+
  geom_errorbar(aes(ymin = Odds-SE , ymax = Odds+SE) ,width=0.4, 
                position = position_dodge(width=.6))+
  scale_y_continuous(name="Odds ratio of alien occurrence",
                     limits=c(0,300),breaks=seq(0,300,100))+
  scale_color_manual(name='LU-types',
                     values = c("#2166AC","#4393C3","#92C5DE",
                                "#F4A582","red","#B2182B"),
                     label=c('Primary','Secondary','Plantation',
                             'Pasture','Cropland','Urban'))+
  guides(color=FALSE)+
  theme_bw()+
  theme(panel.grid.major.x = element_blank() , 
        axis.ticks.length=unit(0.08,"inch"),
        panel.grid.major.y = element_line(size = 0.6 , colour = "grey90") ,
        panel.spacing = unit(0,"lines") , 
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_text(colour = "black",angle = 25, 
                                   size = 12,vjust = 0.6) ,
        axis.text.y = element_text(colour = "black",  size = 12),
        legend.title = element_text(face = 'bold'),
        legend.background = element_blank(),
        legend.box.background = element_blank(),
        legend.key = element_blank(),
        legend.direction =  "horizontal",legend.position = c(0.4,0.9)) 
all

#corss cheacking
names(model_result_table)
all_cross_spider<-ggplot(model_result_table , aes(LU , mean.ratio,color=LU))+
  geom_point(aes(color=LU),size=2.5)+
    geom_errorbar(aes(ymin = lower.ci.ratio, ymax = upper.ci.ratio) ,width=0.6, 
                position = position_dodge(width=.6),color="grey50")+
  geom_errorbar(aes(ymin = mean.ratio-se.ratio , ymax = mean.ratio+se.ratio) ,width=0.4, 
                position = position_dodge(width=.6))+
  scale_y_continuous(name="Odds ratio of alien occurrence",
                     limits=c(0,300),breaks=seq(0,300,100))+

  scale_color_manual(name='LU-types',
                     values = c("#2166AC","#4393C3","#92C5DE",
                                "#F4A582","red","#B2182B"),
                     label=c('Primary','Secondary','Plantation',
                             'Pasture','Cropland','Urban'))+

  guides(color=FALSE)+
  theme_bw()+
  theme(panel.grid.major.x = element_blank() , 
        axis.ticks.length=unit(0.08,"inch"),
        panel.grid.major.y = element_line(size = 0.6 , colour = "grey90") ,
        panel.spacing = unit(0,"lines") , 
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_text(colour = "black",angle = 25, 
                                   size = 12,vjust = 0.6) ,
        axis.text.y = element_text(colour = "black",  size = 12),
        legend.title = element_text(face = 'bold'),
        legend.background = element_blank(),
        legend.box.background = element_blank(),
        legend.key = element_blank(),
        legend.direction =  "horizontal",legend.position = c(0.4,0.9)) 

all_cross_spider

#com<-cowplot::plot_grid(all,all_cross,ncol=2,align = 'hv')
#com
ggsave(all_cross_spider,filename = '.../figxb.tiff',compression='lzw', width = 3,height = 3.0,dpi=200)
```
###plants subset model

```{r}
####part1: run the model 
db.t<-db[db$taxa=="Vascular plants",]
levels(db.t$LU)
db.t$LU<-
  factor(db.t$LU,c("Urban","SV","Plantation","Pasture","Cropland","Primary"))
db.t<-subset(db.t,!(LU %in% "Urban" & taxa %in%"Vascular plants"))
#0 the model used in the paper
dplyr::count(db.t,Biome)
m_paper <- glmer(Alien.presence ~ LU+ (1|SS/SSB) , data = db.t , family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#1 excluding the assemblages from biome of #Boreal Forests/Taiga
db.t_1<-db.t[db.t$Biome != "Boreal Forests/Taiga",]
m_1 <- glmer(Alien.presence ~ LU + (1|SS/SSB) , data = db.t_1 , family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#2 excluding the assemblages from biome of #Deserts & Xeric Shrublands
db.t_2<-db.t[db.t$Biome != "Deserts & Xeric Shrublands",]
m_2 <- glmer(Alien.presence ~ LU + (1|SS/SSB) , data = db.t_2 , family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#3 excluding the assemblages from biome of #Mediterranean Forests, Woodlands & Scrub
db.t_3<-db.t[db.t$Biome != "Mediterranean Forests, Woodlands & Scrub",]
m_3 <- glmer(Alien.presence ~ LU + (1|SS/SSB) , data = db.t_3 , family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#4 excluding the assemblages from biome of #Montane Grasslands & Shrublands
db.t_4<-db.t[db.t$Biome != "Montane Grasslands & Shrublands",]
m_4 <- glmer(Alien.presence ~ LU + (1|SS/SSB) , data = db.t_4 , family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#5 excluding the assemblages from biome of #Temperate Broadleaf & Mixed Forests
db.t_5<-db.t[db.t$Biome != "Temperate Broadleaf & Mixed Forests",]
m_5 <- glmer(Alien.presence ~ LU + (1|SS/SSB) , data = db.t_5, family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#6 excluding the assemblages from biome of #Temperate Conifer Forests
db.t_6<-db.t[db.t$Biome != "Temperate Conifer Forests",]
m_6 <- glmer(Alien.presence ~ LU + (1|SS/SSB) , data = db.t_6, family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#7 excluding the assemblages from biome of #Temperate Grasslands, Savannas & Shrublands
db.t_7<-db.t[db.t$Biome != "Temperate Grasslands, Savannas & Shrublands",]
m_7 <- glmer(Alien.presence ~ LU + (1|SS/SSB) , data = db.t_7, family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#8 excluding the assemblages from biome of #Tropical & Subtropical Coniferous Forests
db.t_8<-db.t[db.t$Biome != "Tropical & Subtropical Coniferous Forests",]
m_8 <- glmer(Alien.presence ~ LU + (1|SS/SSB) , data = db.t_8, family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#9 excluding the assemblages from biome of #Tropical & Subtropical Dry Broadleaf Forests
db.t_9<-db.t[db.t$Biome != "Tropical & Subtropical Dry Broadleaf Forests",]
m_9 <- glmer(Alien.presence ~ LU + (1|SS/SSB) , data = db.t_9, family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#10 excluding the assemblages from biome of #Tropical & Subtropical Grasslands, Savannas & Shrublands
db.t_10<-db.t[db.t$Biome != "Tropical & Subtropical Grasslands, Savannas & Shrublands",]
m_10 <- glmer(Alien.presence ~ LU + (1|SS/SSB) , data = db.t_10, family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#11 excluding the assemblages from biome of #Tropical & Subtropical Moist Broadleaf Forests
db.t_11<-db.t[db.t$Biome != "Tropical & Subtropical Moist Broadleaf Forests",]
m_11 <- glmer(Alien.presence ~ LU + (1|SS/SSB) , data = db.t_11, family = binomial , 
                 control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

####part2: model backtransfomration
#selelct the rows that compared to primary
pred.full<-m_paper %>% emmeans(specs = ~LU , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
pred.full_2<-pred.full[grepl("Primary",pred.full$contrast),]
pred.full_2$contrast<-as.character(pred.full_2$contrast)
pred.full_2[5,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
pred.full_2[6,]<-c("Urban",NA,NA, NA,NA,NA,NA,NA,NA)
library(stringr)
pred.full_2[c('name1', 'name2')] <- str_split_fixed(pred.full_2$contrast, '/', 2)
names(pred.full_2)
names(pred.full_2)[10]<-c("LU")
pred.full_2$LU<-as.factor(pred.full_2$LU)
levels(pred.full_2$LU)<-c("Cropland","Pasture","Plantation",
                          "Primary","Secondary", "Urban")
pred.full_2$LU<-
  factor(pred.full_2$LU,c("Primary","Secondary","Plantation",
                          "Pasture","Cropland","Urban"))
names(pred.full_2)[2]<-c("Odds")
pred.full_2$Odds<-as.numeric(pred.full_2$Odds)
pred.full_2$SE<-as.numeric(pred.full_2$SE)
pred.full_2$LU<-as.factor(pred.full_2$LU)
#add the model name
pred.full_2$model<-with(pred.full_2,"Original")
data.full<-pred.full_2

# for the model 1
pred.m_1<-m_1 %>% emmeans(specs = ~LU , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
#selelct the rows that compared to primary
pred.full_2<-pred.m_1[grepl("Primary",pred.m_1$contrast),]
pred.full_2$contrast<-as.character(pred.full_2$contrast)
pred.full_2[5,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
pred.full_2[6,]<-c("Urban",NA,NA, NA,NA,NA,NA,NA,NA)
library(stringr)
pred.full_2[c('name1', 'name2')] <- str_split_fixed(pred.full_2$contrast, '/', 2)
names(pred.full_2)
names(pred.full_2)[10]<-c("LU")
pred.full_2$LU<-as.factor(pred.full_2$LU)
levels(pred.full_2$LU)<-c("Cropland","Pasture","Plantation",
                          "Primary","Secondary", "Urban")
pred.full_2$LU<-
  factor(pred.full_2$LU,c("Primary","Secondary","Plantation",
                          "Pasture","Cropland","Urban"))
names(pred.full_2)[2]<-c("Odds")
pred.full_2$Odds<-as.numeric(pred.full_2$Odds)
pred.full_2$SE<-as.numeric(pred.full_2$SE)
pred.full_2$LU<-as.factor(pred.full_2$LU)
#add the model name
pred.full_2$model<-with(pred.full_2,"m_1")
data.m_1<-pred.full_2

# for the model 2
pred.m_2<-m_2 %>% emmeans(specs = ~LU , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()

#selelct the rows that compared to primary
pred.full_2<-pred.m_2[grepl("Primary",pred.m_2$contrast),]
pred.full_2$contrast<-as.character(pred.full_2$contrast)
pred.full_2[5,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
pred.full_2[6,]<-c("Urban",NA,NA, NA,NA,NA,NA,NA,NA)
library(stringr)
pred.full_2[c('name1', 'name2')] <- str_split_fixed(pred.full_2$contrast, '/', 2)
names(pred.full_2)
names(pred.full_2)[10]<-c("LU")
pred.full_2$LU<-as.factor(pred.full_2$LU)
levels(pred.full_2$LU)<-c("Cropland","Pasture","Plantation",
                          "Primary","Secondary", "Urban")
pred.full_2$LU<-
  factor(pred.full_2$LU,c("Primary","Secondary","Plantation",
                          "Pasture","Cropland","Urban"))
names(pred.full_2)[2]<-c("Odds")
pred.full_2$Odds<-as.numeric(pred.full_2$Odds)
pred.full_2$SE<-as.numeric(pred.full_2$SE)
pred.full_2$LU<-as.factor(pred.full_2$LU)
#add the model name
pred.full_2$model<-with(pred.full_2,"m_2")
data.m_2<-pred.full_2

# for the model 3
pred.m_3<-m_3 %>% emmeans(specs = ~LU, type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
#selelct the rows that compared to primary
pred.full_2<-pred.m_3[grepl("Primary",pred.m_3$contrast),]
pred.full_2$contrast<-as.character(pred.full_2$contrast)
pred.full_2[5,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
pred.full_2[6,]<-c("Urban",NA,NA, NA,NA,NA,NA,NA,NA)
library(stringr)
pred.full_2[c('name1', 'name2')] <- str_split_fixed(pred.full_2$contrast, '/', 2)
names(pred.full_2)
names(pred.full_2)[10]<-c("LU")
pred.full_2$LU<-as.factor(pred.full_2$LU)
levels(pred.full_2$LU)<-c("Cropland","Pasture","Plantation",
                          "Primary","Secondary", "Urban")
pred.full_2$LU<-
  factor(pred.full_2$LU,c("Primary","Secondary","Plantation",
                          "Pasture","Cropland","Urban"))
names(pred.full_2)[2]<-c("Odds")
pred.full_2$Odds<-as.numeric(pred.full_2$Odds)
pred.full_2$SE<-as.numeric(pred.full_2$SE)
pred.full_2$LU<-as.factor(pred.full_2$LU)
#add the model name
pred.full_2$model<-with(pred.full_2,"m_3")
data.m_3<-pred.full_2

# for the model 4
pred.m_4<-m_4 %>% emmeans(specs = ~LU , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
#selelct the rows that compared to primary
pred.full_2<-pred.m_4[grepl("Primary",pred.m_4$contrast),]
pred.full_2$contrast<-as.character(pred.full_2$contrast)
pred.full_2[5,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
pred.full_2[6,]<-c("Urban",NA,NA, NA,NA,NA,NA,NA,NA)
library(stringr)
pred.full_2[c('name1', 'name2')] <- str_split_fixed(pred.full_2$contrast, '/', 2)
names(pred.full_2)
names(pred.full_2)[10]<-c("LU")
pred.full_2$LU<-as.factor(pred.full_2$LU)
levels(pred.full_2$LU)<-c("Cropland","Pasture","Plantation",
                          "Primary","Secondary", "Urban")
pred.full_2$LU<-
  factor(pred.full_2$LU,c("Primary","Secondary","Plantation",
                          "Pasture","Cropland","Urban"))
names(pred.full_2)[2]<-c("Odds")
pred.full_2$Odds<-as.numeric(pred.full_2$Odds)
pred.full_2$SE<-as.numeric(pred.full_2$SE)
pred.full_2$LU<-as.factor(pred.full_2$LU)
#add the model name
pred.full_2$model<-with(pred.full_2,"m_4")
data.m_4<-pred.full_2


# for the model 5
pred.m_5<-m_5 %>% emmeans(specs = ~LU , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
#selelct the rows that compared to primary
#selelct the rows that compared to primary
pred.full_2<-pred.m_5[grepl("Primary",pred.m_5$contrast),]
pred.full_2$contrast<-as.character(pred.full_2$contrast)
pred.full_2[5,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
pred.full_2[6,]<-c("Urban",NA,NA, NA,NA,NA,NA,NA,NA)
library(stringr)
pred.full_2[c('name1', 'name2')] <- str_split_fixed(pred.full_2$contrast, '/', 2)
names(pred.full_2)
names(pred.full_2)[10]<-c("LU")
pred.full_2$LU<-as.factor(pred.full_2$LU)
levels(pred.full_2$LU)<-c("Cropland","Pasture","Plantation",
                          "Primary","Secondary", "Urban")
pred.full_2$LU<-
  factor(pred.full_2$LU,c("Primary","Secondary","Plantation",
                          "Pasture","Cropland","Urban"))
names(pred.full_2)[2]<-c("Odds")
pred.full_2$Odds<-as.numeric(pred.full_2$Odds)
pred.full_2$SE<-as.numeric(pred.full_2$SE)
pred.full_2$LU<-as.factor(pred.full_2$LU)
#add the model name
pred.full_2$model<-with(pred.full_2,"m_5")
data.m_5<-pred.full_2

# for the model 6
pred.m_6<-m_6 %>% emmeans(specs = ~LU , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
#selelct the rows that compared to primary
pred.full_2<-pred.m_6[grepl("Primary",pred.m_6$contrast),]
pred.full_2$contrast<-as.character(pred.full_2$contrast)
pred.full_2[5,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
pred.full_2[6,]<-c("Urban",NA,NA, NA,NA,NA,NA,NA,NA)
library(stringr)
pred.full_2[c('name1', 'name2')] <- str_split_fixed(pred.full_2$contrast, '/', 2)
names(pred.full_2)
names(pred.full_2)[10]<-c("LU")
pred.full_2$LU<-as.factor(pred.full_2$LU)
levels(pred.full_2$LU)<-c("Cropland","Pasture","Plantation",
                          "Primary","Secondary", "Urban")
pred.full_2$LU<-
  factor(pred.full_2$LU,c("Primary","Secondary","Plantation",
                          "Pasture","Cropland","Urban"))
names(pred.full_2)[2]<-c("Odds")
pred.full_2$Odds<-as.numeric(pred.full_2$Odds)
pred.full_2$SE<-as.numeric(pred.full_2$SE)
pred.full_2$LU<-as.factor(pred.full_2$LU)

#add the model name
pred.full_2$model<-with(pred.full_2,"m_6")
data.m_6<-pred.full_2

# for the model 7
pred.m_7<-m_7 %>% emmeans(specs = ~LU , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
#selelct the rows that compared to primary
pred.full_2<-pred.m_7[grepl("Primary",pred.m_7$contrast),]
pred.full_2$contrast<-as.character(pred.full_2$contrast)
pred.full_2[5,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
pred.full_2[6,]<-c("Urban",NA,NA, NA,NA,NA,NA,NA,NA)
library(stringr)
pred.full_2[c('name1', 'name2')] <- str_split_fixed(pred.full_2$contrast, '/', 2)
names(pred.full_2)
names(pred.full_2)[10]<-c("LU")
pred.full_2$LU<-as.factor(pred.full_2$LU)
levels(pred.full_2$LU)<-c("Cropland","Pasture","Plantation",
                          "Primary","Secondary", "Urban")
pred.full_2$LU<-
  factor(pred.full_2$LU,c("Primary","Secondary","Plantation",
                          "Pasture","Cropland","Urban"))
names(pred.full_2)[2]<-c("Odds")
pred.full_2$Odds<-as.numeric(pred.full_2$Odds)
pred.full_2$SE<-as.numeric(pred.full_2$SE)
pred.full_2$LU<-as.factor(pred.full_2$LU)
#add the model name
pred.full_2$model<-with(pred.full_2,"m_7")
data.m_7<-pred.full_2

# for the model 8
pred.m_8<-m_8 %>% emmeans(specs = ~LU , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
#selelct the rows that compared to primary
pred.full_2<-pred.m_8[grepl("Primary",pred.m_8$contrast),]
pred.full_2$contrast<-as.character(pred.full_2$contrast)
pred.full_2[5,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
pred.full_2[6,]<-c("Urban",NA,NA, NA,NA,NA,NA,NA,NA)
library(stringr)
pred.full_2[c('name1', 'name2')] <- str_split_fixed(pred.full_2$contrast, '/', 2)
names(pred.full_2)
names(pred.full_2)[10]<-c("LU")
pred.full_2$LU<-as.factor(pred.full_2$LU)
levels(pred.full_2$LU)<-c("Cropland","Pasture","Plantation",
                          "Primary","Secondary", "Urban")
pred.full_2$LU<-
  factor(pred.full_2$LU,c("Primary","Secondary","Plantation",
                          "Pasture","Cropland","Urban"))
names(pred.full_2)[2]<-c("Odds")
pred.full_2$Odds<-as.numeric(pred.full_2$Odds)
pred.full_2$SE<-as.numeric(pred.full_2$SE)
pred.full_2$LU<-as.factor(pred.full_2$LU)
#add the model name
pred.full_2$model<-with(pred.full_2,"m_8")
data.m_8<-pred.full_2

# for the model 9
pred.m_9<-m_9 %>% emmeans(specs = ~LU , type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()

#selelct the rows that compared to primary
pred.full_2<-pred.m_9[grepl("Primary",pred.m_9$contrast),]
pred.full_2$contrast<-as.character(pred.full_2$contrast)
pred.full_2[5,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
pred.full_2[6,]<-c("Urban",NA,NA, NA,NA,NA,NA,NA,NA)
library(stringr)
pred.full_2[c('name1', 'name2')] <- str_split_fixed(pred.full_2$contrast, '/', 2)
names(pred.full_2)
names(pred.full_2)[10]<-c("LU")
pred.full_2$LU<-as.factor(pred.full_2$LU)
levels(pred.full_2$LU)<-c("Cropland","Pasture","Plantation",
                          "Primary","Secondary", "Urban")
pred.full_2$LU<-
  factor(pred.full_2$LU,c("Primary","Secondary","Plantation",
                          "Pasture","Cropland","Urban"))
names(pred.full_2)[2]<-c("Odds")
pred.full_2$Odds<-as.numeric(pred.full_2$Odds)
pred.full_2$SE<-as.numeric(pred.full_2$SE)
pred.full_2$LU<-as.factor(pred.full_2$LU)
#add the model name
pred.full_2$model<-with(pred.full_2,"m_9")
data.m_9<-pred.full_2

# for the model 10
pred.m_10<-m_10 %>% emmeans(specs = ~LU, type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
#selelct the rows that compared to primary
pred.full_2<-pred.m_10[grepl("Primary",pred.m_10$contrast),]
pred.full_2$contrast<-as.character(pred.full_2$contrast)
pred.full_2[5,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
pred.full_2[6,]<-c("Urban",NA,NA, NA,NA,NA,NA,NA,NA)
library(stringr)
pred.full_2[c('name1', 'name2')] <- str_split_fixed(pred.full_2$contrast, '/', 2)
names(pred.full_2)
names(pred.full_2)[10]<-c("LU")
pred.full_2$LU<-as.factor(pred.full_2$LU)
levels(pred.full_2$LU)<-c("Cropland","Pasture","Plantation",
                          "Primary","Secondary", "Urban")
pred.full_2$LU<-
  factor(pred.full_2$LU,c("Primary","Secondary","Plantation",
                          "Pasture","Cropland","Urban"))
names(pred.full_2)[2]<-c("Odds")
pred.full_2$Odds<-as.numeric(pred.full_2$Odds)
pred.full_2$SE<-as.numeric(pred.full_2$SE)
pred.full_2$LU<-as.factor(pred.full_2$LU)
#add the model name
pred.full_2$model<-with(pred.full_2,"m_10")
data.m_10<-pred.full_2

#mode l11
pred.m_11<-m_11 %>% emmeans(specs = ~LU, type = "response") %>%pairs(infer = T , adjust = "tukey")%>%as.data.frame()
#selelct the rows that compared to primary
pred.full_2<-pred.m_11[grepl("Primary",pred.m_11$contrast),]
pred.full_2$contrast<-as.character(pred.full_2$contrast)
pred.full_2[5,]<-c("Primary / Primary",1,NA, NA,NA,NA,NA,NA,NA)
pred.full_2[6,]<-c("Urban",NA,NA, NA,NA,NA,NA,NA,NA)
library(stringr)
pred.full_2[c('name1', 'name2')] <- str_split_fixed(pred.full_2$contrast, '/', 2)
names(pred.full_2)
names(pred.full_2)[10]<-c("LU")
pred.full_2$LU<-as.factor(pred.full_2$LU)
levels(pred.full_2$LU)<-c("Cropland","Pasture","Plantation",
                          "Primary","Secondary", "Urban")
pred.full_2$LU<-
  factor(pred.full_2$LU,c("Primary","Secondary","Plantation",
                          "Pasture","Cropland","Urban"))
names(pred.full_2)[2]<-c("Odds")
pred.full_2$Odds<-as.numeric(pred.full_2$Odds)
pred.full_2$SE<-as.numeric(pred.full_2$SE)
pred.full_2$LU<-as.factor(pred.full_2$LU)
#add the model name
pred.full_2$model<-with(pred.full_2,"m_11")
data.m_11<-pred.full_2

#2_2combine all the model-transfered result
data.model<-rbind(data.full,data.m_1,data.m_2,data.m_3,data.m_4,data.m_5,data.m_6,data.m_7,
                  data.m_8,data.m_9,data.m_10,data.m_11)
names(data.model)
#2_3claclate the mean and confidence interval 95%

#get the model result in our paper
model_result_paper<-data.model%>% filter(model=="Original")
library(dplyr)
model_result_cross<-data.model%>% filter(model!="Original") %>%group_by(LU) %>%
  dplyr::summarise(mean.ratio = mean(Odds, na.rm = TRUE),
            sd.ratio = sd(Odds, na.rm = TRUE),
            n.ratio = n()) %>%
  mutate(se.ratio = sd.ratio / sqrt(n.ratio),
         lower.ci.ratio = mean.ratio - qt(1 - (0.05 / 2), n.ratio - 1) * se.ratio,
         upper.ci.ratio = mean.ratio + qt(1 - (0.05 / 2), n.ratio - 1) * se.ratio)
model_result_table<-merge(model_result_paper[,c(10,2,3)],model_result_cross[,c(1:3,5:7)],by="LU",all.x=T)
model_result_table$se.ratio[model_result_table$LU=="Primary"]<-NA
model_result_table$lower.ci.ratio[model_result_table$LU=="Primary"]<-NA
model_result_table$upper.ci.ratio[model_result_table$LU=="Primary"]<-NA
model_result_table$mean.ratio[model_result_table$LU=="Urban"]<-NA
```

####figure
```{r}
all<-ggplot(model_result_table , aes(LU , Odds,color=LU))+
  geom_point(aes(color=LU),size=2.5)+
  geom_errorbar(aes(ymin = Odds-SE , ymax = Odds+SE) ,width=0.4, 
                position = position_dodge(width=.6))+
  scale_y_continuous(name="Odds ratio of alien occurrence",
                     limits=c(0,30),breaks=seq(0,30,10))+
  scale_color_manual(name='LU-types',
                     values = c("#2166AC","#4393C3","#92C5DE",
                                "#F4A582","red","#B2182B"),
                     label=c('Primary','Secondary','Plantation',
                             'Pasture','Cropland','Urban'))+
  guides(color=FALSE)+
  theme_bw()+
  theme(panel.grid.major.x = element_blank() , 
        axis.ticks.length=unit(0.08,"inch"),
        panel.grid.major.y = element_line(size = 0.6 , colour = "grey90") ,
        panel.spacing = unit(0,"lines") , 
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_text(colour = "black",angle = 25, 
                                   size = 12,vjust = 0.6) ,
        axis.text.y = element_text(colour = "black",  size = 12),
        legend.title = element_text(face = 'bold'),
        legend.background = element_blank(),
        legend.box.background = element_blank(),
        legend.key = element_blank(),
        legend.direction =  "horizontal",legend.position = c(0.4,0.9)) 
all

#corss cheacking
names(model_result_table)
all_cross_plant<-ggplot(model_result_table , aes(LU , mean.ratio,color=LU))+
  geom_point(aes(color=LU),size=2.5)+
    geom_errorbar(aes(ymin = lower.ci.ratio, ymax = upper.ci.ratio) ,width=0.6, 
                position = position_dodge(width=.6),color="grey50")+
  geom_errorbar(aes(ymin = mean.ratio-se.ratio , ymax = mean.ratio+se.ratio) ,width=0.4, 
                position = position_dodge(width=.6))+
  scale_y_continuous(name="Odds ratio of alien occurrence",
                     limits=c(0,30),breaks=seq(0,30,10))+

  scale_color_manual(name='LU-types',
                     values = c("#2166AC","#4393C3","#92C5DE",
                                "#F4A582","red","#B2182B"),
                     label=c('Primary','Secondary','Plantation',
                             'Pasture','Cropland','Urban'))+

  guides(color=FALSE)+
  theme_bw()+
  theme(panel.grid.major.x = element_blank() , 
        axis.ticks.length=unit(0.08,"inch"),
        panel.grid.major.y = element_line(size = 0.6 , colour = "grey90") ,
        panel.spacing = unit(0,"lines") , 
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_text(colour = "black",angle = 25, 
                                   size = 12,vjust = 0.6) ,
        axis.text.y = element_text(colour = "black",  size = 12),
        legend.title = element_text(face = 'bold'),
        legend.background = element_blank(),
        legend.box.background = element_blank(),
        legend.key = element_blank(),
        legend.direction =  "horizontal",legend.position = c(0.4,0.9)) 

all_cross_plant

#com<-cowplot::plot_grid(all,all_cross,ncol=2,align = 'hv')
#com
ggsave(all_cross_plant,filename = '.../figxb.tiff',compression='lzw', width = 3,height = 3.0,dpi=200)
```

##2.2alien species number
###overall full model
```{r}

##alien species number
### overall full model
db_alien <- subset(db , alien_freq > 0)
levels(db_alien$LU)
db_alien$LU<-
  factor(db_alien$LU,c("Primary","SV","Plantation","Pasture","Cropland","Urban"))
# reorder LU-intensity
db_alien$LUI <- factor(db_alien$LUI , levels = c("Minimal use" , "Light use" , "Intense use" , "Cannot decide"))
levels(db_alien$Biome)
dplyr::count(db_alien,Biome)

###part1: run the model

#there are 11 biomes , we will conduct 11 times for the leaving one biome out test
#1)the model in the paper, with SS/SSB in the random factor
db_alien_sp<-db_alien[db_alien$LUI != "Cannot decide",]
m_paper <- glmer(alien_freq ~ LU*LUI + (1|SS/SSB) , data = db_alien_sp , family = poisson , 
           control = glmerControl(optimizer = "bobyqa" , optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#2)adding model, with SS/SSB/Biome in the random factor
m_adding <- glmer(alien_freq ~ LU*LUI + (1|SS/SSB/Biome) , data = db_alien_sp , family = poisson , 
           control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )
AIC(m_paper);AIC(m_adding)# deltAIC = 2
anova(m_paper,m_adding)# p=0.9999, no significance for the two models

#3) leaving one biome out and test the result
#1 excluding the assemblages from biome of #Boreal Forests/Taiga
db_alien_sp_1<-db_alien_sp[db_alien_sp$Biome != "Boreal Forests/Taiga",]
m_1 <- glmer(alien_freq ~ LU*LUI + (1|SS/SSB) , data = db_alien_sp_1 , family = poisson , 
           control = glmerControl(optimizer = "bobyqa" , optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#2 excluding the assemblages from biome of #Deserts & Xeric Shrublands
db_alien_sp_2<-db_alien_sp[db_alien_sp$Biome != "Deserts & Xeric Shrublands",]
m_2 <- glmer(alien_freq ~ LU*LUI + (1|SS/SSB) , data = db_alien_sp_2 , family = poisson , 
           control = glmerControl(optimizer = "bobyqa" , optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#3 excluding the assemblages from biome of #Mediterranean Forests, Woodlands & Scrub
db_alien_sp_3<-db_alien_sp[db_alien_sp$Biome != "Mediterranean Forests, Woodlands & Scrub",]
m_3 <- glmer(alien_freq ~ LU*LUI + (1|SS/SSB) , data = db_alien_sp_3 , family = poisson , 
           control = glmerControl(optimizer = "bobyqa" , optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#4 excluding the assemblages from biome of #Montane Grasslands & Shrublands
db_alien_sp_4<-db_alien_sp[db_alien_sp$Biome != "Montane Grasslands & Shrublands",]
m_4 <- glmer(alien_freq ~ LU*LUI + (1|SS/SSB) , data = db_alien_sp_4 , family = poisson , 
           control = glmerControl(optimizer = "bobyqa" , optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#5 excluding the assemblages from biome of #Temperate Broadleaf & Mixed Forests
db_alien_sp_5<-db_alien_sp[db_alien_sp$Biome != "Temperate Broadleaf & Mixed Forests",]
m_5 <- glmer(alien_freq ~ LU*LUI + (1|SS/SSB) , data = db_alien_sp_5 , family = poisson , 
           control = glmerControl(optimizer = "bobyqa" , optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#6 excluding the assemblages from biome of #Temperate Conifer Forests
db_alien_sp_6<-db_alien_sp[db_alien_sp$Biome != "Temperate Conifer Forests",]
m_6<- glmer(alien_freq ~ LU*LUI + (1|SS/SSB) , data = db_alien_sp_6 , family = poisson , 
           control = glmerControl(optimizer = "bobyqa" , optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#7 excluding the assemblages from biome of #Temperate Grasslands, Savannas & Shrublands
db_alien_sp_7<-db_alien_sp[db_alien_sp$Biome != "Temperate Grasslands, Savannas & Shrublands",]
m_7<- glmer(alien_freq ~ LU*LUI + (1|SS/SSB) , data = db_alien_sp_7 , family = poisson , 
           control = glmerControl(optimizer = "bobyqa" , optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#8 excluding the assemblages from biome of #Tropical & Subtropical Coniferous Forests
db_alien_sp_8<-db_alien_sp[db_alien_sp$Biome != "Tropical & Subtropical Coniferous Forests",]
m_8<- glmer(alien_freq ~ LU*LUI + (1|SS/SSB) , data = db_alien_sp_8 , family = poisson , 
           control = glmerControl(optimizer = "bobyqa" , optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#9 excluding the assemblages from biome of #Tropical & Subtropical Dry Broadleaf Forests
db_alien_sp_9<-db_alien_sp[db_alien_sp$Biome != "Tropical & Subtropical Dry Broadleaf Forests",]
m_9<- glmer(alien_freq ~ LU*LUI + (1|SS/SSB) , data = db_alien_sp_9 , family = poisson , 
           control = glmerControl(optimizer = "bobyqa" , optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#10 excluding the assemblages from biome of #Tropical & Subtropical Grasslands, Savannas & Shrublands
db_alien_sp_10<-db_alien_sp[db_alien_sp$Biome != "Tropical & Subtropical Grasslands, Savannas & Shrublands",]
m_10<- glmer(alien_freq ~ LU*LUI + (1|SS/SSB) , data = db_alien_sp_10 , family = poisson , 
           control = glmerControl(optimizer = "bobyqa" , optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#11 excluding the assemblages from biome of #Tropical & Subtropical Moist Broadleaf Forests
db_alien_sp_11<-db_alien_sp[db_alien_sp$Biome != "Tropical & Subtropical Moist Broadleaf Forests",]
m_11<- glmer(alien_freq ~ LU*LUI + (1|SS/SSB) , data = db_alien_sp_11 , family = poisson , 
           control = glmerControl(optimizer = "bobyqa" , optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

###part2: model backtransfomration
#0. for full model in the paper used.
#calculates the estimated variances, standard deviation
 sds <- VarCorr(m_paper) %>% as.data.frame()
 sd.total <- sqrt(sds[1 , 5]^2 + sds[2 , 5]^2)
 # predict only LU (i.e. averaged over LUI, possible since no interactions)
data.full <- m_paper %>% emmeans(specs = ~LU*LUI , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% as.data.frame()
levels(data.full$LU)[1:2]<-c("Primary","Secondary")
# remove white space
data.full<-data.full%>%drop_na()
data.full$model<-with(data.full,"Original")
names(data.full)[3]<-c("num")

# for the model of m_1
#calculates the estimated variances, standard deviation
 sds <- VarCorr(m_1) %>% as.data.frame()
 sd.total <- sqrt(sds[1 , 5]^2 + sds[2 , 5]^2)
 # predict only LU (i.e. averaged over LUI, possible since no interactions)
data.full_m_1 <- m_1 %>% emmeans(specs = ~LU*LUI , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% as.data.frame()
levels(data.full_m_1$LU)[1:2]<-c("Primary","Secondary")
# remove white space
data.full_m_1<-data.full_m_1%>%drop_na()
names(data.full_m_1)[3]<-c("num")
data.full_m_1$model<-with(data.full_m_1,"m_1")
data.m_1<-data.full_m_1

# for the model of m_2
#calculates the estimated variances, standard deviation
 sds <- VarCorr(m_2) %>% as.data.frame()
 sd.total <- sqrt(sds[1 , 5]^2 + sds[2 , 5]^2)
 # predict only LU (i.e. averaged over LUI, possible since no interactions)
data.full_m_2 <- m_2 %>% emmeans(specs = ~LU*LUI , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% as.data.frame()
levels(data.full_m_2$LU)[1:2]<-c("Primary","Secondary")
# remove white space
data.full_m_2<-data.full_m_2%>%drop_na()
names(data.full_m_2)[3]<-c("num")
data.full_m_2$model<-with(data.full_m_2,"m_2")
data.m_2<-data.full_m_2


# for the model of m_3
#calculates the estimated variances, standard deviation
 sds <- VarCorr(m_3) %>% as.data.frame()
 sd.total <- sqrt(sds[1 , 5]^2 + sds[2 , 5]^2)
 # predict only LU (i.e. averaged over LUI, possible since no interactions)
data.full_m_3 <- m_3 %>% emmeans(specs = ~LU*LUI , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% as.data.frame()
levels(data.full_m_3$LU)[1:2]<-c("Primary","Secondary")
# remove white space
data.full_m_3<-data.full_m_3%>%drop_na()
names(data.full_m_3)[3]<-c("num")
data.full_m_3$model<-with(data.full_m_3,"m_3")
data.m_3<-data.full_m_3

# for the model of m_4
#calculates the estimated variances, standard deviation
 sds <- VarCorr(m_4) %>% as.data.frame()
 sd.total <- sqrt(sds[1 , 5]^2 + sds[2 , 5]^2)
 # predict only LU (i.e. averaged over LUI, possible since no interactions)
data.full_m_4 <- m_4 %>% emmeans(specs = ~LU*LUI , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% as.data.frame()
levels(data.full_m_4$LU)[1:2]<-c("Primary","Secondary")
# remove white space
data.full_m_4<-data.full_m_4%>%drop_na()
names(data.full_m_4)[3]<-c("num")
data.full_m_4$model<-with(data.full_m_4,"m_4")
data.m_4<-data.full_m_4

# for the model of m_5
#calculates the estimated variances, standard deviation
 sds <- VarCorr(m_5) %>% as.data.frame()
 sd.total <- sqrt(sds[1 , 5]^2 + sds[2 , 5]^2)
 # predict only LU (i.e. averaged over LUI, possible since no interactions)
data.full_m_5 <- m_5 %>% emmeans(specs = ~LU*LUI , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% as.data.frame()
levels(data.full_m_5$LU)[1:2]<-c("Primary","Secondary")
# remove white space
data.full_m_5<-data.full_m_5%>%drop_na()
names(data.full_m_5)[3]<-c("num")
data.full_m_5$model<-with(data.full_m_5,"m_5")
data.m_5<-data.full_m_5

# for the model of m_6
#calculates the estimated variances, standard deviation
 sds <- VarCorr(m_6) %>% as.data.frame()
 sd.total <- sqrt(sds[1 , 5]^2 + sds[2 , 5]^2)
 # predict only LU (i.e. averaged over LUI, possible since no interactions)
data.full_m_6 <- m_6 %>% emmeans(specs = ~LU*LUI , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% as.data.frame()
levels(data.full_m_6$LU)[1:2]<-c("Primary","Secondary")
# remove white space
data.full_m_6<-data.full_m_6%>%drop_na()
names(data.full_m_6)[3]<-c("num")
data.full_m_6$model<-with(data.full_m_6,"m_6")
data.m_6<-data.full_m_6

# for the model of m_7
#calculates the estimated variances, standard deviation
 sds <- VarCorr(m_7) %>% as.data.frame()
 sd.total <- sqrt(sds[1 , 5]^2 + sds[2 , 5]^2)
 # predict only LU (i.e. averaged over LUI, possible since no interactions)
data.full_m_7 <- m_7 %>% emmeans(specs = ~LU*LUI , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% as.data.frame()
levels(data.full_m_7$LU)[1:2]<-c("Primary","Secondary")
# remove white space
data.full_m_7<-data.full_m_7%>%drop_na()
names(data.full_m_7)[3]<-c("num")
data.full_m_7$model<-with(data.full_m_7,"m_7")
data.m_7<-data.full_m_7

# for the model of m_8
#calculates the estimated variances, standard deviation
 sds <- VarCorr(m_8) %>% as.data.frame()
 sd.total <- sqrt(sds[1 , 5]^2 + sds[2 , 5]^2)
 # predict only LU (i.e. averaged over LUI, possible since no interactions)
data.full_m_8 <- m_8 %>% emmeans(specs = ~LU*LUI , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% as.data.frame()
levels(data.full_m_8$LU)[1:2]<-c("Primary","Secondary")
# remove white space
data.full_m_8<-data.full_m_8%>%drop_na()
names(data.full_m_8)[3]<-c("num")
data.full_m_8$model<-with(data.full_m_8,"m_8")
data.m_8<-data.full_m_8

# for the model of m_9
#calculates the estimated variances, standard deviation
 sds <- VarCorr(m_9) %>% as.data.frame()
 sd.total <- sqrt(sds[1 , 5]^2 + sds[2 , 5]^2)
 # predict only LU (i.e. averaged over LUI, possible since no interactions)
data.full_m_9 <- m_9 %>% emmeans(specs = ~LU*LUI , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% as.data.frame()
levels(data.full_m_9$LU)[1:2]<-c("Primary","Secondary")
# remove white space
data.full_m_9<-data.full_m_9%>%drop_na()
names(data.full_m_9)[3]<-c("num")
data.full_m_9$model<-with(data.full_m_9,"m_9")
data.m_9<-data.full_m_9

# for the model of m_10
#calculates the estimated variances, standard deviation
 sds <- VarCorr(m_10) %>% as.data.frame()
 sd.total <- sqrt(sds[1 , 5]^2 + sds[2 , 5]^2)
 # predict only LU (i.e. averaged over LUI, possible since no interactions)
data.full_m_10 <- m_10 %>% emmeans(specs = ~LU*LUI , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% as.data.frame()
levels(data.full_m_10$LU)[1:2]<-c("Primary","Secondary")
# remove white space
data.full_m_10<-data.full_m_10%>%drop_na()
names(data.full_m_10)[3]<-c("num")
data.full_m_10$model<-with(data.full_m_10,"m_10")
data.m_10<-data.full_m_10

# for the model of m_11
#calculates the estimated variances, standard deviation
 sds <- VarCorr(m_11) %>% as.data.frame()
 sd.total <- sqrt(sds[1 , 5]^2 + sds[2 , 5]^2)
 # predict only LU (i.e. averaged over LUI, possible since no interactions)
data.full_m_11 <- m_11 %>% emmeans(specs = ~LU*LUI , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% as.data.frame()
levels(data.full_m_11$LU)[1:2]<-c("Primary","Secondary")
# remove white space
data.full_m_11<-data.full_m_11%>%drop_na()
names(data.full_m_11)[3]<-c("num")
data.full_m_11$model<-with(data.full_m_11,"m_11")
data.m_11<-data.full_m_11


#2_2combine all the model-transfered result
data.model<-rbind(data.full,data.m_1,data.m_2,data.m_3,data.m_4,data.m_5,data.m_6,data.m_7,
                  data.m_8,data.m_9,data.m_10,data.m_11)
names(data.model)
#2_3claclate the mean and confidence interval 95%

#get the model result in our paper
model_result_paper<-data.model%>% filter(model=="Original")
library(dplyr)
model_result_cross<-data.model%>% filter(model!="Original") %>%group_by(LU,LUI) %>%
  dplyr::summarise(mean.num = mean(num, na.rm = TRUE),
            sd.num = sd(num, na.rm = TRUE),
            n.num = n()) %>%
  mutate(se.num = sd.num / sqrt(n.num),
         lower.ci.num = mean.num - qt(1 - (0.05 / 2), n.num - 1) * se.num,
         upper.ci.num = mean.num + qt(1 - (0.05 / 2), n.num - 1) * se.num)
model_result_alien_sp<-merge(model_result_paper[,c(1:4)],model_result_cross[,c(1:3,6:8)],by=c("LU","LUI"),all.x=T)

```

###figure
```{r}
all_sp<-ggplot(model_result_alien_sp , aes(LU , num,shape=LUI,color=LU))+
  geom_errorbar(aes(ymin = num-SE , ymax = num+SE) ,width=0.4, 
                position = position_dodge(width=.6))+
  scale_y_continuous(name="Number of alien species",
                     limits=c(0.5,4),breaks=seq(0,4,1))+
  geom_point(aes(shape=LUI),position = position_dodge(width=.6),size=3.5)+
  scale_shape_manual(name="LU-intensity",values=c(15, 17, 18))+
  scale_color_manual(name='LU-types',
                     values = c("#2166AC","#4393C3","#92C5DE",
                                "#F4A582","red","#B2182B"),
                     label=c('Primary','Secondary','Plantation',
                             'Pasture','Cropland','Urban'))+
  guides(color=FALSE)+
  annotate(geom="text", x=0.818, y=1.45, label="a",size=4,color="#2166AC")+
  annotate(geom="text", x=1, y=2.1, label="bcd",size=4,color="#2166AC")+
  annotate(geom="text", x=1.2, y=2.7, label="bcd",size=4,color="#2166AC")+
  annotate(geom="text", x=1.82, y=2.7, label="b",size=4,color="#4393C3")+
  annotate(geom="text", x=2, y=2.55, label="bcd",size=4,color="#4393C3")+
  annotate(geom="text", x=2.2, y=2.4, label="abcd",size=4,color="#4393C3")+
  
  annotate(geom="text", x=2.82, y=3.15, label="bcd",size=4,color="#92C5DE")+
  annotate(geom="text", x=3, y=2.5, label="bcd",size=4,color="#92C5DE")+
  annotate(geom="text", x=3.2, y=1.8, label="abcd",size=4,color="#92C5DE")+ 
  annotate(geom="text", x=3.82, y=2.32, label="bcd",size=4,color="#F4A582")+
  annotate(geom="text", x=4, y=2.6, label="bc",size=4,color="#F4A582")+
  annotate(geom="text", x=4.2, y=2.5, label="abcd",size=4,color="#F4A582")+
  
  annotate(geom="text", x=4.82, y=2.7, label="bc",size=4,color="red")+
  annotate(geom="text", x=5, y=1.8, label="ad",size=4,color="red")+
  annotate(geom="text", x=5.2, y=2, label="acd",size=4,color="red")+
  annotate(geom="text", x=5.82, y=3, label="bcd",size=4,color="#B2182B")+ 
  annotate(geom="text", x=6, y=3.25, label="bcd",size=4,color="#B2182B")+ 
  annotate(geom="text", x=6.2, y=3.12, label="abcd",size=4,color="#B2182B")+  
  theme_bw()+
  theme(panel.grid.major.x = element_blank() , 
        axis.ticks.length=unit(0.08,"inch"),
        panel.grid.major.y = element_line(size = 0.6 , colour = "grey90") ,
        panel.spacing = unit(0,"lines") , 
        axis.title.x = element_blank(),
        axis.title.y = element_text(size=12),
        axis.text.x = element_text(colour = "black",angle = 25, 
                                   size = 12,vjust = 0.6) ,
        axis.text.y = element_text(colour = "black",  size = 12),
        legend.title = element_text(face = 'bold'),
        legend.background = element_blank(),
        legend.box.background = element_blank(),
        legend.key = element_blank(),
        legend.direction =  "horizontal",legend.position = c(0.5,0.94)) 
all_sp

#corss cheacking
names(model_result_alien_sp)
all_sp_cross<-ggplot(model_result_alien_sp , aes(LU , mean.num,shape=LUI,color=LU))+
    geom_errorbar(aes(ymin = lower.ci.num, ymax = upper.ci.num) ,width=0.6, 
                position = position_dodge(width=.6),color="grey50")+
  geom_errorbar(aes(ymin = mean.num-se.num , ymax = mean.num+se.num) ,width=0.4, 
                position = position_dodge(width=.6))+
    scale_y_continuous(name="Number of alien species",
                     limits=c(0.5,4),breaks=seq(0,4,1))+
  geom_point(aes(shape=LUI),position = position_dodge(width=.6),size=3.5)+
  scale_shape_manual(name="LU-intensity",values=c(15, 17, 18))+
  scale_color_manual(name='LU-types',
                     values = c("#2166AC","#4393C3","#92C5DE",
                                "#F4A582","red","#B2182B"),
                     label=c('Primary','Secondary','Plantation',
                             'Pasture','Cropland','Urban'))+
  guides(color=FALSE)+
  theme_bw()+
  theme(panel.grid.major.x = element_blank() , 
        axis.ticks.length=unit(0.08,"inch"),
        panel.grid.major.y = element_line(size = 0.6 , colour = "grey90") ,
        panel.spacing = unit(0,"lines") , 
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_text(colour = "black",angle = 25, 
                                   size = 12,vjust = 0.6) ,
        axis.text.y = element_text(colour = "black",  size = 12),
        legend.title = element_text(face = 'bold'),
        legend.background = element_blank(),
        legend.box.background = element_blank(),
        legend.key = element_blank(),
        legend.direction =  "horizontal",legend.position = c(0.4,0.9)) 

all_sp_cross

#com<-cowplot::plot_grid(all_sp,all_sp_cross,ncol=2,align = 'hv')
#com
ggsave(all_sp_cross,filename = '.../fig2.bnew.tiff',compression='lzw', width = 10,height = 3.0,dpi=200)
```
###overall subset model
```{r}
db_alien <- subset(db , alien_freq > 0)
levels(db_alien$LU)
db_alien$LU<-
  factor(db_alien$LU,c("Primary","SV","Plantation","Pasture","Cropland","Urban"))
levels(db_alien$Biome)
dplyr::count(db_alien,Biome)

###part1: run the model
#there are 11 biomes , we will conduct 11 times for the leaving one biome out test
#1)the model in the paper, with SS/SSB in the random factor
m_paper <- glmer(alien_freq ~ LU + (1|SS/SSB) , data = db_alien , family = poisson , 
           control = glmerControl(optimizer = "bobyqa" , optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#2)adding model, with SS/SSB/Biome in the random factor
m_adding <- glmer(alien_freq ~ LU + (1|SS/SSB/Biome) , data = db_alien , family = poisson , 
           control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )
AIC(m_paper);AIC(m_adding)# deltAIC = 2
anova(m_paper,m_adding)# p=0.9999, no significance for the two models

#3) leaving one biome out and test the result
#1 excluding the assemblages from biome of #Boreal Forests/Taiga
db_alien_1<-db_alien[db_alien$Biome != "Boreal Forests/Taiga",]
m_1 <- glmer(alien_freq ~ LU + (1|SS/SSB) , data = db_alien_1 , family = poisson , 
           control = glmerControl(optimizer = "bobyqa" , optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#2 excluding the assemblages from biome of #Deserts & Xeric Shrublands
db_alien_2<-db_alien[db_alien$Biome != "Deserts & Xeric Shrublands",]
m_2 <- glmer(alien_freq ~ LU + (1|SS/SSB) , data = db_alien_2 , family = poisson , 
           control = glmerControl(optimizer = "bobyqa" , optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#3 excluding the assemblages from biome of #Mediterranean Forests, Woodlands & Scrub
db_alien_3<-db_alien[db_alien$Biome != "Mediterranean Forests, Woodlands & Scrub",]
m_3 <- glmer(alien_freq ~ LU + (1|SS/SSB) , data = db_alien_3 , family = poisson , 
           control = glmerControl(optimizer = "bobyqa" , optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#4 excluding the assemblages from biome of #Montane Grasslands & Shrublands
db_alien_4<-db_alien[db_alien$Biome != "Montane Grasslands & Shrublands",]
m_4 <- glmer(alien_freq ~ LU + (1|SS/SSB) , data = db_alien_4 , family = poisson , 
           control = glmerControl(optimizer = "bobyqa" , optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#5 excluding the assemblages from biome of #Temperate Broadleaf & Mixed Forests
db_alien_5<-db_alien[db_alien$Biome != "Temperate Broadleaf & Mixed Forests",]
m_5 <- glmer(alien_freq ~ LU + (1|SS/SSB) , data = db_alien_5 , family = poisson , 
           control = glmerControl(optimizer = "bobyqa" , optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#6 excluding the assemblages from biome of #Temperate Conifer Forests
db_alien_6<-db_alien[db_alien$Biome != "Temperate Conifer Forests",]
m_6<- glmer(alien_freq ~ LU + (1|SS/SSB) , data = db_alien_6 , family = poisson , 
           control = glmerControl(optimizer = "bobyqa" , optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#7 excluding the assemblages from biome of #Temperate Grasslands, Savannas & Shrublands
db_alien_7<-db_alien[db_alien$Biome != "Temperate Grasslands, Savannas & Shrublands",]
m_7<- glmer(alien_freq ~ LU + (1|SS/SSB) , data = db_alien_7 , family = poisson , 
           control = glmerControl(optimizer = "bobyqa" , optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#8 excluding the assemblages from biome of #Tropical & Subtropical Coniferous Forests
db_alien_8<-db_alien[db_alien$Biome != "Tropical & Subtropical Coniferous Forests",]
m_8<- glmer(alien_freq ~ LU + (1|SS/SSB) , data = db_alien_8 , family = poisson , 
           control = glmerControl(optimizer = "bobyqa" , optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#9 excluding the assemblages from biome of #Tropical & Subtropical Dry Broadleaf Forests
db_alien_9<-db_alien[db_alien$Biome != "Tropical & Subtropical Dry Broadleaf Forests",]
m_9<- glmer(alien_freq ~ LU + (1|SS/SSB) , data = db_alien_9 , family = poisson , 
           control = glmerControl(optimizer = "bobyqa" , optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#10 excluding the assemblages from biome of #Tropical & Subtropical Grasslands, Savannas & Shrublands
db_alien_10<-db_alien[db_alien$Biome != "Tropical & Subtropical Grasslands, Savannas & Shrublands",]
m_10<- glmer(alien_freq ~ LU + (1|SS/SSB) , data = db_alien_10 , family = poisson , 
           control = glmerControl(optimizer = "bobyqa" , optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#11 excluding the assemblages from biome of #Tropical & Subtropical Moist Broadleaf Forests
db_alien_11<-db_alien[db_alien$Biome != "Tropical & Subtropical Moist Broadleaf Forests",]
m_11<- glmer(alien_freq ~ LU + (1|SS/SSB) , data = db_alien_11 , family = poisson , 
           control = glmerControl(optimizer = "bobyqa" , optCtrl = list(maxfun = 1e5)),nAGQ = 1 )




###part2: model backtransfomration
#0. for full model in the paper used.
#calculates the estimated variances, standard deviation
 sds <- VarCorr(m_paper) %>% as.data.frame()
 sd.total <- sqrt(sds[1 , 5]^2 + sds[2 , 5]^2)
 # predict only LU (i.e. averaged over LUI, possible since no interactions)
data.full <- m_paper %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% as.data.frame()
levels(data.full$LU)[1:2]<-c("Primary","Secondary")
# remove white space
data.full<-data.full%>%drop_na()
data.full$model<-with(data.full,"Original")
names(data.full)[2]<-c("num")

# for the model of m_1
#calculates the estimated variances, standard deviation
 sds <- VarCorr(m_1) %>% as.data.frame()
 sd.total <- sqrt(sds[1 , 5]^2 + sds[2 , 5]^2)
 # predict only LU (i.e. averaged over LUI, possible since no interactions)
data.full_m_1 <- m_1 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% as.data.frame()
levels(data.full_m_1$LU)[1:2]<-c("Primary","Secondary")
# remove white space
data.full_m_1<-data.full_m_1%>%drop_na()
names(data.full_m_1)[2]<-c("num")
data.full_m_1$model<-with(data.full_m_1,"m_1")
data.m_1<-data.full_m_1

# for the model of m_2
#calculates the estimated variances, standard deviation
 sds <- VarCorr(m_2) %>% as.data.frame()
 sd.total <- sqrt(sds[1 , 5]^2 + sds[2 , 5]^2)
 # predict only LU (i.e. averaged over LUI, possible since no interactions)
data.full_m_2 <- m_2 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% as.data.frame()
levels(data.full_m_2$LU)[1:2]<-c("Primary","Secondary")
# remove white space
data.full_m_2<-data.full_m_2%>%drop_na()
names(data.full_m_2)[2]<-c("num")
data.full_m_2$model<-with(data.full_m_2,"m_2")
data.m_2<-data.full_m_2


# for the model of m_3
#calculates the estimated variances, standard deviation
 sds <- VarCorr(m_3) %>% as.data.frame()
 sd.total <- sqrt(sds[1 , 5]^2 + sds[2 , 5]^2)
 # predict only LU (i.e. averaged over LUI, possible since no interactions)
data.full_m_3 <- m_3 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% as.data.frame()
levels(data.full_m_3$LU)[1:2]<-c("Primary","Secondary")
# remove white space
data.full_m_3<-data.full_m_3%>%drop_na()
names(data.full_m_3)[2]<-c("num")
data.full_m_3$model<-with(data.full_m_3,"m_3")
data.m_3<-data.full_m_3

# for the model of m_4
#calculates the estimated variances, standard deviation
 sds <- VarCorr(m_4) %>% as.data.frame()
 sd.total <- sqrt(sds[1 , 5]^2 + sds[2 , 5]^2)
 # predict only LU (i.e. averaged over LUI, possible since no interactions)
data.full_m_4 <- m_4 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% as.data.frame()
levels(data.full_m_4$LU)[1:2]<-c("Primary","Secondary")
# remove white space
data.full_m_4<-data.full_m_4%>%drop_na()
names(data.full_m_4)[2]<-c("num")
data.full_m_4$model<-with(data.full_m_4,"m_4")
data.m_4<-data.full_m_4

# for the model of m_5
#calculates the estimated variances, standard deviation
 sds <- VarCorr(m_5) %>% as.data.frame()
 sd.total <- sqrt(sds[1 , 5]^2 + sds[2 , 5]^2)
 # predict only LU (i.e. averaged over LUI, possible since no interactions)
data.full_m_5 <- m_5 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% as.data.frame()
levels(data.full_m_5$LU)[1:2]<-c("Primary","Secondary")
# remove white space
data.full_m_5<-data.full_m_5%>%drop_na()
names(data.full_m_5)[2]<-c("num")
data.full_m_5$model<-with(data.full_m_5,"m_5")
data.m_5<-data.full_m_5

# for the model of m_6
#calculates the estimated variances, standard deviation
 sds <- VarCorr(m_6) %>% as.data.frame()
 sd.total <- sqrt(sds[1 , 5]^2 + sds[2 , 5]^2)
 # predict only LU (i.e. averaged over LUI, possible since no interactions)
data.full_m_6 <- m_6 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% as.data.frame()
levels(data.full_m_6$LU)[1:2]<-c("Primary","Secondary")
# remove white space
data.full_m_6<-data.full_m_6%>%drop_na()
names(data.full_m_6)[2]<-c("num")
data.full_m_6$model<-with(data.full_m_6,"m_6")
data.m_6<-data.full_m_6

# for the model of m_7
#calculates the estimated variances, standard deviation
 sds <- VarCorr(m_7) %>% as.data.frame()
 sd.total <- sqrt(sds[1 , 5]^2 + sds[2 , 5]^2)
 # predict only LU (i.e. averaged over LUI, possible since no interactions)
data.full_m_7 <- m_7 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% as.data.frame()
levels(data.full_m_7$LU)[1:2]<-c("Primary","Secondary")
# remove white space
data.full_m_7<-data.full_m_7%>%drop_na()
names(data.full_m_7)[2]<-c("num")
data.full_m_7$model<-with(data.full_m_7,"m_7")
data.m_7<-data.full_m_7

# for the model of m_8
#calculates the estimated variances, standard deviation
 sds <- VarCorr(m_8) %>% as.data.frame()
 sd.total <- sqrt(sds[1 , 5]^2 + sds[2 , 5]^2)
 # predict only LU (i.e. averaged over LUI, possible since no interactions)
data.full_m_8 <- m_8 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% as.data.frame()
levels(data.full_m_8$LU)[1:2]<-c("Primary","Secondary")
# remove white space
data.full_m_8<-data.full_m_8%>%drop_na()
names(data.full_m_8)[2]<-c("num")
data.full_m_8$model<-with(data.full_m_8,"m_8")
data.m_8<-data.full_m_8

# for the model of m_9
#calculates the estimated variances, standard deviation
 sds <- VarCorr(m_9) %>% as.data.frame()
 sd.total <- sqrt(sds[1 , 5]^2 + sds[2 , 5]^2)
 # predict only LU (i.e. averaged over LUI, possible since no interactions)
data.full_m_9 <- m_9 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% as.data.frame()
levels(data.full_m_9$LU)[1:2]<-c("Primary","Secondary")
# remove white space
data.full_m_9<-data.full_m_9%>%drop_na()
names(data.full_m_9)[2]<-c("num")
data.full_m_9$model<-with(data.full_m_9,"m_9")
data.m_9<-data.full_m_9

# for the model of m_10
#calculates the estimated variances, standard deviation
 sds <- VarCorr(m_10) %>% as.data.frame()
 sd.total <- sqrt(sds[1 , 5]^2 + sds[2 , 5]^2)
 # predict only LU (i.e. averaged over LUI, possible since no interactions)
data.full_m_10 <- m_10 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% as.data.frame()
levels(data.full_m_10$LU)[1:2]<-c("Primary","Secondary")
# remove white space
data.full_m_10<-data.full_m_10%>%drop_na()
names(data.full_m_10)[2]<-c("num")
data.full_m_10$model<-with(data.full_m_10,"m_10")
data.m_10<-data.full_m_10

# for the model of m_11
#calculates the estimated variances, standard deviation
 sds <- VarCorr(m_11) %>% as.data.frame()
 sd.total <- sqrt(sds[1 , 5]^2 + sds[2 , 5]^2)
 # predict only LU (i.e. averaged over LUI, possible since no interactions)
data.full_m_11 <- m_11 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% as.data.frame()
levels(data.full_m_11$LU)[1:2]<-c("Primary","Secondary")
# remove white space
data.full_m_11<-data.full_m_11%>%drop_na()
names(data.full_m_11)[2]<-c("num")
data.full_m_11$model<-with(data.full_m_11,"m_11")
data.m_11<-data.full_m_11


#2_2combine all the model-transfered result
data.model<-rbind(data.full,data.m_1,data.m_2,data.m_3,data.m_4,data.m_5,data.m_6,data.m_7,
                  data.m_8,data.m_9,data.m_10,data.m_11)
names(data.model)
#2_3claclate the mean and confidence interval 95%

#get the model result in our paper
model_result_paper<-data.model%>% filter(model=="Original")
library(dplyr)
model_result_cross<-data.model%>% filter(model!="Original") %>%group_by(LU) %>%
  dplyr::summarise(mean.num = mean(num, na.rm = TRUE),
            sd.num = sd(num, na.rm = TRUE),
            n.num = n()) %>%
  mutate(se.num = sd.num / sqrt(n.num),
         lower.ci.num = mean.num - qt(1 - (0.05 / 2), n.num - 1) * se.num,
         upper.ci.num = mean.num + qt(1 - (0.05 / 2), n.num - 1) * se.num)
model_result_alien_sp<-merge(model_result_paper[,c(1:3)],model_result_cross[,c(1:2,5:7)],by=c("LU"),all.x=T)

```

###figure
```{r}
all<-ggplot(model_result_alien_sp , aes(LU , num,color=LU))+
  geom_errorbar(aes(ymin = num-SE , ymax = num+SE) ,width=0.2, 
                position = position_dodge(width=.6))+
  scale_y_continuous(name="Number of alien species",
                     limits=c(-0.2,6),breaks=seq(0,6,2))+
  geom_point(position = position_dodge(width=.6),size=3)+
  scale_color_manual(name='LU-types',
                     values = c("#2166AC","#4393C3","#92C5DE",
                                "#F4A582","red","#B2182B"),
                     label=c('Primary','Secondary','Plantation',
                             'Pasture','Cropland','Urban'))+
  annotate(geom="text", x=1, y=2, label="a",size=4,color="#2166AC")+
  annotate(geom="text", x=2, y=2.8, label="b",size=4,color="#4393C3")+
  annotate(geom="text", x=3, y=2.7, label="bc",size=4,color="#92C5DE")+
  annotate(geom="text", x=4, y=2.6, label="bc",size=4,color="#F4A582")+
  annotate(geom="text", x=5, y=2.3, label="c",size=4,color="red")+
  annotate(geom="text", x=6, y=3.2, label="bc",size=4,color="#B2182B")+
  guides(colour = guide_legend(nrow = 1),shape=guide_legend(nrow = 1))+
  theme_bw()+
  theme(panel.grid.major.x = element_blank() , 
        axis.ticks.length=unit(0.08,"inch"),
        panel.grid.major.y = element_line(size = 0.6 , colour = "grey90") ,
        panel.spacing = unit(0,"lines") , 
        axis.title.x = element_blank(),
        axis.title.y = element_text(size=13),
        axis.text.x = element_text(colour = "black",angle = 25, 
                                   size = 12,vjust = 0.6) ,
        axis.text.y = element_text(colour = "black",  size = 12),
        legend.position = "none")
all
all_sp<-ggplot(model_result_alien_sp , aes(LU , mean.num,color=LU))+
    geom_point(aes(color=LU),size=2.5)+
    geom_errorbar(aes(ymin = lower.ci.num, ymax = upper.ci.num) ,width=0.6, 
                position = position_dodge(width=.6),color="grey50")+
  geom_errorbar(aes(ymin = mean.num-se.num , ymax = mean.num+se.num) ,width=0.2, 
                position = position_dodge(width=.6))+
  scale_y_continuous(name="Number of alien species",
                     limits=c(-0.2,6),breaks=seq(0,6,2))+
  geom_point(position = position_dodge(width=.6),size=3)+
  scale_color_manual(name='LU-types',
                     values = c("#2166AC","#4393C3","#92C5DE",
                                "#F4A582","red","#B2182B"),
                     label=c('Primary','Secondary','Plantation',
                             'Pasture','Cropland','Urban'))+
  guides(colour = guide_legend(nrow = 1),shape=guide_legend(nrow = 1))+
  theme_bw()+
  theme(panel.grid.major.x = element_blank() , 
        axis.ticks.length=unit(0.08,"inch"),
        panel.grid.major.y = element_line(size = 0.6 , colour = "grey90") ,
        panel.spacing = unit(0,"lines") , 
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_text(colour = "black",angle = 25, 
                                   size = 12,vjust = 0.6) ,
        axis.text.y = element_text(colour = "black",  size = 12),
        legend.position = "none")
all_sp

ggsave(all_sp,filename = '.../all_sp.tiff',width = 3,height = 3,dpi = 200)
```
###ants subset model
```{r}
db_alien <- subset(db , alien_freq > 0)
db_alien.t<-db_alien[db_alien$taxa=="Ants",]
levels(db_alien.t$LU)

levels(db_alien.t$Biome)
dplyr::count(db_alien.t,Biome)

###part1: run the model
#there are 11 biomes , we will conduct 11 times for the leaving one biome out test
#1)the model in the paper, with SS/SSB in the random factor
m_paper <- glmer(alien_freq ~ LU + (1|SS), data = db_alien.t , family = poisson)

#3) leaving one biome out and test the result
#1 excluding the assemblages from biome of #Deserts & Xeric Shrublands
db_alien_1<-db_alien.t[db_alien.t$Biome != "Deserts & Xeric Shrublands",]
m_1 <- glmer(alien_freq ~ LU + (1|SS), data = db_alien_1 , family = poisson)

#2 excluding the assemblages from biome of #Mediterranean Forests, Woodlands & Scrub
db_alien_2<-db_alien.t[db_alien.t$Biome != "Mediterranean Forests, Woodlands & Scrub",]
m_2 <- glmer(alien_freq ~ LU + (1|SS), data = db_alien_2 , family = poisson)

#3 excluding the assemblages from biome of #Montane Grasslands & Shrublands
db_alien_3<-db_alien.t[db_alien.t$Biome != "Montane Grasslands & Shrublands",]
m_3 <- glmer(alien_freq ~ LU + (1|SS/SSB) , data = db_alien_3 , family = poisson , 
           control = glmerControl(optimizer = "bobyqa" , optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#4 excluding the assemblages from biome of #Temperate Broadleaf & Mixed Forests
db_alien_4<-db_alien.t[db_alien.t$Biome != "Temperate Broadleaf & Mixed Forests",]
m_4 <- glmer(alien_freq ~ LU + (1|SS), data = db_alien_4 , family = poisson)

#5 excluding the assemblages from biome of #Tropical & Subtropical Dry Broadleaf Forests
db_alien_5<-db_alien.t[db_alien.t$Biome != "Tropical & Subtropical Dry Broadleaf Forests",]
m_5 <- glmer(alien_freq ~ LU + (1|SS), data = db_alien_5 , family = poisson)

#6 excluding the assemblages from biome of #Tropical & Subtropical Grasslands, Savannas & Shrublands
db_alien_6<-db_alien.t[db_alien.t$Biome != "Tropical & Subtropical Grasslands, Savannas & Shrublands",]
m_6<- glmer(alien_freq ~ LU + (1|SS), data = db_alien_6 , family = poisson)

#7 excluding the assemblages from biome of #Tropical & Subtropical Moist Broadleaf Forests
db_alien_7<-db_alien.t[db_alien.t$Biome != "Tropical & Subtropical Moist Broadleaf Forests",]
m_7<- glmer(alien_freq ~ LU + (1|SS), data = db_alien_7 , family = poisson)

###part2: model backtransfomration
#0. for full model in the paper used.
# repeat for model with short database
 sds <- VarCorr(m_paper) %>% as.data.frame()
 sd.total <- sqrt(sds[1 , 5]^2 )
 # predict only LU (i.e. averaged over LUI, possible since no interactions)
data.full <- m_paper %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% as.data.frame()
levels(data.full$LU)[2]<-"Secondary"
# remove white space
data.full<-data.full%>%drop_na()
data.full$model<-with(data.full,"Original")
names(data.full)[2]<-c("num")

# for the model of m_1
#calculates the estimated variances, standard deviation
 sds <- VarCorr(m_1) %>% as.data.frame()
 sd.total <- sqrt(sds[1 , 5]^2)
 # predict only LU (i.e. averaged over LUI, possible since no interactions)
data.full_m_1 <- m_1 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% as.data.frame()
levels(data.full_m_1$LU)[2]<-"Secondary"
# remove white space
data.full_m_1<-data.full_m_1%>%drop_na()
names(data.full_m_1)[2]<-c("num")
data.full_m_1$model<-with(data.full_m_1,"m_1")
data.m_1<-data.full_m_1

# for the model of m_2
#calculates the estimated variances, standard deviation
 sds <- VarCorr(m_2) %>% as.data.frame()
 sd.total <- sqrt(sds[1 , 5]^2)
 # predict only LU (i.e. averaged over LUI, possible since no interactions)
data.full_m_2 <- m_2 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% as.data.frame()
levels(data.full_m_2$LU)[2]<-"Secondary"
# remove white space
data.full_m_2<-data.full_m_2%>%drop_na()
names(data.full_m_2)[2]<-c("num")
data.full_m_2$model<-with(data.full_m_2,"m_2")
data.m_2<-data.full_m_2


# for the model of m_3
#calculates the estimated variances, standard deviation
 sds <- VarCorr(m_3) %>% as.data.frame()
 sd.total <- sqrt(sds[1 , 5]^2 )
 # predict only LU (i.e. averaged over LUI, possible since no interactions)
data.full_m_3 <- m_3 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% as.data.frame()
levels(data.full_m_3$LU)[2]<-"Secondary"
# remove white space
data.full_m_3<-data.full_m_3%>%drop_na()
names(data.full_m_3)[2]<-c("num")
data.full_m_3$model<-with(data.full_m_3,"m_3")
data.m_3<-data.full_m_3

# for the model of m_4
#calculates the estimated variances, standard deviation
 sds <- VarCorr(m_4) %>% as.data.frame()
 sd.total <- sqrt(sds[1 , 5]^2 )
 # predict only LU (i.e. averaged over LUI, possible since no interactions)
data.full_m_4 <- m_4 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% as.data.frame()
levels(data.full_m_4$LU)[2]<-"Secondary"
# remove white space
data.full_m_4<-data.full_m_4%>%drop_na()
names(data.full_m_4)[2]<-c("num")
data.full_m_4$model<-with(data.full_m_4,"m_4")
data.m_4<-data.full_m_4

# for the model of m_5
#calculates the estimated variances, standard deviation
 sds <- VarCorr(m_5) %>% as.data.frame()
 sd.total <- sqrt(sds[1 , 5]^2 )
 # predict only LU (i.e. averaged over LUI, possible since no interactions)
data.full_m_5 <- m_5 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% as.data.frame()
levels(data.full_m_5$LU)[2]<-"Secondary"
# remove white space
data.full_m_5<-data.full_m_5%>%drop_na()
names(data.full_m_5)[2]<-c("num")
data.full_m_5$model<-with(data.full_m_5,"m_5")
data.m_5<-data.full_m_5

# for the model of m_6
#calculates the estimated variances, standard deviation
 sds <- VarCorr(m_6) %>% as.data.frame()
 sd.total <- sqrt(sds[1 , 5]^2 )
 # predict only LU (i.e. averaged over LUI, possible since no interactions)
data.full_m_6 <- m_6 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% as.data.frame()
levels(data.full_m_6$LU)[2]<-"Secondary"
# remove white space
data.full_m_6<-data.full_m_6%>%drop_na()
names(data.full_m_6)[2]<-c("num")
data.full_m_6$model<-with(data.full_m_6,"m_6")
data.m_6<-data.full_m_6

# for the model of m_7
#calculates the estimated variances, standard deviation
 sds <- VarCorr(m_7) %>% as.data.frame()
 sd.total <- sqrt(sds[1 , 5]^2 )
 # predict only LU (i.e. averaged over LUI, possible since no interactions)
data.full_m_7 <- m_7 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% as.data.frame()
levels(data.full_m_7$LU)[2]<-"Secondary"
# remove white space
data.full_m_7<-data.full_m_7%>%drop_na()
names(data.full_m_7)[2]<-c("num")
data.full_m_7$model<-with(data.full_m_7,"m_7")
data.m_7<-data.full_m_7



#2_2combine all the model-transfered result
data.model<-rbind(data.full,data.m_1,data.m_2,data.m_3,data.m_4,data.m_5,data.m_6,data.m_7)
names(data.model)
#2_3claclate the mean and confidence interval 95%

#get the model result in our paper
model_result_paper<-data.model%>% filter(model=="Original")
library(dplyr)
model_result_cross<-data.model%>% filter(model!="Original") %>%group_by(LU) %>%
  dplyr::summarise(mean.num = mean(num, na.rm = TRUE),
            sd.num = sd(num, na.rm = TRUE),
            n.num = n()) %>%
  mutate(se.num = sd.num / sqrt(n.num),
         lower.ci.num = mean.num - qt(1 - (0.05 / 2), n.num - 1) * se.num,
         upper.ci.num = mean.num + qt(1 - (0.05 / 2), n.num - 1) * se.num)
model_result_alien_sp<-merge(model_result_paper[,c(1:3)],model_result_cross[,c(1:2,5:7)],by=c("LU"),all.x=T)
model_result_alien_sp$taxa<-with(model_result_alien_sp,"Ants")
model_result_alien_sp_ant<-model_result_alien_sp
```
###birds subset model
```{r}
db_alien <- subset(db , alien_freq > 0)
db_alien.t<-db_alien[db_alien$taxa=="Birds",]
levels(db_alien.t$LU)

levels(db_alien.t$Biome)
dplyr::count(db_alien.t,Biome)

###part1: run the model
#there are 11 biomes , we will conduct 11 times for the leaving one biome out test
#1)the model in the paper, with SS/SSB in the random factor
m_paper <- glmer(alien_freq ~ LU + (1|SS), data = db_alien.t , family = poisson)

#3) leaving one biome out and test the result
#1 excluding the assemblages from biome of #Temperate Broadleaf & Mixed Forests
db_alien_1<-db_alien.t[db_alien.t$Biome != "Temperate Broadleaf & Mixed Forests",]
m_1 <- glmer(alien_freq ~ LU + (1|SS), data = db_alien_1 , family = poisson)

#2 excluding the assemblages from biome of #Mediterranean Forests, Woodlands & Scrub
db_alien_2<-db_alien.t[db_alien.t$Biome != "Mediterranean Forests, Woodlands & Scrub",]
m_2 <- glmer(alien_freq ~ LU + (1|SS), data = db_alien_2 , family = poisson)

#3 excluding the assemblages from biome of #Temperate Grasslands, Savannas & Shrublands
db_alien_3<-db_alien.t[db_alien.t$Biome != "Temperate Grasslands, Savannas & Shrublands",]
m_3 <- glmer(alien_freq ~ LU + (1|SS), data = db_alien_3 , family = poisson)

#4 excluding the assemblages from biome of #Tropical & Subtropical Dry Broadleaf Forests
db_alien_4<-db_alien.t[db_alien.t$Biome != "Tropical & Subtropical Dry Broadleaf Forests",]
m_4 <- glmer(alien_freq ~ LU + (1|SS), data = db_alien_4 , family = poisson)

#5 excluding the assemblages from biome of #Tropical & Subtropical Moist Broadleaf Forests
db_alien_5<-db_alien.t[db_alien.t$Biome != "Tropical & Subtropical Moist Broadleaf Forests",]
m_5 <- glmer(alien_freq ~ LU + (1|SS), data = db_alien_5 , family = poisson)


###part2: model backtransfomration
#0. for full model in the paper used.
# repeat for model with short database
 sds <- VarCorr(m_paper) %>% as.data.frame()
 sd.total <- sqrt(sds[1 , 5]^2 )
 # predict only LU (i.e. averaged over LUI, possible since no interactions)
data.full <- m_paper %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% as.data.frame()
levels(data.full$LU)[2]<-"Secondary"
# remove white space
data.full<-data.full%>%drop_na()
data.full$model<-with(data.full,"Original")
names(data.full)[2]<-c("num")

# for the model of m_1
#calculates the estimated variances, standard deviation
 sds <- VarCorr(m_1) %>% as.data.frame()
 sd.total <- sqrt(sds[1 , 5]^2)
 # predict only LU (i.e. averaged over LUI, possible since no interactions)
data.full_m_1 <- m_1 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% as.data.frame()
levels(data.full_m_1$LU)[2]<-"Secondary"
# remove white space
data.full_m_1<-data.full_m_1%>%drop_na()
names(data.full_m_1)[2]<-c("num")
data.full_m_1$model<-with(data.full_m_1,"m_1")
data.m_1<-data.full_m_1

# for the model of m_2
#calculates the estimated variances, standard deviation
 sds <- VarCorr(m_2) %>% as.data.frame()
 sd.total <- sqrt(sds[1 , 5]^2)
 # predict only LU (i.e. averaged over LUI, possible since no interactions)
data.full_m_2 <- m_2 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% as.data.frame()
levels(data.full_m_2$LU)[2]<-"Secondary"
# remove white space
data.full_m_2<-data.full_m_2%>%drop_na()
names(data.full_m_2)[2]<-c("num")
data.full_m_2$model<-with(data.full_m_2,"m_2")
data.m_2<-data.full_m_2


# for the model of m_3
#calculates the estimated variances, standard deviation
 sds <- VarCorr(m_3) %>% as.data.frame()
 sd.total <- sqrt(sds[1 , 5]^2 )
 # predict only LU (i.e. averaged over LUI, possible since no interactions)
data.full_m_3 <- m_3 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% as.data.frame()
levels(data.full_m_3$LU)[2]<-"Secondary"
# remove white space
data.full_m_3<-data.full_m_3%>%drop_na()
names(data.full_m_3)[2]<-c("num")
data.full_m_3$model<-with(data.full_m_3,"m_3")
data.m_3<-data.full_m_3

# for the model of m_4
#calculates the estimated variances, standard deviation
 sds <- VarCorr(m_4) %>% as.data.frame()
 sd.total <- sqrt(sds[1 , 5]^2 )
 # predict only LU (i.e. averaged over LUI, possible since no interactions)
data.full_m_4 <- m_4 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% as.data.frame()
levels(data.full_m_4$LU)[2]<-"Secondary"
# remove white space
data.full_m_4<-data.full_m_4%>%drop_na()
names(data.full_m_4)[2]<-c("num")
data.full_m_4$model<-with(data.full_m_4,"m_4")
data.m_4<-data.full_m_4

# for the model of m_5
#calculates the estimated variances, standard deviation
 sds <- VarCorr(m_5) %>% as.data.frame()
 sd.total <- sqrt(sds[1 , 5]^2 )
 # predict only LU (i.e. averaged over LUI, possible since no interactions)
data.full_m_5 <- m_5 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% as.data.frame()
levels(data.full_m_5$LU)[2]<-"Secondary"
# remove white space
data.full_m_5<-data.full_m_5%>%drop_na()
names(data.full_m_5)[2]<-c("num")
data.full_m_5$model<-with(data.full_m_5,"m_5")
data.m_5<-data.full_m_5


#2_2combine all the model-transfered result
data.model<-rbind(data.full,data.m_1,data.m_2,data.m_3,data.m_4,data.m_5)
names(data.model)
#2_3claclate the mean and confidence interval 95%

#get the model result in our paper
model_result_paper<-data.model%>% filter(model=="Original")
library(dplyr)
model_result_cross<-data.model%>% filter(model!="Original") %>%group_by(LU) %>%
  dplyr::summarise(mean.num = mean(num, na.rm = TRUE),
            sd.num = sd(num, na.rm = TRUE),
            n.num = n()) %>%
  mutate(se.num = sd.num / sqrt(n.num),
         lower.ci.num = mean.num - qt(1 - (0.05 / 2), n.num - 1) * se.num,
         upper.ci.num = mean.num + qt(1 - (0.05 / 2), n.num - 1) * se.num)
model_result_alien_sp<-merge(model_result_paper[,c(1:3)],model_result_cross[,c(1:2,5:7)],by=c("LU"),all.x=T)
model_result_alien_sp$taxa<-with(model_result_alien_sp,"Birds")
model_result_alien_sp_bird<-model_result_alien_sp
```
###spiders subset model
```{r}
db_alien <- subset(db , alien_freq > 0)
db_alien.t<-db_alien[db_alien$taxa=="Spiders",]
levels(db_alien.t$LU)

levels(db_alien.t$Biome)
dplyr::count(db_alien.t,Biome)

###part1: run the model
#there are 11 biomes , we will conduct 11 times for the leaving one biome out test
#1)the model in the paper, with SS/SSB in the random factor
dplyr::count(db_alien.t,LU)
m_paper <- glmer(alien_freq ~ LU + (1|SS), data = db_alien.t , family = poisson)

#3) leaving one biome out and test the result
#1 excluding the assemblages from biome of #Mediterranean Forests, Woodlands & Scrub
db_alien_1<-db_alien.t[db_alien.t$Biome != "Mediterranean Forests, Woodlands & Scrub",]
dplyr::count(db_alien_1,LU)
m_1 <- glmer(alien_freq ~ LU + (1|SS), data = db_alien_1 , family = poisson)

#2 excluding the assemblages from biome of #Temperate Broadleaf & Mixed Forests
db_alien_2<-db_alien.t[db_alien.t$Biome != "Temperate Broadleaf & Mixed Forests",]
dplyr::count(db_alien_2,LU)
m_2 <- glmer(alien_freq ~ LU + (1|SS), data = db_alien_2 , family = poisson)

#3 excluding the assemblages from biome of #Temperate Grasslands, Savannas & Shrublands
db_alien_3<-db_alien.t[db_alien.t$Biome != "Temperate Grasslands, Savannas & Shrublands",]
dplyr::count(db_alien_3,LU)
m_3 <- glmer(alien_freq ~ LU + (1|SS), data = db_alien_3 , family = poisson)
```


```{r}
###part2: model backtransfomration
#0. for full model in the paper used.
# repeat for model with short database
 sds <- VarCorr(m_paper) %>% as.data.frame()
 sd.total <- sqrt(sds[1 , 5]^2 )
 # predict only LU (i.e. averaged over LUI, possible since no interactions)
data.full <- m_paper %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% as.data.frame()
data.full$LU<-as.character(data.full$LU)
data.full[6,]<-c("Urban",NA,NA,NA,NA,NA,"a")
data.full$LU<-as.factor(data.full$LU)
levels(data.full$LU)[5]<-"Secondary"
data.full$LU<-
  factor(data.full$LU,c("Primary","Secondary","Plantation", "Pasture","Cropland", "Urban"))
# remove white space
data.full<-data.full%>%drop_na()
data.full$model<-with(data.full,"Original")
names(data.full)[2]<-c("num")

# for the model of m_1
#calculates the estimated variances, standard deviation
 sds <- VarCorr(m_1) %>% as.data.frame()
 sd.total <- sqrt(sds[1 , 5]^2)
 # predict only LU (i.e. averaged over LUI, possible since no interactions)
data.full_m_1 <- m_1 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% as.data.frame()
data.full_m_1$LU<-as.character(data.full_m_1$LU)
data.full_m_1[6,]<-c("Urban",NA,NA,NA,NA,NA,"a")
data.full_m_1$LU<-as.factor(data.full_m_1$LU)
levels(data.full_m_1$LU)[5]<-"Secondary"
data.full_m_1$LU<-
  factor(data.full_m_1$LU,c("Primary","Secondary","Plantation", "Pasture","Cropland", "Urban"))
# remove white space
data.full_m_1<-data.full_m_1%>%drop_na()
data.full_m_1$model<-with(data.full_m_1,"m_1")
names(data.full_m_1)[2]<-c("num")
data.m_1<-data.full_m_1

# for the model of m_2
#calculates the estimated variances, standard deviation
 sds <- VarCorr(m_2) %>% as.data.frame()
 sd.total <- sqrt(sds[1 , 5]^2)
 # predict only LU (i.e. averaged over LUI, possible since no interactions)
data.full_m_2 <- m_2 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% as.data.frame()
data.full_m_2$LU<-as.character(data.full_m_2$LU)
data.full_m_2[6,]<-c("Urban",NA,NA,NA,NA,NA,"a")
data.full_m_2$LU<-as.factor(data.full_m_2$LU)
levels(data.full_m_2$LU)[5]<-"Secondary"
data.full_m_2$LU<-
  factor(data.full_m_2$LU,c("Primary","Secondary","Plantation", "Pasture","Cropland", "Urban"))
# remove white space
data.full_m_2<-data.full_m_2%>%drop_na()
data.full_m_2$model<-with(data.full_m_2,"m_2")
names(data.full_m_2)[2]<-c("num")
data.m_2<-data.full_m_2


# for the model of m_3
#calculates the estimated variances, standard deviation
 sds <- VarCorr(m_3) %>% as.data.frame()
 sd.total <- sqrt(sds[1 , 5]^2 )
 # predict only LU (i.e. averaged over LUI, possible since no interactions)
data.full_m_3 <- m_3 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% as.data.frame()
data.full_m_3$LU<-as.character(data.full_m_3$LU)
data.full_m_3[6,]<-c("Urban",NA,NA,NA,NA,NA,"a")
data.full_m_3$LU<-as.factor(data.full_m_3$LU)
levels(data.full_m_3$LU)[5]<-"Secondary"
data.full_m_3$LU<-
  factor(data.full_m_3$LU,c("Primary","Secondary","Plantation", "Pasture","Cropland", "Urban"))
# remove white space
data.full_m_3<-data.full_m_3%>%drop_na()
data.full_m_3$model<-with(data.full_m_3,"m_3")
names(data.full_m_3)[2]<-c("num")
data.m_3<-data.full_m_3


#2_2check the result for 3 leaving out tests. Since the low number of sampling size, we can not get the mean values of cross validation.

```
###plants subset model
```{r}
db_alien <- subset(db , alien_freq > 0)
db_alien.t<-db_alien[db_alien$taxa=="Vascular plants",]
levels(db_alien.t$LU)
db_alien.t$LU<-
  factor(db_alien.t$LU,c("Primary","SV","Plantation","Pasture","Cropland","Urban"))
levels(db_alien.t$Biome)
dplyr::count(db_alien.t,Biome)

###part1: run the model
#there are 11 biomes , we will conduct 11 times for the leaving one biome out test
#1)the model in the paper, with SS/SSB in the random factor
m_paper <- glmer(alien_freq ~ LU + (1|SS/SSB) , data = db_alien.t , family = poisson , 
           control = glmerControl(optimizer = "bobyqa" , optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#2)adding model, with SS/SSB/Biome in the random factor
m_adding <- glmer(alien_freq ~ LU + (1|SS/SSB/Biome) , data = db_alien.t , family = poisson , 
           control = glmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e5)),nAGQ = 1 )
AIC(m_paper);AIC(m_adding)# deltAIC = 2
anova(m_paper,m_adding)# p=0.9999, no significance for the two models

#3) leaving one biome out and test the result
#1 excluding the assemblages from biome of #Boreal Forests/Taiga
db_alien.t_1<-db_alien.t[db_alien.t$Biome != "Boreal Forests/Taiga",]
m_1 <- glmer(alien_freq ~ LU + (1|SS/SSB) , data = db_alien.t_1 , family = poisson , 
           control = glmerControl(optimizer = "bobyqa" , optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#2 excluding the assemblages from biome of #Deserts & Xeric Shrublands
db_alien.t_2<-db_alien.t[db_alien.t$Biome != "Deserts & Xeric Shrublands",]
m_2 <- glmer(alien_freq ~ LU + (1|SS/SSB) , data = db_alien.t_2 , family = poisson , 
           control = glmerControl(optimizer = "bobyqa" , optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#3 excluding the assemblages from biome of #Mediterranean Forests, Woodlands & Scrub
db_alien.t_3<-db_alien.t[db_alien.t$Biome != "Mediterranean Forests, Woodlands & Scrub",]
m_3 <- glmer(alien_freq ~ LU + (1|SS/SSB) , data = db_alien.t_3 , family = poisson , 
           control = glmerControl(optimizer = "bobyqa" , optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#4 excluding the assemblages from biome of #Montane Grasslands & Shrublands
db_alien.t_4<-db_alien.t[db_alien.t$Biome != "Montane Grasslands & Shrublands",]
m_4 <- glmer(alien_freq ~ LU + (1|SS/SSB) , data = db_alien.t_4 , family = poisson , 
           control = glmerControl(optimizer = "bobyqa" , optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#5 excluding the assemblages from biome of #Temperate Broadleaf & Mixed Forests
db_alien.t_5<-db_alien.t[db_alien.t$Biome != "Temperate Broadleaf & Mixed Forests",]
m_5 <- glmer(alien_freq ~ LU + (1|SS/SSB) , data = db_alien.t_5 , family = poisson , 
           control = glmerControl(optimizer = "bobyqa" , optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#6 excluding the assemblages from biome of #Temperate Conifer Forests
db_alien.t_6<-db_alien.t[db_alien.t$Biome != "Temperate Conifer Forests",]
m_6<- glmer(alien_freq ~ LU + (1|SS/SSB) , data = db_alien.t_6 , family = poisson , 
           control = glmerControl(optimizer = "bobyqa" , optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#7 excluding the assemblages from biome of #Temperate Grasslands, Savannas & Shrublands
db_alien.t_7<-db_alien.t[db_alien.t$Biome != "Temperate Grasslands, Savannas & Shrublands",]
m_7<- glmer(alien_freq ~ LU + (1|SS/SSB) , data = db_alien.t_7 , family = poisson , 
           control = glmerControl(optimizer = "bobyqa" , optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#8 excluding the assemblages from biome of #Tropical & Subtropical Coniferous Forests
db_alien.t_8<-db_alien.t[db_alien.t$Biome != "Tropical & Subtropical Coniferous Forests",]
m_8<- glmer(alien_freq ~ LU + (1|SS/SSB) , data = db_alien.t_8 , family = poisson , 
           control = glmerControl(optimizer = "bobyqa" , optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#9 excluding the assemblages from biome of #Tropical & Subtropical Dry Broadleaf Forests
db_alien.t_9<-db_alien.t[db_alien.t$Biome != "Tropical & Subtropical Dry Broadleaf Forests",]
m_9<- glmer(alien_freq ~ LU + (1|SS/SSB) , data = db_alien.t_9 , family = poisson , 
           control = glmerControl(optimizer = "bobyqa" , optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#10 excluding the assemblages from biome of #Tropical & Subtropical Grasslands, Savannas & Shrublands
db_alien.t_10<-db_alien.t[db_alien.t$Biome != "Tropical & Subtropical Grasslands, Savannas & Shrublands",]
m_10<- glmer(alien_freq ~ LU + (1|SS/SSB) , data = db_alien.t_10 , family = poisson , 
           control = glmerControl(optimizer = "bobyqa" , optCtrl = list(maxfun = 1e5)),nAGQ = 1 )

#11 excluding the assemblages from biome of #Tropical & Subtropical Moist Broadleaf Forests
db_alien.t_11<-db_alien.t[db_alien.t$Biome != "Tropical & Subtropical Moist Broadleaf Forests",]
m_11<- glmer(alien_freq ~ LU + (1|SS/SSB) , data = db_alien.t_11 , family = poisson , 
           control = glmerControl(optimizer = "bobyqa" , optCtrl = list(maxfun = 1e5)),nAGQ = 1 )




###part2: model backtransfomration
#0. for full model in the paper used.
#calculates the estimated variances, standard deviation
 sds <- VarCorr(m_paper) %>% as.data.frame()
 sd.total <- sqrt(sds[1 , 5]^2 + sds[2 , 5]^2)
 # predict only LU (i.e. averaged over LUI, possible since no interactions)
data.full <- m_paper %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% as.data.frame()
levels(data.full$LU)[1:2]<-c("Primary","Secondary")
# remove white space
data.full<-data.full%>%drop_na()
data.full$model<-with(data.full,"Original")
names(data.full)[2]<-c("num")

# for the model of m_1
#calculates the estimated variances, standard deviation
 sds <- VarCorr(m_1) %>% as.data.frame()
 sd.total <- sqrt(sds[1 , 5]^2 + sds[2 , 5]^2)
 # predict only LU (i.e. averaged over LUI, possible since no interactions)
data.full_m_1 <- m_1 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% as.data.frame()
levels(data.full_m_1$LU)[1:2]<-c("Primary","Secondary")
# remove white space
data.full_m_1<-data.full_m_1%>%drop_na()
names(data.full_m_1)[2]<-c("num")
data.full_m_1$model<-with(data.full_m_1,"m_1")
data.m_1<-data.full_m_1

# for the model of m_2
#calculates the estimated variances, standard deviation
 sds <- VarCorr(m_2) %>% as.data.frame()
 sd.total <- sqrt(sds[1 , 5]^2 + sds[2 , 5]^2)
 # predict only LU (i.e. averaged over LUI, possible since no interactions)
data.full_m_2 <- m_2 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% as.data.frame()
levels(data.full_m_2$LU)[1:2]<-c("Primary","Secondary")
# remove white space
data.full_m_2<-data.full_m_2%>%drop_na()
names(data.full_m_2)[2]<-c("num")
data.full_m_2$model<-with(data.full_m_2,"m_2")
data.m_2<-data.full_m_2


# for the model of m_3
#calculates the estimated variances, standard deviation
 sds <- VarCorr(m_3) %>% as.data.frame()
 sd.total <- sqrt(sds[1 , 5]^2 + sds[2 , 5]^2)
 # predict only LU (i.e. averaged over LUI, possible since no interactions)
data.full_m_3 <- m_3 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% as.data.frame()
levels(data.full_m_3$LU)[1:2]<-c("Primary","Secondary")
# remove white space
data.full_m_3<-data.full_m_3%>%drop_na()
names(data.full_m_3)[2]<-c("num")
data.full_m_3$model<-with(data.full_m_3,"m_3")
data.m_3<-data.full_m_3

# for the model of m_4
#calculates the estimated variances, standard deviation
 sds <- VarCorr(m_4) %>% as.data.frame()
 sd.total <- sqrt(sds[1 , 5]^2 + sds[2 , 5]^2)
 # predict only LU (i.e. averaged over LUI, possible since no interactions)
data.full_m_4 <- m_4 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% as.data.frame()
levels(data.full_m_4$LU)[1:2]<-c("Primary","Secondary")
# remove white space
data.full_m_4<-data.full_m_4%>%drop_na()
names(data.full_m_4)[2]<-c("num")
data.full_m_4$model<-with(data.full_m_4,"m_4")
data.m_4<-data.full_m_4

# for the model of m_5
#calculates the estimated variances, standard deviation
 sds <- VarCorr(m_5) %>% as.data.frame()
 sd.total <- sqrt(sds[1 , 5]^2 + sds[2 , 5]^2)
 # predict only LU (i.e. averaged over LUI, possible since no interactions)
data.full_m_5 <- m_5 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% as.data.frame()
levels(data.full_m_5$LU)[1:2]<-c("Primary","Secondary")
# remove white space
data.full_m_5<-data.full_m_5%>%drop_na()
names(data.full_m_5)[2]<-c("num")
data.full_m_5$model<-with(data.full_m_5,"m_5")
data.m_5<-data.full_m_5

# for the model of m_6
#calculates the estimated variances, standard deviation
 sds <- VarCorr(m_6) %>% as.data.frame()
 sd.total <- sqrt(sds[1 , 5]^2 + sds[2 , 5]^2)
 # predict only LU (i.e. averaged over LUI, possible since no interactions)
data.full_m_6 <- m_6 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% as.data.frame()
levels(data.full_m_6$LU)[1:2]<-c("Primary","Secondary")
# remove white space
data.full_m_6<-data.full_m_6%>%drop_na()
names(data.full_m_6)[2]<-c("num")
data.full_m_6$model<-with(data.full_m_6,"m_6")
data.m_6<-data.full_m_6

# for the model of m_7
#calculates the estimated variances, standard deviation
 sds <- VarCorr(m_7) %>% as.data.frame()
 sd.total <- sqrt(sds[1 , 5]^2 + sds[2 , 5]^2)
 # predict only LU (i.e. averaged over LUI, possible since no interactions)
data.full_m_7 <- m_7 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% as.data.frame()
levels(data.full_m_7$LU)[1:2]<-c("Primary","Secondary")
# remove white space
data.full_m_7<-data.full_m_7%>%drop_na()
names(data.full_m_7)[2]<-c("num")
data.full_m_7$model<-with(data.full_m_7,"m_7")
data.m_7<-data.full_m_7

# for the model of m_8
#calculates the estimated variances, standard deviation
 sds <- VarCorr(m_8) %>% as.data.frame()
 sd.total <- sqrt(sds[1 , 5]^2 + sds[2 , 5]^2)
 # predict only LU (i.e. averaged over LUI, possible since no interactions)
data.full_m_8 <- m_8 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% as.data.frame()
levels(data.full_m_8$LU)[1:2]<-c("Primary","Secondary")
# remove white space
data.full_m_8<-data.full_m_8%>%drop_na()
names(data.full_m_8)[2]<-c("num")
data.full_m_8$model<-with(data.full_m_8,"m_8")
data.m_8<-data.full_m_8

# for the model of m_9
#calculates the estimated variances, standard deviation
 sds <- VarCorr(m_9) %>% as.data.frame()
 sd.total <- sqrt(sds[1 , 5]^2 + sds[2 , 5]^2)
 # predict only LU (i.e. averaged over LUI, possible since no interactions)
data.full_m_9 <- m_9 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% as.data.frame()
levels(data.full_m_9$LU)[1:2]<-c("Primary","Secondary")
# remove white space
data.full_m_9<-data.full_m_9%>%drop_na()
names(data.full_m_9)[2]<-c("num")
data.full_m_9$model<-with(data.full_m_9,"m_9")
data.m_9<-data.full_m_9

# for the model of m_10
#calculates the estimated variances, standard deviation
 sds <- VarCorr(m_10) %>% as.data.frame()
 sd.total <- sqrt(sds[1 , 5]^2 + sds[2 , 5]^2)
 # predict only LU (i.e. averaged over LUI, possible since no interactions)
data.full_m_10 <- m_10 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% as.data.frame()
levels(data.full_m_10$LU)[1:2]<-c("Primary","Secondary")
# remove white space
data.full_m_10<-data.full_m_10%>%drop_na()
names(data.full_m_10)[2]<-c("num")
data.full_m_10$model<-with(data.full_m_10,"m_10")
data.m_10<-data.full_m_10

# for the model of m_11
#calculates the estimated variances, standard deviation
 sds <- VarCorr(m_11) %>% as.data.frame()
 sd.total <- sqrt(sds[1 , 5]^2 + sds[2 , 5]^2)
 # predict only LU (i.e. averaged over LUI, possible since no interactions)
data.full_m_11 <- m_11 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% as.data.frame()
levels(data.full_m_11$LU)[1:2]<-c("Primary","Secondary")
# remove white space
data.full_m_11<-data.full_m_11%>%drop_na()
names(data.full_m_11)[2]<-c("num")
data.full_m_11$model<-with(data.full_m_11,"m_11")
data.m_11<-data.full_m_11


#2_2combine all the model-transfered result
data.model<-rbind(data.full,data.m_1,data.m_2,data.m_3,data.m_4,data.m_5,data.m_6,data.m_7,
                  data.m_8,data.m_9,data.m_10,data.m_11)
names(data.model)
#2_3claclate the mean and confidence interval 95%

#get the model result in our paper
model_result_paper<-data.model%>% filter(model=="Original")
library(dplyr)
model_result_cross<-data.model%>% filter(model!="Original") %>%group_by(LU) %>%
  dplyr::summarise(mean.num = mean(num, na.rm = TRUE),
            sd.num = sd(num, na.rm = TRUE),
            n.num = n()) %>%
  mutate(se.num = sd.num / sqrt(n.num),
         lower.ci.num = mean.num - qt(1 - (0.05 / 2), n.num - 1) * se.num,
         upper.ci.num = mean.num + qt(1 - (0.05 / 2), n.num - 1) * se.num)
model_result_alien_sp<-merge(model_result_paper[,c(1:3)],model_result_cross[,c(1:2,5:7)],by=c("LU"),all.x=T)
model_result_alien_sp$taxa<-with(model_result_alien_sp,"Vascular plants")
model_result_alien_sp_plant<-model_result_alien_sp

```
###combine three taxa
```{r}
# ants, birds and spiders
combine.cross<-rbind(model_result_alien_sp_ant,model_result_alien_sp_bird,model_result_alien_sp_plant)
combine.cross$taxa<-as.factor(combine.cross$taxa)
combine.cross$LU<-
  factor(combine.cross$LU,c("Primary","Secondary","Plantation","Pasture","Cropland","Urban"))
all.taxa<-ggplot(combine.cross , aes(LU , mean.num,color=taxa,shape=taxa))+
  geom_point(size=2.5,  position = position_dodge(0.6))+
  geom_errorbar(aes(ymin = lower.ci.num, ymax = upper.ci.num) ,width=0.6, 
                position = position_dodge(width=.6),color="grey50")+
  geom_errorbar(aes(ymin = mean.num-se.num , ymax = mean.num+se.num) ,width=0.4, 
                position = position_dodge(width=.6))+
  scale_y_continuous(name="Number of alien species",
                     limits=c(-0.2,6),breaks=seq(0,6,2))+
  geom_point(position = position_dodge(width=.6),size=3)+
  scale_shape_manual(name="Taxa",values=c(16,17,7), 
                     label=c('Ants','Birds','Vascular plants'))+
  scale_color_manual(name='Taxa',
                     values = c("brown1","lightgoldenrod4","magenta"),
                     label=c('Ants','Birds','Vascular plants'))+
  guides(colour = guide_legend(nrow = 1),shape=guide_legend(nrow = 1))+
  theme_bw()+
  theme(panel.grid.major.x = element_blank() , 
        axis.ticks.length=unit(0.08,"inch"),
        panel.grid.major.y = element_line(size = 0.6 , colour = "grey90") ,
        panel.spacing = unit(0,"lines") , 
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_text(colour = "black",angle = 25, 
                                   size = 12,vjust = 0.6) ,
        axis.text.y = element_text(colour = "black",  size = 12),
        legend.title = element_text(face = 'bold'),
        legend.background = element_blank(),
        legend.box.background = element_blank(),
        legend.key = element_blank(),
        legend.direction =  "horizontal",legend.position = c(0.45,0.92)) 
all.taxa
ggsave(all.taxa,filename = '.../all.taxa.tiff',width = 6.0,height = 3,dpi = 200)
```






































#2.3alien proportions
###overall full model
```{r}
names(db_alien)
db_alien$alien_prop <- db_alien$alien_freq / db_alien$pred_freq
summary(db_alien$alien_prop)
# alien proportion contains 1, therefore apply lemon squeezer following Smithson M, Verkuilen J (2006). "A Better Lemon Squeezer? Maximum-Likelihood Regression with Beta-Distributed Dependent Variables." Psychological Methods, 11 (1), 54-71
db_alien$alien_prop_squeezed <- (db_alien$alien_prop * (nrow(db_alien)-1) + 0.5) / nrow(db_alien)


###part1: run the model
#there are 11 biomes , we will conduct 11 times for the leaving one biome out test
#1)the model in the paper, with SS/SSB in the random factor
db_alien_pro<-db_alien[db_alien$LUI != "Cannot decide",]
library(glmmTMB)
m_paper <- glmmTMB(alien_prop_squeezed ~ LU*LUI + (1|SS/SSB) , data = db_alien_pro , family = beta_family)

#2)adding model, with SS/SSB/Biome in the random factor
m_adding <- glmmTMB(alien_prop_squeezed ~ LU*LUI + (1|SS/SSB/Biome) , data = db_alien_pro , family = beta_family)
AIC(m_paper);AIC(m_adding)# deltAIC = 2
anova(m_paper,m_adding)# p=0.9999, no significance for the two models

#3) leaving one biome out and test the result
#1 excluding the assemblages from biome of #Boreal Forests/Taiga
db_alien_pro_1<-db_alien_pro[db_alien_pro$Biome != "Boreal Forests/Taiga",]
m_1 <- glmmTMB(alien_prop_squeezed ~ LU*LUI + (1|SS/SSB) , data = db_alien_pro_1 , family = beta_family)

#2 excluding the assemblages from biome of #Deserts & Xeric Shrublands
db_alien_pro_2<-db_alien_pro[db_alien_pro$Biome != "Deserts & Xeric Shrublands",]
m_2 <- glmmTMB(alien_prop_squeezed ~ LU*LUI + (1|SS/SSB) , data = db_alien_pro_2, family = beta_family)

#3 excluding the assemblages from biome of #Mediterranean Forests, Woodlands & Scrub
db_alien_pro_3<-db_alien_pro[db_alien_pro$Biome != "Mediterranean Forests, Woodlands & Scrub",]
m_3 <- glmmTMB(alien_prop_squeezed ~ LU*LUI + (1|SS/SSB) , data = db_alien_pro_3, family = beta_family)

#4 excluding the assemblages from biome of #Montane Grasslands & Shrublands
db_alien_pro_4<-db_alien_pro[db_alien_pro$Biome != "Montane Grasslands & Shrublands",]
m_4 <- glmmTMB(alien_prop_squeezed ~ LU*LUI + (1|SS/SSB) , data = db_alien_pro_4, family = beta_family)

#5 excluding the assemblages from biome of #Temperate Broadleaf & Mixed Forests
db_alien_pro_5<-db_alien_pro[db_alien_pro$Biome != "Temperate Broadleaf & Mixed Forests",]
m_5 <- glmmTMB(alien_prop_squeezed ~ LU*LUI + (1|SS/SSB) , data = db_alien_pro_5, family = beta_family)

#6 excluding the assemblages from biome of #Temperate Conifer Forests
db_alien_pro_6<-db_alien_pro[db_alien_pro$Biome != "Temperate Conifer Forests",]
m_6 <- glmmTMB(alien_prop_squeezed ~ LU*LUI + (1|SS/SSB) , data = db_alien_pro_6, family = beta_family)

#7 excluding the assemblages from biome of #Temperate Grasslands, Savannas & Shrublands
db_alien_pro_7<-db_alien_pro[db_alien_pro$Biome != "Temperate Grasslands, Savannas & Shrublands",]
m_7 <- glmmTMB(alien_prop_squeezed ~ LU*LUI + (1|SS/SSB) , data = db_alien_pro_7, family = beta_family)

#8 excluding the assemblages from biome of #Tropical & Subtropical Coniferous Forests
db_alien_pro_8<-db_alien_pro[db_alien_pro$Biome != "Tropical & Subtropical Coniferous Forests",]
m_8 <- glmmTMB(alien_prop_squeezed ~ LU*LUI + (1|SS/SSB) , data = db_alien_pro_8, family = beta_family)

#9 excluding the assemblages from biome of #Tropical & Subtropical Dry Broadleaf Forests
db_alien_pro_9<-db_alien_pro[db_alien_pro$Biome != "Tropical & Subtropical Dry Broadleaf Forests",]
m_9 <- glmmTMB(alien_prop_squeezed ~ LU*LUI + (1|SS/SSB) , data = db_alien_pro_9, family = beta_family)

#10 excluding the assemblages from biome of #Tropical & Subtropical Grasslands, Savannas & Shrublands
db_alien_pro_10<-db_alien_pro[db_alien_pro$Biome != "Tropical & Subtropical Grasslands, Savannas & Shrublands",]
m_10 <- glmmTMB(alien_prop_squeezed ~ LU*LUI + (1|SS/SSB) , data = db_alien_pro_10, family = beta_family)

#11 excluding the assemblages from biome of #Tropical & Subtropical Moist Broadleaf Forests
db_alien_pro_11<-db_alien_pro[db_alien_pro$Biome != "Tropical & Subtropical Moist Broadleaf Forests",]
m_11 <- glmmTMB(alien_prop_squeezed ~ LU*LUI + (1|SS/SSB) , data = db_alien_pro_11, family = beta_family)

###part2: model backtransfomration
# calculate combined effect for several random effects
VarCorr(m_paper)
sd.total <- sqrt(4.3675e-05 ^2+1.7201e+00^2)
# predict only LU (i.e. averaged over LUI, possible since no interactions)
pred.full <- m_paper %>% emmeans(specs = ~LU*LUI , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full)[3]<-c("Proportion")
levels(pred.full$LU)[1:2]<-c("Primary","Secondary")
pred.full$model<-with(pred.full,"Original")

# for m_1
VarCorr(m_1)
sd.total <- sqrt(3.4173e-05 ^2+1.6551e+00^2)
# predict only LU (i.e. averaged over LUI, possible since no interactions)
pred.full_m_1 <- m_1 %>% emmeans(specs = ~LU*LUI , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full_m_1)[3]<-c("Proportion")
levels(pred.full_m_1$LU)[1:2]<-c("Primary","Secondary")
pred.full_m_1$model<-with(pred.full_m_1,"m_1")

# for m_2
VarCorr(m_2)
sd.total <- sqrt(4.0639e-05 ^2+1.7346e+00^2)
# predict only LU (i.e. averaged over LUI, possible since no interactions)
pred.full_m_2 <- m_2 %>% emmeans(specs = ~LU*LUI , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full_m_2)[3]<-c("Proportion")
levels(pred.full_m_2$LU)[1:2]<-c("Primary","Secondary")
pred.full_m_2$model<-with(pred.full_m_2,"m_2")

# for m_3
VarCorr(m_3)
sd.total <- sqrt(4.3023e-05 ^2+1.6668e+00^2)
# predict only LU (i.e. averaged over LUI, possible since no interactions)
pred.full_m_3 <- m_3 %>% emmeans(specs = ~LU*LUI , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full_m_3)[3]<-c("Proportion")
levels(pred.full_m_3$LU)[1:2]<-c("Primary","Secondary")
pred.full_m_3$model<-with(pred.full_m_3,"m_3")

# for m_4
VarCorr(m_4)
sd.total <- sqrt(3.2998e-05 ^2+1.7379e+00^2)
# predict only LU (i.e. averaged over LUI, possible since no interactions)
pred.full_m_4 <- m_4 %>% emmeans(specs = ~LU*LUI , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full_m_4)[3]<-c("Proportion")
levels(pred.full_m_4$LU)[1:2]<-c("Primary","Secondary")
pred.full_m_4$model<-with(pred.full_m_4,"m_4")

# for m_5
VarCorr(m_5)
sd.total <- sqrt(0.099146 ^2+1.972782^2)
# predict only LU (i.e. averaged over LUI, possible since no interactions)
pred.full_m_5 <- m_5 %>% emmeans(specs = ~LU*LUI , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full_m_5)[3]<-c("Proportion")
levels(pred.full_m_5$LU)[1:2]<-c("Primary","Secondary")
pred.full_m_5$model<-with(pred.full_m_5,"m_5")

# for m_6
VarCorr(m_6)
sd.total <- sqrt(4.1694e-05^2+1.7295e+00^2)
# predict only LU (i.e. averaged over LUI, possible since no interactions)
pred.full_m_6 <- m_6 %>% emmeans(specs = ~LU*LUI , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full_m_6)[3]<-c("Proportion")
levels(pred.full_m_6$LU)[1:2]<-c("Primary","Secondary")
pred.full_m_6$model<-with(pred.full_m_6,"m_6")

# for m_7
VarCorr(m_7)
sd.total <- sqrt(3.7563e-05^2+1.7322e+00^2)
# predict only LU (i.e. averaged over LUI, possible since no interactions)
pred.full_m_7 <- m_7 %>% emmeans(specs = ~LU*LUI , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full_m_7)[3]<-c("Proportion")
levels(pred.full_m_7$LU)[1:2]<-c("Primary","Secondary")
pred.full_m_7$model<-with(pred.full_m_7,"m_7")


# for m_8
VarCorr(m_8)
sd.total <- sqrt(0.00004094 ^2+1.72374844^2)
# predict only LU (i.e. averaged over LUI, possible since no interactions)
pred.full_m_8 <- m_8 %>% emmeans(specs = ~LU*LUI , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full_m_8)[3]<-c("Proportion")
levels(pred.full_m_8$LU)[1:2]<-c("Primary","Secondary")
pred.full_m_8$model<-with(pred.full_m_8,"m_8")

# for m_9
VarCorr(m_9)
sd.total <- sqrt(3.1937e-05 ^2+1.6749e+00^2)
# predict only LU (i.e. averaged over LUI, possible since no interactions)
pred.full_m_9 <- m_9 %>% emmeans(specs = ~LU*LUI , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full_m_9)[3]<-c("Proportion")
levels(pred.full_m_9$LU)[1:2]<-c("Primary","Secondary")
pred.full_m_9$model<-with(pred.full_m_9,"m_9")


# for m_10
VarCorr(m_10)
sd.total <- sqrt(2.9184e-05 ^2+1.6360e+00^2)
# predict only LU (i.e. averaged over LUI, possible since no interactions)
pred.full_m_10 <- m_10 %>% emmeans(specs = ~LU*LUI , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full_m_10)[3]<-c("Proportion")
levels(pred.full_m_10$LU)[1:2]<-c("Primary","Secondary")
pred.full_m_10$model<-with(pred.full_m_10,"m_10")


# for m_11
VarCorr(m_11)
sd.total <- sqrt(2.9024e-05 ^2+1.6961e+00^2)
# predict only LU (i.e. averaged over LUI, possible since no interactions)
pred.full_m_11 <- m_11 %>% emmeans(specs = ~LU*LUI , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full_m_11)[3]<-c("Proportion")
levels(pred.full_m_11$LU)[1:2]<-c("Primary","Secondary")
pred.full_m_11$model<-with(pred.full_m_11,"m_11")

#2_2combine all the model-transfered result
pred.full_model<-rbind(pred.full,pred.full_m_1,pred.full_m_2,pred.full_m_3,pred.full_m_4,pred.full_m_5,pred.full_m_6,
                       pred.full_m_7,pred.full_m_8,pred.full_m_9,pred.full_m_10,pred.full_m_11)
names(pred.full_model)
#2_3claclate the mean and confidence interval 95%

#get the model result in our paper
model_result_paper<-pred.full_model%>% filter(model=="Original")
library(dplyr)
model_result_cross<-pred.full_model%>% filter(model!="Original") %>%group_by(LU,LUI) %>%
  dplyr::summarise(mean.prop = mean(Proportion, na.rm = TRUE),
            sd.prop = sd(Proportion, na.rm = TRUE),
            n.prop = n()) %>%
  mutate(se.prop = sd.prop / sqrt(n.prop),
         lower.ci.prop = mean.prop - qt(1 - (0.05 / 2), n.prop - 1) * se.prop,
         upper.ci.prop = mean.prop + qt(1 - (0.05 / 2), n.prop - 1) * se.prop)
model_result_alien_prop<-merge(model_result_paper[,c(1:4)],model_result_cross[,c(1:3,6:8)],by=c("LU","LUI"),all.x=T)
```
###figure
```{r}
all_pro<-ggplot(model_result_paper , aes(LU , Proportion,shape=LUI,color=LU))+
  geom_errorbar(aes(ymin = Proportion-SE , ymax = Proportion+SE) ,width=0.4, 
                position = position_dodge(width=.6))+
  scale_y_continuous(name="Alien proportions",
                     limits=c(0.25,0.6),breaks=seq(0.3,0.6,0.1))+
  geom_point(aes(shape=LUI),position = position_dodge(width=.6),size=3.5)+
  scale_shape_manual(name="LU-intensity",values=c(15, 17, 18))+
  scale_color_manual(name='LU-types',
                     values = c("#2166AC","#4393C3","#92C5DE",
                                "#F4A582","red","#B2182B"),
                     label=c('Primary','Secondary','Plantation',
                             'Pasture','Cropland','Urban'))+
  guides(color=FALSE)+
  annotate(geom="text", x=0.817, y=0.42, label="a",size=4,color="#2166AC")+
  annotate(geom="text", x=1, y=0.44, label="ab",size=4,color="#2166AC")+
  annotate(geom="text", x=1.2, y=0.5, label="abc",size=4,color="#2166AC")+
  annotate(geom="text", x=1.82, y=0.44, label="ab",size=4,color="#4393C3")+
  annotate(geom="text", x=2, y=0.44, label="ab",size=4,color="#4393C3")+
  annotate(geom="text", x=2.2, y=0.49, label="abc",size=4,color="#4393C3")+
  
  annotate(geom="text", x=2.82, y=0.46, label="abc",size=4,color="#92C5DE")+
  annotate(geom="text", x=3, y=0.48, label="bc",size=4,color="#92C5DE")+
  annotate(geom="text", x=3.2, y=0.51, label="bc",size=4,color="#92C5DE")+ 
  annotate(geom="text", x=3.818, y=0.46, label="abc",size=4,color="#F4A582")+
  annotate(geom="text", x=4, y=0.47, label="abc",size=4,color="#F4A582")+
  annotate(geom="text", x=4.2, y=0.475, label="abc",size=4,color="#F4A582")+
  
  annotate(geom="text", x=4.817, y=0.51, label="c",size=4,color="red")+
  annotate(geom="text", x=5, y=0.455, label="abc",size=4,color="red")+
  annotate(geom="text", x=5.2, y=0.46, label="abc",size=4,color="red")+
  annotate(geom="text", x=5.82, y=0.49, label="bc",size=4,color="#B2182B")+ 
  annotate(geom="text", x=6, y=0.495, label="abc",size=4,color="#B2182B")+ 
  annotate(geom="text", x=6.2, y=0.53, label="abc",size=4,color="#B2182B")+  
  theme_bw()+
  theme(panel.grid.major.x = element_blank() , 
        axis.ticks.length=unit(0.08,"inch"),
        panel.grid.major.y = element_line(size = 0.6 , colour = "grey90") ,
        panel.spacing = unit(0,"lines") , 
        axis.title.x = element_blank(),
        axis.title.y = element_text(size=12),
        axis.text.x = element_text(colour = "black",angle = 25, 
                                   size = 12,vjust = 0.6) ,
        axis.text.y = element_text(colour = "black",  size = 12),
        legend.title = element_text(face = 'bold'),
        legend.background = element_blank(),
        legend.box.background = element_blank(),
        legend.key = element_blank(),
        legend.direction =  "horizontal",legend.position = c(0.5,0.94)) 
all_pro

#for corss validate
all_cross<-ggplot(model_result_cross , aes(LU , mean.prop,shape=LUI,color=LU))+
  geom_errorbar(aes(ymin = lower.ci.prop, ymax = upper.ci.prop) ,width=0.6, 
                position = position_dodge(width=.6),color="grey50")+
  geom_errorbar(aes(ymin = mean.prop-se.prop , ymax = mean.prop+se.prop) ,width=0.4, 
                position = position_dodge(width=.6))+
  scale_y_continuous(name="Alien proportions",
                     limits=c(0.25,0.6),breaks=seq(0.3,0.6,0.1))+
  geom_point(aes(shape=LUI),position = position_dodge(width=.6),size=3.5)+
  scale_shape_manual(name="LU-intensity",values=c(15, 17, 18))+
  scale_color_manual(name='LU-types',
                     values = c("#2166AC","#4393C3","#92C5DE",
                                "#F4A582","red","#B2182B"),
                     label=c('Primary','Secondary','Plantation',
                             'Pasture','Cropland','Urban'))+
  guides(color=FALSE)+
  theme_bw()+
  theme(panel.grid.major.x = element_blank() , 
        axis.ticks.length=unit(0.08,"inch"),
        panel.grid.major.y = element_line(size = 0.6 , colour = "grey90") ,
        panel.spacing = unit(0,"lines") , 
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_text(colour = "black",angle = 25, 
                                   size = 12,vjust = 0.6) ,
        axis.text.y = element_text(colour = "black",  size = 12),
        legend.title = element_text(face = 'bold'),
        legend.background = element_blank(),
        legend.box.background = element_blank(),
        legend.key = element_blank(),
        legend.direction =  "horizontal",legend.position = c(0.4,0.9))
all_cross
#com<-cowplot::plot_grid(all_pro,all_cross,ncol=2,align = 'hv')
#com
ggsave(all_cross,filename = '.../fig2c.bnew.tiff',compression='lzw', width = 10,height = 3.0,dpi=200)
```
###overall subset model after
```{r}
####part1: run the model 
levels(db_alien$LU)
dplyr::count(db_alien,Biome)


#0 the model used in the paper
m_paper <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS) , data = db_alien, family = beta_family)
#1 excluding the assemblages from biome of #Boreal Forests/Taiga
db_alien_1<-db_alien[db_alien$Biome != "Boreal Forests/Taiga",]
m_1 <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS) , data = db_alien_1, family = beta_family)

#2 excluding the assemblages from biome of #Deserts & Xeric Shrublands
db_alien_2<-db_alien[db_alien$Biome != "Deserts & Xeric Shrublands",]
m_2 <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS) , data = db_alien_2, family = beta_family)

#3 excluding the assemblages from biome of #Mediterranean Forests, Woodlands & Scrub
db_alien_3<-db_alien[db_alien$Biome != "Mediterranean Forests, Woodlands & Scrub",]
m_3 <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS) , data = db_alien_3, family = beta_family)

#4 excluding the assemblages from biome of #Montane Grasslands & Shrublands
db_alien_4<-db_alien[db_alien$Biome != "Montane Grasslands & Shrublands",]
m_4 <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS) , data = db_alien_4, family = beta_family)

#5 excluding the assemblages from biome of #Temperate Broadleaf & Mixed Forests
db_alien_5<-db_alien[db_alien$Biome != "Temperate Broadleaf & Mixed Forests",]
m_5 <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS) , data = db_alien_5, family = beta_family)

#6 excluding the assemblages from biome of #Temperate Conifer Forests
db_alien_6<-db_alien[db_alien$Biome != "Temperate Conifer Forests",]
m_6 <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS) , data = db_alien_6, family = beta_family)

#7 excluding the assemblages from biome of #Temperate Grasslands, Savannas & Shrublands
db_alien_7<-db_alien[db_alien$Biome != "Temperate Grasslands, Savannas & Shrublands",]
m_7 <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS) , data = db_alien_7, family = beta_family)

#8 excluding the assemblages from biome of #Tropical & Subtropical Coniferous Forests
db_alien_8<-db_alien[db_alien$Biome != "Tropical & Subtropical Coniferous Forests",]
m_8 <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS) , data = db_alien_8, family = beta_family)

#9 excluding the assemblages from biome of #Tropical & Subtropical Dry Broadleaf Forestss
db_alien_9<-db_alien[db_alien$Biome != "Tropical & Subtropical Dry Broadleaf Forests",]
m_9 <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS) , data = db_alien_9, family = beta_family)

#10 excluding the assemblages from biome of #Tropical & Subtropical Grasslands, Savannas & Shrublands
db_alien_10<-db_alien[db_alien$Biome != "Tropical & Subtropical Grasslands, Savannas & Shrublands",]
m_10 <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS) , data = db_alien_10, family = beta_family)

#11 excluding the assemblages from biome of #Tropical & Subtropical Moist Broadleaf Forests
db_alien_11<-db_alien[db_alien$Biome != "Tropical & Subtropical Moist Broadleaf Forests",]
m_11 <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS) , data = db_alien_11, family = beta_family)

####part2: model backtransfomration
#selelct the rows that compared to primary
VarCorr(m_paper)
sd.total <- sqrt(1.7775 ^2)
pred.full <- m_paper %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full)[2]<-"prob"
levels(pred.full$LU)[2]<-"Secondary"
#add the model name
pred.full$model<-with(pred.full,"Original")
data.full.all<-pred.full

# for the model 1
VarCorr(m_1)
sd.total <- sqrt(1.7174 ^2)
pred.full <- m_1 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full)[2]<-"prob"
levels(pred.full$LU)[2]<-"Secondary"
#add the model name
pred.full$model<-with(pred.full,"Original")
data.full<-pred.full
#add the model name
data.full$model<-with(data.full,"m_1")
data.m_1<-data.full

# for the model 2
VarCorr(m_2)
sd.total <- sqrt(1.7906 ^2)
pred.full <- m_2 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full)[2]<-"prob"
levels(pred.full$LU)[2]<-"Secondary"
#add the model name
pred.full$model<-with(pred.full,"Original")
data.full<-pred.full
#add the model name
data.full$model<-with(data.full,"m_2")
data.m_2<-data.full

# for the model 3
VarCorr(m_3)
sd.total <- sqrt(1.7265 ^2)
pred.full <- m_3 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full)[2]<-"prob"
levels(pred.full$LU)[2]<-"Secondary"
#add the model name
pred.full$model<-with(pred.full,"Original")
data.full<-pred.full
#add the model name
data.full$model<-with(data.full,"m_3")
data.m_3<-data.full

# for the model 4
VarCorr(m_4)
sd.total <- sqrt(1.7893 ^2)
pred.full <- m_4 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full)[2]<-"prob"
levels(pred.full$LU)[2]<-"Secondary"
#add the model name
pred.full$model<-with(pred.full,"Original")
data.full<-pred.full
#add the model name
data.full$model<-with(data.full,"m_4")
data.m_4<-data.full


# for the model 5
VarCorr(m_5)
sd.total <- sqrt(2.0165 ^2)
pred.full <- m_5 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full)[2]<-"prob"
levels(pred.full$LU)[2]<-"Secondary"
#add the model name
pred.full$model<-with(pred.full,"Original")
data.full<-pred.full
#add the model name
data.full$model<-with(data.full,"m_5")
data.m_5<-data.full

# for the model 6
VarCorr(m_6)
sd.total <- sqrt(1.7867  ^2)
pred.full <- m_6 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full)[2]<-"prob"
levels(pred.full$LU)[2]<-"Secondary"
#add the model name
pred.full$model<-with(pred.full,"Original")
data.full<-pred.full
#add the model name
data.full$model<-with(data.full,"m_6")
data.m_6<-data.full


# for the model 7
VarCorr(m_7)
sd.total <- sqrt(1.7889   ^2)
pred.full <- m_7 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full)[2]<-"prob"
levels(pred.full$LU)[2]<-"Secondary"
#add the model name
pred.full$model<-with(pred.full,"Original")
data.full<-pred.full
#add the model name
data.full$model<-with(data.full,"m_7")
data.m_7<-data.full

# for the model 8
VarCorr(m_8)
sd.total <- sqrt(1.7816   ^2)
pred.full <- m_8 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full)[2]<-"prob"
levels(pred.full$LU)[2]<-"Secondary"
#add the model name
pred.full$model<-with(pred.full,"Original")
data.full<-pred.full
#add the model name
data.full$model<-with(data.full,"m_8")
data.m_8<-data.full

# for the model 9
VarCorr(m_9)
sd.total <- sqrt(1.7287  ^2)
pred.full <- m_9 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full)[2]<-"prob"
levels(pred.full$LU)[2]<-"Secondary"
#add the model name
pred.full$model<-with(pred.full,"Original")
data.full<-pred.full
#add the model name
data.full$model<-with(data.full,"m_9")
data.m_9<-data.full

# for the model 10
VarCorr(m_10)
sd.total <- sqrt(1.6862   ^2)
pred.full <- m_10 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full)[2]<-"prob"
levels(pred.full$LU)[2]<-"Secondary"
#add the model name
pred.full$model<-with(pred.full,"Original")
data.full<-pred.full
#add the model name
data.full$model<-with(data.full,"m_10")
data.m_10<-data.full


# for the model 11
VarCorr(m_11)
sd.total <- sqrt(1.7892   ^2)
pred.full <- m_11 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full)[2]<-"prob"
levels(pred.full$LU)[2]<-"Secondary"
#add the model name
pred.full$model<-with(pred.full,"Original")
data.full<-pred.full
#add the model name
data.full$model<-with(data.full,"m_11")
data.m_11<-data.full



#2_2combine all the model-transfered result
data.model<-rbind(data.full.all,data.m_1,data.m_2,data.m_3,data.m_4,data.m_5,data.m_6,data.m_7,
                  data.m_8,data.m_9,data.m_10,data.m_11)
names(data.model)
#2_3claclate the mean and confidence interval 95%

#get the model result in our paper
model_result_paper<-data.model%>% filter(model=="Original")
library(dplyr)
model_result_cross<-data.model%>% filter(model!="Original") %>%group_by(LU) %>%
  dplyr::summarise(mean.prop= mean(prob, na.rm = TRUE),
            sd.prop= sd(prob, na.rm = TRUE),
            n.prop= n()) %>%
  mutate(se.prop= sd.prop/ sqrt(n.prop),
         lower.ci.prop= mean.prop- qt(1 - (0.05 / 2), n.prop- 1) * sd.prop,
         upper.ci.prop= mean.prop+ qt(1 - (0.05 / 2), n.prop- 1) * sd.prop)
model_result_last<-merge(model_result_paper[,c(1,2,3)],model_result_cross[,c(1:2,5:7)],by="LU",all.x=T)
```
###figure
```{r}
all<-ggplot(model_result_last , aes(LU , prob,color=LU))+
  geom_errorbar(aes(ymin = prob-SE , ymax = prob+SE) ,width=0.2, 
                position = position_dodge(width=.6))+
  scale_y_continuous(name="Alien proportions",
                     limits=c(0,1),breaks=seq(0,0.9,0.3))+
  geom_point(position = position_dodge(width=.6),size=3)+
  scale_color_manual(name='LU-types',
                     values = c("#2166AC","#4393C3","#92C5DE",
                                "#F4A582","red","#B2182B"),
                     label=c('Primary','Secondary','Plantation',
                             'Pasture','Cropland','Urban'))+
  annotate(geom="text", x=1, y=0.38, label="a",size=4,color="#2166AC")+
  annotate(geom="text", x=2, y=0.43, label="b",size=4,color="#4393C3")+
  annotate(geom="text", x=3, y=0.47, label="bc",size=4,color="#92C5DE")+
  annotate(geom="text", x=4, y=0.43, label="abc",size=4,color="#F4A582")+
  annotate(geom="text", x=5, y=0.47, label="c",size=4,color="red")+
  annotate(geom="text", x=6, y=0.49, label="bc",size=4,color="#B2182B")+
  guides(colour = guide_legend(nrow = 1),shape=guide_legend(nrow = 1))+
  theme_bw()+
  theme(panel.grid.major.x = element_blank() , 
        axis.ticks.length=unit(0.08,"inch"),
        panel.grid.major.y = element_line(size = 0.6 , colour = "grey90") ,
        panel.spacing = unit(0,"lines") , 
        axis.title.x = element_blank(),
        axis.title.y = element_text(size=13),
        axis.text.x = element_text(colour = "black",angle = 25, 
                                   size = 12,vjust = 0.6) ,
        axis.text.y = element_text(colour = "black",  size = 12),
        legend.position = "none")
all
#ggsave(all,filename = '.../all.tiff',width = 4.5,height = 3,dpi = 200)

all_sp_cross<-ggplot(model_result_last , aes(LU , mean.prop,color=LU))+
    geom_errorbar(aes(ymin = lower.ci.prop, ymax = upper.ci.prop) ,width=0.6, 
                position = position_dodge(width=.6),color="grey50")+
  geom_errorbar(aes(ymin = mean.prop-se.prop , ymax = mean.prop+se.prop) ,width=0.4, 
                position = position_dodge(width=.6))+
  scale_y_continuous(name="Alien proportions",
                     limits=c(0,1),breaks=seq(0,0.9,0.3))+
  geom_point(position = position_dodge(width=.6),size=3.5)+
  scale_shape_manual(name="LU-intensity",values=c(15, 17, 18))+
  scale_color_manual(name='LU-types',
                     values = c("#2166AC","#4393C3","#92C5DE",
                                "#F4A582","red","#B2182B"),
                     label=c('Primary','Secondary','Plantation',
                             'Pasture','Cropland','Urban'))+
  guides(color=FALSE)+
  theme_bw()+
  theme(panel.grid.major.x = element_blank() , 
        axis.ticks.length=unit(0.08,"inch"),
        panel.grid.major.y = element_line(size = 0.6 , colour = "grey90") ,
        panel.spacing = unit(0,"lines") , 
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_text(colour = "black",angle = 25, 
                                   size = 12,vjust = 0.6) ,
        axis.text.y = element_text(colour = "black",  size = 12),
        legend.title = element_text(face = 'bold'),
        legend.background = element_blank(),
        legend.box.background = element_blank(),
        legend.key = element_blank(),
        legend.direction =  "horizontal",legend.position = c(0.4,0.9)) 

all_sp_cross


#com<-cowplot::plot_grid(all_sp,all_sp_cross,ncol=2,align = 'hv')
#com
ggsave(all_sp_cross,filename = '.../fig2.bnew.tiff',compression='lzw', width = 3,height = 3.0,dpi=200)
```


###ant subset model
```{r}
names(db_alien)
###part1: run the model
db_alien_t<-db_alien[db_alien$taxa == "Ants",]
dplyr::count(db_alien_t,Biome)

library(glmmTMB)
m_paper <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS) , data = db_alien_t , family = beta_family)

#3) leaving one biome out and test the result
#1 excluding the assemblages from biome of #Deserts & Xeric Shrublands
db_alien_t_1<-db_alien_t[db_alien_t$Biome != "Deserts & Xeric Shrublands",]
m_1 <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS) , data = db_alien_t_1 , family = beta_family)

#2 excluding the assemblages from biome of #Mediterranean Forests, Woodlands & Scrub
db_alien_t_2<-db_alien_t[db_alien_t$Biome != "Mediterranean Forests, Woodlands & Scrub",]
m_2 <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS) , data = db_alien_t_2, family = beta_family)

#3 excluding the assemblages from biome of #Montane Grasslands & Shrublands
db_alien_t_3<-db_alien_t[db_alien_t$Biome != "Montane Grasslands & Shrublands",]
m_3 <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS) , data = db_alien_t_3, family = beta_family)

#4 excluding the assemblages from biome of #Temperate Broadleaf & Mixed Forests
db_alien_t_4<-db_alien_t[db_alien_t$Biome != "Temperate Broadleaf & Mixed Forests",]
m_4 <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS) , data = db_alien_t_4, family = beta_family)

#5 excluding the assemblages from biome of #Tropical & Subtropical Dry Broadleaf Forests
db_alien_t_5<-db_alien_t[db_alien_t$Biome != "Tropical & Subtropical Dry Broadleaf Forests",]
m_5 <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS) , data = db_alien_t_5, family = beta_family)

#6 excluding the assemblages from biome of #Tropical & Subtropical Grasslands, Savannas & Shrublands
db_alien_t_6<-db_alien_t[db_alien_t$Biome != "Tropical & Subtropical Grasslands, Savannas & Shrublands",]
m_6 <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS) , data = db_alien_t_6, family = beta_family)

#7 excluding the assemblages from biome of #Tropical & Subtropical Moist Broadleaf Forests
db_alien_t_7<-db_alien_t[db_alien_t$Biome != "Tropical & Subtropical Moist Broadleaf Forests",]
m_7 <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS) , data = db_alien_t_7, family = beta_family)


###part2: model backtransfomration
# calculate combined effect for several random effects
VarCorr(m_paper)
sd.total <- sqrt(1.432  ^2)
# predict only LU (i.e. averaged over LUI, possible since no interactions)
pred.full <- m_paper %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full)[2]<-c("Prop")
levels(pred.full$LU)[1:2]<-c("Primary","Secondary")
pred.full$model<-with(pred.full,"Original")
pred.full_ant<-pred.full

# for m_1
VarCorr(m_1)
sd.total <- sqrt(1.4719^2)
# predict only LU (i.e. averaged over LUI, possible since no interactions)
pred.full_m_1 <- m_1 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full_m_1)[2]<-c("Prop")
levels(pred.full_m_1$LU)[1:2]<-c("Primary","Secondary")
pred.full_m_1$model<-with(pred.full_m_1,"m_1")

# for m_2
VarCorr(m_2)
sd.total <- sqrt(1.5756 ^2)
# predict only LU (i.e. averaged over LUI, possible since no interactions)
pred.full_m_2 <- m_2 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full_m_2)[2]<-c("Prop")
levels(pred.full_m_2$LU)[1:2]<-c("Primary","Secondary")
pred.full_m_2$model<-with(pred.full_m_2,"m_2")

# for m_3
VarCorr(m_3)
sd.total <- sqrt(1.474 ^2)
# predict only LU (i.e. averaged over LUI, possible since no interactions)
pred.full_m_3 <- m_3 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full_m_3)[2]<-c("Prop")
levels(pred.full_m_3$LU)[1:2]<-c("Primary","Secondary")
pred.full_m_3$model<-with(pred.full_m_3,"m_3")

# for m_4
VarCorr(m_4)
sd.total <- sqrt(1.8383^2)
# predict only LU (i.e. averaged over LUI, possible since no interactions)
pred.full_m_4 <- m_4 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full_m_4)[2]<-c("Prop")
levels(pred.full_m_4$LU)[1:2]<-c("Primary","Secondary")
pred.full_m_4$model<-with(pred.full_m_4,"m_4")

# for m_5
VarCorr(m_5)
sd.total <- sqrt(1.3662 ^2)
# predict only LU (i.e. averaged over LUI, possible since no interactions)
pred.full_m_5 <- m_5 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full_m_5)[2]<-c("Prop")
levels(pred.full_m_5$LU)[1:2]<-c("Primary","Secondary")
pred.full_m_5$model<-with(pred.full_m_5,"m_5")

# for m_6
VarCorr(m_6)
sd.total <- sqrt(1.4336^2)
# predict only LU (i.e. averaged over LUI, possible since no interactions)
pred.full_m_6 <- m_6 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full_m_6)[2]<-c("Prop")
levels(pred.full_m_6$LU)[1:2]<-c("Primary","Secondary")
pred.full_m_6$model<-with(pred.full_m_6,"m_6")

# for m_7
VarCorr(m_7)
sd.total <- sqrt(0.55749 ^2)
# predict only LU (i.e. averaged over LUI, possible since no interactions)
pred.full_m_7 <- m_7 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full_m_7)[2]<-c("Prop")
levels(pred.full_m_7$LU)[1:2]<-c("Primary","Secondary")
pred.full_m_7$model<-with(pred.full_m_7,"m_7")

#2_2combine all the model-transfered result
pred.full_model<-rbind(pred.full_ant,pred.full_m_1,pred.full_m_2,pred.full_m_3,pred.full_m_4,pred.full_m_5,
                       pred.full_m_6,pred.full_m_7)
names(pred.full_model)
#2_3claclate the mean and confidence interval 95%

#get the model result in our paper
model_result_paper<-pred.full_model%>% filter(model=="Original")
library(dplyr)
model_result_cross<-pred.full_model%>% filter(model!="Original") %>%group_by(LU)%>%
  dplyr::summarise(mean.prop = mean(Prop, na.rm = TRUE),
            sd.prop = sd(Prop, na.rm = TRUE),
            n.prop = n()) %>%
  mutate(se.prop = sd.prop / sqrt(n.prop),
         lower.ci.prop = mean.prop - qt(1 - (0.05 / 2), n.prop - 1) * se.prop,
         upper.ci.prop = mean.prop + qt(1 - (0.05 / 2), n.prop - 1) * se.prop)
model_result_alien_prop<-merge(model_result_paper[,c(1:3)],model_result_cross[,c(1:2,5:7)],by="LU",all.x=T)
model_result_alien_prop$taxa<-with(model_result_alien_prop,"Ants")
model_result_alien_prop_ants<-model_result_alien_prop
```
###birds subset model
```{r}
names(db_alien)
###part1: run the model
db_alien_t<-db_alien[db_alien$taxa == "Birds",]
dplyr::count(db_alien_t,Biome)

library(glmmTMB)
m_paper <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS/SSB) , data = db_alien_t , family = beta_family)

#3) leaving one biome out and test the result
#1 excluding the assemblages from biome of #Mediterranean Forests, Woodlands & Scrub
db_alien_t_1<-db_alien_t[db_alien_t$Biome != "Mediterranean Forests, Woodlands & Scrub",]
m_1 <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS/SSB) , data = db_alien_t_1 , family = beta_family)

#2 excluding the assemblages from biome of #Temperate Broadleaf & Mixed Forests
db_alien_t_2<-db_alien_t[db_alien_t$Biome != "Temperate Broadleaf & Mixed Forests",]
m_2 <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS/SSB) , data = db_alien_t_2, family = beta_family)

#3 excluding the assemblages from biome of #Temperate Grasslands, Savannas & Shrublands
db_alien_t_3<-db_alien_t[db_alien_t$Biome != "Temperate Grasslands, Savannas & Shrublands",]
m_3 <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS/SSB) , data = db_alien_t_3, family = beta_family)

#4 excluding the assemblages from biome of #Tropical & Subtropical Dry Broadleaf Forests
db_alien_t_4<-db_alien_t[db_alien_t$Biome != "Tropical & Subtropical Dry Broadleaf Forests",]
m_4 <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS/SSB) , data = db_alien_t_4, family = beta_family)

#5 excluding the assemblages from biome of #Tropical & Subtropical Moist Broadleaf Forests
db_alien_t_5<-db_alien_t[db_alien_t$Biome != "Tropical & Subtropical Moist Broadleaf Forests",]
m_5 <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS/SSB) , data = db_alien_t_5, family = beta_family)



###part2: model backtransfomration
# calculate combined effect for several random effects
VarCorr(m_paper)
sd.total <- sqrt(0.14103  ^2+0.95390  ^2)
# predict only LU (i.e. averaged over LUI, possible since no interactions)
pred.full <- m_paper %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full)[2]<-c("Prop")
levels(pred.full$LU)[1:2]<-c("Primary","Secondary")
pred.full$model<-with(pred.full,"Original")
pred.full<-pred.full

# for m_1
VarCorr(m_1)
sd.total <- sqrt(0.14088^2+0.97436^2)
# predict only LU (i.e. averaged over LUI, possible since no interactions)
pred.full_m_1 <- m_1 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full_m_1)[2]<-c("Prop")
levels(pred.full_m_1$LU)[1:2]<-c("Primary","Secondary")
pred.full_m_1$model<-with(pred.full_m_1,"m_1")

# for m_2
VarCorr(m_2)
sd.total <- sqrt(0.19447  ^2+1.07580  ^2)
# predict only LU (i.e. averaged over LUI, possible since no interactions)
pred.full_m_2 <- m_2 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full_m_2)[2]<-c("Prop")
levels(pred.full_m_2$LU)[1:2]<-c("Primary","Secondary")
pred.full_m_2$model<-with(pred.full_m_2,"m_2")

# for m_3
VarCorr(m_3)
sd.total <- sqrt(3.1818e-05^2+6.3079e-01^2)
# predict only LU (i.e. averaged over LUI, possible since no interactions)
pred.full_m_3 <- m_3 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full_m_3)[2]<-c("Prop")
levels(pred.full_m_3$LU)[1:2]<-c("Primary","Secondary")
pred.full_m_3$model<-with(pred.full_m_3,"m_3")

# for m_4
VarCorr(m_4)
sd.total <- sqrt(0.14170^2+0.97011^2)
# predict only LU (i.e. averaged over LUI, possible since no interactions)
pred.full_m_4 <- m_4 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full_m_4)[2]<-c("Prop")
levels(pred.full_m_4$LU)[1:2]<-c("Primary","Secondary")
pred.full_m_4$model<-with(pred.full_m_4,"m_4")

# for m_5
VarCorr(m_5)
sd.total <- sqrt(0.16537^2+1.09516^2)
# predict only LU (i.e. averaged over LUI, possible since no interactions)
pred.full_m_5 <- m_5 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full_m_5)[2]<-c("Prop")
levels(pred.full_m_5$LU)[1:2]<-c("Primary","Secondary")
pred.full_m_5$model<-with(pred.full_m_5,"m_5")


#2_2combine all the model-transfered result
pred.full_model<-rbind(pred.full,pred.full_m_1,pred.full_m_2,pred.full_m_3,pred.full_m_4,pred.full_m_5)
names(pred.full_model)
#2_3claclate the mean and confidence interval 95%

#get the model result in our paper
model_result_paper<-pred.full_model%>% filter(model=="Original")
library(dplyr)
model_result_cross<-pred.full_model%>% filter(model!="Original") %>%group_by(LU)%>%
  dplyr::summarise(mean.prop = mean(Prop, na.rm = TRUE),
            sd.prop = sd(Prop, na.rm = TRUE),
            n.prop = n()) %>%
  mutate(se.prop = sd.prop / sqrt(n.prop),
         lower.ci.prop = mean.prop - qt(1 - (0.05 / 2), n.prop - 1) * se.prop,
         upper.ci.prop = mean.prop + qt(1 - (0.05 / 2), n.prop - 1) * se.prop)
model_result_alien_prop<-merge(model_result_paper[,c(1:3)],model_result_cross[,c(1:2,5:7)],by="LU",all.x=T)
model_result_alien_prop$taxa<-with(model_result_alien_prop,"Birds")
model_result_alien_prop_birds<-model_result_alien_prop
```

###mammal subset model
```{r}
names(db_alien)
###part1: run the model
db_alien_t<-db_alien[db_alien$taxa == "Mammals",]
db_alien_t<-db_alien_t[db_alien_t$LU!="Cropland",]
dplyr::count(db_alien_t,Biome)

library(glmmTMB)
m_paper <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS) , data = db_alien_t , family = beta_family)

#3) leaving one biome out and test the result
#1 excluding the assemblages from biome of #Boreal Forests/Taiga
db_alien_t_1<-db_alien_t[db_alien_t$Biome != "Boreal Forests/Taiga",]
m_1 <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS) , data = db_alien_t_1 , family = beta_family)

#2 excluding the assemblages from biome of #Deserts & Xeric Shrublands
db_alien_t_2<-db_alien_t[db_alien_t$Biome != "Deserts & Xeric Shrublands",]
m_2 <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS) , data = db_alien_t_2, family = beta_family)

#3 excluding the assemblages from biome of #Mediterranean Forests, Woodlands & Scrub
db_alien_t_3<-db_alien_t[db_alien_t$Biome != "Mediterranean Forests, Woodlands & Scrub",]
m_3 <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS) , data = db_alien_t_3, family = beta_family)

#4 excluding the assemblages from biome of #Temperate Broadleaf & Mixed Forests
db_alien_t_4<-db_alien_t[db_alien_t$Biome != "Temperate Broadleaf & Mixed Forests",]
m_4 <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS) , data = db_alien_t_4, family = beta_family)

#5 excluding the assemblages from biome of #Temperate Grasslands, Savannas & Shrublands
db_alien_t_5<-db_alien_t[db_alien_t$Biome != "Temperate Grasslands, Savannas & Shrublands",]
m_5 <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS) , data = db_alien_t_5, family = beta_family)

#6 excluding the assemblages from biome of #Tropical & Subtropical Grasslands, Savannas & Shrublands
db_alien_t_6<-db_alien_t[db_alien_t$Biome != "Tropical & Subtropical Grasslands, Savannas & Shrublands",]
m_6 <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS) , data = db_alien_t_6, family = beta_family)

#7 excluding the assemblages from biome of #Tropical & Subtropical Moist Broadleaf Forests
db_alien_t_7<-db_alien_t[db_alien_t$Biome != "Tropical & Subtropical Moist Broadleaf Forests",]
m_7 <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS) , data = db_alien_t_7, family = beta_family)


###part2: model backtransfomration
# calculate combined effect for several random effects
VarCorr(m_paper)
sd.total <- sqrt(1.073  ^2)
# predict only LU (i.e. averaged over LUI, possible since no interactions)
pred.full <- m_paper %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full)[2]<-c("Prop")
levels(pred.full$LU)[1:2]<-c("Primary","Secondary")
pred.full$model<-with(pred.full,"Original")
pred.full<-pred.full

# for m_1
VarCorr(m_1)
sd.total <- sqrt(0.97085 ^2)
# predict only LU (i.e. averaged over LUI, possible since no interactions)
pred.full_m_1 <- m_1 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full_m_1)[2]<-c("Prop")
levels(pred.full_m_1$LU)[1:2]<-c("Primary","Secondary")
pred.full_m_1$model<-with(pred.full_m_1,"m_1")

# for m_2
VarCorr(m_2)
sd.total <- sqrt(1.0571  ^2)
# predict only LU (i.e. averaged over LUI, possible since no interactions)
pred.full_m_2 <- m_2 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full_m_2)[2]<-c("Prop")
levels(pred.full_m_2$LU)[1:2]<-c("Primary","Secondary")
pred.full_m_2$model<-with(pred.full_m_2,"m_2")

# for m_3
VarCorr(m_3)
sd.total <- sqrt(1.1443^2)
# predict only LU (i.e. averaged over LUI, possible since no interactions)
pred.full_m_3 <- m_3 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full_m_3)[2]<-c("Prop")
levels(pred.full_m_3$LU)[1:2]<-c("Primary","Secondary")
pred.full_m_3$model<-with(pred.full_m_3,"m_3")

# for m_4
VarCorr(m_4)
sd.total <- sqrt(1.3177 ^2)
# predict only LU (i.e. averaged over LUI, possible since no interactions)
pred.full_m_4 <- m_4 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full_m_4)[2]<-c("Prop")
levels(pred.full_m_4$LU)[1:2]<-c("Primary","Secondary")
pred.full_m_4$model<-with(pred.full_m_4,"m_4")

# for m_5
VarCorr(m_5)
sd.total <- sqrt(1.0636 ^2)
# predict only LU (i.e. averaged over LUI, possible since no interactions)
pred.full_m_5 <- m_5 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full_m_5)[2]<-c("Prop")
levels(pred.full_m_5$LU)[1:2]<-c("Primary","Secondary")
pred.full_m_5$model<-with(pred.full_m_5,"m_5")

# for m_6
VarCorr(m_6)
sd.total <- sqrt(1.0636 ^2)
# predict only LU (i.e. averaged over LUI, possible since no interactions)
pred.full_m_6 <- m_6 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full_m_6)[2]<-c("Prop")
levels(pred.full_m_6$LU)[1:2]<-c("Primary","Secondary")
pred.full_m_6$model<-with(pred.full_m_6,"m_6")

# for m_7
VarCorr(m_7)
sd.total <- sqrt(1.0636 ^2)
# predict only LU (i.e. averaged over LUI, possible since no interactions)
pred.full_m_7 <- m_7 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full_m_7)[2]<-c("Prop")
levels(pred.full_m_7$LU)[1:2]<-c("Primary","Secondary")
pred.full_m_7$model<-with(pred.full_m_7,"m_7")





#2_2combine all the model-transfered result
pred.full_model<-rbind(pred.full,pred.full_m_1,pred.full_m_2,pred.full_m_3,pred.full_m_4,pred.full_m_5,
                       pred.full_m_6,pred.full_m_7)
names(pred.full_model)
#2_3claclate the mean and confidence interval 95%

#get the model result in our paper
model_result_paper<-pred.full_model%>% filter(model=="Original")
library(dplyr)
model_result_cross<-pred.full_model%>% filter(model!="Original") %>%group_by(LU)%>%
  dplyr::summarise(mean.prop = mean(Prop, na.rm = TRUE),
            sd.prop = sd(Prop, na.rm = TRUE),
            n.prop = n()) %>%
  mutate(se.prop = sd.prop / sqrt(n.prop),
         lower.ci.prop = mean.prop - qt(1 - (0.05 / 2), n.prop - 1) * se.prop,
         upper.ci.prop = mean.prop + qt(1 - (0.05 / 2), n.prop - 1) * se.prop)
model_result_alien_prop<-merge(model_result_paper[,c(1:3)],model_result_cross[,c(1:2,5:7)],by="LU",all.x=T)
model_result_alien_prop$taxa<-with(model_result_alien_prop,"Mammals")
model_result_alien_prop_mam<-model_result_alien_prop
```
###spiders subset model
```{r}
names(db_alien)
###part1: run the model
db_alien_t<-db_alien[db_alien$taxa == "Spiders",]
dplyr::count(db_alien_t,Biome)

library(glmmTMB)
m_paper <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS) , data = db_alien_t , family = beta_family)

#3) leaving one biome out and test the result
#1 excluding the assemblages from biome of #Mediterranean Forests, Woodlands & Scrub
db_alien_t_1<-db_alien_t[db_alien_t$Biome != "Mediterranean Forests, Woodlands & Scrub",]
m_1 <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS) , data = db_alien_t_1 , family = beta_family)

#2 excluding the assemblages from biome of #Temperate Broadleaf & Mixed Forests
db_alien_t_2<-db_alien_t[db_alien_t$Biome != "Temperate Broadleaf & Mixed Forests",]
m_2 <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS) , data = db_alien_t_2, family = beta_family)

#3 excluding the assemblages from biome of #Temperate Grasslands, Savannas & Shrublands
db_alien_t_3<-db_alien_t[db_alien_t$Biome != "Temperate Grasslands, Savannas & Shrublands",]
m_3 <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS) , data = db_alien_t_3, family = beta_family)


###part2: model backtransfomration
# calculate combined effect for several random effects
VarCorr(m_paper)
sd.total <- sqrt(1.073  ^2)
# predict only LU (i.e. averaged over LUI, possible since no interactions)
pred.full <- m_paper %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full)[2]<-c("Prop")
levels(pred.full$LU)[1:2]<-c("Primary","Secondary")
pred.full$model<-with(pred.full,"Original")
pred.full<-pred.full

# for m_1
VarCorr(m_1)
sd.total <- sqrt(0.97085 ^2)
# predict only LU (i.e. averaged over LUI, possible since no interactions)
pred.full_m_1 <- m_1 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full_m_1)[2]<-c("Prop")
levels(pred.full_m_1$LU)[1:2]<-c("Primary","Secondary")
pred.full_m_1$model<-with(pred.full_m_1,"m_1")

# for m_2
VarCorr(m_2)
sd.total <- sqrt(1.0571  ^2)
# predict only LU (i.e. averaged over LUI, possible since no interactions)
pred.full_m_2 <- m_2 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full_m_2)[2]<-c("Prop")
levels(pred.full_m_2$LU)[1:2]<-c("Primary","Secondary")
pred.full_m_2$model<-with(pred.full_m_2,"m_2")

# for m_3
VarCorr(m_3)
sd.total <- sqrt(1.1443^2)
# predict only LU (i.e. averaged over LUI, possible since no interactions)
pred.full_m_3 <- m_3 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full_m_3)[2]<-c("Prop")
levels(pred.full_m_3$LU)[1:2]<-c("Primary","Secondary")
pred.full_m_3$model<-with(pred.full_m_3,"m_3")

#2_2combine all the model-transfered result
pred.full_model<-rbind(pred.full,pred.full_m_1,pred.full_m_2,pred.full_m_3)
names(pred.full_model)
#2_3claclate the mean and confidence interval 95%

#get the model result in our paper
model_result_paper<-pred.full_model%>% filter(model=="Original")
library(dplyr)
model_result_cross<-pred.full_model%>% filter(model!="Original") %>%group_by(LU)%>%
  dplyr::summarise(mean.prop = mean(Prop, na.rm = TRUE),
            sd.prop = sd(Prop, na.rm = TRUE),
            n.prop = n()) %>%
  mutate(se.prop = sd.prop / sqrt(n.prop),
         lower.ci.prop = mean.prop - qt(1 - (0.05 / 2), n.prop - 1) * se.prop,
         upper.ci.prop = mean.prop + qt(1 - (0.05 / 2), n.prop - 1) * se.prop)
model_result_alien_prop<-merge(model_result_paper[,c(1:3)],model_result_cross[,c(1:2,5:7)],by="LU",all.x=T)
model_result_alien_prop$taxa<-with(model_result_alien_prop,"Spiders")
model_result_alien_prop_spider<-model_result_alien_prop

#due to the spider only have three biomes, low sampling size, we therefore did not use the across validation.
```







```{r}
#there are 184 assemblages are belonging to boreal and tundra, merge into temperate
levels(db$Biome) <- c("Temperate", "Temperate","Tropic","Tropic",
                      "Tropic","Temperate","Temperate","Temperate",
                      "Temperate","Tropic","Tropic","Tropic",
                      "Tropic","Temperate")
#add the site is island or continents
levels(db$Country)
#add all of the continent
db$island_continent<-with(db,"continent")
#then revise them by checking
db$island_continent<-as.character(db$island_continent)
db$island_continent[db$Country == "Comoros"] <- "Island"
db$island_continent[db$Country == "Comoros"] <- "Island"
db$island_continent[db$Country == "Indonesia"] <- "Island"
db$island_continent[db$Country == "Ireland"] <- "Island"
db$island_continent[db$Country == "Japan"] <- "Island"
db$island_continent[db$Country == "Madagascar"] <- "Island"
db$island_continent[db$Country == "New Zealand"] <- "Island"

db$island_continent[db$Country == "Papua New Guinea"] <- "Island"
db$island_continent[db$Country == "Philippines"] <- "Island"
db$island_continent[db$Country == "Puerto Rico"] <- "Island"

db$island_continent[db$Country == "Sao Tome and Principe"] <- "Island"
db$island_continent[db$Country == "Solomon Islands"] <- "Island"
db$island_continent[db$Country == "Sri Lanka"] <- "Island"
db$island_continent[db$Country == "United Kingdom"] <- "Island"

#check the coutries which has data in the islands 
db$island_continent[db$Country == "United States"  & db$Longitude<(-150)] <- "Island"
db$island_continent[db$Country == "Malaysia"  & db$Longitude>(110)] <- "Island"

```
###plant subset model
```{r}
names(db_alien)
###part1: run the model
db_alien_t<-db_alien[db_alien$taxa == "Vascular plants",]
dplyr::count(db_alien_t,Biome)

library(glmmTMB)
m_paper <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS/SSB) , data = db_alien_t , family = beta_family)

#3) leaving one biome out and test the result
#1 excluding the aSS/SSBemblages from biome of #Boreal Forests/Taiga
db_alien_t_1<-db_alien_t[db_alien_t$Biome != "Boreal Forests/Taiga",]
m_1 <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS/SSB) , data = db_alien_t_1 , family = beta_family)

#2 excluding the aSS/SSBemblages from biome of #Deserts & Xeric Shrublands
db_alien_t_2<-db_alien_t[db_alien_t$Biome != "Deserts & Xeric Shrublands",]
m_2 <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS/SSB) , data = db_alien_t_2, family = beta_family)

#3 excluding the aSS/SSBemblages from biome of #Mediterranean Forests, Woodlands & Scrub
db_alien_t_3<-db_alien_t[db_alien_t$Biome != "Mediterranean Forests, Woodlands & Scrub",]
m_3 <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS/SSB) , data = db_alien_t_3, family = beta_family)

#4 excluding the aSS/SSBemblages from biome of #Montane Grasslands & Shrublands
db_alien_t_4<-db_alien_t[db_alien_t$Biome != "Montane Grasslands & Shrublands",]
m_4 <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS/SSB) , data = db_alien_t_4, family = beta_family)

#5 excluding the aSS/SSBemblages from biome of #Temperate Broadleaf & Mixed Forests
db_alien_t_5<-db_alien_t[db_alien_t$Biome != "Temperate Broadleaf & Mixed Forests",]
m_5 <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS/SSB) , data = db_alien_t_5, family = beta_family)

#6 excluding the aSS/SSBemblages from biome of #Temperate Conifer Forests
db_alien_t_6<-db_alien_t[db_alien_t$Biome != "Temperate Conifer Forests",]
m_6 <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS/SSB) , data = db_alien_t_6, family = beta_family)

#7 excluding the aSS/SSBemblages from biome of #Temperate GraSS/SSBlands, Savannas & Shrublands
db_alien_t_7<-db_alien_t[db_alien_t$Biome != "Temperate Grasslands, Savannas & Shrublands",]
m_7 <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS/SSB) , data = db_alien_t_7, family = beta_family)

#8 excluding the aSS/SSBemblages from biome of #Tropical & Subtropical Coniferous Forests
db_alien_t_8<-db_alien_t[db_alien_t$Biome != "Tropical & Subtropical Coniferous Forests",]
m_8 <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS/SSB) , data = db_alien_t_8, family = beta_family)

#9 excluding the aSS/SSBemblages from biome of #Tropical & Subtropical Dry Broadleaf Forests
db_alien_t_9<-db_alien_t[db_alien_t$Biome != "Tropical & Subtropical Dry Broadleaf Forests",]
m_9 <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS/SSB) , data = db_alien_t_9, family = beta_family)

#10 excluding the aSS/SSBemblages from biome of #Temperate Conifer Forests
db_alien_t_10<-db_alien_t[db_alien_t$Biome != "Temperate Conifer Forests",]
m_10 <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS/SSB) , data = db_alien_t_10, family = beta_family)

#11 excluding the aSS/SSBemblages from biome of #Tropical & Subtropical Moist Broadleaf Forests
db_alien_t_11<-db_alien_t[db_alien_t$Biome != "Tropical & Subtropical Moist Broadleaf Forests",]
m_11 <- glmmTMB(alien_prop_squeezed ~ LU + (1|SS/SSB) , data = db_alien_t_11, family = beta_family)



###part2: model backtransfomration
# calculate combined effect for several random effects
VarCorr(m_paper)
sd.total <- sqrt(0.26813  ^2+1.28556 ^2)
# predict only LU (i.e. averaged over LUI, possible since no interactions)
pred.full <- m_paper %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full)[2]<-c("Prop")
levels(pred.full$LU)[1:2]<-c("Primary","Secondary")
pred.full$model<-with(pred.full,"Original")
pred.full<-pred.full

# for m_1
VarCorr(m_1)
sd.total <- sqrt(0.26814   ^2+1.29716 ^2)
# predict only LU (i.e. averaged over LUI, possible since no interactions)
pred.full_m_1 <- m_1 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full_m_1)[2]<-c("Prop")
levels(pred.full_m_1$LU)[1:2]<-c("Primary","Secondary")
pred.full_m_1$model<-with(pred.full_m_1,"m_1")

# for m_2
VarCorr(m_2)
sd.total <- sqrt(0.26823  ^2+1.29483 ^2)
# predict only LU (i.e. averaged over LUI, possible since no interactions)
pred.full_m_2 <- m_2 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full_m_2)[2]<-c("Prop")
levels(pred.full_m_2$LU)[1:2]<-c("Primary","Secondary")
pred.full_m_2$model<-with(pred.full_m_2,"m_2")

# for m_3
VarCorr(m_3)
sd.total <- sqrt(0.26649^2+1.27955 ^2)
# predict only LU (i.e. averaged over LUI, possible since no interactions)
pred.full_m_3 <- m_3 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full_m_3)[2]<-c("Prop")
levels(pred.full_m_3$LU)[1:2]<-c("Primary","Secondary")
pred.full_m_3$model<-with(pred.full_m_3,"m_3")

# for m_4
VarCorr(m_4)
sd.total <- sqrt(0.26813  ^2+1.28556 ^2)
# predict only LU (i.e. averaged over LUI, possible since no interactions)
pred.full_m_4 <- m_4 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full_m_4)[2]<-c("Prop")
levels(pred.full_m_4$LU)[1:2]<-c("Primary","Secondary")
pred.full_m_4$model<-with(pred.full_m_4,"m_4")

# for m_5
VarCorr(m_5)
sd.total <- sqrt(0.25273  ^2+1.43684 ^2)
# predict only LU (i.e. averaged over LUI, possible since no interactions)
pred.full_m_5 <- m_5 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full_m_5)[2]<-c("Prop")
levels(pred.full_m_5$LU)[1:2]<-c("Primary","Secondary")
pred.full_m_5$model<-with(pred.full_m_5,"m_5")

# for m_6
VarCorr(m_6)
sd.total <- sqrt(0.26782 ^2+1.30511  ^2)
# predict only LU (i.e. averaged over LUI, possible since no interactions)
pred.full_m_6 <- m_6 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full_m_6)[2]<-c("Prop")
levels(pred.full_m_6$LU)[1:2]<-c("Primary","Secondary")
pred.full_m_6$model<-with(pred.full_m_6,"m_6")

# for m_7
VarCorr(m_7)
sd.total <- sqrt(0.26813  ^2+1.28556 ^2)
# predict only LU (i.e. averaged over LUI, possible since no interactions)
pred.full_m_7 <- m_7 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full_m_7)[2]<-c("Prop")
levels(pred.full_m_7$LU)[1:2]<-c("Primary","Secondary")
pred.full_m_7$model<-with(pred.full_m_7,"m_7")

# for m_8
VarCorr(m_8)
sd.total <- sqrt(0.26613  ^2+1.29731 ^2)
# predict only LU (i.e. averaged over LUI, possible since no interactions)
pred.full_m_8 <- m_8 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full_m_8)[2]<-c("Prop")
levels(pred.full_m_8$LU)[1:2]<-c("Primary","Secondary")
pred.full_m_8$model<-with(pred.full_m_8,"m_8")

# for m_9
VarCorr(m_9)
sd.total <- sqrt(0.26677  ^2+0.80712 ^2)
# predict only LU (i.e. averaged over LUI, possible since no interactions)
pred.full_m_9 <- m_9 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full_m_9)[2]<-c("Prop")
levels(pred.full_m_9$LU)[1:2]<-c("Primary","Secondary")
pred.full_m_9$model<-with(pred.full_m_9,"m_9")

# for m_10
VarCorr(m_10)
sd.total <- sqrt(0.26782   ^2+1.30511 ^2)
# predict only LU (i.e. averaged over LUI, possible since no interactions)
pred.full_m_10 <- m_10 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full_m_10)[2]<-c("Prop")
levels(pred.full_m_10$LU)[1:2]<-c("Primary","Secondary")
pred.full_m_10$model<-with(pred.full_m_10,"m_10")

# for m_11
VarCorr(m_11)
sd.total <- sqrt(0.27334   ^2+1.57417 ^2)
# predict only LU (i.e. averaged over LUI, possible since no interactions)
pred.full_m_11 <- m_11 %>% emmeans(specs = ~LU , type = "response") %>%
  cld(bias.adj = T , sigma = sd.total , sort = F , adjust = "bonferroni" , Letters = letters) %>% 
  as.data.frame()
names(pred.full_m_11)[2]<-c("Prop")
levels(pred.full_m_11$LU)[1:2]<-c("Primary","Secondary")
pred.full_m_11$model<-with(pred.full_m_11,"m_11")



#2_2combine all the model-transfered result
pred.full_model<-rbind(pred.full,pred.full_m_1,pred.full_m_2,pred.full_m_3,pred.full_m_4,pred.full_m_5,
                       pred.full_m_6,pred.full_m_7,pred.full_m_8,pred.full_m_9,pred.full_m_10,pred.full_m_11)
names(pred.full_model)
#2_3claclate the mean and confidence interval 95%

#get the model result in our paper
model_result_paper<-pred.full_model%>% filter(model=="Original")
library(dplyr)
model_result_cross<-pred.full_model%>% filter(model!="Original") %>%group_by(LU)%>%
  dplyr::summarise(mean.prop = mean(Prop, na.rm = TRUE),
            sd.prop = sd(Prop, na.rm = TRUE),
            n.prop = n()) %>%
  mutate(se.prop = sd.prop / sqrt(n.prop),
         lower.ci.prop = mean.prop - qt(1 - (0.05 / 2), n.prop - 1) * se.prop,
         upper.ci.prop = mean.prop + qt(1 - (0.05 / 2), n.prop - 1) * se.prop)
model_result_alien_prop<-merge(model_result_paper[,c(1:3)],model_result_cross[,c(1:2,5:7)],by="LU",all.x=T)
model_result_alien_prop$taxa<-with(model_result_alien_prop,"Vascular plants")
model_result_alien_prop_plant<-model_result_alien_prop
```

###combine five taxa
```{r}
# ants, birds and spiders
combine.cross<-rbind(model_result_alien_prop_ants,model_result_alien_prop_birds,model_result_alien_prop_mam,model_result_alien_prop_plant)
combine.cross$taxa<-as.factor(combine.cross$taxa)

combine.cross$LU<-
  factor(combine.cross$LU,c("Primary","Secondary","Plantation","Pasture","Cropland","Urban"))
all.taxa<-ggplot(combine.cross , aes(LU , mean.prop,color=taxa,shape=taxa))+
  geom_point(size=2.5,  position = position_dodge(0.6))+
  geom_errorbar(aes(ymin = lower.ci.prop, ymax = upper.ci.prop) ,width=0.6, 
                position = position_dodge(0.6),color="grey50")+
  geom_errorbar(aes(ymin = mean.prop-se.prop , ymax = mean.prop+se.prop) ,width=0.4, 
                position = position_dodge(0.6))+
  scale_y_continuous(name="Number of alien species",
                     limits=c(0,1),breaks=seq(0,0.9,0.3))+
  scale_shape_manual(name="Taxa",values=c(16,17,15,7), 
                     label=c('Ants','Birds',"Mammals",'Vascular plants'))+
  scale_color_manual(name='Taxa',
                     values = c("brown1","lightgoldenrod4","cyan2","magenta"),
                     label=c('Ants','Birds',"Mammals",'Vascular plants'))+
  guides(colour = guide_legend(nrow = 1),shape=guide_legend(nrow = 1))+
  theme_bw()+
  theme(panel.grid.major.x = element_blank() , 
        axis.ticks.length=unit(0.08,"inch"),
        panel.grid.major.y = element_line(size = 0.6 , colour = "grey90") ,
        panel.spacing = unit(0,"lines") , 
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_text(colour = "black",angle = 25, 
                                   size = 12,vjust = 0.6) ,
        axis.text.y = element_text(colour = "black",  size = 12),
        legend.title = element_text(face = 'bold'),
        legend.background = element_blank(),
        legend.box.background = element_blank(),
        legend.key = element_blank(),
        legend.direction =  "horizontal",legend.position = c(0.45,0.92)) 
all.taxa
ggsave(all.taxa,filename = '.../all.taxa.tiff',width = 6.0,height = 3,dpi = 200)
```

